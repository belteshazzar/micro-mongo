{"version":3,"file":"micro-mongo-1.1.3.umd.js","sources":["../src/ObjectId.js","../src/utils.js","../src/Cursor.js","../src/SortedCursor.js","../node_modules/stemmer/index.js","../src/TextIndex.js","../src/queryMatcher.js","../src/updates.js","../src/CollectionIndex.js","../src/RegularCollectionIndex.js","../src/TextCollectionIndex.js","../src/RTree.js","../src/GeospatialCollectionIndex.js","../src/QueryPlanner.js","../src/Collection.js","../src/StorageEngine.js","../src/ObjectStorageEngine.js","../src/DB.js","../src/MongoClient.js","../src/IndexedDbStorageEngine.js","../main.js"],"sourcesContent":["/**\r\n * ObjectId class - MongoDB-compatible 24-character hex string identifier\r\n * Format: 8-char timestamp + 16-char random data\r\n */\r\nexport class ObjectId {\r\n  constructor(id) {\r\n    if (id === undefined || id === null) {\r\n      // Generate new ObjectId\r\n      this.id = ObjectId.generate();\r\n    } else if (typeof id === 'string') {\r\n      // Create from hex string\r\n      if (!ObjectId.isValid(id)) {\r\n        throw new Error(`Argument passed in must be a string of 24 hex characters, got: ${id}`);\r\n      }\r\n      this.id = id.toLowerCase();\r\n    } else if (id instanceof ObjectId) {\r\n      // Copy constructor\r\n      this.id = id.id;\r\n    } else {\r\n      throw new Error(`Argument passed in must be a string of 24 hex characters or an ObjectId`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the ObjectId as a 24-character hex string\r\n   */\r\n  toString() {\r\n    return this.id;\r\n  }\r\n\r\n  /**\r\n   * Returns the ObjectId as a 24-character hex string (alias for toString)\r\n   */\r\n  toHexString() {\r\n    return this.id;\r\n  }\r\n\r\n  /**\r\n   * Returns the timestamp portion of the ObjectId as a Date\r\n   */\r\n  getTimestamp() {\r\n    const timestamp = parseInt(this.id.substring(0, 8), 16);\r\n    return new Date(timestamp * 1000);\r\n  }\r\n\r\n  /**\r\n   * Compares this ObjectId with another for equality\r\n   */\r\n  equals(other) {\r\n    if (!other) return false;\r\n    \r\n    if (other instanceof ObjectId) {\r\n      return this.id === other.id;\r\n    }\r\n    \r\n    if (typeof other === 'string') {\r\n      return this.id === other.toLowerCase();\r\n    }\r\n    \r\n    // Handle objects with id property\r\n    if (other.id) {\r\n      return this.id === other.id;\r\n    }\r\n    \r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Returns the ObjectId in JSON format (as hex string)\r\n   */\r\n  toJSON() {\r\n    return this.id;\r\n  }\r\n\r\n  /**\r\n   * Custom inspect for Node.js console.log\r\n   */\r\n  inspect() {\r\n    return `ObjectId(\"${this.id}\")`;\r\n  }\r\n\r\n  /**\r\n   * Validates if a string is a valid ObjectId hex string\r\n   */\r\n  static isValid(id) {\r\n    if (!id) return false;\r\n    if (typeof id !== 'string') return false;\r\n    if (id.length !== 24) return false;\r\n    return /^[0-9a-fA-F]{24}$/.test(id);\r\n  }\r\n\r\n  /**\r\n   * Creates an ObjectId from a timestamp\r\n   */\r\n  static createFromTime(timestamp) {\r\n    const ts = Math.floor(timestamp / 1000);\r\n    const tsHex = ('00000000' + ts.toString(16)).slice(-8);\r\n    const tail = '0000000000000000'; // Zero out the random portion\r\n    return new ObjectId(tsHex + tail);\r\n  }\r\n\r\n  /**\r\n   * Generates a new ObjectId hex string\r\n   * Format: 8-char timestamp (4 bytes) + 16-char random data (8 bytes)\r\n   */\r\n  static generate() {\r\n    const ts = Math.floor(Date.now() / 1000);\r\n    \r\n    // Generate 8 random bytes\r\n    const rand = typeof crypto !== 'undefined' && crypto.getRandomValues ? new Uint8Array(8) : null;\r\n    let tail = '';\r\n    \r\n    if (rand) {\r\n      crypto.getRandomValues(rand);\r\n      for (let i = 0; i < rand.length; i++) {\r\n        tail += ('0' + rand[i].toString(16)).slice(-2);\r\n      }\r\n    } else {\r\n      // Fallback for environments without crypto\r\n      // Generate two 8-character hex strings\r\n      tail = Math.random().toString(16).slice(2).padEnd(8, '0').slice(0, 8) +\r\n             Math.random().toString(16).slice(2).padEnd(8, '0').slice(0, 8);\r\n    }\r\n    \r\n    const tsHex = ('00000000' + ts.toString(16)).slice(-8);\r\n    return (tsHex + tail).slice(0, 24);\r\n  }\r\n}","/**\n * Utility functions for MicroMongoDB\n */\n\nimport { ObjectId } from './ObjectId.js';\n\n/**\n * Compare two values for equality, handling ObjectId instances\n */\nfunction valuesEqual(a, b) {\n\t// Handle ObjectId comparison\n\tif (a instanceof ObjectId || b instanceof ObjectId) {\n\t\tif (a instanceof ObjectId && b instanceof ObjectId) {\n\t\t\treturn a.equals(b);\n\t\t}\n\t\tif (a instanceof ObjectId && typeof b === 'string') {\n\t\t\treturn a.equals(b);\n\t\t}\n\t\tif (b instanceof ObjectId && typeof a === 'string') {\n\t\t\treturn b.equals(a);\n\t\t}\n\t\treturn false;\n\t}\n\t\n\t// Regular equality\n\treturn a == b;\n}\n\n/**\n * Deep copy an object or array\n */\nexport function copy(o) {\n\t// Handle ObjectId\n\tif (o instanceof ObjectId) {\n\t\treturn new ObjectId(o.id);\n\t}\n\t\n\tvar out, v, key;\n\tout = Array.isArray(o) ? [] : {};\n\tfor (key in o) {\n\t\tv = o[key];\n\t\tout[key] = (typeof v === \"object\" && v !== null) ? copy(v) : v;\n\t}\n\treturn out;\n}\n\n/**\n * Get a property from an object using dot notation\n */\nexport function getProp(obj, name) {\n\tvar path = name.split(\".\");\n\tvar result = obj[path[0]];\n\tfor (var i = 1; i < path.length; i++) {\n\t\tif (result == undefined || result == null) return result;\n\t\tresult = result[path[i]];\n\t}\n\treturn result;\n}\n\n/**\n * Check if value is an array\n */\nexport function isArray(o) {\n\treturn Array == o.constructor;\n}\n\n/**\n * Convert object to array of key-value pairs\n */\nexport function toArray(obj) {\n\tvar arr = [];\n\tfor (var key in obj) {\n\t\tif (obj.hasOwnProperty(key)) {\n\t\t\tvar el = {};\n\t\t\tel[key] = obj[key];\n\t\t\tarr.push(el);\n\t\t}\n\t}\n\treturn arr;\n}\n\n/**\n * Check if a value is in an array\n */\nexport function isIn(val, values) {\n\tfor (var i = 0; i < values.length; i++) {\n\t\tif (valuesEqual(values[i], val)) return true;\n\t}\n\treturn false;\n}\n\n/**\n * Check if two arrays match\n */\nexport function arrayMatches(x, y) {\n\tif (x.length != y.length) return false;\n\tfor (var i = 0; i < x.length; i++) {\n\t\tif (valuesEqual(x[i], y[i])) continue;\n\t\tif (typeof (x[i]) != typeof (y[i])) return false;\n\t\tif (typeof (x[i]) == \"object\" && x[i] !== null) {\n\t\t\tif (isArray(x[i])) {\n\t\t\t\tif (!arrayMatches(x[i], y[i])) return false;\n\t\t\t} else {\n\t\t\t\tif (!objectMatches(x[i], y[i])) return false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (!valuesEqual(x[i], y[i])) return false;\n\t\t}\n\t}\n\treturn true;\n}\n\n/**\n * Check if two objects match\n */\nexport function objectMatches(x, y) {\n\tfor (var p in x) {\n\t\tif (!x.hasOwnProperty(p)) continue;\n\t\tif (!y.hasOwnProperty(p)) return false;\n\t\tif (valuesEqual(x[p], y[p])) continue;\n\t\tif (typeof (x[p]) != typeof (y[p])) return false;\n\t\tif (typeof (x[p]) == \"object\" && x[p] !== null) {\n\t\t\tif (isArray(x[p])) {\n\t\t\t\tif (!arrayMatches(x[p], y[p])) return false;\n\t\t\t} else {\n\t\t\t\tif (!objectMatches(x[p], y[p])) return false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (!valuesEqual(x[p], y[p])) return false;\n\t\t}\n\t}\n\tfor (var p in y) {\n\t\tif (y.hasOwnProperty(p) && !x.hasOwnProperty(p)) return false;\n\t}\n\treturn true;\n}\n\n/**\n * Apply projection to a document\n */\nexport function applyProjection(projection, doc) {\n\tvar result = {};\n\tvar keys = Object.keys(projection);\n\tif (keys.length == 0) return doc;\n\t\n\t// Check for mixed inclusion/exclusion (except _id which can be excluded in inclusion projection)\n\tvar hasInclusion = false;\n\tvar hasExclusion = false;\n\tfor (var i = 0; i < keys.length; i++) {\n\t\tif (keys[i] === '_id') continue; // _id is special\n\t\tif (projection[keys[i]]) hasInclusion = true;\n\t\telse hasExclusion = true;\n\t}\n\t\n\tif (hasInclusion && hasExclusion) {\n\t\tthrow { $err: \"Can't canonicalize query: BadValue Projection cannot have a mix of inclusion and exclusion.\", code: 17287 };\n\t}\n\t\n\tif (projection[keys[0]] || hasInclusion) {\n\t\t// inclusion with _id (unless explicitly excluded)\n\t\tif (projection._id !== 0) {\n\t\t\tresult._id = doc._id;\n\t\t}\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\tif (keys[i] === '_id') continue;\n\t\t\tif (!projection[keys[i]]) continue;\n\t\t\tresult[keys[i]] = doc[keys[i]];\n\t\t}\n\t} else {\n\t\t// exclusion\n\t\tfor (var key in doc) {\n\t\t\tresult[key] = doc[key];\n\t\t}\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\tif (projection[keys[i]]) continue;\n\t\t\tdelete result[keys[i]];\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Convert bbox to GeoJSON\n */\nexport function bboxToGeojson(bbox) {\n\tconst minLon = bbox[0][0];\n\tconst maxLat = bbox[0][1];\n\tconst maxLon = bbox[1][0];\n\tconst minLat = bbox[1][1];\n\treturn {\n\t\ttype: 'FeatureCollection',\n\t\tfeatures: [{\n\t\t\ttype: 'Feature',\n\t\t\tproperties: {},\n\t\t\tgeometry: {\n\t\t\t\ttype: 'Polygon',\n\t\t\t\tcoordinates: [[\n\t\t\t\t\t[minLon, maxLat],\n\t\t\t\t\t[minLon, minLat],\n\t\t\t\t\t[maxLon, minLat],\n\t\t\t\t\t[maxLon, maxLat],\n\t\t\t\t\t[minLon, maxLat]\n\t\t\t\t]]\n\t\t\t}\n\t\t}]\n\t};\n}\n","import { applyProjection } from './utils.js';\n\n/**\n * Cursor class for iterating over query results\n */\nexport class Cursor {\n\tconstructor(collection, query, projection, matches, storage, indexes, planQuery, SortedCursor) {\n\t\tthis.collection = collection;\n\t\tthis.query = query;\n\t\tthis.projection = projection;\n\t\tthis.matches = matches;\n\t\tthis.storage = storage;\n\t\tthis.indexes = indexes;\n\t\tthis.planQuery = planQuery;\n\t\tthis.SortedCursor = SortedCursor;\n\t\t\n\t\t// Validate projection if provided\n\t\tif (projection && Object.keys(projection).length > 0) {\n\t\t\tconst keys = Object.keys(projection);\n\t\t\tlet hasInclusion = false;\n\t\t\tlet hasExclusion = false;\n\t\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\t\tif (keys[i] === '_id') continue; // _id is special\n\t\t\t\tif (projection[keys[i]]) hasInclusion = true;\n\t\t\t\telse hasExclusion = true;\n\t\t\t}\n\t\t\t\n\t\t\tif (hasInclusion && hasExclusion) {\n\t\t\t\tthrow { $err: \"Can't canonicalize query: BadValue Projection cannot have a mix of inclusion and exclusion.\", code: 17287 };\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.pos = 0;\n\t\tthis.max = 0;\n\t\tthis._next = false; // false == unknown, null == no more, !null == next\n\t\t\n\t\t// Query planning - check if we can use an index\n\t\tconst queryPlan = this.planQuery(this.query);\n\t\tthis.useIndex = queryPlan && queryPlan.useIndex;\n\t\tthis.planType = queryPlan ? queryPlan.planType : 'full_scan';\n\t\tthis.indexDocIds = null;\n\t\tthis.indexPos = 0;\n\t\tthis.fullScanDocIds = {}; // Track which docs we've seen to avoid duplicates\n\n\t\t// If using index, get the document IDs from the query plan\n\t\tif (this.useIndex && queryPlan.docIds) {\n\t\t\tthis.indexDocIds = queryPlan.docIds.slice();\n\t\t}\n\t\t\n\t\t// Initialize by finding first document\n\t\tthis._findNext();\n\t}\n\n\t_findNext() {\n\t\t// First, try to get documents from index\n\t\twhile (this.indexDocIds !== null && this.indexPos < this.indexDocIds.length) {\n\t\t\tconst docId = this.indexDocIds[this.indexPos++];\n\t\t\tconst doc = this.storage.getStore()[docId];\n\t\t\tif (doc && this.matches(doc, this.query)) {\n\t\t\t\tthis.fullScanDocIds[doc._id] = true;\n\t\t\t\tthis._next = doc;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// If doc doesn't match (shouldn't happen with good index), continue to next\n\t\t}\n\n\t\t// Then fall back to full scan for remaining documents\n\t\t// This handles complex queries where index only partially matches\n\t\twhile (this.pos < this.storage.size() && (this.max == 0 || this.pos < this.max)) {\n\t\t\tconst cur = this.storage.get(this.pos++);\n\t\t\t// Skip docs we already returned from index\n\t\t\tif (cur && !this.fullScanDocIds[cur._id] && this.matches(cur, this.query)) {\n\t\t\t\tthis.fullScanDocIds[cur._id] = true;\n\t\t\t\tthis._next = cur;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis._next = null;\n\t}\n\n\tbatchSize() { throw \"Not Implemented\"; }\n\tclose() { throw \"Not Implemented\"; }\n\tcomment() { throw \"Not Implemented\"; }\n\t\n\tcount() {\n\t\tlet num = 0;\n\t\tconst c = new Cursor(this.collection, this.query, null, this.matches, this.storage, this.indexes, this.planQuery, this.SortedCursor);\n\t\twhile (c.hasNext()) {\n\t\t\tnum++;\n\t\t\tc.next();\n\t\t}\n\t\treturn num;\n\t}\n\t\n\texplain() { throw \"Not Implemented\"; }\n\t\n\tasync forEach(fn) {\n\t\twhile (this.hasNext()) {\n\t\t\tawait fn(this.next());\n\t\t}\n\t}\n\t\n\thasNext() {\n\t\tif (this._next === false) this._findNext();\n\t\treturn this._next != null;\n\t}\n\t\n\thint() { throw \"Not Implemented\"; }\n\titcount() { throw \"Not Implemented\"; }\n\t\n\tlimit(_max) {\n\t\tthis.max = _max;\n\t\treturn this;\n\t}\n\t\n\tmap(fn) {\n\t\tconst results = [];\n\t\twhile (this.hasNext()) {\n\t\t\tresults.push(fn(this.next()));\n\t\t}\n\t\treturn results;\n\t}\n\t\n\tmaxScan() { throw \"Not Implemented\"; }\n\tmaxTimeMS() { throw \"Not Implemented\"; }\n\tmax() { throw \"Not Implemented\"; }\n\tmin() { throw \"Not Implemented\"; }\n\t\n\tnext() {\n\t\tif (this._next == null) throw \"Error: error hasNext: false\";\n\t\tconst result = this._next;\n\t\tthis._findNext();\n\t\tif (this.projection) return applyProjection(this.projection, result);\n\t\telse return result;\n\t}\n\t\n\tnoCursorTimeout() { throw \"Not Implemented\"; }\n\tobjsLeftInBatch() { throw \"Not Implemented\"; }\n\tpretty() { throw \"Not Implemented\"; }\n\treadConcern() { throw \"Not Implemented\"; }\n\treadPref() { throw \"Not Implemented\"; }\n\treturnKey() { throw \"Not Implemented\"; }\n\tshowRecordId() { throw \"Not Implemented\"; }\n\tsize() { throw \"Not Implemented\"; }\n\t\n\tskip(num) {\n\t\twhile (num > 0) {\n\t\t\tthis.next();\n\t\t\tnum--;\n\t\t}\n\t\treturn this;\n\t}\n\t\n\tsnapshot() { throw \"Not Implemented\"; }\n\t\n\tsort(s) {\n\t\treturn new this.SortedCursor(this.collection, this.query, this, s);\n\t}\n\t\n\ttailable() { throw \"Not Implemented\"; }\n\t\n\tasync toArray() {\n\t\tconst results = [];\n\t\twhile (this.hasNext()) {\n\t\t\tresults.push(this.next());\n\t\t}\n\t\treturn results;\n\t}\n\t\n\t// Support for async iteration (for await...of)\n\tasync *[Symbol.asyncIterator]() {\n\t\twhile (this.hasNext()) {\n\t\t\tyield this.next();\n\t\t}\n\t}\n}\n","/**\n * SortedCursor class for iterating over sorted query results\n */\nexport class SortedCursor {\n\tconstructor(collection, query, cursor, sort) {\n\t\tthis.collection = collection;\n\t\tthis.query = query;\n\t\tthis.sortSpec = sort;\n\t\tthis.pos = 0;\n\t\tthis.items = [];\n\t\t\n\t\t// Collect all items from the cursor\n\t\twhile (cursor.hasNext()) {\n\t\t\tthis.items.push(cursor.next());\n\t\t}\n\t\t\n\t\t// Sort the items\n\t\tconst sortKeys = Object.keys(sort);\n\t\tthis.items.sort(function(a, b) {\n\t\t\tfor (let i = 0; i < sortKeys.length; i++) {\n\t\t\t\tif (a[sortKeys[i]] == undefined && b[sortKeys[i]] != undefined) return -1 * sort[sortKeys[i]];\n\t\t\t\tif (a[sortKeys[i]] != undefined && b[sortKeys[i]] == undefined) return 1 * sort[sortKeys[i]];\n\t\t\t\tif (a[sortKeys[i]] < b[sortKeys[i]]) return -1 * sort[sortKeys[i]];\n\t\t\t\tif (a[sortKeys[i]] > b[sortKeys[i]]) return 1 * sort[sortKeys[i]];\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t}\n\n\tbatchSize() { throw \"Not Implemented\"; }\n\tclose() { throw \"Not Implemented\"; }\n\tcomment() { throw \"Not Implemented\"; }\n\t\n\tcount() {\n\t\treturn this.items.length;\n\t}\n\t\n\texplain() { throw \"Not Implemented\"; }\n\t\n\tasync forEach(fn) {\n\t\twhile (this.hasNext()) {\n\t\t\tawait fn(this.next());\n\t\t}\n\t}\n\t\n\thasNext() {\n\t\treturn this.pos < this.items.length;\n\t}\n\t\n\thint() { throw \"Not Implemented\"; }\n\titcount() { throw \"Not Implemented\"; }\n\t\n\tlimit(max) {\n\t\tthis.items = this.items.slice(0, max);\n\t\treturn this;\n\t}\n\t\n\tmap(fn) {\n\t\tconst results = [];\n\t\twhile (this.hasNext()) {\n\t\t\tresults.push(fn(this.next()));\n\t\t}\n\t\treturn results;\n\t}\n\t\n\tmaxScan() { throw \"Not Implemented\"; }\n\tmaxTimeMS() { throw \"Not Implemented\"; }\n\tmax() { throw \"Not Implemented\"; }\n\tmin() { throw \"Not Implemented\"; }\n\t\n\tnext() {\n\t\treturn this.items[this.pos++];\n\t}\n\t\n\tnoCursorTimeout() { throw \"Not Implemented\"; }\n\tobjsLeftInBatch() { throw \"Not Implemented\"; }\n\tpretty() { throw \"Not Implemented\"; }\n\treadConcern() { throw \"Not Implemented\"; }\n\treadPref() { throw \"Not Implemented\"; }\n\treturnKey() { throw \"Not Implemented\"; }\n\tshowRecordId() { throw \"Not Implemented\"; }\n\tsize() { throw \"Not Implemented\"; }\n\t\n\tskip(num) {\n\t\twhile (num > 0) {\n\t\t\tthis.next();\n\t\t\tnum--;\n\t\t}\n\t\treturn this;\n\t}\n\t\n\tsnapshot() { throw \"Not Implemented\"; }\n\t\n\tsort(s) {\n\t\treturn new SortedCursor(this.collection, this.query, this, s);\n\t}\n\t\n\ttailable() { throw \"Not Implemented\"; }\n\t\n\tasync toArray() {\n\t\tconst results = [];\n\t\twhile (this.hasNext()) {\n\t\t\tresults.push(this.next());\n\t\t}\n\t\treturn results;\n\t}\n\t\n\t// Support for async iteration (for await...of)\n\tasync *[Symbol.asyncIterator]() {\n\t\twhile (this.hasNext()) {\n\t\t\tyield this.next();\n\t\t}\n\t}\n}\n","// Standard suffix manipulations.\n/** @type {Record<string, string>} */\nconst step2list = {\n  ational: 'ate',\n  tional: 'tion',\n  enci: 'ence',\n  anci: 'ance',\n  izer: 'ize',\n  bli: 'ble',\n  alli: 'al',\n  entli: 'ent',\n  eli: 'e',\n  ousli: 'ous',\n  ization: 'ize',\n  ation: 'ate',\n  ator: 'ate',\n  alism: 'al',\n  iveness: 'ive',\n  fulness: 'ful',\n  ousness: 'ous',\n  aliti: 'al',\n  iviti: 'ive',\n  biliti: 'ble',\n  logi: 'log'\n}\n\n/** @type {Record<string, string>} */\nconst step3list = {\n  icate: 'ic',\n  ative: '',\n  alize: 'al',\n  iciti: 'ic',\n  ical: 'ic',\n  ful: '',\n  ness: ''\n}\n\n// Consonant-vowel sequences.\nconst consonant = '[^aeiou]'\nconst vowel = '[aeiouy]'\nconst consonants = '(' + consonant + '[^aeiouy]*)'\nconst vowels = '(' + vowel + '[aeiou]*)'\n\nconst gt0 = new RegExp('^' + consonants + '?' + vowels + consonants)\nconst eq1 = new RegExp(\n  '^' + consonants + '?' + vowels + consonants + vowels + '?$'\n)\nconst gt1 = new RegExp('^' + consonants + '?(' + vowels + consonants + '){2,}')\nconst vowelInStem = new RegExp('^' + consonants + '?' + vowel)\nconst consonantLike = new RegExp('^' + consonants + vowel + '[^aeiouwxy]$')\n\n// Exception expressions.\nconst sfxLl = /ll$/\nconst sfxE = /^(.+?)e$/\nconst sfxY = /^(.+?)y$/\nconst sfxIon = /^(.+?(s|t))(ion)$/\nconst sfxEdOrIng = /^(.+?)(ed|ing)$/\nconst sfxAtOrBlOrIz = /(at|bl|iz)$/\nconst sfxEED = /^(.+?)eed$/\nconst sfxS = /^.+?[^s]s$/\nconst sfxSsesOrIes = /^.+?(ss|i)es$/\nconst sfxMultiConsonantLike = /([^aeiouylsz])\\1$/\nconst step2 =\n  /^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/\nconst step3 = /^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/\nconst step4 =\n  /^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/\n\n/**\n * Get the stem from a given value.\n *\n * @param {string} value\n *   Value to stem.\n * @returns {string}\n *   Stem for `value`\n */\n// eslint-disable-next-line complexity\nexport function stemmer(value) {\n  let result = String(value).toLowerCase()\n\n  // Exit early.\n  if (result.length < 3) {\n    return result\n  }\n\n  /** @type {boolean} */\n  let firstCharacterWasLowerCaseY = false\n\n  // Detect initial `y`, make sure it never matches.\n  if (\n    result.codePointAt(0) === 121 // Lowercase Y\n  ) {\n    firstCharacterWasLowerCaseY = true\n    result = 'Y' + result.slice(1)\n  }\n\n  // Step 1a.\n  if (sfxSsesOrIes.test(result)) {\n    // Remove last two characters.\n    result = result.slice(0, -2)\n  } else if (sfxS.test(result)) {\n    // Remove last character.\n    result = result.slice(0, -1)\n  }\n\n  /** @type {RegExpMatchArray|null} */\n  let match\n\n  // Step 1b.\n  if ((match = sfxEED.exec(result))) {\n    if (gt0.test(match[1])) {\n      // Remove last character.\n      result = result.slice(0, -1)\n    }\n  } else if ((match = sfxEdOrIng.exec(result)) && vowelInStem.test(match[1])) {\n    result = match[1]\n\n    if (sfxAtOrBlOrIz.test(result)) {\n      // Append `e`.\n      result += 'e'\n    } else if (sfxMultiConsonantLike.test(result)) {\n      // Remove last character.\n      result = result.slice(0, -1)\n    } else if (consonantLike.test(result)) {\n      // Append `e`.\n      result += 'e'\n    }\n  }\n\n  // Step 1c.\n  if ((match = sfxY.exec(result)) && vowelInStem.test(match[1])) {\n    // Remove suffixing `y` and append `i`.\n    result = match[1] + 'i'\n  }\n\n  // Step 2.\n  if ((match = step2.exec(result)) && gt0.test(match[1])) {\n    result = match[1] + step2list[match[2]]\n  }\n\n  // Step 3.\n  if ((match = step3.exec(result)) && gt0.test(match[1])) {\n    result = match[1] + step3list[match[2]]\n  }\n\n  // Step 4.\n  if ((match = step4.exec(result))) {\n    if (gt1.test(match[1])) {\n      result = match[1]\n    }\n  } else if ((match = sfxIon.exec(result)) && gt1.test(match[1])) {\n    result = match[1]\n  }\n\n  // Step 5.\n  if (\n    (match = sfxE.exec(result)) &&\n    (gt1.test(match[1]) ||\n      (eq1.test(match[1]) && !consonantLike.test(match[1])))\n  ) {\n    result = match[1]\n  }\n\n  if (sfxLl.test(result) && gt1.test(result)) {\n    result = result.slice(0, -1)\n  }\n\n  // Turn initial `Y` back to `y`.\n  if (firstCharacterWasLowerCaseY) {\n    result = 'y' + result.slice(1)\n  }\n\n  return result\n}\n","import { stemmer } from 'stemmer';\n\n// Common English stop words that don't add semantic value to searches\nconst STOPWORDS = new Set([\n  'a', 'about', 'after', 'all', 'also', 'am', 'an', 'and', 'another', 'any', 'are', \n  'around', 'as', 'at', 'be', 'because', 'been', 'before', 'being', 'between', 'both', \n  'but', 'by', 'came', 'can', 'come', 'could', 'did', 'do', 'each', 'for', 'from', \n  'get', 'got', 'has', 'had', 'he', 'have', 'her', 'here', 'him', 'himself', 'his', \n  'how', 'i', 'if', 'in', 'into', 'is', 'it', 'like', 'make', 'many', 'me', 'might', \n  'more', 'most', 'much', 'must', 'my', 'never', 'now', 'of', 'on', 'only', 'or', \n  'other', 'our', 'out', 'over', 'said', 'same', 'see', 'should', 'since', 'some', \n  'still', 'such', 'take', 'than', 'that', 'the', 'their', 'them', 'then', 'there', \n  'these', 'they', 'this', 'those', 'through', 'to', 'too', 'under', 'up', 'very', \n  'was', 'way', 'we', 'well', 'were', 'what', 'where', 'which', 'while', 'who', \n  'with', 'would', 'you', 'your'\n]);\n\n/**\n * TextIndex - A text index implementation using Porter stemmer algorithm\n * \n * This class provides full-text search capabilities by indexing terms\n * and associating them with document IDs. It uses the Porter stemmer\n * algorithm to normalize words to their root forms.\n */\nexport class TextIndex {\n  constructor(options = {}) {\n    // Map from stemmed term to Map of document IDs to term frequency\n    // Structure: term -> { docId: frequency }\n    this.index = new Map();\n    // Map from document ID to Map of stemmed terms to their frequency\n    // Structure: docId -> { term: frequency }\n    this.documentTerms = new Map();\n    // Map from document ID to total term count (for normalization)\n    this.documentLengths = new Map();\n    // Stop words configuration\n    this.useStopWords = options.useStopWords !== false; // default: true\n    // Create a copy of STOPWORDS to avoid mutating the global set\n    this.stopWords = options.stopWords || new Set(STOPWORDS);\n  }\n\n  /**\n   * Tokenize text into individual words\n   * @param {string} text - The text to tokenize\n   * @returns {string[]} Array of words\n   */\n  _tokenize(text) {\n    if (typeof text !== 'string') {\n      return [];\n    }\n    // Split on non-word characters and filter out empty strings\n    const words = text.toLowerCase()\n      .split(/\\W+/)\n      .filter(word => word.length > 0);\n    \n    // Filter stop words if enabled\n    if (this.useStopWords) {\n      return words.filter(word => !this.stopWords.has(word));\n    }\n    \n    return words;\n  }\n\n  /**\n   * Add terms from text to the index for a given document ID\n   * @param {string} docId - The document identifier\n   * @param {string} text - The text content to index\n   */\n  add(docId, text) {\n    if (!docId) {\n      throw new Error('Document ID is required');\n    }\n\n    const words = this._tokenize(text);\n    const termFrequency = new Map();\n\n    // Count term frequencies\n    words.forEach(word => {\n      const stem = stemmer(word);\n      termFrequency.set(stem, (termFrequency.get(stem) || 0) + 1);\n    });\n\n    // Add to index\n    termFrequency.forEach((frequency, stem) => {\n      if (!this.index.has(stem)) {\n        this.index.set(stem, new Map());\n      }\n      this.index.get(stem).set(docId, frequency);\n    });\n\n    // Track document terms and frequencies\n    this.documentTerms.set(docId, termFrequency);\n    this.documentLengths.set(docId, words.length);\n  }\n\n  /**\n   * Remove all indexed terms for a given document ID\n   * @param {string} docId - The document identifier to remove\n   * @returns {boolean} True if document was found and removed, false otherwise\n   */\n  remove(docId) {\n    if (!this.documentTerms.has(docId)) {\n      return false;\n    }\n\n    // Get all terms associated with this document\n    const terms = this.documentTerms.get(docId);\n\n    // Remove document ID from each term's posting list\n    terms.forEach((frequency, term) => {\n      if (this.index.has(term)) {\n        this.index.get(term).delete(docId);\n        // Clean up empty term entries\n        if (this.index.get(term).size === 0) {\n          this.index.delete(term);\n        }\n      }\n    });\n\n    // Remove document from tracking\n    this.documentTerms.delete(docId);\n    this.documentLengths.delete(docId);\n    return true;\n  }\n\n  /**\n   * Query the index for documents containing the given terms with relevance scoring\n   * @param {string} queryText - The search query text\n   * @param {Object} options - Query options\n   * @param {boolean} options.scored - If true, return scored results; if false, return just IDs (default: true)\n   * @param {boolean} options.requireAll - If true, require ALL terms; if false, rank by relevance (default: false)\n   * @returns {Array} Array of document IDs (if scored=false) or objects with {id, score} (if scored=true)\n   */\n  query(queryText, options = { scored: true, requireAll: false }) {\n    const words = this._tokenize(queryText);\n    if (words.length === 0) {\n      return [];\n    }\n\n    // Get stemmed versions of query terms\n    const stemmedTerms = words.map(word => stemmer(word));\n    const uniqueTerms = [...new Set(stemmedTerms)];\n\n    if (options.requireAll) {\n      // Strict AND logic - document must contain ALL terms\n      const docSets = uniqueTerms.map(term => {\n        const termDocs = this.index.get(term);\n        return termDocs ? new Set(termDocs.keys()) : new Set();\n      });\n\n      if (docSets.length === 0) {\n        return [];\n      }\n\n      // Compute intersection of all document sets\n      const intersection = new Set(docSets[0]);\n      for (let i = 1; i < docSets.length; i++) {\n        for (const docId of intersection) {\n          if (!docSets[i].has(docId)) {\n            intersection.delete(docId);\n          }\n        }\n      }\n\n      return Array.from(intersection);\n    }\n\n    // Relevance-based scoring (OR logic with ranking)\n    // Calculate IDF (Inverse Document Frequency) for each term\n    const totalDocs = this.documentLengths.size;\n    const idf = new Map();\n    \n    uniqueTerms.forEach(term => {\n      const docsWithTerm = this.index.get(term)?.size || 0;\n      if (docsWithTerm > 0) {\n        // IDF = log(totalDocs / docsWithTerm)\n        idf.set(term, Math.log(totalDocs / docsWithTerm));\n      }\n    });\n\n    // Collect all documents that contain at least one query term\n    const docScores = new Map();\n\n    uniqueTerms.forEach(term => {\n      const termDocs = this.index.get(term);\n      if (!termDocs) return;\n\n      termDocs.forEach((termFreq, docId) => {\n        if (!docScores.has(docId)) {\n          docScores.set(docId, 0);\n        }\n\n        // Calculate TF-IDF score\n        // TF = term frequency in document / total terms in document\n        const docLength = this.documentLengths.get(docId) || 1;\n        const tf = termFreq / docLength;\n        \n        // Add to document's total score\n        const termIdf = idf.get(term) || 0;\n        const tfIdf = tf * termIdf;\n        \n        docScores.set(docId, docScores.get(docId) + tfIdf);\n      });\n    });\n\n    // Bonus for documents containing multiple query terms\n    docScores.forEach((score, docId) => {\n      const docTerms = this.documentTerms.get(docId);\n      if (docTerms) {\n        const matchingTerms = uniqueTerms.filter(term => docTerms.has(term)).length;\n        // Boost score based on term coverage (what % of query terms are present)\n        const coverage = matchingTerms / uniqueTerms.length;\n        docScores.set(docId, score * (1 + coverage));\n      }\n    });\n\n    // Sort by score (highest first)\n    const results = Array.from(docScores.entries())\n      .map(([id, score]) => ({ id, score }))\n      .sort((a, b) => b.score - a.score);\n\n    // Return based on options\n    if (options.scored === false) {\n      return results.map(r => r.id);\n    }\n    \n    return results;\n  }\n\n  /**\n   * Get the number of unique terms in the index\n   * @returns {number} Number of unique terms\n   */\n  getTermCount() {\n    return this.index.size;\n  }\n\n  /**\n   * Get the number of documents in the index\n   * @returns {number} Number of indexed documents\n   */\n  getDocumentCount() {\n    return this.documentTerms.size;\n  }\n\n  /**\n   * Clear all data from the index\n   */\n  clear() {\n    this.index.clear();\n    this.documentTerms.clear();\n    this.documentLengths.clear();\n  }\n\n  /**\n   * Add custom stop words\n   * @param {...string} words - Words to add to stop word list\n   * @returns {TextIndex} this for chaining\n   */\n  addStopWords(...words) {\n    words.forEach(word => this.stopWords.add(word.toLowerCase()));\n    return this;\n  }\n\n  /**\n   * Remove words from stop word list\n   * @param {...string} words - Words to remove from stop word list\n   * @returns {TextIndex} this for chaining\n   */\n  removeStopWords(...words) {\n    words.forEach(word => this.stopWords.delete(word.toLowerCase()));\n    return this;\n  }\n\n  /**\n   * Enable or disable stop word filtering\n   * @param {boolean} enabled - Whether to filter stop words\n   * @returns {TextIndex} this for chaining\n   */\n  setStopWordFiltering(enabled) {\n    this.useStopWords = enabled;\n    return this;\n  }\n\n  /**\n   * Serialize the text index state for storage\n   * @returns {Object} Serializable state\n   */\n  serialize() {\n    // Convert Maps to plain objects for JSON serialization\n    const indexObj = {};\n    this.index.forEach((docs, term) => {\n      const docsObj = {};\n      docs.forEach((freq, docId) => {\n        docsObj[docId] = freq;\n      });\n      indexObj[term] = docsObj;\n    });\n\n    const documentTermsObj = {};\n    this.documentTerms.forEach((terms, docId) => {\n      const termsObj = {};\n      terms.forEach((freq, term) => {\n        termsObj[term] = freq;\n      });\n      documentTermsObj[docId] = termsObj;\n    });\n\n    const documentLengthsObj = {};\n    this.documentLengths.forEach((length, docId) => {\n      documentLengthsObj[docId] = length;\n    });\n\n    return {\n      index: indexObj,\n      documentTerms: documentTermsObj,\n      documentLengths: documentLengthsObj,\n      useStopWords: this.useStopWords,\n      stopWords: Array.from(this.stopWords)\n    };\n  }\n\n  /**\n   * Restore the text index state from serialized data\n   * @param {Object} state - Serialized state\n   */\n  deserialize(state) {\n    // Restore index\n    this.index = new Map();\n    for (const term in state.index) {\n      const docs = new Map();\n      for (const docId in state.index[term]) {\n        docs.set(docId, state.index[term][docId]);\n      }\n      this.index.set(term, docs);\n    }\n\n    // Restore documentTerms\n    this.documentTerms = new Map();\n    for (const docId in state.documentTerms) {\n      const terms = new Map();\n      for (const term in state.documentTerms[docId]) {\n        terms.set(term, state.documentTerms[docId][term]);\n      }\n      this.documentTerms.set(docId, terms);\n    }\n\n    // Restore documentLengths\n    this.documentLengths = new Map();\n    for (const docId in state.documentLengths) {\n      this.documentLengths.set(docId, state.documentLengths[docId]);\n    }\n\n    // Restore settings\n    this.useStopWords = state.useStopWords !== false;\n    if (state.stopWords) {\n      this.stopWords = new Set(state.stopWords);\n    }\n  }\n}\n","import { getProp, isArray, arrayMatches, objectMatches, toArray, isIn, bboxToGeojson } from './utils.js';\nimport { TextIndex } from './TextIndex.js';\nimport { ObjectId } from './ObjectId.js';\n\n/**\n * Compare two values for equality, handling ObjectId instances\n */\nfunction valuesEqual(a, b) {\n\t// Handle ObjectId comparison\n\tif (a instanceof ObjectId || b instanceof ObjectId) {\n\t\tif (a instanceof ObjectId && b instanceof ObjectId) {\n\t\t\treturn a.equals(b);\n\t\t}\n\t\tif (a instanceof ObjectId && typeof b === 'string') {\n\t\t\treturn a.equals(b);\n\t\t}\n\t\tif (b instanceof ObjectId && typeof a === 'string') {\n\t\t\treturn b.equals(a);\n\t\t}\n\t\treturn false;\n\t}\n\t\n\t// Regular equality\n\treturn a == b;\n}\n\n/**\n * Compare two values with a comparison operator, handling ObjectId instances\n */\nfunction compareValues(a, b, operator) {\n\t// Convert ObjectIds to comparable values (use timestamp for ordering)\n\tlet aVal = a;\n\tlet bVal = b;\n\t\n\tif (a instanceof ObjectId) {\n\t\taVal = a.toString();\n\t}\n\tif (b instanceof ObjectId) {\n\t\tbVal = b.toString();\n\t}\n\t\n\tswitch(operator) {\n\t\tcase '>': return aVal > bVal;\n\t\tcase '>=': return aVal >= bVal;\n\t\tcase '<': return aVal < bVal;\n\t\tcase '<=': return aVal <= bVal;\n\t\tdefault: return false;\n\t}\n}\n\n/**\n * Text search helper\n * Creates a temporary TextIndex to check if the text matches the query\n */\nexport function text(prop, query) {\n\tconst textIndex = new TextIndex();\n\ttextIndex.add('id', prop);\n\tconst results = textIndex.query(query, { scored: false });\n\treturn results.length === 1;\n}\n\n/**\n * Geo within helper - using bounding box logic instead of de9im\n * This is a simpler implementation that doesn't require de9im dependency\n */\nexport function geoWithin(prop, query) {\n\ttry {\n\t\t// bbox format: [[minLon, maxLat], [maxLon, minLat]]\n\t\tif (!Array.isArray(query) || query.length !== 2) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst minLon = query[0][0];\n\t\tconst maxLat = query[0][1];\n\t\tconst maxLon = query[1][0];\n\t\tconst minLat = query[1][1];\n\n\t\t// Check if geometry is within bounding box\n\t\treturn isGeometryWithinBBox(prop, minLon, maxLon, minLat, maxLat);\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\n/**\n * Check if a GeoJSON geometry is within a bounding box\n * For Points: checks if the point is within the bbox\n * For Polygons: checks if ALL vertices are within the bbox\n */\nfunction isGeometryWithinBBox(geoJson, minLon, maxLon, minLat, maxLat) {\n\tif (!geoJson) return false;\n\n\t// Handle GeoJSON FeatureCollection\n\tif (geoJson.type === 'FeatureCollection' && geoJson.features && geoJson.features.length > 0) {\n\t\t// All features must be within the bbox\n\t\tfor (const feature of geoJson.features) {\n\t\t\tif (feature.geometry) {\n\t\t\t\tif (!isGeometryWithinBBox(feature.geometry, minLon, maxLon, minLat, maxLat)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t// Handle GeoJSON Feature\n\tif (geoJson.type === 'Feature' && geoJson.geometry) {\n\t\treturn isGeometryWithinBBox(geoJson.geometry, minLon, maxLon, minLat, maxLat);\n\t}\n\n\t// Handle GeoJSON Point\n\tif (geoJson.type === 'Point' && geoJson.coordinates) {\n\t\tconst [lng, lat] = geoJson.coordinates;\n\t\tif (typeof lng === 'number' && typeof lat === 'number') {\n\t\t\treturn lng >= minLon && lng <= maxLon && lat >= minLat && lat <= maxLat;\n\t\t}\n\t}\n\n\t// Handle GeoJSON Polygon - ALL vertices must be within the bbox\n\tif (geoJson.type === 'Polygon' && geoJson.coordinates && geoJson.coordinates.length > 0) {\n\t\tfor (const ring of geoJson.coordinates) {\n\t\t\tfor (const coord of ring) {\n\t\t\t\tconst lng = coord[0];\n\t\t\t\tconst lat = coord[1];\n\t\t\t\tif (lng < minLon || lng > maxLon || lat < minLat || lat > maxLat) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n/**\n * Extract coordinates from a GeoJSON object for indexing purposes\n * This uses centroid for polygons to get a single point to index\n * @param {Object} geoJson - The GeoJSON object\n * @returns {Object|null} Object with lat and lng, or null if invalid\n */\nfunction extractCoordinatesFromGeoJSON(geoJson) {\n\tif (!geoJson) return null;\n\n\t// Handle GeoJSON FeatureCollection\n\tif (geoJson.type === 'FeatureCollection' && geoJson.features && geoJson.features.length > 0) {\n\t\tconst feature = geoJson.features[0];\n\t\tif (feature.geometry) {\n\t\t\treturn extractCoordinatesFromGeoJSON(feature.geometry);\n\t\t}\n\t}\n\n\t// Handle GeoJSON Feature\n\tif (geoJson.type === 'Feature' && geoJson.geometry) {\n\t\treturn extractCoordinatesFromGeoJSON(geoJson.geometry);\n\t}\n\n\t// Handle GeoJSON Point\n\tif (geoJson.type === 'Point' && geoJson.coordinates) {\n\t\tconst [lng, lat] = geoJson.coordinates;\n\t\tif (typeof lng === 'number' && typeof lat === 'number') {\n\t\t\treturn { lat, lng };\n\t\t}\n\t}\n\n\t// Handle GeoJSON Polygon - use centroid of first coordinate ring\n\tif (geoJson.type === 'Polygon' && geoJson.coordinates && geoJson.coordinates.length > 0) {\n\t\tconst ring = geoJson.coordinates[0];\n\t\tif (ring.length > 0) {\n\t\t\tlet sumLat = 0, sumLng = 0;\n\t\t\tfor (const coord of ring) {\n\t\t\t\tsumLng += coord[0];\n\t\t\t\tsumLat += coord[1];\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tlat: sumLat / ring.length,\n\t\t\t\tlng: sumLng / ring.length\n\t\t\t};\n\t\t}\n\t}\n\n\treturn null;\n}\n\n/**\n * $where operator implementation\n * SECURITY NOTE: This uses Function constructor which can execute arbitrary code.\n * This is acceptable for a local/in-memory database but should NOT be used\n * in environments where untrusted user input is processed.\n */\nexport function where(doc, value) {\n\tif (typeof value === 'function') {\n\t\ttry {\n\t\t\treturn value.call(doc);\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t} else if (typeof value === 'string') {\n\t\t// Evaluate the string as a function\n\t\ttry {\n\t\t\tvar fn = new Function('return ' + value);\n\t\t\treturn fn.call(doc);\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn false;\n}\n\n/**\n * Top-level match function\n */\nexport function tlMatches(doc, query) {\n\tvar key = Object.keys(query)[0];\n\tvar value = query[key];\n\tif (key.charAt(0) == \"$\") {\n\t\tif (key == \"$and\") return and(doc, value);\n\t\telse if (key == \"$or\") return or(doc, value);\n\t\telse if (key == \"$not\") return not(doc, value);\n\t\telse if (key == \"$nor\") return nor(doc, value);\n\t\telse if (key == \"$where\") return where(doc, value);\n\t\telse throw { $err: \"Can't canonicalize query: BadValue unknown top level operator: \" + key, code: 17287 };\n\t} else {\n\t\treturn opMatches(doc, key, value);\n\t}\n}\n\n/**\n * Operator match function\n */\nexport function opMatches(doc, key, value) {\n\tif (typeof (value) == \"string\") return valuesEqual(getProp(doc, key), value);\n\telse if (typeof (value) == \"number\") return valuesEqual(getProp(doc, key), value);\n\telse if (typeof (value) == \"boolean\") return valuesEqual(getProp(doc, key), value);\n\telse if (value instanceof ObjectId) return valuesEqual(getProp(doc, key), value);\n\telse if (typeof (value) == \"object\") {\n\t\tif (value instanceof RegExp) return getProp(doc, key) && getProp(doc, key).match(value);\n\t\telse if (isArray(value)) return getProp(doc, key) && arrayMatches(getProp(doc, key), value);\n\t\telse {\n\t\t\tvar keys = Object.keys(value);\n\t\t\tif (keys[0].charAt(0) == \"$\") {\n\t\t\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\t\t\tvar operator = Object.keys(value)[i];\n\t\t\t\t\tvar operand = value[operator];\n\t\t\t\t\tif (operator == \"$eq\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || !valuesEqual(getProp(doc, key), operand)) return false;\n\t\t\t\t\t} else if (operator == \"$gt\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || !compareValues(getProp(doc, key), operand, '>')) return false;\n\t\t\t\t\t} else if (operator == \"$gte\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || !compareValues(getProp(doc, key), operand, '>=')) return false;\n\t\t\t\t\t} else if (operator == \"$lt\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || !compareValues(getProp(doc, key), operand, '<')) return false;\n\t\t\t\t\t} else if (operator == \"$lte\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || !compareValues(getProp(doc, key), operand, '<=')) return false;\n\t\t\t\t\t} else if (operator == \"$ne\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || !(!valuesEqual(getProp(doc, key), operand))) return false;\n\t\t\t\t\t} else if (operator == \"$in\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || !isIn(getProp(doc, key), operand)) return false;\n\t\t\t\t\t} else if (operator == \"$nin\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || isIn(getProp(doc, key), operand)) return false;\n\t\t\t\t\t} else if (operator == \"$exists\") {\n\t\t\t\t\t\tif (operand ? getProp(doc, key) == undefined : getProp(doc, key) != undefined) return false;\n\t\t\t\t\t} else if (operator == \"$type\") {\n\t\t\t\t\t\tif (typeof (getProp(doc, key)) != operand) return false;\n\t\t\t\t\t} else if (operator == \"$mod\") {\n\t\t\t\t\t\tif (operand.length != 2) throw { $err: \"Can't canonicalize query: BadValue malformed mod, not enough elements\", code: 17287 };\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || (getProp(doc, key) % operand[0] != operand[1])) return false;\n\t\t\t\t\t} else if (operator == \"$regex\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || !getProp(doc, key).match(operand)) return false;\n\t\t\t\t\t} else if (operator == \"$text\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || !text(getProp(doc, key), operand)) return false;\n\t\t\t\t\t} else if (operator == \"$geoWithin\") {\n\t\t\t\t\t\tif (getProp(doc, key) == undefined || !geoWithin(getProp(doc, key), operand)) return false;\n\t\t\t\t\t} else if (operator == \"$not\") {\n\t\t\t\t\t\tif (opMatches(doc, key, operand)) return false;\n\t\t\t\t\t} else if (operator == \"$all\") {\n\t\t\t\t\t\tvar fieldValue = getProp(doc, key);\n\t\t\t\t\t\tif (fieldValue == undefined || !isArray(fieldValue)) return false;\n\t\t\t\t\t\tfor (var j = 0; j < operand.length; j++) {\n\t\t\t\t\t\t\tif (!isIn(operand[j], fieldValue)) return false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (operator == \"$elemMatch\") {\n\t\t\t\t\t\tvar fieldValue = getProp(doc, key);\n\t\t\t\t\t\tif (fieldValue == undefined || !isArray(fieldValue)) return false;\n\t\t\t\t\t\tvar found = false;\n\t\t\t\t\t\tfor (var j = 0; j < fieldValue.length; j++) {\n\t\t\t\t\t\t\tvar element = fieldValue[j];\n\t\t\t\t\t\t\t// Check if element matches the query\n\t\t\t\t\t\t\tif (typeof element === 'object' && !isArray(element)) {\n\t\t\t\t\t\t\t\t// For objects, use matches\n\t\t\t\t\t\t\t\tif (matches(element, operand)) {\n\t\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// For primitive values, check operators directly\n\t\t\t\t\t\t\t\tvar matchesPrimitive = true;\n\t\t\t\t\t\t\t\tvar opKeys = Object.keys(operand);\n\t\t\t\t\t\t\t\tfor (var k = 0; k < opKeys.length; k++) {\n\t\t\t\t\t\t\t\t\tvar op = opKeys[k];\n\t\t\t\t\t\t\t\t\tvar opValue = operand[op];\n\t\t\t\t\t\t\t\t\tif (op == \"$gte\" && !(element >= opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$gt\" && !(element > opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$lte\" && !(element <= opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$lt\" && !(element < opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$eq\" && !(element == opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$ne\" && !(element != opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$in\" && !isIn(element, opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$nin\" && isIn(element, opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (matchesPrimitive) {\n\t\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!found) return false;\n\t\t\t\t\t} else if (operator == \"$size\") {\n\t\t\t\t\t\tvar fieldValue = getProp(doc, key);\n\t\t\t\t\t\tif (fieldValue == undefined || !isArray(fieldValue)) return false;\n\t\t\t\t\t\tif (fieldValue.length != operand) return false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow { $err: \"Can't canonicalize query: BadValue unknown operator: \" + operator, code: 17287 };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn getProp(doc, key) && objectMatches(getProp(doc, key), value);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * $not operator\n */\nexport function not(doc, value) {\n\treturn !tlMatches(doc, value);\n}\n\n/**\n * $and operator\n */\nexport function and(doc, els) {\n\tfor (var i = 0; i < els.length; i++) {\n\t\tif (!tlMatches(doc, els[i])) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\n/**\n * $or operator\n */\nexport function or(doc, els) {\n\tfor (var i = 0; i < els.length; i++) {\n\t\tif (tlMatches(doc, els[i])) return true;\n\t}\n\treturn false;\n}\n\n/**\n * $nor operator\n */\nexport function nor(doc, els) {\n\tfor (var i = 0; i < els.length; i++) {\n\t\tif (tlMatches(doc, els[i])) return false;\n\t}\n\treturn true;\n}\n\n/**\n * Main matches function - query structure: (top level operators ( \"age\" : (operators) ))\n * top, top level query, implicit $and\n */\nexport function matches(doc, query) {\n\treturn and(doc, toArray(query));\n}\n","/**\n * Update operations module\n */\n\n/**\n * Apply update operators to a document\n */\nexport function applyUpdates(updates, doc, setOnInsert) {\n\tvar keys = Object.keys(updates);\n\tfor (var i = 0; i < keys.length; i++) {\n\t\tvar key = keys[i];\n\t\tvar value = updates[key];\n\t\tif (key == \"$inc\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tvar field = fields[j];\n\t\t\t\tvar amount = value[field];\n\t\t\t\tdoc[field] = doc[field] + amount;\n\t\t\t}\n\t\t} else if (key == \"$mul\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tvar field = fields[j];\n\t\t\t\tvar amount = value[field];\n\t\t\t\tdoc[field] = doc[field] * amount;\n\t\t\t}\n\t\t} else if (key == \"$rename\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tvar field = fields[j];\n\t\t\t\tvar newName = value[field];\n\t\t\t\tdoc[newName] = doc[field];\n\t\t\t\tdelete doc[field];\n\t\t\t}\n\t\t} else if (key == \"$setOnInsert\" && setOnInsert) {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tdoc[fields[j]] = value[fields[j]];\n\t\t\t}\n\t\t} else if (key == \"$set\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tdoc[fields[j]] = value[fields[j]];\n\t\t\t}\n\t\t} else if (key == \"$unset\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tdelete doc[fields[j]];\n\t\t\t}\n\t\t} else if (key == \"$min\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tvar field = fields[j];\n\t\t\t\tvar amount = value[field];\n\t\t\t\tdoc[field] = Math.min(doc[field], amount);\n\t\t\t}\n\t\t} else if (key == \"$max\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tvar field = fields[j];\n\t\t\t\tvar amount = value[field];\n\t\t\t\tdoc[field] = Math.max(doc[field], amount);\n\t\t\t}\n\t\t} else if (key == \"$currentDate\") {  // TODO not the same as mongo\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tdoc[fields[j]] = new Date();\n\t\t\t}\n\t\t} else if (key == \"$addToSet\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tvar field = fields[j];\n\t\t\t\tvar value = value[field];\n\t\t\t\tdoc[field].push(value);\n\t\t\t}\n\t\t} else if (key == \"$pop\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tvar field = fields[j];\n\t\t\t\tvar value = value[field];\n\t\t\t\tif (value == 1) {\n\t\t\t\t\tdoc[field].pop();\n\t\t\t\t} else if (value == -1) {\n\t\t\t\t\tdoc[field].shift();\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (key == \"$pullAll\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tvar src = doc[fields[j]];\n\t\t\t\tvar toRemove = value[fields[j]];\n\t\t\t\tvar notRemoved = [];\n\t\t\t\tfor (var k = 0; k < src.length; k++) {\n\t\t\t\t\tvar removed = false;\n\t\t\t\t\tfor (var l = 0; l < toRemove.length; l++) {\n\t\t\t\t\t\tif (src[k] == toRemove[l]) {\n\t\t\t\t\t\t\tremoved = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!removed) notRemoved.push(src[k]);\n\t\t\t\t}\n\t\t\t\tdoc[fields[j]] = notRemoved;\n\t\t\t}\n\t\t} else if (key == \"$pushAll\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tvar field = fields[j];\n\t\t\t\tvar values = value[field];\n\t\t\t\tfor (var k = 0; k < values.length; k++) {\n\t\t\t\t\tdoc[field].push(values[k]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (key == \"$push\") {\n\t\t\tvar fields = Object.keys(value);\n\t\t\tfor (var j = 0; j < fields.length; j++) {\n\t\t\t\tvar field = fields[j];\n\t\t\t\tdoc[field].push(value[field]);\n\t\t\t}\n\t\t} else if (key == \"$bit\") {\n\t\t\tvar field = Object.keys(value)[0];\n\t\t\tvar operation = value[field];\n\t\t\tvar operator = Object.keys(operation)[0];\n\t\t\tvar operand = operation[operator];\n\t\t\tif (operator == \"and\") {\n\t\t\t\tdoc[field] = doc[field] & operand;\n\t\t\t} else if (operator == \"or\") {\n\t\t\t\tdoc[field] = doc[field] | operand;\n\t\t\t} else if (operator == \"xor\") {\n\t\t\t\tdoc[field] = doc[field] ^ operand;\n\t\t\t} else {\n\t\t\t\tthrow \"unknown $bit operator: \" + operator;\n\t\t\t}\n\t\t} else {\n\t\t\tthrow \"unknown update operator: \" + key;\n\t\t}\n\t}\n}\n\n/**\n * Create a new document from query and update operators for upsert\n */\nexport function createDocFromUpdate(query, updates, idGenerator) {\n\tvar newDoc = { _id: idGenerator() };\n\tvar onlyFields = true;\n\tvar updateKeys = Object.keys(updates);\n\tfor (var i = 0; i < updateKeys.length; i++) {\n\t\tif (updateKeys[i].charAt(0) == \"$\") {\n\t\t\tonlyFields = false;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (onlyFields) {\n\t\tfor (var i = 0; i < updateKeys.length; i++) {\n\t\t\tnewDoc[updateKeys[i]] = updates[updateKeys[i]];\n\t\t}\n\t} else {\n\t\tvar queryKeys = Object.keys(query);\n\t\tfor (var i = 0; i < queryKeys.length; i++) {\n\t\t\tnewDoc[queryKeys[i]] = query[queryKeys[i]];\n\t\t}\n\t\tapplyUpdates(updates, newDoc, true);\n\t}\n\treturn newDoc;\n}\n","/**\n * Base class for collection indexes\n * Provides a common interface for different types of indexes (e.g., regular, text, geo)\n */\nexport class CollectionIndex {\n\tconstructor(keys, options = {}) {\n\t\tthis.keys = keys;\n\t\tthis.options = options;\n\t\tthis.name = options.name || this.generateIndexName(keys);\n\t}\n\n\t/**\n\t * Generate index name from keys\n\t */\n\tgenerateIndexName(keys) {\n\t\tconst parts = [];\n\t\tfor (const field in keys) {\n\t\t\tif (keys.hasOwnProperty(field)) {\n\t\t\t\tparts.push(field + '_' + keys[field]);\n\t\t\t}\n\t\t}\n\t\treturn parts.join('_');\n\t}\n\n\t/**\n\t * Add a document to the index\n\t * @param {Object} doc - The document to index\n\t */\n\tadd(doc) {\n\t\tthrow new Error('add() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Remove a document from the index\n\t * @param {Object} doc - The document to remove\n\t */\n\tremove(doc) {\n\t\tthrow new Error('remove() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Update a document in the index (remove old, add new)\n\t * @param {Object} oldDoc - The old document\n\t * @param {Object} newDoc - The new document\n\t */\n\tupdate(oldDoc, newDoc) {\n\t\tthis.remove(oldDoc);\n\t\tthis.add(newDoc);\n\t}\n\n\t/**\n\t * Query the index\n\t * @param {*} query - The query to execute\n\t * @returns {Array} Array of document IDs or null if index cannot satisfy query\n\t */\n\tquery(query) {\n\t\tthrow new Error('query() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Clear all data from the index\n\t */\n\tclear() {\n\t\tthrow new Error('clear() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Get index specification (for getIndexes())\n\t */\n\tgetSpec() {\n\t\treturn {\n\t\t\tname: this.name,\n\t\t\tkey: this.keys\n\t\t};\n\t}\n\n\t/**\n\t * Serialize index state for storage\n\t * @returns {Object} Serializable index state\n\t */\n\tserialize() {\n\t\tthrow new Error('serialize() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Restore index state from serialized data\n\t * @param {Object} data - Serialized index state\n\t */\n\tdeserialize(data) {\n\t\tthrow new Error('deserialize() must be implemented by subclass');\n\t}\n}\n","import { CollectionIndex } from './CollectionIndex.js';\nimport { getProp } from './utils.js';\n\n/**\n * Regular (B-tree style) index implementation\n * Supports equality queries on indexed fields\n */\nexport class RegularCollectionIndex extends CollectionIndex {\n\tconstructor(keys, options = {}) {\n\t\tsuper(keys, options);\n\t\t// Map of key value to array of document _ids\n\t\tthis.data = {};\n\t}\n\n\t/**\n\t * Extract index key value from a document\n\t */\n\textractIndexKey(doc) {\n\t\tconst keyFields = Object.keys(this.keys);\n\t\tif (keyFields.length === 0) return null;\n\n\t\t// For simple single-field index\n\t\tif (keyFields.length === 1) {\n\t\t\tconst field = keyFields[0];\n\t\t\tconst value = getProp(doc, field);\n\t\t\tif (value === undefined) return null;\n\t\t\t// Preserve type information in the key\n\t\t\treturn JSON.stringify({ t: typeof value, v: value });\n\t\t}\n\n\t\t// For compound index, concatenate values with type preservation\n\t\tconst keyParts = [];\n\t\tfor (let i = 0; i < keyFields.length; i++) {\n\t\t\tconst value = getProp(doc, keyFields[i]);\n\t\t\tif (value === undefined) return null;\n\t\t\tkeyParts.push(JSON.stringify(value));\n\t\t}\n\t\t// Use a separator that won't appear in JSON\n\t\treturn keyParts.join('\\x00');\n\t}\n\n\t/**\n\t * Add a document to the index\n\t * @param {Object} doc - The document to index\n\t */\n\tadd(doc) {\n\t\tconst indexKey = this.extractIndexKey(doc);\n\t\tif (indexKey !== null) {\n\t\t\tif (!this.data[indexKey]) {\n\t\t\t\tthis.data[indexKey] = [];\n\t\t\t}\n\t\t\tthis.data[indexKey].push(doc._id);\n\t\t}\n\t}\n\n\t/**\n\t * Remove a document from the index\n\t * @param {Object} doc - The document to remove\n\t */\n\tremove(doc) {\n\t\tconst indexKey = this.extractIndexKey(doc);\n\t\tif (indexKey !== null && this.data[indexKey]) {\n\t\t\tconst arr = this.data[indexKey];\n\t\t\tconst idx = arr.indexOf(doc._id);\n\t\t\tif (idx !== -1) {\n\t\t\t\tarr.splice(idx, 1);\n\t\t\t}\n\t\t\tif (arr.length === 0) {\n\t\t\t\tdelete this.data[indexKey];\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Query the index\n\t * @param {*} query - The query object\n\t * @returns {Array|null} Array of document IDs or null if index cannot satisfy query\n\t */\n\tquery(query) {\n\t\tconst queryKeys = Object.keys(query);\n\t\tconst indexFields = Object.keys(this.keys);\n\n\t\t// Only support single-field index queries for now\n\t\tif (indexFields.length !== 1) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst field = indexFields[0];\n\t\t\n\t\t// Check if query has this field\n\t\tif (queryKeys.indexOf(field) === -1) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst queryValue = query[field];\n\n\t\t// Case 1: Simple equality\n\t\tif (typeof queryValue !== 'object' || queryValue === null) {\n\t\t\tconst indexKey = JSON.stringify({ t: typeof queryValue, v: queryValue });\n\t\t\treturn this.data[indexKey] || [];\n\t\t}\n\n\t\t// Case 2: Query with operators\n\t\tif (typeof queryValue === 'object' && !Array.isArray(queryValue)) {\n\t\t\treturn this._queryWithOperators(field, queryValue);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Query index with comparison operators\n\t * @private\n\t */\n\t_queryWithOperators(field, operators) {\n\t\tconst ops = Object.keys(operators);\n\t\tconst results = new Set();\n\n\t\t// Handle range queries: $gt, $gte, $lt, $lte\n\t\tconst hasRangeOp = ops.some(op => ['$gt', '$gte', '$lt', '$lte'].includes(op));\n\t\t\n\t\tif (hasRangeOp) {\n\t\t\t// Scan all entries and filter by range\n\t\t\tfor (const indexKey in this.data) {\n\t\t\t\ttry {\n\t\t\t\t\tconst parsed = JSON.parse(indexKey);\n\t\t\t\t\tconst value = parsed.v;\n\t\t\t\t\tconst type = parsed.t;\n\t\t\t\t\t\n\t\t\t\t\t// Check if value matches all operators\n\t\t\t\t\tlet matches = true;\n\t\t\t\t\tfor (const op of ops) {\n\t\t\t\t\t\tconst operand = operators[op];\n\t\t\t\t\t\tif (op === '$gt' && !(value > operand)) matches = false;\n\t\t\t\t\t\telse if (op === '$gte' && !(value >= operand)) matches = false;\n\t\t\t\t\t\telse if (op === '$lt' && !(value < operand)) matches = false;\n\t\t\t\t\t\telse if (op === '$lte' && !(value <= operand)) matches = false;\n\t\t\t\t\t\telse if (op === '$eq' && !(value === operand)) matches = false;\n\t\t\t\t\t\telse if (op === '$ne' && !(value !== operand)) matches = false;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t// Add all document IDs for this index entry\n\t\t\t\t\t\tthis.data[indexKey].forEach(id => results.add(id));\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// Skip malformed entries\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn Array.from(results);\n\t\t}\n\n\t\t// Handle $in operator\n\t\tif (ops.includes('$in')) {\n\t\t\tconst values = operators['$in'];\n\t\t\tif (Array.isArray(values)) {\n\t\t\t\tfor (const value of values) {\n\t\t\t\t\tconst indexKey = JSON.stringify({ t: typeof value, v: value });\n\t\t\t\t\tif (this.data[indexKey]) {\n\t\t\t\t\t\tthis.data[indexKey].forEach(id => results.add(id));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn Array.from(results);\n\t\t\t}\n\t\t}\n\n\t\t// Handle $eq operator\n\t\tif (ops.includes('$eq')) {\n\t\t\tconst value = operators['$eq'];\n\t\t\tconst indexKey = JSON.stringify({ t: typeof value, v: value });\n\t\t\treturn this.data[indexKey] || [];\n\t\t}\n\n\t\t// Handle $ne operator (requires full scan, not optimal)\n\t\tif (ops.includes('$ne')) {\n\t\t\tconst excludeValue = operators['$ne'];\n\t\t\tconst excludeKey = JSON.stringify({ t: typeof excludeValue, v: excludeValue });\n\t\t\tfor (const indexKey in this.data) {\n\t\t\t\tif (indexKey !== excludeKey) {\n\t\t\t\t\tthis.data[indexKey].forEach(id => results.add(id));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn Array.from(results);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Clear all data from the index\n\t */\n\tclear() {\n\t\tthis.data = {};\n\t}\n\n\t/**\n\t * Serialize index state for storage\n\t * @returns {Object} Serializable index state\n\t */\n\tserialize() {\n\t\treturn {\n\t\t\ttype: 'regular',\n\t\t\tkeys: this.keys,\n\t\t\toptions: this.options,\n\t\t\tdata: this.data\n\t\t};\n\t}\n\n\t/**\n\t * Restore index state from serialized data\n\t * @param {Object} state - Serialized index state\n\t */\n\tdeserialize(state) {\n\t\tthis.data = state.data || {};\n\t}\n}\n","import { CollectionIndex } from './CollectionIndex.js';\nimport { TextIndex } from './TextIndex.js';\nimport { getProp } from './utils.js';\n\n/**\n * Text index implementation using TextIndex\n * Supports full-text search on one or more fields\n */\nexport class TextCollectionIndex extends CollectionIndex {\n\tconstructor(keys, options = {}) {\n\t\tsuper(keys, options);\n\t\t// Create the underlying TextIndex\n\t\tthis.textIndex = new TextIndex(options);\n\t\t// Track which fields are indexed\n\t\tthis.indexedFields = [];\n\t\tfor (const field in keys) {\n\t\t\tif (keys[field] === 'text') {\n\t\t\t\tthis.indexedFields.push(field);\n\t\t\t}\n\t\t}\n\t\tif (this.indexedFields.length === 0) {\n\t\t\tthrow new Error('Text index must have at least one field with type \"text\"');\n\t\t}\n\t}\n\n\t/**\n\t * Extract text content from a document for the indexed fields\n\t * @param {Object} doc - The document\n\t * @returns {string} Combined text from all indexed fields\n\t */\n\t_extractText(doc) {\n\t\tconst textParts = [];\n\t\tfor (const field of this.indexedFields) {\n\t\t\tconst value = getProp(doc, field);\n\t\t\tif (value !== undefined && value !== null) {\n\t\t\t\ttextParts.push(String(value));\n\t\t\t}\n\t\t}\n\t\treturn textParts.join(' ');\n\t}\n\n\t/**\n\t * Add a document to the text index\n\t * @param {Object} doc - The document to index\n\t */\n\tadd(doc) {\n\t\tif (!doc._id) {\n\t\t\tthrow new Error('Document must have an _id field');\n\t\t}\n\t\tconst text = this._extractText(doc);\n\t\tif (text) {\n\t\t\tthis.textIndex.add(String(doc._id), text);\n\t\t}\n\t}\n\n\t/**\n\t * Remove a document from the text index\n\t * @param {Object} doc - The document to remove\n\t */\n\tremove(doc) {\n\t\tif (!doc._id) {\n\t\t\treturn;\n\t\t}\n\t\tthis.textIndex.remove(String(doc._id));\n\t}\n\n\t/**\n\t * Query the text index\n\t * @param {*} query - The query object\n\t * @returns {Array|null} Array of document IDs or null if query is not a text search\n\t */\n\tquery(query) {\n\t\t// This method is used for query planning\n\t\t// Text queries are handled separately in queryMatcher\n\t\treturn null;\n\t}\n\n\t/**\n\t * Search the text index\n\t * @param {string} searchText - The text to search for\n\t * @param {Object} options - Search options\n\t * @returns {Array} Array of document IDs\n\t */\n\tsearch(searchText, options = {}) {\n\t\tconst results = this.textIndex.query(searchText, { scored: false, ...options });\n\t\treturn results;\n\t}\n\n\t/**\n\t * Clear all data from the index\n\t */\n\tclear() {\n\t\tthis.textIndex.clear();\n\t}\n\n\t/**\n\t * Get index specification\n\t */\n\tgetSpec() {\n\t\treturn {\n\t\t\tname: this.name,\n\t\t\tkey: this.keys,\n\t\t\ttextIndexVersion: 3,\n\t\t\tweights: this._getWeights()\n\t\t};\n\t}\n\n\t/**\n\t * Get field weights (all default to 1 for now)\n\t */\n\t_getWeights() {\n\t\tconst weights = {};\n\t\tfor (const field of this.indexedFields) {\n\t\t\tweights[field] = 1;\n\t\t}\n\t\treturn weights;\n\t}\n\n\t/**\n\t * Serialize index state for storage\n\t * @returns {Object} Serializable index state\n\t */\n\tserialize() {\n\t\treturn {\n\t\t\ttype: 'text',\n\t\t\tkeys: this.keys,\n\t\t\toptions: this.options,\n\t\t\tindexedFields: this.indexedFields,\n\t\t\ttextIndexState: this.textIndex.serialize()\n\t\t};\n\t}\n\n\t/**\n\t * Restore index state from serialized data\n\t * @param {Object} state - Serialized index state\n\t */\n\tdeserialize(state) {\n\t\tthis.indexedFields = state.indexedFields || [];\n\t\tif (state.textIndexState) {\n\t\t\tthis.textIndex.deserialize(state.textIndexState);\n\t\t}\n\t}\n}\n","/**\n * R-tree implementation for geospatial indexing\n * \n * This implementation supports:\n * - Adding points with lat/lng coordinates\n * - Removing points\n * - Bounding box queries\n * - Location + radius queries (converted to bounding box)\n */\n\n/**\n * Calculate distance between two points using Haversine formula\n * @param {number} lat1 - Latitude of first point\n * @param {number} lng1 - Longitude of first point\n * @param {number} lat2 - Latitude of second point\n * @param {number} lng2 - Longitude of second point\n * @returns {number} Distance in kilometers\n */\nfunction haversineDistance(lat1, lng1, lat2, lng2) {\n\tconst R = 6371; // Earth's radius in kilometers\n\tconst dLat = (lat2 - lat1) * Math.PI / 180;\n\tconst dLng = (lng2 - lng1) * Math.PI / 180;\n\tconst a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n\t\tMath.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n\t\tMath.sin(dLng / 2) * Math.sin(dLng / 2);\n\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\treturn R * c;\n}\n\n/**\n * Convert radius query to bounding box\n * Approximation: 1 degree latitude  111 km\n * @param {number} lat - Center latitude\n * @param {number} lng - Center longitude\n * @param {number} radiusKm - Radius in kilometers\n * @returns {Object} Bounding box {minLat, maxLat, minLng, maxLng}\n */\nfunction radiusToBoundingBox(lat, lng, radiusKm) {\n\tconst latDelta = radiusKm / 111; // degrees\n\tconst lngDelta = radiusKm / (111 * Math.cos(lat * Math.PI / 180)); // degrees\n\t\n\treturn {\n\t\tminLat: lat - latDelta,\n\t\tmaxLat: lat + latDelta,\n\t\tminLng: lng - lngDelta,\n\t\tmaxLng: lng + lngDelta\n\t};\n}\n\n/**\n * Check if two bounding boxes intersect\n */\nfunction intersects(bbox1, bbox2) {\n\treturn !(bbox1.maxLat < bbox2.minLat ||\n\t\tbbox1.minLat > bbox2.maxLat ||\n\t\tbbox1.maxLng < bbox2.minLng ||\n\t\tbbox1.minLng > bbox2.maxLng);\n}\n\n/**\n * Check if bbox1 contains bbox2\n */\nfunction contains(bbox1, bbox2) {\n\treturn bbox1.minLat <= bbox2.minLat &&\n\t\tbbox1.maxLat >= bbox2.maxLat &&\n\t\tbbox1.minLng <= bbox2.minLng &&\n\t\tbbox1.maxLng >= bbox2.maxLng;\n}\n\n/**\n * Calculate the area of a bounding box\n */\nfunction area(bbox) {\n\treturn (bbox.maxLat - bbox.minLat) * (bbox.maxLng - bbox.minLng);\n}\n\n/**\n * Calculate the bounding box that contains both input boxes\n */\nfunction union(bbox1, bbox2) {\n\treturn {\n\t\tminLat: Math.min(bbox1.minLat, bbox2.minLat),\n\t\tmaxLat: Math.max(bbox1.maxLat, bbox2.maxLat),\n\t\tminLng: Math.min(bbox1.minLng, bbox2.minLng),\n\t\tmaxLng: Math.max(bbox1.maxLng, bbox2.maxLng)\n\t};\n}\n\n/**\n * Calculate the enlargement needed to include bbox2 in bbox1\n */\nfunction enlargement(bbox1, bbox2) {\n\tconst unionBox = union(bbox1, bbox2);\n\treturn area(unionBox) - area(bbox1);\n}\n\n/**\n * R-tree Node class\n */\nclass RTreeNode {\n\tconstructor(isLeaf = false) {\n\t\tthis.isLeaf = isLeaf;\n\t\tthis.children = []; // For internal nodes: child nodes; For leaf nodes: data entries\n\t\tthis.bbox = null;\n\t}\n\n\t/**\n\t * Update the bounding box to contain all children\n\t */\n\tupdateBBox() {\n\t\tif (this.children.length === 0) {\n\t\t\tthis.bbox = null;\n\t\t\treturn;\n\t\t}\n\n\t\tlet minLat = Infinity, maxLat = -Infinity;\n\t\tlet minLng = Infinity, maxLng = -Infinity;\n\n\t\tfor (const child of this.children) {\n\t\t\tconst bbox = child.bbox;\n\t\t\tminLat = Math.min(minLat, bbox.minLat);\n\t\t\tmaxLat = Math.max(maxLat, bbox.maxLat);\n\t\t\tminLng = Math.min(minLng, bbox.minLng);\n\t\t\tmaxLng = Math.max(maxLng, bbox.maxLng);\n\t\t}\n\n\t\tthis.bbox = { minLat, maxLat, minLng, maxLng };\n\t}\n}\n\n/**\n * R-tree implementation\n */\nexport class RTree {\n\tconstructor(maxEntries = 9) {\n\t\tthis.maxEntries = maxEntries;\n\t\tthis.minEntries = Math.max(2, Math.ceil(maxEntries / 2));\n\t\tthis.root = new RTreeNode(true);\n\t\tthis._size = 0; // Track size for O(1) queries\n\t}\n\n\t/**\n\t * Insert a point into the R-tree\n\t * @param {number} lat - Latitude\n\t * @param {number} lng - Longitude\n\t * @param {*} data - Associated data\n\t */\n\tinsert(lat, lng, data) {\n\t\t// Create a point bounding box (bbox with zero area)\n\t\tconst bbox = {\n\t\t\tminLat: lat,\n\t\t\tmaxLat: lat,\n\t\t\tminLng: lng,\n\t\t\tmaxLng: lng\n\t\t};\n\n\t\tconst entry = { bbox, lat, lng, data };\n\t\tthis._insert(entry, this.root, 1);\n\t\tthis._size++;\n\t}\n\n\t/**\n\t * Internal insert method\n\t */\n\t_insert(entry, node, level) {\n\t\tif (node.isLeaf) {\n\t\t\tnode.children.push(entry);\n\t\t\tnode.updateBBox();\n\n\t\t\tif (node.children.length > this.maxEntries) {\n\t\t\t\treturn this._split(node);\n\t\t\t}\n\t\t} else {\n\t\t\t// Choose subtree\n\t\t\tconst target = this._chooseSubtree(entry.bbox, node);\n\t\t\tconst splitNode = this._insert(entry, target, level + 1);\n\n\t\t\tif (splitNode) {\n\t\t\t\tnode.children.push(splitNode);\n\t\t\t\tnode.updateBBox();\n\n\t\t\t\tif (node.children.length > this.maxEntries) {\n\t\t\t\t\treturn this._split(node);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnode.updateBBox();\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * Choose the best subtree to insert an entry\n\t */\n\t_chooseSubtree(bbox, node) {\n\t\tlet minEnlargement = Infinity;\n\t\tlet minArea = Infinity;\n\t\tlet targetNode = null;\n\n\t\tfor (const child of node.children) {\n\t\t\tconst enl = enlargement(child.bbox, bbox);\n\t\t\tconst ar = area(child.bbox);\n\n\t\t\tif (enl < minEnlargement || (enl === minEnlargement && ar < minArea)) {\n\t\t\t\tminEnlargement = enl;\n\t\t\t\tminArea = ar;\n\t\t\t\ttargetNode = child;\n\t\t\t}\n\t\t}\n\n\t\treturn targetNode;\n\t}\n\n\t/**\n\t * Split an overflowing node\n\t */\n\t_split(node) {\n\t\t// Simple linear split algorithm\n\t\tconst children = node.children;\n\t\tconst isLeaf = node.isLeaf;\n\n\t\t// Find two seeds (most distant entries)\n\t\tlet maxDist = -Infinity;\n\t\tlet seed1Idx = 0, seed2Idx = 1;\n\n\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\tfor (let j = i + 1; j < children.length; j++) {\n\t\t\t\tconst bbox1 = children[i].bbox;\n\t\t\t\tconst bbox2 = children[j].bbox;\n\t\t\t\tconst combinedBox = union(bbox1, bbox2);\n\t\t\t\tconst waste = area(combinedBox) - area(bbox1) - area(bbox2);\n\t\t\t\t\n\t\t\t\tif (waste > maxDist) {\n\t\t\t\t\tmaxDist = waste;\n\t\t\t\t\tseed1Idx = i;\n\t\t\t\t\tseed2Idx = j;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Create two new nodes\n\t\tconst node1 = new RTreeNode(isLeaf);\n\t\tconst node2 = new RTreeNode(isLeaf);\n\n\t\tnode1.children.push(children[seed1Idx]);\n\t\tnode2.children.push(children[seed2Idx]);\n\n\t\t// Distribute remaining entries\n\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\tif (i === seed1Idx || i === seed2Idx) continue;\n\n\t\t\tconst child = children[i];\n\t\t\tconst bbox = child.bbox;\n\t\t\t\n\t\t\tconst enl1 = node1.children.length === 0 ? Infinity : enlargement(node1.bbox || bbox, bbox);\n\t\t\tconst enl2 = node2.children.length === 0 ? Infinity : enlargement(node2.bbox || bbox, bbox);\n\n\t\t\tif (node1.children.length < this.minEntries && \n\t\t\t\tchildren.length - i + node1.children.length <= this.minEntries) {\n\t\t\t\tnode1.children.push(child);\n\t\t\t} else if (node2.children.length < this.minEntries && \n\t\t\t\tchildren.length - i + node2.children.length <= this.minEntries) {\n\t\t\t\tnode2.children.push(child);\n\t\t\t} else if (enl1 < enl2) {\n\t\t\t\tnode1.children.push(child);\n\t\t\t} else if (enl2 < enl1) {\n\t\t\t\tnode2.children.push(child);\n\t\t\t} else {\n\t\t\t\t// Equal enlargement, choose the one with smaller area\n\t\t\t\tconst area1 = node1.bbox ? area(node1.bbox) : 0;\n\t\t\t\tconst area2 = node2.bbox ? area(node2.bbox) : 0;\n\t\t\t\tif (area1 < area2) {\n\t\t\t\t\tnode1.children.push(child);\n\t\t\t\t} else {\n\t\t\t\t\tnode2.children.push(child);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnode1.updateBBox();\n\t\t\tnode2.updateBBox();\n\t\t}\n\n\t\t// Update the original node with one group\n\t\tnode.children = node1.children;\n\t\tnode.updateBBox();\n\n\t\t// If this was the root, create a new root\n\t\tif (node === this.root) {\n\t\t\tconst newRoot = new RTreeNode(false);\n\t\t\tnewRoot.children = [node1, node2];\n\t\t\tnewRoot.updateBBox();\n\t\t\tthis.root = newRoot;\n\t\t\treturn null;\n\t\t}\n\n\t\treturn node2;\n\t}\n\n\t/**\n\t * Search for points within a bounding box\n\t * @param {Object} bbox - Bounding box {minLat, maxLat, minLng, maxLng}\n\t * @returns {Array} Array of matching entries\n\t */\n\tsearchBBox(bbox) {\n\t\tconst results = [];\n\t\tthis._searchBBox(bbox, this.root, results);\n\t\treturn results;\n\t}\n\n\t/**\n\t * Internal bounding box search\n\t */\n\t_searchBBox(bbox, node, results) {\n\t\tif (!node.bbox || !intersects(bbox, node.bbox)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.isLeaf) {\n\t\t\tfor (const entry of node.children) {\n\t\t\t\tif (intersects(bbox, entry.bbox)) {\n\t\t\t\t\tresults.push(entry);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const child of node.children) {\n\t\t\t\tthis._searchBBox(bbox, child, results);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Search for points within a radius of a location\n\t * @param {number} lat - Center latitude\n\t * @param {number} lng - Center longitude\n\t * @param {number} radiusKm - Radius in kilometers\n\t * @returns {Array} Array of matching entries\n\t */\n\tsearchRadius(lat, lng, radiusKm) {\n\t\t// Convert radius to bounding box for initial filtering\n\t\tconst bbox = radiusToBoundingBox(lat, lng, radiusKm);\n\t\tconst candidates = this.searchBBox(bbox);\n\n\t\t// Filter by actual distance\n\t\tconst results = [];\n\t\tfor (const entry of candidates) {\n\t\t\tconst dist = haversineDistance(lat, lng, entry.lat, entry.lng);\n\t\t\tif (dist <= radiusKm) {\n\t\t\t\tresults.push(entry);\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t}\n\n\t/**\n\t * Remove a point from the R-tree\n\t * @param {number} lat - Latitude\n\t * @param {number} lng - Longitude\n\t * @param {*} data - Associated data (optional, for exact match)\n\t * @returns {boolean} True if removed, false if not found\n\t */\n\tremove(lat, lng, data = null) {\n\t\tconst bbox = {\n\t\t\tminLat: lat,\n\t\t\tmaxLat: lat,\n\t\t\tminLng: lng,\n\t\t\tmaxLng: lng\n\t\t};\n\n\t\tconst removed = this._remove(bbox, data, this.root, null, -1);\n\t\t\n\t\tif (removed) {\n\t\t\tthis._size--;\n\t\t}\n\t\t\n\t\t// If root has only one child after removal, make that child the new root\n\t\tif (this.root.children.length === 1 && !this.root.isLeaf) {\n\t\t\tthis.root = this.root.children[0];\n\t\t}\n\n\t\treturn removed;\n\t}\n\n\t/**\n\t * Internal remove method\n\t */\n\t_remove(bbox, data, node, parent, indexInParent) {\n\t\tif (!node.bbox || !intersects(bbox, node.bbox)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (node.isLeaf) {\n\t\t\tfor (let i = 0; i < node.children.length; i++) {\n\t\t\t\tconst entry = node.children[i];\n\t\t\t\tif (entry.lat === bbox.minLat && entry.lng === bbox.minLng) {\n\t\t\t\t\t// If data is specified, check for match\n\t\t\t\t\tconst dataMatches = data === null || \n\t\t\t\t\t\tJSON.stringify(entry.data) === JSON.stringify(data);\n\t\t\t\t\t\n\t\t\t\t\tif (dataMatches) {\n\t\t\t\t\t\tnode.children.splice(i, 1);\n\t\t\t\t\t\tnode.updateBBox();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Handle underflow\n\t\t\t\t\t\tif (node.children.length < this.minEntries && node !== this.root) {\n\t\t\t\t\t\t\t// Simple approach: reinsert all entries from this node\n\t\t\t\t\t\t\tconst entries = node.children.slice();\n\t\t\t\t\t\t\tnode.children = [];\n\t\t\t\t\t\t\tnode.updateBBox();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Remove this node from parent\n\t\t\t\t\t\t\tif (parent) {\n\t\t\t\t\t\t\t\tparent.children.splice(indexInParent, 1);\n\t\t\t\t\t\t\t\tparent.updateBBox();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Reinsert entries\n\t\t\t\t\t\t\tfor (const e of entries) {\n\t\t\t\t\t\t\t\tthis._insert(e, this.root, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let i = 0; i < node.children.length; i++) {\n\t\t\t\tconst child = node.children[i];\n\t\t\t\tif (this._remove(bbox, data, child, node, i)) {\n\t\t\t\t\tnode.updateBBox();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Get all entries in the tree\n\t * @returns {Array} All entries\n\t */\n\tgetAll() {\n\t\tconst results = [];\n\t\tthis._getAll(this.root, results);\n\t\treturn results;\n\t}\n\n\t/**\n\t * Internal method to get all entries\n\t */\n\t_getAll(node, results) {\n\t\tif (node.isLeaf) {\n\t\t\tresults.push(...node.children);\n\t\t} else {\n\t\t\tfor (const child of node.children) {\n\t\t\t\tthis._getAll(child, results);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get the number of entries in the tree\n\t * @returns {number} Number of entries\n\t */\n\tsize() {\n\t\treturn this._size;\n\t}\n\n\t/**\n\t * Clear all entries from the tree\n\t */\n\tclear() {\n\t\tthis.root = new RTreeNode(true);\n\t\tthis._size = 0;\n\t}\n\n\t/**\n\t * Serialize the R-tree state for storage\n\t * @returns {Object} Serializable state\n\t */\n\tserialize() {\n\t\treturn {\n\t\t\tmaxEntries: this.maxEntries,\n\t\t\tminEntries: this.minEntries,\n\t\t\tsize: this._size,\n\t\t\troot: this._serializeNode(this.root)\n\t\t};\n\t}\n\n\t/**\n\t * Serialize a node recursively\n\t */\n\t_serializeNode(node) {\n\t\tconst serialized = {\n\t\t\tisLeaf: node.isLeaf,\n\t\t\tbbox: node.bbox,\n\t\t\tchildren: []\n\t\t};\n\n\t\tif (node.isLeaf) {\n\t\t\t// Leaf nodes contain entries\n\t\t\tserialized.children = node.children.map(entry => ({\n\t\t\t\tbbox: entry.bbox,\n\t\t\t\tlat: entry.lat,\n\t\t\t\tlng: entry.lng,\n\t\t\t\tdata: entry.data\n\t\t\t}));\n\t\t} else {\n\t\t\t// Internal nodes contain child nodes\n\t\t\tserialized.children = node.children.map(child => this._serializeNode(child));\n\t\t}\n\n\t\treturn serialized;\n\t}\n\n\t/**\n\t * Restore the R-tree state from serialized data\n\t * @param {Object} state - Serialized state\n\t */\n\tdeserialize(state) {\n\t\tthis.maxEntries = state.maxEntries || 9;\n\t\tthis.minEntries = state.minEntries || Math.ceil(this.maxEntries / 2);\n\t\tthis._size = state.size || 0;\n\t\tthis.root = this._deserializeNode(state.root);\n\t}\n\n\t/**\n\t * Deserialize a node recursively\n\t */\n\t_deserializeNode(serialized) {\n\t\tconst node = new RTreeNode(serialized.isLeaf);\n\t\tnode.bbox = serialized.bbox;\n\n\t\tif (serialized.isLeaf) {\n\t\t\t// Restore leaf entries\n\t\t\tnode.children = serialized.children.map(entry => ({\n\t\t\t\tbbox: entry.bbox,\n\t\t\t\tlat: entry.lat,\n\t\t\t\tlng: entry.lng,\n\t\t\t\tdata: entry.data\n\t\t\t}));\n\t\t} else {\n\t\t\t// Restore child nodes\n\t\t\tnode.children = serialized.children.map(child => this._deserializeNode(child));\n\t\t}\n\n\t\treturn node;\n\t}\n}\n\nexport default RTree;\n","import { CollectionIndex } from './CollectionIndex.js';\nimport { RTree } from './RTree.js';\nimport { getProp } from './utils.js';\n\n/**\n * Geospatial index implementation using RTree\n * Supports geospatial queries on GeoJSON fields\n */\nexport class GeospatialCollectionIndex extends CollectionIndex {\n\tconstructor(keys, options = {}) {\n\t\tsuper(keys, options);\n\t\t// Create the underlying RTree\n\t\tthis.rtree = new RTree();\n\t\t// Track which field is the geospatial field\n\t\tthis.geoField = null;\n\t\tfor (const field in keys) {\n\t\t\tif (keys[field] === '2dsphere' || keys[field] === '2d') {\n\t\t\t\tthis.geoField = field;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!this.geoField) {\n\t\t\tthrow new Error('Geospatial index must have at least one field with type \"2dsphere\" or \"2d\"');\n\t\t}\n\t}\n\n\t/**\n\t * Extract coordinates from a GeoJSON object\n\t * @param {Object} geoJson - The GeoJSON object\n\t * @returns {Object|null} Object with lat and lng, or null if invalid\n\t */\n\t_extractCoordinates(geoJson) {\n\t\tif (!geoJson) return null;\n\n\t\t// Handle GeoJSON FeatureCollection\n\t\tif (geoJson.type === 'FeatureCollection' && geoJson.features && geoJson.features.length > 0) {\n\t\t\tconst feature = geoJson.features[0];\n\t\t\tif (feature.geometry) {\n\t\t\t\treturn this._extractCoordinates(feature.geometry);\n\t\t\t}\n\t\t}\n\n\t\t// Handle GeoJSON Feature\n\t\tif (geoJson.type === 'Feature' && geoJson.geometry) {\n\t\t\treturn this._extractCoordinates(geoJson.geometry);\n\t\t}\n\n\t\t// Handle GeoJSON Point\n\t\tif (geoJson.type === 'Point' && geoJson.coordinates) {\n\t\t\tconst [lng, lat] = geoJson.coordinates;\n\t\t\tif (typeof lng === 'number' && typeof lat === 'number') {\n\t\t\t\treturn { lat, lng };\n\t\t\t}\n\t\t}\n\n\t\t// Handle GeoJSON Polygon - use centroid of first coordinate\n\t\tif (geoJson.type === 'Polygon' && geoJson.coordinates && geoJson.coordinates.length > 0) {\n\t\t\tconst ring = geoJson.coordinates[0];\n\t\t\tif (ring.length > 0) {\n\t\t\t\tlet sumLat = 0, sumLng = 0;\n\t\t\t\tfor (const coord of ring) {\n\t\t\t\t\tsumLng += coord[0];\n\t\t\t\t\tsumLat += coord[1];\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tlat: sumLat / ring.length,\n\t\t\t\t\tlng: sumLng / ring.length\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Add a document to the geospatial index\n\t * @param {Object} doc - The document to index\n\t */\n\tadd(doc) {\n\t\tif (!doc._id) {\n\t\t\tthrow new Error('Document must have an _id field');\n\t\t}\n\t\tconst geoValue = getProp(doc, this.geoField);\n\t\tconst coords = this._extractCoordinates(geoValue);\n\t\tif (coords) {\n\t\t\tthis.rtree.insert(coords.lat, coords.lng, { \n\t\t\t\t_id: doc._id, \n\t\t\t\tgeoJson: geoValue \n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Remove a document from the geospatial index\n\t * @param {Object} doc - The document to remove\n\t */\n\tremove(doc) {\n\t\tif (!doc._id) {\n\t\t\treturn;\n\t\t}\n\t\tconst geoValue = getProp(doc, this.geoField);\n\t\tconst coords = this._extractCoordinates(geoValue);\n\t\tif (coords) {\n\t\t\tthis.rtree.remove(coords.lat, coords.lng, { \n\t\t\t\t_id: doc._id, \n\t\t\t\tgeoJson: geoValue \n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Query the geospatial index\n\t * @param {*} query - The query object\n\t * @returns {Array|null} Array of document IDs or null if query is not a geospatial query\n\t */\n\tquery(query) {\n\t\t// Check if this is a geospatial query on our indexed field\n\t\tif (!query[this.geoField]) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst geoQuery = query[this.geoField];\n\n\t\t// Handle $geoWithin with bounding box\n\t\tif (geoQuery.$geoWithin) {\n\t\t\tconst bbox = geoQuery.$geoWithin;\n\t\t\t// bbox format: [[minLon, maxLat], [maxLon, minLat]]\n\t\t\tif (Array.isArray(bbox) && bbox.length === 2) {\n\t\t\t\tconst minLon = bbox[0][0];\n\t\t\t\tconst maxLat = bbox[0][1];\n\t\t\t\tconst maxLon = bbox[1][0];\n\t\t\t\tconst minLat = bbox[1][1];\n\n\t\t\t\tconst results = this.rtree.searchBBox({\n\t\t\t\t\tminLat: minLat,\n\t\t\t\t\tmaxLat: maxLat,\n\t\t\t\t\tminLng: minLon,\n\t\t\t\t\tmaxLng: maxLon\n\t\t\t\t});\n\n\t\t\t\t// Extract document IDs\n\t\t\t\treturn results.map(entry => entry.data._id);\n\t\t\t}\n\t\t}\n\n\t\t// Handle $near with radius (future enhancement)\n\t\t// if (geoQuery.$near) {\n\t\t//   const center = geoQuery.$near;\n\t\t//   const maxDistance = geoQuery.$maxDistance || 1000; // default 1000km\n\t\t//   // Implementation would use rtree.searchRadius\n\t\t// }\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Clear all data from the index\n\t */\n\tclear() {\n\t\tthis.rtree.clear();\n\t}\n\n\t/**\n\t * Get index specification\n\t */\n\tgetSpec() {\n\t\treturn {\n\t\t\tname: this.name,\n\t\t\tkey: this.keys,\n\t\t\t'2dsphereIndexVersion': 3\n\t\t};\n\t}\n\n\t/**\n\t * Serialize index state for storage\n\t * @returns {Object} Serializable index state\n\t */\n\tserialize() {\n\t\treturn {\n\t\t\ttype: 'geospatial',\n\t\t\tkeys: this.keys,\n\t\t\toptions: this.options,\n\t\t\tgeoField: this.geoField,\n\t\t\trtreeState: this.rtree.serialize()\n\t\t};\n\t}\n\n\t/**\n\t * Restore index state from serialized data\n\t * @param {Object} state - Serialized index state\n\t */\n\tdeserialize(state) {\n\t\tthis.geoField = state.geoField;\n\t\tif (state.rtreeState) {\n\t\t\tthis.rtree.deserialize(state.rtreeState);\n\t\t}\n\t}\n}\n","import { TextCollectionIndex } from './TextCollectionIndex.js';\nimport { GeospatialCollectionIndex } from './GeospatialCollectionIndex.js';\n\n/**\n * Query execution plan\n */\nclass QueryPlan {\n\tconstructor() {\n\t\tthis.type = 'full_scan'; // 'full_scan', 'index_scan', 'index_intersection', 'index_union'\n\t\tthis.indexes = []; // Indexes to use\n\t\tthis.indexScans = []; // Array of { indexName, docIds }\n\t\tthis.estimatedCost = Infinity;\n\t}\n}\n\n/**\n * Query planner - analyzes queries and generates optimal execution plans\n */\nexport class QueryPlanner {\n\tconstructor(indexes) {\n\t\tthis.indexes = indexes;\n\t}\n\n\t/**\n\t * Generate an execution plan for a query\n\t * @param {Object} query - MongoDB query object\n\t * @returns {QueryPlan} Execution plan\n\t */\n\tplan(query) {\n\t\tconst plan = new QueryPlan();\n\n\t\t// Empty query - full scan\n\t\tif (!query || Object.keys(query).length === 0) {\n\t\t\treturn plan;\n\t\t}\n\n\t\t// Analyze query structure\n\t\tconst analysis = this._analyzeQuery(query);\n\n\t\t// Check for text search\n\t\tif (analysis.hasTextSearch) {\n\t\t\tconst textPlan = this._planTextSearch(query, analysis);\n\t\t\tif (textPlan) {\n\t\t\t\treturn textPlan;\n\t\t\t}\n\t\t}\n\n\t\t// Check for geospatial query\n\t\tif (analysis.hasGeoQuery) {\n\t\t\tconst geoPlan = this._planGeoQuery(query, analysis);\n\t\t\tif (geoPlan) {\n\t\t\t\treturn geoPlan;\n\t\t\t}\n\t\t}\n\n\t\t// Check for $and queries - can use index intersection\n\t\tif (analysis.type === 'and') {\n\t\t\tconst andPlan = this._planAndQuery(query, analysis);\n\t\t\tif (andPlan.type !== 'full_scan') {\n\t\t\t\treturn andPlan;\n\t\t\t}\n\t\t}\n\n\t\t// Check for $or queries - can use index union\n\t\tif (analysis.type === 'or') {\n\t\t\tconst orPlan = this._planOrQuery(query, analysis);\n\t\t\tif (orPlan.type !== 'full_scan') {\n\t\t\t\treturn orPlan;\n\t\t\t}\n\t\t}\n\n\t\t// Try to find a single index for simple queries\n\t\tconst simplePlan = this._planSimpleQuery(query);\n\t\tif (simplePlan.type !== 'full_scan') {\n\t\t\treturn simplePlan;\n\t\t}\n\n\t\t// Fall back to full scan\n\t\treturn plan;\n\t}\n\n\t/**\n\t * Analyze query structure\n\t * @private\n\t */\n\t_analyzeQuery(query) {\n\t\tconst analysis = {\n\t\t\ttype: 'simple', // 'simple', 'and', 'or', 'complex'\n\t\t\tfields: [],\n\t\t\toperators: {},\n\t\t\thasTextSearch: false,\n\t\t\thasGeoQuery: false,\n\t\t\tconditions: []\n\t\t};\n\n\t\tconst keys = Object.keys(query);\n\n\t\t// Check for top-level logical operators\n\t\tif (keys.length === 1) {\n\t\t\tconst key = keys[0];\n\t\t\tif (key === '$and') {\n\t\t\t\tanalysis.type = 'and';\n\t\t\t\tanalysis.conditions = query.$and;\n\t\t\t\t// Analyze each condition\n\t\t\t\tfor (const condition of analysis.conditions) {\n\t\t\t\t\tconst subAnalysis = this._analyzeQuery(condition);\n\t\t\t\t\tanalysis.fields.push(...subAnalysis.fields);\n\t\t\t\t\tif (subAnalysis.hasTextSearch) analysis.hasTextSearch = true;\n\t\t\t\t\tif (subAnalysis.hasGeoQuery) analysis.hasGeoQuery = true;\n\t\t\t\t}\n\t\t\t\treturn analysis;\n\t\t\t} else if (key === '$or') {\n\t\t\t\tanalysis.type = 'or';\n\t\t\t\tanalysis.conditions = query.$or;\n\t\t\t\t// Analyze each condition\n\t\t\t\tfor (const condition of analysis.conditions) {\n\t\t\t\t\tconst subAnalysis = this._analyzeQuery(condition);\n\t\t\t\t\tanalysis.fields.push(...subAnalysis.fields);\n\t\t\t\t\tif (subAnalysis.hasTextSearch) analysis.hasTextSearch = true;\n\t\t\t\t\tif (subAnalysis.hasGeoQuery) analysis.hasGeoQuery = true;\n\t\t\t\t}\n\t\t\t\treturn analysis;\n\t\t\t}\n\t\t}\n\n\t\t// Analyze simple field conditions\n\t\tfor (const field of keys) {\n\t\t\tif (field.startsWith('$')) {\n\t\t\t\tcontinue; // Skip top-level operators we don't handle yet\n\t\t\t}\n\n\t\t\tanalysis.fields.push(field);\n\t\t\tconst value = query[field];\n\n\t\t\t// Check for operators\n\t\t\tif (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n\t\t\t\tconst ops = Object.keys(value);\n\t\t\t\tanalysis.operators[field] = ops;\n\n\t\t\t\t// Check for text search\n\t\t\t\tif (ops.includes('$text')) {\n\t\t\t\t\tanalysis.hasTextSearch = true;\n\t\t\t\t}\n\n\t\t\t\t// Check for geospatial operators\n\t\t\t\tif (ops.some(op => ['$geoWithin', '$geoIntersects', '$near', '$nearSphere'].includes(op))) {\n\t\t\t\t\tanalysis.hasGeoQuery = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If multiple fields, it's an implicit $and\n\t\tif (keys.length > 1) {\n\t\t\tanalysis.type = 'and';\n\t\t}\n\n\t\treturn analysis;\n\t}\n\n\t/**\n\t * Plan for text search queries\n\t * @private\n\t */\n\t_planTextSearch(query, analysis) {\n\t\t// Find text index\n\t\tfor (const indexName in this.indexes) {\n\t\t\tconst index = this.indexes[indexName];\n\t\t\tif (index instanceof TextCollectionIndex) {\n\t\t\t\t// Look for $text operator in query\n\t\t\t\tconst textQuery = this._extractTextQuery(query);\n\t\t\t\tif (textQuery) {\n\t\t\t\t\tconst plan = new QueryPlan();\n\t\t\t\t\tplan.type = 'index_scan';\n\t\t\t\t\tplan.indexes = [indexName];\n\t\t\t\t\tconst docIds = index.search(textQuery);\n\t\t\t\t\tplan.indexScans = [{ indexName, docIds }];\n\t\t\t\t\tplan.estimatedCost = docIds.length;\n\t\t\t\t\treturn plan;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * Extract $text query from query object\n\t * @private\n\t */\n\t_extractTextQuery(query) {\n\t\tfor (const field in query) {\n\t\t\tconst value = query[field];\n\t\t\tif (typeof value === 'object' && value !== null && value.$text) {\n\t\t\t\treturn typeof value.$text === 'string' ? value.$text : value.$text.$search;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * Plan for geospatial queries\n\t * @private\n\t */\n\t_planGeoQuery(query, analysis) {\n\t\t// Find geospatial index\n\t\tfor (const indexName in this.indexes) {\n\t\t\tconst index = this.indexes[indexName];\n\t\t\tif (index instanceof GeospatialCollectionIndex) {\n\t\t\t\tconst docIds = index.query(query);\n\t\t\t\tif (docIds !== null) {\n\t\t\t\t\tconst plan = new QueryPlan();\n\t\t\t\t\tplan.type = 'index_scan';\n\t\t\t\t\tplan.indexes = [indexName];\n\t\t\t\t\tplan.indexScans = [{ indexName, docIds }];\n\t\t\t\t\tplan.estimatedCost = docIds.length;\n\t\t\t\t\treturn plan;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * Plan for $and queries (index intersection)\n\t * @private\n\t */\n\t_planAndQuery(query, analysis) {\n\t\tconst plan = new QueryPlan();\n\n\t\t// Extract conditions\n\t\tlet conditions;\n\t\tif (query.$and) {\n\t\t\tconditions = query.$and;\n\t\t} else {\n\t\t\t// Implicit AND - convert to array of conditions\n\t\t\tconditions = Object.keys(query).map(field => ({ [field]: query[field] }));\n\t\t}\n\n\t\t// Try to find indexes for each condition\n\t\tconst indexableConditions = [];\n\t\tfor (const condition of conditions) {\n\t\t\tconst conditionPlan = this._planSimpleQuery(condition);\n\t\t\tif (conditionPlan.type === 'index_scan') {\n\t\t\t\tindexableConditions.push(conditionPlan.indexScans[0]);\n\t\t\t}\n\t\t}\n\n\t\t// If we have multiple indexable conditions, use index intersection\n\t\tif (indexableConditions.length > 1) {\n\t\t\tplan.type = 'index_intersection';\n\t\t\tplan.indexScans = indexableConditions;\n\t\t\tplan.indexes = indexableConditions.map(scan => scan.indexName);\n\t\t\t\n\t\t\t// Estimate cost as the smallest set\n\t\t\tplan.estimatedCost = Math.min(...indexableConditions.map(scan => scan.docIds.length));\n\t\t\treturn plan;\n\t\t}\n\n\t\t// If we have one indexable condition, use it\n\t\tif (indexableConditions.length === 1) {\n\t\t\tplan.type = 'index_scan';\n\t\t\tplan.indexScans = [indexableConditions[0]];\n\t\t\tplan.indexes = [indexableConditions[0].indexName];\n\t\t\tplan.estimatedCost = indexableConditions[0].docIds.length;\n\t\t\treturn plan;\n\t\t}\n\n\t\treturn plan; // full_scan\n\t}\n\n\t/**\n\t * Plan for $or queries (index union)\n\t * @private\n\t */\n\t_planOrQuery(query, analysis) {\n\t\tconst plan = new QueryPlan();\n\n\t\tif (!query.$or) {\n\t\t\treturn plan;\n\t\t}\n\n\t\tconst conditions = query.$or;\n\n\t\t// Try to find indexes for each condition\n\t\tconst indexableConditions = [];\n\t\tfor (const condition of conditions) {\n\t\t\tconst conditionPlan = this._planSimpleQuery(condition);\n\t\t\tif (conditionPlan.type === 'index_scan') {\n\t\t\t\tindexableConditions.push(conditionPlan.indexScans[0]);\n\t\t\t}\n\t\t}\n\n\t\t// If we have at least one indexable condition, use index union\n\t\tif (indexableConditions.length > 0) {\n\t\t\tplan.type = 'index_union';\n\t\t\tplan.indexScans = indexableConditions;\n\t\t\tplan.indexes = indexableConditions.map(scan => scan.indexName);\n\t\t\t\n\t\t\t// Estimate cost as the sum of all sets\n\t\t\tplan.estimatedCost = indexableConditions.reduce((sum, scan) => sum + scan.docIds.length, 0);\n\t\t\treturn plan;\n\t\t}\n\n\t\treturn plan; // full_scan\n\t}\n\n\t/**\n\t * Plan for simple single-field queries\n\t * @private\n\t */\n\t_planSimpleQuery(query) {\n\t\tconst plan = new QueryPlan();\n\t\tconst queryKeys = Object.keys(query);\n\n\t\tif (queryKeys.length === 0) {\n\t\t\treturn plan;\n\t\t}\n\n\t\t// Try each index\n\t\tfor (const indexName in this.indexes) {\n\t\t\tconst index = this.indexes[indexName];\n\n\t\t\t// Skip special index types (they have their own planning)\n\t\t\tif (index instanceof TextCollectionIndex || index instanceof GeospatialCollectionIndex) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Try to use this index\n\t\t\tconst docIds = index.query(query);\n\t\t\tif (docIds !== null && docIds.length >= 0) {\n\t\t\t\tplan.type = 'index_scan';\n\t\t\t\tplan.indexes = [indexName];\n\t\t\t\tplan.indexScans = [{ indexName, docIds }];\n\t\t\t\tplan.estimatedCost = docIds.length;\n\t\t\t\treturn plan;\n\t\t\t}\n\t\t}\n\n\t\treturn plan; // full_scan\n\t}\n\n\t/**\n\t * Execute a query plan and return document IDs\n\t * @param {QueryPlan} plan - The execution plan\n\t * @returns {Array|null} Array of document IDs or null for full scan\n\t */\n\texecute(plan) {\n\t\tif (plan.type === 'full_scan') {\n\t\t\treturn null; // Signals cursor to do full scan\n\t\t}\n\n\t\tif (plan.type === 'index_scan') {\n\t\t\treturn plan.indexScans[0].docIds;\n\t\t}\n\n\t\tif (plan.type === 'index_intersection') {\n\t\t\t// Intersection: docs must be in ALL index results\n\t\t\tif (plan.indexScans.length === 0) return null;\n\t\t\t\n\t\t\t// Start with the smallest set for efficiency\n\t\t\tconst sorted = plan.indexScans.slice().sort((a, b) => a.docIds.length - b.docIds.length);\n\t\t\tlet result = new Set(sorted[0].docIds);\n\t\t\t\n\t\t\t// Intersect with each subsequent set\n\t\t\tfor (let i = 1; i < sorted.length; i++) {\n\t\t\t\tconst currentSet = new Set(sorted[i].docIds);\n\t\t\t\tresult = new Set([...result].filter(id => currentSet.has(id)));\n\t\t\t\t\n\t\t\t\t// Early exit if intersection becomes empty\n\t\t\t\tif (result.size === 0) break;\n\t\t\t}\n\t\t\t\n\t\t\treturn Array.from(result);\n\t\t}\n\n\t\tif (plan.type === 'index_union') {\n\t\t\t// Union: docs in ANY index result\n\t\t\tconst result = new Set();\n\t\t\tfor (const scan of plan.indexScans) {\n\t\t\t\tscan.docIds.forEach(id => result.add(id));\n\t\t\t}\n\t\t\treturn Array.from(result);\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import { Cursor } from './Cursor.js';\nimport { SortedCursor } from './SortedCursor.js';\nimport { isArray, getProp, applyProjection, copy } from './utils.js';\nimport { matches } from './queryMatcher.js';\nimport { applyUpdates, createDocFromUpdate } from './updates.js';\nimport { RegularCollectionIndex } from './RegularCollectionIndex.js';\nimport { TextCollectionIndex } from './TextCollectionIndex.js';\nimport { GeospatialCollectionIndex } from './GeospatialCollectionIndex.js';\nimport { QueryPlanner } from './QueryPlanner.js';\n\n/**\n * Collection class\n */\nexport class Collection {\n\tconstructor(db, storage, idGenerator) {\n\t\tthis.db = db;\n\t\tthis.storage = storage;\n\t\tthis.idGenerator = idGenerator;\n\t\tthis.indexes = {}; // Index storage - map of index name to index structure\n\t\tthis.queryPlanner = new QueryPlanner(this.indexes); // Query planner\n\t\tthis.isCollection = true; // TODO used by dropDatabase, ugly\n\t}\n\n\t/**\n\t * Generate index name from keys\n\t */\n\tgenerateIndexName(keys) {\n\t\tconst parts = [];\n\t\tfor (const field in keys) {\n\t\t\tif (keys.hasOwnProperty(field)) {\n\t\t\t\tparts.push(field + '_' + keys[field]);\n\t\t\t}\n\t\t}\n\t\treturn parts.join('_');\n\t}\n\n\t/**\n\t * Determine if keys specify a text index\n\t */\n\tisTextIndex(keys) {\n\t\tfor (const field in keys) {\n\t\t\tif (keys[field] === 'text') {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Determine if keys specify a geospatial index\n\t */\n\tisGeospatialIndex(keys) {\n\t\tfor (const field in keys) {\n\t\t\tif (keys[field] === '2dsphere' || keys[field] === '2d') {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Build/rebuild an index\n\t */\n\tbuildIndex(indexName, keys, options = {}) {\n\t\tlet index;\n\t\t\n\t\t// Create appropriate index type\n\t\tif (this.isTextIndex(keys)) {\n\t\t\tindex = new TextCollectionIndex(keys, { ...options, name: indexName });\n\t\t} else if (this.isGeospatialIndex(keys)) {\n\t\t\tindex = new GeospatialCollectionIndex(keys, { ...options, name: indexName });\n\t\t} else {\n\t\t\tindex = new RegularCollectionIndex(keys, { ...options, name: indexName });\n\t\t}\n\n\t\t// Build index by scanning all documents\n\t\tfor (let i = 0; i < this.storage.size(); i++) {\n\t\t\tconst doc = this.storage.get(i);\n\t\t\tif (doc) {\n\t\t\t\tindex.add(doc);\n\t\t\t}\n\t\t}\n\n\t\tthis.indexes[indexName] = index;\n\t\treturn index;\n\t}\n\n\t/**\n\t * Update indexes when a document is inserted\n\t */\n\tupdateIndexesOnInsert(doc) {\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tconst index = this.indexes[indexName];\n\t\t\t\tindex.add(doc);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Update indexes when a document is deleted\n\t */\n\tupdateIndexesOnDelete(doc) {\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tconst index = this.indexes[indexName];\n\t\t\t\tindex.remove(doc);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Query planner - analyze query and determine optimal execution plan\n\t */\n\tplanQuery(query) {\n\t\tconst plan = this.queryPlanner.plan(query);\n\t\tconst docIds = this.queryPlanner.execute(plan);\n\t\t\n\t\treturn {\n\t\t\tuseIndex: plan.type !== 'full_scan',\n\t\t\tplanType: plan.type,\n\t\t\tindexNames: plan.indexes,\n\t\t\tdocIds: docIds,\n\t\t\testimatedCost: plan.estimatedCost\n\t\t};\n\t}\n\n\t/**\n\t * Get a text index for the given field\n\t * @param {string} field - The field name\n\t * @returns {TextCollectionIndex|null} The text index or null if not found\n\t */\n\tgetTextIndex(field) {\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tconst index = this.indexes[indexName];\n\t\t\t\tif (index instanceof TextCollectionIndex) {\n\t\t\t\t\t// Check if this field is indexed\n\t\t\t\t\tif (index.indexedFields.includes(field)) {\n\t\t\t\t\t\treturn index;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Collection methods\n\taggregate(pipeline) {\n\t\tif (!pipeline || !isArray(pipeline)) {\n\t\t\tthrow { $err: \"Pipeline must be an array\", code: 17287 };\n\t\t}\n\n\t\t// Start with all documents\n\t\tlet results = [];\n\t\tconst cursor = this.find({});\n\t\twhile (cursor.hasNext()) {\n\t\t\tresults.push(cursor.next());\n\t\t}\n\n\t\t// Process each stage in the pipeline\n\t\tfor (let i = 0; i < pipeline.length; i++) {\n\t\t\tconst stage = pipeline[i];\n\t\t\tconst stageKeys = Object.keys(stage);\n\t\t\tif (stageKeys.length !== 1) {\n\t\t\t\tthrow { $err: \"Each pipeline stage must have exactly one key\", code: 17287 };\n\t\t\t}\n\t\t\tconst stageType = stageKeys[0];\n\t\t\tconst stageSpec = stage[stageType];\n\n\t\t\tif (stageType === \"$match\") {\n\t\t\t\t// Filter documents based on query\n\t\t\t\tconst matched = [];\n\t\t\t\tfor (let j = 0; j < results.length; j++) {\n\t\t\t\t\tif (matches(results[j], stageSpec)) {\n\t\t\t\t\t\tmatched.push(results[j]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresults = matched;\n\t\t\t} else if (stageType === \"$project\") {\n\t\t\t\t// Reshape documents\n\t\t\t\tconst projected = [];\n\t\t\t\tfor (let j = 0; j < results.length; j++) {\n\t\t\t\t\tprojected.push(applyProjection(stageSpec, results[j]));\n\t\t\t\t}\n\t\t\t\tresults = projected;\n\t\t\t} else if (stageType === \"$sort\") {\n\t\t\t\t// Sort documents\n\t\t\t\tconst sortKeys = Object.keys(stageSpec);\n\t\t\t\tresults.sort(function (a, b) {\n\t\t\t\t\tfor (let k = 0; k < sortKeys.length; k++) {\n\t\t\t\t\t\tconst key = sortKeys[k];\n\t\t\t\t\t\tif (a[key] === undefined && b[key] !== undefined) return -1 * stageSpec[key];\n\t\t\t\t\t\tif (a[key] !== undefined && b[key] === undefined) return 1 * stageSpec[key];\n\t\t\t\t\t\tif (a[key] < b[key]) return -1 * stageSpec[key];\n\t\t\t\t\t\tif (a[key] > b[key]) return 1 * stageSpec[key];\n\t\t\t\t\t}\n\t\t\t\t\treturn 0;\n\t\t\t\t});\n\t\t\t} else if (stageType === \"$limit\") {\n\t\t\t\t// Limit number of documents\n\t\t\t\tresults = results.slice(0, stageSpec);\n\t\t\t} else if (stageType === \"$skip\") {\n\t\t\t\t// Skip documents\n\t\t\t\tresults = results.slice(stageSpec);\n\t\t\t} else if (stageType === \"$group\") {\n\t\t\t\t// Group documents\n\t\t\t\tconst groups = {};\n\t\t\t\tconst groupId = stageSpec._id;\n\n\t\t\t\tfor (let j = 0; j < results.length; j++) {\n\t\t\t\t\tconst doc = results[j];\n\t\t\t\t\tlet key;\n\n\t\t\t\t\t// Compute group key\n\t\t\t\t\tif (groupId === null || groupId === undefined) {\n\t\t\t\t\t\tkey = null;\n\t\t\t\t\t} else if (typeof groupId === 'string' && groupId.charAt(0) === '$') {\n\t\t\t\t\t\t// Field reference\n\t\t\t\t\t\tkey = getProp(doc, groupId.substring(1));\n\t\t\t\t\t} else if (typeof groupId === 'object') {\n\t\t\t\t\t\t// Computed key\n\t\t\t\t\t\tkey = JSON.stringify(groupId);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tkey = groupId;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst keyStr = JSON.stringify(key);\n\n\t\t\t\t\t// Initialize group\n\t\t\t\t\tif (!groups[keyStr]) {\n\t\t\t\t\t\tgroups[keyStr] = {\n\t\t\t\t\t\t\t_id: key,\n\t\t\t\t\t\t\tdocs: [],\n\t\t\t\t\t\t\taccumulators: {}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tgroups[keyStr].docs.push(doc);\n\t\t\t\t}\n\n\t\t\t\t// Apply accumulators\n\t\t\t\tconst grouped = [];\n\t\t\t\tfor (const groupKey in groups) {\n\t\t\t\t\tconst group = groups[groupKey];\n\t\t\t\t\tconst result = { _id: group._id };\n\n\t\t\t\t\t// Process each accumulator field\n\t\t\t\t\tfor (const field in stageSpec) {\n\t\t\t\t\t\tif (field === '_id') continue;\n\n\t\t\t\t\t\tconst accumulator = stageSpec[field];\n\t\t\t\t\t\tconst accKeys = Object.keys(accumulator);\n\t\t\t\t\t\tif (accKeys.length !== 1) continue;\n\n\t\t\t\t\t\tconst accType = accKeys[0];\n\t\t\t\t\t\tconst accExpr = accumulator[accType];\n\n\t\t\t\t\t\tif (accType === '$sum') {\n\t\t\t\t\t\t\tlet sum = 0;\n\t\t\t\t\t\t\tfor (let k = 0; k < group.docs.length; k++) {\n\t\t\t\t\t\t\t\tif (typeof accExpr === 'number') {\n\t\t\t\t\t\t\t\t\tsum += accExpr;\n\t\t\t\t\t\t\t\t} else if (typeof accExpr === 'string' && accExpr.charAt(0) === '$') {\n\t\t\t\t\t\t\t\t\tconst val = getProp(group.docs[k], accExpr.substring(1));\n\t\t\t\t\t\t\t\t\tsum += val || 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresult[field] = sum;\n\t\t\t\t\t\t} else if (accType === '$avg') {\n\t\t\t\t\t\t\tlet sum = 0;\n\t\t\t\t\t\t\tlet count = 0;\n\t\t\t\t\t\t\tfor (let k = 0; k < group.docs.length; k++) {\n\t\t\t\t\t\t\t\tif (typeof accExpr === 'string' && accExpr.charAt(0) === '$') {\n\t\t\t\t\t\t\t\t\tconst val = getProp(group.docs[k], accExpr.substring(1));\n\t\t\t\t\t\t\t\t\tif (val !== undefined && val !== null) {\n\t\t\t\t\t\t\t\t\t\tsum += val;\n\t\t\t\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresult[field] = count > 0 ? sum / count : 0;\n\t\t\t\t\t\t} else if (accType === '$min') {\n\t\t\t\t\t\t\tlet min = undefined;\n\t\t\t\t\t\t\tfor (let k = 0; k < group.docs.length; k++) {\n\t\t\t\t\t\t\t\tif (typeof accExpr === 'string' && accExpr.charAt(0) === '$') {\n\t\t\t\t\t\t\t\t\tconst val = getProp(group.docs[k], accExpr.substring(1));\n\t\t\t\t\t\t\t\t\tif (val !== undefined && (min === undefined || val < min)) {\n\t\t\t\t\t\t\t\t\t\tmin = val;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresult[field] = min;\n\t\t\t\t\t\t} else if (accType === '$max') {\n\t\t\t\t\t\t\tlet max = undefined;\n\t\t\t\t\t\t\tfor (let k = 0; k < group.docs.length; k++) {\n\t\t\t\t\t\t\t\tif (typeof accExpr === 'string' && accExpr.charAt(0) === '$') {\n\t\t\t\t\t\t\t\t\tconst val = getProp(group.docs[k], accExpr.substring(1));\n\t\t\t\t\t\t\t\t\tif (val !== undefined && (max === undefined || val > max)) {\n\t\t\t\t\t\t\t\t\t\tmax = val;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresult[field] = max;\n\t\t\t\t\t\t} else if (accType === '$push') {\n\t\t\t\t\t\t\tconst arr = [];\n\t\t\t\t\t\t\tfor (let k = 0; k < group.docs.length; k++) {\n\t\t\t\t\t\t\t\tif (typeof accExpr === 'string' && accExpr.charAt(0) === '$') {\n\t\t\t\t\t\t\t\t\tconst val = getProp(group.docs[k], accExpr.substring(1));\n\t\t\t\t\t\t\t\t\tarr.push(val);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresult[field] = arr;\n\t\t\t\t\t\t} else if (accType === '$addToSet') {\n\t\t\t\t\t\t\tconst set = {};\n\t\t\t\t\t\t\tfor (let k = 0; k < group.docs.length; k++) {\n\t\t\t\t\t\t\t\tif (typeof accExpr === 'string' && accExpr.charAt(0) === '$') {\n\t\t\t\t\t\t\t\t\tconst val = getProp(group.docs[k], accExpr.substring(1));\n\t\t\t\t\t\t\t\t\tset[JSON.stringify(val)] = val;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst arr = [];\n\t\t\t\t\t\t\tfor (const valKey in set) {\n\t\t\t\t\t\t\t\tarr.push(set[valKey]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresult[field] = arr;\n\t\t\t\t\t\t} else if (accType === '$first') {\n\t\t\t\t\t\t\tif (group.docs.length > 0) {\n\t\t\t\t\t\t\t\tif (typeof accExpr === 'string' && accExpr.charAt(0) === '$') {\n\t\t\t\t\t\t\t\t\tresult[field] = getProp(group.docs[0], accExpr.substring(1));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (accType === '$last') {\n\t\t\t\t\t\t\tif (group.docs.length > 0) {\n\t\t\t\t\t\t\t\tif (typeof accExpr === 'string' && accExpr.charAt(0) === '$') {\n\t\t\t\t\t\t\t\t\tresult[field] = getProp(group.docs[group.docs.length - 1], accExpr.substring(1));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tgrouped.push(result);\n\t\t\t\t}\n\t\t\t\tresults = grouped;\n\t\t\t} else if (stageType === \"$count\") {\n\t\t\t\t// Count documents and return single document with count\n\t\t\t\tresults = [{ [stageSpec]: results.length }];\n\t\t\t} else if (stageType === \"$unwind\") {\n\t\t\t\t// Unwind array field\n\t\t\t\tconst unwound = [];\n\t\t\t\tlet fieldPath = stageSpec;\n\t\t\t\tif (typeof fieldPath === 'string' && fieldPath.charAt(0) === '$') {\n\t\t\t\t\tfieldPath = fieldPath.substring(1);\n\t\t\t\t}\n\n\t\t\t\tfor (let j = 0; j < results.length; j++) {\n\t\t\t\t\tconst doc = results[j];\n\t\t\t\t\tconst arr = getProp(doc, fieldPath);\n\n\t\t\t\t\tif (arr && isArray(arr) && arr.length > 0) {\n\t\t\t\t\t\tfor (let k = 0; k < arr.length; k++) {\n\t\t\t\t\t\t\tconst unwoundDoc = copy(doc);\n\t\t\t\t\t\t\t// Set the unwound value\n\t\t\t\t\t\t\tconst parts = fieldPath.split('.');\n\t\t\t\t\t\t\tlet target = unwoundDoc;\n\t\t\t\t\t\t\tfor (let l = 0; l < parts.length - 1; l++) {\n\t\t\t\t\t\t\t\tif (!target[parts[l]]) {\n\t\t\t\t\t\t\t\t\ttarget[parts[l]] = {};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\ttarget = target[parts[l]];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttarget[parts[parts.length - 1]] = arr[k];\n\t\t\t\t\t\t\tunwound.push(unwoundDoc);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// MongoDB's default behavior: skip documents where field is missing, null, empty array, or not an array\n\t\t\t\t}\n\t\t\t\tresults = unwound;\n\t\t\t} else {\n\t\t\t\tthrow { $err: \"Unsupported aggregation stage: \" + stageType, code: 17287 };\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t}\n\n\tbulkWrite() { throw \"Not Implemented\"; }\n\n\tasync count() {\n\t\treturn this.storage.size();\n\t}\n\n\tasync copyTo(destCollectionName) {\n\t\tif (!this.db[destCollectionName]) {\n\t\t\tthis.db.createCollection(destCollectionName);\n\t\t}\n\t\tconst destCol = this.db[destCollectionName];\n\t\tlet numCopied = 0;\n\t\tconst c = this.find({});\n\t\twhile (c.hasNext()) {\n\t\t\tawait destCol.insertOne(c.next());\n\t\t\tnumCopied++;\n\t\t}\n\t\treturn numCopied;\n\t}\n\n\tasync createIndex(keys, options) {\n\t\t// MongoDB-compliant createIndex\n\t\t// keys: { fieldName: 1 } for ascending, { fieldName: -1 } for descending, { fieldName: 'text' } for text\n\t\t// options: { name: \"indexName\", unique: true, ... }\n\n\t\tif (!keys || typeof keys !== 'object' || Array.isArray(keys)) {\n\t\t\tthrow { $err: \"createIndex requires a key specification object\", code: 2 };\n\t\t}\n\n\t\tconst indexName = (options && options.name) ? options.name : this.generateIndexName(keys);\n\n\t\t// Check if index already exists\n\t\tif (this.indexes[indexName]) {\n\t\t\t// MongoDB checks for key specification conflicts\n\t\t\tconst existingIndex = this.indexes[indexName];\n\t\t\tconst existingKeys = JSON.stringify(existingIndex.keys);\n\t\t\tconst newKeys = JSON.stringify(keys);\n\t\t\tif (existingKeys !== newKeys) {\n\t\t\t\tthrow { $err: \"Index with name '\" + indexName + \"' already exists with a different key specification\", code: 85 };\n\t\t\t}\n\t\t\t// Same index, return without error\n\t\t\treturn indexName;\n\t\t}\n\n\t\t// Build the index\n\t\tthis.buildIndex(indexName, keys, options);\n\n\t\treturn indexName;\n\t}\n\n\tdataSize() { throw \"Not Implemented\"; }\n\n\tasync deleteOne(query) {\n\t\tconst doc = await this.findOne(query);\n\t\tif (doc) {\n\t\t\tthis.updateIndexesOnDelete(doc);\n\t\t\tthis.storage.remove(doc._id);\n\t\t\treturn { deletedCount: 1 };\n\t\t} else {\n\t\t\treturn { deletedCount: 0 };\n\t\t}\n\t}\n\n\tasync deleteMany(query) {\n\t\tconst c = this.find(query);\n\t\tconst ids = [];\n\t\tconst docs = [];\n\t\twhile (c.hasNext()) {\n\t\t\tconst doc = c.next();\n\t\t\tids.push(doc._id);\n\t\t\tdocs.push(doc);\n\t\t}\n\t\tconst deletedCount = ids.length;\n\t\tfor (let i = 0; i < ids.length; i++) {\n\t\t\tthis.updateIndexesOnDelete(docs[i]);\n\t\t\tthis.storage.remove(ids[i]);\n\t\t}\n\t\treturn { deletedCount: deletedCount };\n\t}\n\n\tasync distinct(field, query) {\n\t\tconst vals = {};\n\t\tconst c = this.find(query);\n\t\twhile (c.hasNext()) {\n\t\t\tconst d = c.next();\n\t\t\tif (d[field]) {\n\t\t\t\tvals[d[field]] = true;\n\t\t\t}\n\t\t}\n\t\treturn Object.keys(vals);\n\t}\n\n\tdrop() {\n\t\tthis.storage.clear();\n\t\t// Clear all indexes\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tthis.indexes[indexName].clear();\n\t\t\t}\n\t\t}\n\t}\n\n\tdropIndex(indexName) {\n\t\tif (!this.indexes[indexName]) {\n\t\t\tthrow { $err: \"Index not found with name: \" + indexName, code: 27 };\n\t\t}\n\t\tthis.indexes[indexName].clear();\n\t\tdelete this.indexes[indexName];\n\t\treturn { nIndexesWas: Object.keys(this.indexes).length + 1, ok: 1 };\n\t}\n\n\tdropIndexes() {\n\t\tconst count = Object.keys(this.indexes).length;\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tthis.indexes[indexName].clear();\n\t\t\t}\n\t\t}\n\t\tthis.indexes = {};\n\t\treturn { nIndexesWas: count, msg: \"non-_id indexes dropped\", ok: 1 };\n\t}\n\tensureIndex() { throw \"Not Implemented\"; }\n\texplain() { throw \"Not Implemented\"; }\n\n\tfind(query, projection) {\n\t\treturn new Cursor(\n\t\t\tthis,\n\t\t\t(query == undefined ? {} : query),\n\t\t\tprojection,\n\t\t\tmatches,\n\t\t\tthis.storage,\n\t\t\tthis.indexes,\n\t\t\tthis.planQuery.bind(this),\n\t\t\tSortedCursor\n\t\t);\n\t}\n\n\tfindAndModify() { throw \"Not Implemented\"; }\n\n\tasync findOne(query, projection) {\n\t\tconst cursor = this.find(query, projection);\n\t\tif (cursor.hasNext()) {\n\t\t\treturn cursor.next();\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tasync findOneAndDelete(filter, options) {\n\t\tlet c = this.find(filter);\n\t\tif (options && options.sort) c = c.sort(options.sort);\n\t\tif (!c.hasNext()) return null;\n\t\tconst doc = c.next();\n\t\tthis.storage.remove(doc._id);\n\t\tif (options && options.projection) return applyProjection(options.projection, doc);\n\t\telse return doc;\n\t}\n\n\tasync findOneAndReplace(filter, replacement, options) {\n\t\tlet c = this.find(filter);\n\t\tif (options && options.sort) c = c.sort(options.sort);\n\t\tif (!c.hasNext()) return null;\n\t\tconst doc = c.next();\n\t\treplacement._id = doc._id;\n\t\tthis.storage.set(doc._id, replacement);\n\t\tif (options && options.returnNewDocument) {\n\t\t\tif (options && options.projection) return applyProjection(options.projection, replacement);\n\t\t\telse return replacement;\n\t\t} else {\n\t\t\tif (options && options.projection) return applyProjection(options.projection, doc);\n\t\t\telse return doc;\n\t\t}\n\t}\n\n\tasync findOneAndUpdate(filter, update, options) {\n\t\tlet c = this.find(filter);\n\t\tif (options && options.sort) c = c.sort(options.sort);\n\t\tif (!c.hasNext()) return null;\n\t\tconst doc = c.next();\n\t\tconst clone = Object.assign({}, doc);\n\t\tapplyUpdates(update, clone);\n\t\tthis.storage.set(doc._id, clone);\n\t\tif (options && options.returnNewDocument) {\n\t\t\tif (options && options.projection) return applyProjection(options.projection, clone);\n\t\t\telse return clone;\n\t\t} else {\n\t\t\tif (options && options.projection) return applyProjection(options.projection, doc);\n\t\t\telse return doc;\n\t\t}\n\t}\n\n\tgetIndexes() {\n\t\t// Return array of index specifications\n\t\tconst result = [];\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tresult.push(this.indexes[indexName].getSpec());\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetShardDistribution() { throw \"Not Implemented\"; }\n\tgetShardVersion() { throw \"Not Implemented\"; }\n\n\t// non-mongo\n\tgetStore() {\n\t\treturn this.storage.getStore();\n\t}\n\n\tgroup() { throw \"Not Implemented\"; }\n\n\tasync insert(doc) {\n\t\tif (Array == doc.constructor) {\n\t\t\treturn await this.insertMany(doc);\n\t\t} else {\n\t\t\treturn await this.insertOne(doc);\n\t\t}\n\t}\n\n\tasync insertOne(doc) {\n\t\tif (doc._id == undefined) doc._id = this.idGenerator();\n\t\tthis.storage.set(doc._id, doc);\n\t\tthis.updateIndexesOnInsert(doc);\n\t\treturn { insertedId: doc._id };\n\t}\n\n\tasync insertMany(docs) {\n\t\tconst insertedIds = [];\n\t\tfor (let i = 0; i < docs.length; i++) {\n\t\t\tconst result = await this.insertOne(docs[i]);\n\t\t\tinsertedIds.push(result.insertedId);\n\t\t}\n\t\treturn { insertedIds: insertedIds };\n\t}\n\n\tisCapped() { throw \"Not Implemented\"; }\n\tmapReduce() { throw \"Not Implemented\"; }\n\treIndex() { throw \"Not Implemented\"; }\n\n\tasync replaceOne(query, replacement, options) { // only replace\n\t\t// first\n\t\tconst result = {};\n\t\tconst c = this.find(query);\n\t\tresult.matchedCount = c.count();\n\t\tif (result.matchedCount == 0) {\n\t\t\tresult.modifiedCount = 0;\n\t\t\tif (options && options.upsert) {\n\t\t\t\tconst newDoc = replacement;\n\t\t\t\tnewDoc._id = this.idGenerator();\n\t\t\t\tthis.storage.set(newDoc._id, newDoc);\n\t\t\t\tresult.upsertedId = newDoc._id;\n\t\t\t}\n\t\t} else {\n\t\t\tresult.modifiedCount = 1;\n\t\t\tconst doc = c.next();\n\t\t\tthis.updateIndexesOnDelete(doc);\n\t\t\treplacement._id = doc._id;\n\t\t\tthis.storage.set(doc._id, replacement);\n\t\t\tthis.updateIndexesOnInsert(replacement);\n\t\t}\n\t\treturn result;\n\t}\n\n\tremove(query, options) {\n\t\tconst c = this.find(query);\n\t\tif (!c.hasNext()) return;\n\t\tif (options === true || (options && options.justOne)) {\n\t\t\tconst doc = c.next();\n\t\t\tthis.updateIndexesOnDelete(doc);\n\t\t\tthis.storage.remove(doc._id);\n\t\t} else {\n\t\t\twhile (c.hasNext()) {\n\t\t\t\tconst doc = c.next();\n\t\t\t\tthis.updateIndexesOnDelete(doc);\n\t\t\t\tthis.storage.remove(doc._id);\n\t\t\t}\n\t\t}\n\t}\n\n\trenameCollection() { throw \"Not Implemented\"; }\n\tsave() { throw \"Not Implemented\"; }\n\tstats() { throw \"Not Implemented\"; }\n\tstorageSize() { throw \"Not Implemented\"; }\n\ttotalSize() { throw \"Not Implemented\"; }\n\ttotalIndexSize() { throw \"Not Implemented\"; }\n\n\tupdate(query, updates, options) {\n\t\tconst c = this.find(query);\n\t\tif (c.hasNext()) {\n\t\t\tif (options && options.multi) {\n\t\t\t\twhile (c.hasNext()) {\n\t\t\t\t\tconst doc = c.next();\n\t\t\t\t\tthis.updateIndexesOnDelete(doc);\n\t\t\t\t\tapplyUpdates(updates, doc);\n\t\t\t\t\tthis.storage.set(doc._id, doc);\n\t\t\t\t\tthis.updateIndexesOnInsert(doc);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst doc = c.next();\n\t\t\t\tthis.updateIndexesOnDelete(doc);\n\t\t\t\tapplyUpdates(updates, doc);\n\t\t\t\tthis.storage.set(doc._id, doc);\n\t\t\t\tthis.updateIndexesOnInsert(doc);\n\t\t\t}\n\t\t} else {\n\t\t\tif (options && options.upsert) {\n\t\t\t\tconst newDoc = createDocFromUpdate(query, updates, this.idGenerator);\n\t\t\t\tthis.storage.set(newDoc._id, newDoc);\n\t\t\t\tthis.updateIndexesOnInsert(newDoc);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync updateOne(query, updates, options) {\n\t\tconst c = this.find(query);\n\t\tif (c.hasNext()) {\n\t\t\tconst doc = c.next();\n\t\t\tthis.updateIndexesOnDelete(doc);\n\t\t\tapplyUpdates(updates, doc);\n\t\t\tthis.storage.set(doc._id, doc);\n\t\t\tthis.updateIndexesOnInsert(doc);\n\t\t} else {\n\t\t\tif (options && options.upsert) {\n\t\t\t\tconst newDoc = createDocFromUpdate(query, updates, this.idGenerator);\n\t\t\t\tthis.storage.set(newDoc._id, newDoc);\n\t\t\t\tthis.updateIndexesOnInsert(newDoc);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync updateMany(query, updates, options) {\n\t\tconst c = this.find(query);\n\t\tif (c.hasNext()) {\n\t\t\twhile (c.hasNext()) {\n\t\t\t\tconst doc = c.next();\n\t\t\t\tthis.updateIndexesOnDelete(doc);\n\t\t\t\tapplyUpdates(updates, doc);\n\t\t\t\tthis.storage.set(doc._id, doc);\n\t\t\t\tthis.updateIndexesOnInsert(doc);\n\t\t\t}\n\t\t} else {\n\t\t\tif (options && options.upsert) {\n\t\t\t\tconst newDoc = createDocFromUpdate(query, updates, this.idGenerator);\n\t\t\t\tthis.storage.set(newDoc._id, newDoc);\n\t\t\t\tthis.updateIndexesOnInsert(newDoc);\n\t\t\t}\n\t\t}\n\t}\n\n\tvalidate() { throw \"Not Implemented\"; }\n\n\t/**\n\t * Export collection state for storage\n\t * @returns {Object} Collection state including documents and indexes\n\t */\n\texportState() {\n\t\t// Export all documents\n\t\tconst documents = [];\n\t\tfor (let i = 0; i < this.storage.size(); i++) {\n\t\t\tconst doc = this.storage.get(i);\n\t\t\tif (doc) {\n\t\t\t\tdocuments.push(doc);\n\t\t\t}\n\t\t}\n\n\t\t// Export all indexes\n\t\tconst indexes = [];\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tconst index = this.indexes[indexName];\n\t\t\t\tindexes.push(index.serialize());\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tdocuments: documents,\n\t\t\tindexes: indexes\n\t\t};\n\t}\n\n\t/**\n\t * Import collection state from storage\n\t * @param {Object} state - Collection state including documents and indexes\n\t */\n\tasync importState(state) {\n\t\t// Clear existing data\n\t\tthis.storage.clear();\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tthis.indexes[indexName].clear();\n\t\t\t}\n\t\t}\n\t\tthis.indexes = {};\n\n\t\t// Import documents\n\t\tif (state.documents && Array.isArray(state.documents)) {\n\t\t\tfor (const doc of state.documents) {\n\t\t\t\tthis.storage.set(doc._id, doc);\n\t\t\t}\n\t\t}\n\n\t\t// Import indexes\n\t\tif (state.indexes && Array.isArray(state.indexes)) {\n\t\t\tfor (const indexState of state.indexes) {\n\t\t\t\t// Recreate the index based on its type\n\t\t\t\tlet index;\n\t\t\t\tif (indexState.type === 'text') {\n\t\t\t\t\tindex = new TextCollectionIndex(indexState.keys, indexState.options);\n\t\t\t\t\tindex.deserialize(indexState);\n\t\t\t\t} else if (indexState.type === 'geospatial') {\n\t\t\t\t\tindex = new GeospatialCollectionIndex(indexState.keys, indexState.options);\n\t\t\t\t\tindex.deserialize(indexState);\n\t\t\t\t} else {\n\t\t\t\t\t// Default to regular index\n\t\t\t\t\tindex = new RegularCollectionIndex(indexState.keys, indexState.options);\n\t\t\t\t\tindex.deserialize(indexState);\n\t\t\t\t}\n\t\t\t\tthis.indexes[index.name] = index;\n\t\t\t}\n\t\t}\n\t}\n}\n","/**\n * Abstract base class for storage engines\n * Defines the interface for storing and retrieving database state\n */\nexport class StorageEngine {\n\tconstructor() {\n\t\tif (new.target === StorageEngine) {\n\t\t\tthrow new TypeError(\"Cannot construct StorageEngine instances directly\");\n\t\t}\n\t}\n\n\t/**\n\t * Initialize the storage engine\n\t * @returns {Promise<void>}\n\t */\n\tasync initialize() {\n\t\tthrow new Error('initialize() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Save the entire database state\n\t * @param {Object} dbState - The database state to save\n\t * @param {string} dbState.name - The database name\n\t * @param {Object} dbState.collections - Map of collection names to collection data\n\t * @returns {Promise<void>}\n\t */\n\tasync saveDatabase(dbState) {\n\t\tthrow new Error('saveDatabase() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Load the entire database state\n\t * @param {string} dbName - The database name\n\t * @returns {Promise<Object|null>} The database state or null if not found\n\t */\n\tasync loadDatabase(dbName) {\n\t\tthrow new Error('loadDatabase() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Save a single collection's state\n\t * @param {string} dbName - The database name\n\t * @param {string} collectionName - The collection name\n\t * @param {Object} collectionState - The collection state to save\n\t * @param {Array} collectionState.documents - The documents in the collection\n\t * @param {Array} collectionState.indexes - The indexes in the collection\n\t * @returns {Promise<void>}\n\t */\n\tasync saveCollection(dbName, collectionName, collectionState) {\n\t\tthrow new Error('saveCollection() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Load a single collection's state\n\t * @param {string} dbName - The database name\n\t * @param {string} collectionName - The collection name\n\t * @returns {Promise<Object|null>} The collection state or null if not found\n\t */\n\tasync loadCollection(dbName, collectionName) {\n\t\tthrow new Error('loadCollection() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Delete a collection\n\t * @param {string} dbName - The database name\n\t * @param {string} collectionName - The collection name\n\t * @returns {Promise<void>}\n\t */\n\tasync deleteCollection(dbName, collectionName) {\n\t\tthrow new Error('deleteCollection() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Delete the entire database\n\t * @param {string} dbName - The database name\n\t * @returns {Promise<void>}\n\t */\n\tasync deleteDatabase(dbName) {\n\t\tthrow new Error('deleteDatabase() must be implemented by subclass');\n\t}\n\n\t/**\n\t * Close/cleanup the storage engine\n\t * @returns {Promise<void>}\n\t */\n\tasync close() {\n\t\tthrow new Error('close() must be implemented by subclass');\n\t}\n}\n","import { StorageEngine } from './StorageEngine.js';\n\n/**\n * In-memory storage engine (default)\n * Does not persist data between sessions\n */\nexport class ObjectStorageEngine extends StorageEngine {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.databases = {};\n\t}\n\n\t/**\n\t * Initialize the storage engine\n\t * @returns {Promise<void>}\n\t */\n\tasync initialize() {\n\t\t// No initialization needed for in-memory storage\n\t}\n\n\t/**\n\t * Save the entire database state\n\t * @param {Object} dbState - The database state to save\n\t * @returns {Promise<void>}\n\t */\n\tasync saveDatabase(dbState) {\n\t\tthis.databases[dbState.name] = JSON.parse(JSON.stringify(dbState));\n\t}\n\n\t/**\n\t * Load the entire database state\n\t * @param {string} dbName - The database name\n\t * @returns {Promise<Object|null>} The database state or null if not found\n\t */\n\tasync loadDatabase(dbName) {\n\t\tif (this.databases[dbName]) {\n\t\t\treturn JSON.parse(JSON.stringify(this.databases[dbName]));\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * Save a single collection's state\n\t * @param {string} dbName - The database name\n\t * @param {string} collectionName - The collection name\n\t * @param {Object} collectionState - The collection state to save\n\t * @returns {Promise<void>}\n\t */\n\tasync saveCollection(dbName, collectionName, collectionState) {\n\t\tif (!this.databases[dbName]) {\n\t\t\tthis.databases[dbName] = {\n\t\t\t\tname: dbName,\n\t\t\t\tcollections: {}\n\t\t\t};\n\t\t}\n\t\tthis.databases[dbName].collections[collectionName] = JSON.parse(JSON.stringify(collectionState));\n\t}\n\n\t/**\n\t * Load a single collection's state\n\t * @param {string} dbName - The database name\n\t * @param {string} collectionName - The collection name\n\t * @returns {Promise<Object|null>} The collection state or null if not found\n\t */\n\tasync loadCollection(dbName, collectionName) {\n\t\tif (this.databases[dbName] && this.databases[dbName].collections[collectionName]) {\n\t\t\treturn JSON.parse(JSON.stringify(this.databases[dbName].collections[collectionName]));\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * Delete a collection\n\t * @param {string} dbName - The database name\n\t * @param {string} collectionName - The collection name\n\t * @returns {Promise<void>}\n\t */\n\tasync deleteCollection(dbName, collectionName) {\n\t\tif (this.databases[dbName] && this.databases[dbName].collections) {\n\t\t\tdelete this.databases[dbName].collections[collectionName];\n\t\t}\n\t}\n\n\t/**\n\t * Delete the entire database\n\t * @param {string} dbName - The database name\n\t * @returns {Promise<void>}\n\t */\n\tasync deleteDatabase(dbName) {\n\t\tdelete this.databases[dbName];\n\t}\n\n\t/**\n\t * Close/cleanup the storage engine\n\t * @returns {Promise<void>}\n\t */\n\tasync close() {\n\t\t// No cleanup needed for in-memory storage\n\t}\n}\n","import { Collection } from './Collection.js';\nimport { LocalStorageStore, ObjectStore } from '../main.js';\nimport { ObjectId } from './ObjectId.js';\nimport { ObjectStorageEngine } from './ObjectStorageEngine.js';\n\n/**\n * DB class\n */\nexport class DB {\n\tconstructor(options) {\n\t\tthis.options = options || {};\n\t\tthis.dbName = this.options.dbName || 'default';\n\t\t\n\t\t// Initialize storage engine if provided\n\t\tthis.storageEngine = this.options.storageEngine || null;\n\t\t\n\t\t// Initialize localStorage collection if available\n\t\tif (typeof localStorage !== \"undefined\") {\n\t\t\tthis.localStorage = new Collection(\n\t\t\t\tthis,\n\t\t\t\t(this.options.localStorage ? this.options.localStorage : LocalStorageStore),\n\t\t\t\tthis._id.bind(this)\n\t\t\t);\n\t\t} else {\n\t\t\tthis.localStorage = null;\n\t\t}\n\n\t\t// Return a Proxy to enable dynamic collection creation\n\t\treturn new Proxy(this, {\n\t\t\tget(target, property, receiver) {\n\t\t\t\t// If property exists on target (including undefined values), return it\n\t\t\t\tif (property in target) {\n\t\t\t\t\treturn Reflect.get(target, property, receiver);\n\t\t\t\t}\n\n\t\t\t\t// If property is a symbol or special property, return undefined\n\t\t\t\tif (typeof property === 'symbol' || property.startsWith('_')) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\t// For collection names, create the collection if it doesn't exist\n\t\t\t\t// Only auto-create if it's a valid collection name and doesn't already exist\n\t\t\t\tif (typeof property === 'string' && property !== 'localStorage') {\n\t\t\t\t\t// Don't auto-create if property was explicitly deleted\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(target, property)) {\n\t\t\t\t\t\treturn target[property];\n\t\t\t\t\t}\n\t\t\t\t\t// Auto-create the collection\n\t\t\t\t\ttarget.createCollection(property);\n\t\t\t\t\treturn target[property];\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Log function\n\t */\n\t_log(msg) {\n\t\tif (this.options && this.options.print) this.options.print(msg);\n\t\telse console.log(msg);\n\t}\n\n\t/**\n\t * ID generator function\n\t */\n\t_id() {\n\t\tif (this.options && this.options.id) return this.options.id();\n\t\telse return new ObjectId();\n\t}\n\n\t// DB Methods\n\tcloneCollection() { throw \"Not Implemented\"; }\n\tcloneDatabase() { throw \"Not Implemented\"; }\n\tcommandHelp() { throw \"Not Implemented\"; }\n\tcopyDatabase() { throw \"Not Implemented\"; }\n\n\tcreateCollection(name) {\n\t\tif (!name) return;\n\t\tif (name == \"localStorage\") {\n\t\t\tthis.localStorage = new Collection(\n\t\t\t\tthis,\n\t\t\t\t(this.options.localStorage ? this.options.localStorage : LocalStorageStore),\n\t\t\t\tthis._id.bind(this)\n\t\t\t);\n\t\t} else {\n\t\t\tthis[name] = new Collection(\n\t\t\t\tthis,\n\t\t\t\t(this.options && this.options.storage ? new this.options.storage() : new ObjectStore()),\n\t\t\t\tthis._id.bind(this)\n\t\t\t);\n\t\t}\n\t}\n\n\tcurrentOp() { throw \"Not Implemented\"; }\n\n\tdropDatabase() {\n\t\tfor (const key in this) {\n\t\t\tif (this[key] != null && this[key].isCollection) {\n\t\t\t\tthis[key].drop(); // drop the contents\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t}\n\t}\n\n\teval() { throw \"Not Implemented\"; }\n\tfsyncLock() { throw \"Not Implemented\"; }\n\tfsyncUnlock() { throw \"Not Implemented\"; }\n\tgetCollection() { throw \"Not Implemented\"; }\n\tgetCollectionInfos() { throw \"Not Implemented\"; }\n\n\tgetCollectionNames() {\n\t\tconst names = [];\n\t\tfor (const key in this) {\n\t\t\tif (this[key] != null && this[key].isCollection) {\n\t\t\t\tnames.push(key);\n\t\t\t}\n\t\t}\n\t\treturn names;\n\t}\n\n\tgetLastError() { throw \"Not Implemented\"; }\n\tgetLastErrorObj() { throw \"Not Implemented\"; }\n\tgetLogComponents() { throw \"Not Implemented\"; }\n\tgetMongo() { throw \"Not Implemented\"; }\n\tgetName() { throw \"Not Implemented\"; }\n\tgetPrevError() { throw \"Not Implemented\"; }\n\tgetProfilingLevel() { throw \"Not Implemented\"; }\n\tgetProfilingStatus() { throw \"Not Implemented\"; }\n\tgetReplicationInfo() { throw \"Not Implemented\"; }\n\tgetSiblingDB() { throw \"Not Implemented\"; }\n\n\thelp() {\n\t\tthis._log(\"        help mr                      mapreduce\");\n\t\tthis._log(\"        db.foo.find()                list objects in collection foo\");\n\t\tthis._log(\"        db.foo.find( { a : 1 } )     list objects in foo where a == 1\");\n\t\tthis._log(\"        it                           result of the last line evaluated; use to further iterate\");\n\t}\n\n\thostInfo() { throw \"Not Implemented\"; }\n\tisMaster() { throw \"Not Implemented\"; }\n\tkillOp() { throw \"Not Implemented\"; }\n\tlistCommands() { throw \"Not Implemented\"; }\n\tloadServerScripts() { throw \"Not Implemented\"; }\n\tlogout() { throw \"Not Implemented\"; }\n\tprintCollectionStats() { throw \"Not Implemented\"; }\n\tprintReplicationInfo() { throw \"Not Implemented\"; }\n\tprintShardingStatus() { throw \"Not Implemented\"; }\n\tprintSlaveReplicationInfo() { throw \"Not Implemented\"; }\n\trepairDatabase() { throw \"Not Implemented\"; }\n\tresetError() { throw \"Not Implemented\"; }\n\trunCommand() { throw \"Not Implemented\"; }\n\tserverBuildInfo() { throw \"Not Implemented\"; }\n\tserverCmdLineOpts() { throw \"Not Implemented\"; }\n\tserverStatus() { throw \"Not Implemented\"; }\n\tsetLogLevel() { throw \"Not Implemented\"; }\n\tsetProfilingLevel() { throw \"Not Implemented\"; }\n\tshutdownServer() { throw \"Not Implemented\"; }\n\tstats() { throw \"Not Implemented\"; }\n\tversion() { throw \"Not Implemented\"; }\n\tupgradeCheck() { throw \"Not Implemented\"; }\n\tupgradeCheckAllDBs() { throw \"Not Implemented\"; }\n\n\t/**\n\t * Save database state to storage engine\n\t * @returns {Promise<void>}\n\t */\n\tasync saveToStorage() {\n\t\tif (!this.storageEngine) {\n\t\t\tthrow new Error('No storage engine configured. Pass a storageEngine option when creating the DB.');\n\t\t}\n\n\t\t// Initialize storage engine if needed\n\t\tif (this.storageEngine.initialize) {\n\t\t\tawait this.storageEngine.initialize();\n\t\t}\n\n\t\t// Collect all collections and their states\n\t\tconst collections = {};\n\t\tfor (const key in this) {\n\t\t\tif (this[key] != null && this[key].isCollection) {\n\t\t\t\tcollections[key] = this[key].exportState();\n\t\t\t}\n\t\t}\n\n\t\t// Save to storage engine\n\t\tawait this.storageEngine.saveDatabase({\n\t\t\tname: this.dbName,\n\t\t\tcollections: collections\n\t\t});\n\t}\n\n\t/**\n\t * Load database state from storage engine\n\t * @returns {Promise<void>}\n\t */\n\tasync loadFromStorage() {\n\t\tif (!this.storageEngine) {\n\t\t\tthrow new Error('No storage engine configured. Pass a storageEngine option when creating the DB.');\n\t\t}\n\n\t\t// Initialize storage engine if needed\n\t\tif (this.storageEngine.initialize) {\n\t\t\tawait this.storageEngine.initialize();\n\t\t}\n\n\t\t// Load from storage engine\n\t\tconst dbState = await this.storageEngine.loadDatabase(this.dbName);\n\t\t\n\t\tif (!dbState || !dbState.collections) {\n\t\t\treturn; // No saved state\n\t\t}\n\n\t\t// Drop existing collections\n\t\tthis.dropDatabase();\n\n\t\t// Restore collections\n\t\tfor (const collectionName in dbState.collections) {\n\t\t\tif (dbState.collections.hasOwnProperty(collectionName)) {\n\t\t\t\tthis.createCollection(collectionName);\n\t\t\t\tawait this[collectionName].importState(dbState.collections[collectionName]);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Save a specific collection to storage engine\n\t * @param {string} collectionName - Name of the collection to save\n\t * @returns {Promise<void>}\n\t */\n\tasync saveCollection(collectionName) {\n\t\tif (!this.storageEngine) {\n\t\t\tthrow new Error('No storage engine configured. Pass a storageEngine option when creating the DB.');\n\t\t}\n\n\t\tif (!this[collectionName] || !this[collectionName].isCollection) {\n\t\t\tthrow new Error(`Collection '${collectionName}' does not exist`);\n\t\t}\n\n\t\t// Initialize storage engine if needed\n\t\tif (this.storageEngine.initialize) {\n\t\t\tawait this.storageEngine.initialize();\n\t\t}\n\n\t\tconst collectionState = this[collectionName].exportState();\n\t\tawait this.storageEngine.saveCollection(this.dbName, collectionName, collectionState);\n\t}\n\n\t/**\n\t * Load a specific collection from storage engine\n\t * @param {string} collectionName - Name of the collection to load\n\t * @returns {Promise<void>}\n\t */\n\tasync loadCollection(collectionName) {\n\t\tif (!this.storageEngine) {\n\t\t\tthrow new Error('No storage engine configured. Pass a storageEngine option when creating the DB.');\n\t\t}\n\n\t\t// Initialize storage engine if needed\n\t\tif (this.storageEngine.initialize) {\n\t\t\tawait this.storageEngine.initialize();\n\t\t}\n\n\t\tconst collectionState = await this.storageEngine.loadCollection(this.dbName, collectionName);\n\t\t\n\t\tif (!collectionState) {\n\t\t\treturn; // No saved state for this collection\n\t\t}\n\n\t\t// Create or recreate the collection\n\t\tif (!this[collectionName]) {\n\t\t\tthis.createCollection(collectionName);\n\t\t}\n\n\t\tawait this[collectionName].importState(collectionState);\n\t}\n}\n","\r\nimport { DB } from './DB.js'\r\n// https://mongodb.github.io/node-mongodb-native/6.20/classes/MongoClient.html\r\nexport class MongoClient {\r\n\r\n  constructor(uri, options = {}) {\r\n    this.uri = uri;\r\n    this.options = options;\r\n  }\r\n\r\n  static async connect(uri, options = {}) {\r\n    return new MongoClient(uri, options);\r\n  }\r\n\r\n  db(name, opts = {}) {\r\n    // Merge client options with db-specific options\r\n    const dbOptions = { ...this.options, ...opts, dbName: name };\r\n    return new DB(dbOptions);\r\n  }\r\n\r\n  async close() {\r\n    /* no-op for in-memory */ \r\n  }\r\n}","import { StorageEngine } from './StorageEngine.js';\n\n/**\n * IndexedDB-based storage engine for persistent storage\n * Stores each collection separately in IndexedDB\n */\nexport class IndexedDbStorageEngine extends StorageEngine {\n\tconstructor(dbName = 'micro-mongo') {\n\t\tsuper();\n\t\tthis.dbName = dbName;\n\t\tthis.db = null;\n\t\tthis.indexedDBName = `micro-mongo-${dbName}`;\n\t}\n\n\t/**\n\t * Initialize the IndexedDB connection\n\t * @returns {Promise<void>}\n\t */\n\tasync initialize() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst request = indexedDB.open(this.indexedDBName, 1);\n\n\t\t\trequest.onerror = () => {\n\t\t\t\treject(new Error('Failed to open IndexedDB: ' + request.error));\n\t\t\t};\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tthis.db = request.result;\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\trequest.onupgradeneeded = (event) => {\n\t\t\t\tconst db = event.target.result;\n\t\t\t\t\n\t\t\t\t// Create object stores for collections and metadata\n\t\t\t\tif (!db.objectStoreNames.contains('collections')) {\n\t\t\t\t\tdb.createObjectStore('collections', { keyPath: 'name' });\n\t\t\t\t}\n\t\t\t\tif (!db.objectStoreNames.contains('metadata')) {\n\t\t\t\t\tdb.createObjectStore('metadata', { keyPath: 'key' });\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t}\n\n\t/**\n\t * Save the entire database state\n\t * @param {Object} dbState - The database state to save\n\t * @returns {Promise<void>}\n\t */\n\tasync saveDatabase(dbState) {\n\t\tif (!this.db) {\n\t\t\tawait this.initialize();\n\t\t}\n\n\t\t// Save metadata\n\t\tconst transaction = this.db.transaction(['metadata'], 'readwrite');\n\t\tconst metadataStore = transaction.objectStore('metadata');\n\t\t\n\t\tawait new Promise((resolve, reject) => {\n\t\t\tconst request = metadataStore.put({\n\t\t\t\tkey: 'dbName',\n\t\t\t\tvalue: dbState.name\n\t\t\t});\n\t\t\trequest.onsuccess = () => resolve();\n\t\t\trequest.onerror = () => reject(request.error);\n\t\t});\n\n\t\t// Save each collection\n\t\tfor (const collectionName in dbState.collections) {\n\t\t\tif (dbState.collections.hasOwnProperty(collectionName)) {\n\t\t\t\tawait this.saveCollection(dbState.name, collectionName, dbState.collections[collectionName]);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Load the entire database state\n\t * @param {string} dbName - The database name\n\t * @returns {Promise<Object|null>} The database state or null if not found\n\t */\n\tasync loadDatabase(dbName) {\n\t\tif (!this.db) {\n\t\t\tawait this.initialize();\n\t\t}\n\n\t\tconst transaction = this.db.transaction(['collections'], 'readonly');\n\t\tconst collectionsStore = transaction.objectStore('collections');\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst request = collectionsStore.getAll();\n\t\t\t\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tconst collections = {};\n\t\t\t\tfor (const collectionData of request.result) {\n\t\t\t\t\tcollections[collectionData.name] = {\n\t\t\t\t\t\tdocuments: collectionData.documents || [],\n\t\t\t\t\t\tindexes: collectionData.indexes || []\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tresolve({\n\t\t\t\t\tname: dbName,\n\t\t\t\t\tcollections: collections\n\t\t\t\t});\n\t\t\t};\n\t\t\t\n\t\t\trequest.onerror = () => reject(request.error);\n\t\t});\n\t}\n\n\t/**\n\t * Save a single collection's state\n\t * @param {string} dbName - The database name\n\t * @param {string} collectionName - The collection name\n\t * @param {Object} collectionState - The collection state to save\n\t * @returns {Promise<void>}\n\t */\n\tasync saveCollection(dbName, collectionName, collectionState) {\n\t\tif (!this.db) {\n\t\t\tawait this.initialize();\n\t\t}\n\n\t\tconst transaction = this.db.transaction(['collections'], 'readwrite');\n\t\tconst collectionsStore = transaction.objectStore('collections');\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst request = collectionsStore.put({\n\t\t\t\tname: collectionName,\n\t\t\t\tdocuments: collectionState.documents || [],\n\t\t\t\tindexes: collectionState.indexes || []\n\t\t\t});\n\t\t\t\n\t\t\trequest.onsuccess = () => resolve();\n\t\t\trequest.onerror = () => reject(request.error);\n\t\t});\n\t}\n\n\t/**\n\t * Load a single collection's state\n\t * @param {string} dbName - The database name\n\t * @param {string} collectionName - The collection name\n\t * @returns {Promise<Object|null>} The collection state or null if not found\n\t */\n\tasync loadCollection(dbName, collectionName) {\n\t\tif (!this.db) {\n\t\t\tawait this.initialize();\n\t\t}\n\n\t\tconst transaction = this.db.transaction(['collections'], 'readonly');\n\t\tconst collectionsStore = transaction.objectStore('collections');\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst request = collectionsStore.get(collectionName);\n\t\t\t\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tif (request.result) {\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tdocuments: request.result.documents || [],\n\t\t\t\t\t\tindexes: request.result.indexes || []\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tresolve(null);\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\trequest.onerror = () => reject(request.error);\n\t\t});\n\t}\n\n\t/**\n\t * Delete a collection\n\t * @param {string} dbName - The database name\n\t * @param {string} collectionName - The collection name\n\t * @returns {Promise<void>}\n\t */\n\tasync deleteCollection(dbName, collectionName) {\n\t\tif (!this.db) {\n\t\t\tawait this.initialize();\n\t\t}\n\n\t\tconst transaction = this.db.transaction(['collections'], 'readwrite');\n\t\tconst collectionsStore = transaction.objectStore('collections');\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst request = collectionsStore.delete(collectionName);\n\t\t\trequest.onsuccess = () => resolve();\n\t\t\trequest.onerror = () => reject(request.error);\n\t\t});\n\t}\n\n\t/**\n\t * Delete the entire database\n\t * @param {string} dbName - The database name\n\t * @returns {Promise<void>}\n\t */\n\tasync deleteDatabase(dbName) {\n\t\tif (this.db) {\n\t\t\tthis.db.close();\n\t\t\tthis.db = null;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst request = indexedDB.deleteDatabase(this.indexedDBName);\n\t\t\trequest.onsuccess = () => resolve();\n\t\t\trequest.onerror = () => reject(request.error);\n\t\t});\n\t}\n\n\t/**\n\t * Close/cleanup the storage engine\n\t * @returns {Promise<void>}\n\t */\n\tasync close() {\n\t\tif (this.db) {\n\t\t\tthis.db.close();\n\t\t\tthis.db = null;\n\t\t}\n\t}\n}\n","/**\n * MicroMongoDB - Lightweight MongoDB-compatible database\n * Refactored into separate class files\n */\n\n/**\n * MicroMongoDB.LocalStorageStore\n * \n * Singleton\n */\nexport const LocalStorageStore = (function() {\n\n\treturn {\n\t\tclear : function() {\n\t\t\tlocalStorage.clear();\n\t\t},\n\t\tget : function(i) {\n\t\t\treturn JSON.parse(localStorage.getItem(localStorage.key(i)));\n\t\t},\n\t\tgetStore : function() {\n\t\t\treturn localStorage;\n\t\t},\n\t\tremove : function(key) {\n\t\t\tlocalStorage.removeItem(key);\n\t\t},\n\t\tset : async function(key,val) {\n\t\t\tlocalStorage.setItem(key,JSON.stringify(val));\n\t\t},\n\t\tsize : function() {\n\t\t\treturn localStorage.length;\n\t\t}\n\t};\n\n})(); // MicroMongoDB.LocalStorageStore\n\n/**\n * MicroMongoDB.ObjectStore\n * \n * Public Constructor Function\n */\nexport const ObjectStore = function() {\n\n\tvar objs = {};\n\n\treturn {\n\t\tclear : function() {\n\t\t\tobjs = {};\n\t\t},\n\t\tget : function(i) {\n\t\t\treturn objs[Object.keys(objs)[i]];\n\t\t},\n\t\tgetStore : function() {\n\t\t\treturn objs;\n\t\t},\n\t\tremove : function(key) {\n\t\t\tdelete objs[key];\n\t\t},\n\t\tset : function(key,val) {\n\t\t\tobjs[key] = val;\n\t\t},\n\t\tsize : function() {\n\t\t\treturn Object.keys(objs).length;\n\t\t}\n\t}; // MicroMongoDB.ObjectStore return\n}; // MicroMongoDB.ObjectStore\n\n// Export refactored classes\nexport { MongoClient } from './src/MongoClient.js';\nexport { ObjectId } from './src/ObjectId.js';\nexport { StorageEngine } from './src/StorageEngine.js';\nexport { IndexedDbStorageEngine } from './src/IndexedDbStorageEngine.js';\nexport { ObjectStorageEngine } from './src/ObjectStorageEngine.js';\n"],"names":["valuesEqual","matches","SortedCursor","text"],"mappings":"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","x_google_ignoreList":[4]}