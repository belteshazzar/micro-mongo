{"version":3,"file":"micro-mongo-client.js","sources":["../node_modules/events/events.js","../src/errors.js","../src/client/ProxyChangeStream.js","../src/client/ProxyCursor.js","../src/client/ProxyCollection.js","../src/client/ProxyDB.js","../src/client/MongoClient.js","../node_modules/bjson/src/bjson.js","../src/utils.js","../node_modules/stemmer/index.js","../node_modules/bjson/src/textindex.js","../src/server/aggregationExpressions.js","../src/server/queryMatcher.js","../src/server/ChangeStream.js","../src/client/WorkerBridge.js"],"sourcesContent":["// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","/**\n * MongoDB Error Classes\n * \n * Structured error hierarchy compatible with MongoDB driver\n */\n\n/**\n * Error codes matching MongoDB error codes\n */\nexport const ErrorCodes = {\n\t// General errors\n\tOK: 0,\n\tINTERNAL_ERROR: 1,\n\tBAD_VALUE: 2,\n\tNO_SUCH_KEY: 4,\n\tGRAPH_CONTAINS_CYCLE: 5,\n\tHOST_UNREACHABLE: 6,\n\tHOST_NOT_FOUND: 7,\n\tUNKNOWN_ERROR: 8,\n\tFAILED_TO_PARSE: 17287, // Using test-compatible error code\n\tCANNOT_MUTATE_OBJECT: 10,\n\tUSER_NOT_FOUND: 11,\n\tUNSUPPORTED_FORMAT: 12,\n\tUNAUTHORIZED: 13,\n\tTYPE_MISMATCH: 14,\n\tOVERFLOW: 15,\n\tINVALID_LENGTH: 16,\n\tPROTOCOL_ERROR: 17,\n\tAUTHENTICATION_FAILED: 18,\n\tILLEGAL_OPERATION: 20,\n\tNAMESPACE_NOT_FOUND: 26,\n\tINDEX_NOT_FOUND: 27,\n\tPATH_NOT_VIABLE: 28,\n\tCANNOT_CREATE_INDEX: 67,\n\tINDEX_ALREADY_EXISTS: 68,\n\tINDEX_EXISTS: 68,\n\tCOMMAND_NOT_FOUND: 59,\n\tNAMESPACE_EXISTS: 48,\n\tINVALID_NAMESPACE: 73,\n\tINDEX_OPTIONS_CONFLICT: 85,\n\tINVALID_INDEX_SPECIFICATION_OPTION: 197,\n\t\n\t// Write errors\n\tWRITE_CONFLICT: 112,\n\tDUPLICATE_KEY: 11000,\n\tDUPLICATE_KEY_UPDATE: 11001,\n\t\n\t// Validation errors\n\tDOCUMENT_VALIDATION_FAILURE: 121,\n\t\n\t// Query errors\n\tBAD_QUERY: 2,\n\tCANNOT_INDEX_PARALLEL_ARRAYS: 171,\n\t\n\t// Cursor errors\n\tCURSOR_NOT_FOUND: 43,\n\t\n\t// Collection errors\n\tCOLLECTION_IS_EMPTY: 26,\n  CANNOT_DO_EXCLUSION_ON_FIELD_ID_IN_INCLUSION_PROJECTION: 31254,\n\t\n\t// Not implemented (custom code)\n\tNOT_IMPLEMENTED: 999,\n\tOPERATION_NOT_SUPPORTED: 998\n};\n\n/**\n * Base class for all MongoDB errors\n */\nexport class MongoError extends Error {\n\tconstructor(message, options = {}) {\n\t\tsuper(message);\n\t\tthis.name = 'MongoError';\n\t\tthis.code = options.code || ErrorCodes.UNKNOWN_ERROR;\n\t\tthis.codeName = this._getCodeName(this.code);\n\t\t\n\t\t// Backward compatibility: add $err property matching old error format\n\t\tthis.$err = message;\n\t\t\n\t\t// Additional context\n\t\tif (options.collection) this.collection = options.collection;\n\t\tif (options.database) this.database = options.database;\n\t\tif (options.operation) this.operation = options.operation;\n\t\tif (options.query) this.query = options.query;\n\t\tif (options.document) this.document = options.document;\n\t\tif (options.field) this.field = options.field;\n\t\tif (options.index) this.index = options.index;\n\t\t\n\t\t// Capture stack trace\n\t\tif (Error.captureStackTrace) {\n\t\t\tError.captureStackTrace(this, this.constructor);\n\t\t}\n\t}\n\t\n\t_getCodeName(code) {\n\t\tconst codeToName = {\n\t\t\t0: 'OK',\n\t\t\t1: 'InternalError',\n\t\t\t2: 'BadValue',\n\t\t\t4: 'NoSuchKey',\n\t\t\t5: 'GraphContainsCycle',\n\t\t\t6: 'HostUnreachable',\n\t\t\t7: 'HostNotFound',\n\t\t\t8: 'UnknownError',\n\t\t\t10: 'CannotMutateObject',\n\t\t\t11: 'UserNotFound',\n\t\t\t12: 'UnsupportedFormat',\n\t\t\t13: 'Unauthorized',\n\t\t\t14: 'TypeMismatch',\n\t\t\t15: 'Overflow',\n\t\t\t16: 'InvalidLength',\n\t\t\t17: 'ProtocolError',\n\t\t\t18: 'AuthenticationFailed',\n\t\t\t20: 'IllegalOperation',\n\t\t\t26: 'NamespaceNotFound',\n\t\t\t27: 'IndexNotFound',\n\t\t\t28: 'PathNotViable',\n\t\t\t43: 'CursorNotFound',\n\t\t\t48: 'NamespaceExists',\n\t\t\t59: 'CommandNotFound',\n\t\t\t67: 'CannotCreateIndex',\n\t\t\t68: 'IndexExists',\n\t\t\t73: 'InvalidNamespace',\n\t\t\t85: 'IndexOptionsConflict',\n\t\t\t112: 'WriteConflict',\n\t\t\t121: 'DocumentValidationFailure',\n\t\t\t171: 'CannotIndexParallelArrays',\n\t\t\t197: 'InvalidIndexSpecificationOption',\n\t\t\t998: 'OperationNotSupported',\n\t\t\t999: 'NotImplemented',\n\t\t\t11000: 'DuplicateKey',\n\t\t\t11001: 'DuplicateKeyUpdate',\n\t\t\t17287: 'FailedToParse'\n\t\t};\n\t\treturn codeToName[code] || 'UnknownError';\n\t}\n\t\n\ttoJSON() {\n\t\tconst json = {\n\t\t\tname: this.name,\n\t\t\tmessage: this.message,\n\t\t\tcode: this.code,\n\t\t\tcodeName: this.codeName\n\t\t};\n\t\t\n\t\t// Include all enumerable properties\n\t\tif (this.collection) json.collection = this.collection;\n\t\tif (this.database) json.database = this.database;\n\t\tif (this.operation) json.operation = this.operation;\n\t\tif (this.index) json.index = this.index;\n\t\tif (this.indexName) json.indexName = this.indexName;\n\t\tif (this.field) json.field = this.field;\n\t\tif (this.query) json.query = this.query;\n\t\tif (this.document) json.document = this.document;\n\t\tif (this.namespace) json.namespace = this.namespace;\n\t\tif (this.cursorId) json.cursorId = this.cursorId;\n\t\tif (this.feature) json.feature = this.feature;\n\t\tif (this.keyPattern) json.keyPattern = this.keyPattern;\n\t\tif (this.keyValue) json.keyValue = this.keyValue;\n\t\tif (this.writeErrors) json.writeErrors = this.writeErrors;\n\t\t\n\t\treturn json;\n\t}\n}\n\n/**\n * Server-side errors\n */\nexport class MongoServerError extends MongoError {\n\tconstructor(message, options = {}) {\n\t\tsuper(message, options);\n\t\tthis.name = 'MongoServerError';\n\t}\n}\n\n/**\n * Driver-side errors (client errors)\n */\nexport class MongoDriverError extends MongoError {\n\tconstructor(message, options = {}) {\n\t\tsuper(message, options);\n\t\tthis.name = 'MongoDriverError';\n\t\tthis.code = options.code || ErrorCodes.INTERNAL_ERROR;\n\t}\n}\n\n/**\n * Write operation errors\n */\nexport class WriteError extends MongoError {\n\tconstructor(message, options = {}) {\n\t\tsuper(message, options);\n\t\tthis.name = 'WriteError';\n\t\tthis.code = options.code || ErrorCodes.WRITE_CONFLICT;\n\t}\n}\n\n/**\n * Duplicate key error\n */\nexport class DuplicateKeyError extends WriteError {\n\tconstructor(key, options = {}) {\n\t\tconst keyStr = JSON.stringify(key);\n\t\tconst message = `E11000 duplicate key error${options.collection ? ` collection: ${options.collection}` : ''} index: ${keyStr} dup key: ${keyStr}`;\n\t\tsuper(message, { ...options, code: ErrorCodes.DUPLICATE_KEY });\n\t\tthis.name = 'DuplicateKeyError';\n\t\tthis.keyPattern = key;\n\t\tthis.keyValue = options.keyValue || key;\n\t}\n}\n\n/**\n * Document validation errors\n */\nexport class ValidationError extends MongoError {\n\tconstructor(message, options = {}) {\n\t\tsuper(message, options);\n\t\tthis.name = 'ValidationError';\n\t\tthis.code = options.code || ErrorCodes.DOCUMENT_VALIDATION_FAILURE;\n\t\tthis.validationErrors = options.validationErrors || [];\n\t}\n}\n\n/**\n * Index-related errors\n */\nexport class IndexError extends MongoError {\n\tconstructor(message, options = {}) {\n\t\tsuper(message, options);\n\t\tthis.name = 'IndexError';\n\t}\n}\n\n/**\n * Index already exists error\n */\nexport class IndexExistsError extends IndexError {\n\tconstructor(indexName, options = {}) {\n\t\tsuper(`Index with name '${indexName}' already exists`, {\n\t\t\t...options,\n\t\t\tcode: ErrorCodes.INDEX_EXISTS\n\t\t});\n\t\tthis.name = 'IndexExistsError';\n\t\tthis.indexName = indexName;\n\t}\n}\n\n/**\n * Index not found error\n */\nexport class IndexNotFoundError extends IndexError {\n\tconstructor(indexName, options = {}) {\n\t\tsuper(`Index '${indexName}' not found`, {\n\t\t\t...options,\n\t\t\tcode: ErrorCodes.INDEX_NOT_FOUND,\n\t\t\tindex: indexName\n\t\t});\n\t\tthis.name = 'IndexNotFoundError';\n\t\tthis.indexName = indexName;\n\t}\n}\n\n/**\n * Cannot create index error\n */\nexport class CannotCreateIndexError extends IndexError {\n\tconstructor(reason, options = {}) {\n\t\tsuper(`Cannot create index: ${reason}`, {\n\t\t\t...options,\n\t\t\tcode: ErrorCodes.CANNOT_CREATE_INDEX\n\t\t});\n\t\tthis.name = 'CannotCreateIndexError';\n\t}\n}\n\n/**\n * Query errors\n */\nexport class QueryError extends MongoError {\n\tconstructor(message, options = {}) {\n\t\tsuper(message, options);\n\t\tthis.name = 'QueryError';\n\t\tthis.code = options.code || ErrorCodes.BAD_QUERY;\n\t}\n}\n\n/**\n * Type mismatch error\n */\nexport class TypeMismatchError extends MongoError {\n\tconstructor(field, expectedType, actualType, options = {}) {\n\t\tsuper(\n\t\t\t`Type mismatch for field '${field}': expected ${expectedType}, got ${actualType}`,\n\t\t\t{ ...options, code: ErrorCodes.TYPE_MISMATCH, field }\n\t\t);\n\t\tthis.name = 'TypeMismatchError';\n\t\tthis.expectedType = expectedType;\n\t\tthis.actualType = actualType;\n\t}\n}\n\n/**\n * Namespace errors\n */\nexport class NamespaceError extends MongoError {\n\tconstructor(message, options = {}) {\n\t\tsuper(message, options);\n\t\tthis.name = 'NamespaceError';\n\t}\n}\n\n/**\n * Namespace not found\n */\nexport class NamespaceNotFoundError extends NamespaceError {\n\tconstructor(namespace, options = {}) {\n\t\tsuper(`Namespace '${namespace}' not found`, {\n\t\t\t...options,\n\t\t\tcode: ErrorCodes.NAMESPACE_NOT_FOUND\n\t\t});\n\t\tthis.name = 'NamespaceNotFoundError';\n\t\tthis.namespace = namespace;\n\t}\n}\n\n/**\n * Invalid namespace\n */\nexport class InvalidNamespaceError extends NamespaceError {\n\tconstructor(namespace, reason, options = {}) {\n\t\t// Handle case where reason is actually options\n\t\tif (typeof reason === 'object' && !options) {\n\t\t\toptions = reason;\n\t\t\treason = undefined;\n\t\t}\n\t\tconst msg = reason ? `Invalid namespace '${namespace}': ${reason}` : `Invalid namespace '${namespace}'`;\n\t\tsuper(msg, {\n\t\t\t...options,\n\t\t\tcode: ErrorCodes.INVALID_NAMESPACE\n\t\t});\n\t\tthis.name = 'InvalidNamespaceError';\n\t\tthis.namespace = namespace;\n\t}\n}\n\n/**\n * Cursor errors\n */\nexport class CursorError extends MongoError {\n\tconstructor(message, options = {}) {\n\t\tsuper(message, options);\n\t\tthis.name = 'CursorError';\n\t}\n}\n\n/**\n * Cursor not found\n */\nexport class CursorNotFoundError extends CursorError {\n\tconstructor(cursorId, options = {}) {\n\t\tsuper(`Cursor ${cursorId} not found`, {\n\t\t\t...options,\n\t\t\tcode: ErrorCodes.CURSOR_NOT_FOUND\n\t\t});\n\t\tthis.name = 'CursorNotFoundError';\n\t\tthis.cursorId = cursorId;\n\t}\n}\n\n/**\n * Not implemented error\n */\nexport class NotImplementedError extends MongoError {\n\tconstructor(feature, options = {}) {\n\t\tsuper(`${feature} is not implemented in micro-mongo`, {\n\t\t\t...options,\n\t\t\tcode: ErrorCodes.NOT_IMPLEMENTED\n\t\t});\n\t\tthis.name = 'NotImplementedError';\n\t\tthis.feature = feature;\n\t}\n}\n\n/**\n * Operation not supported\n */\nexport class OperationNotSupportedError extends MongoError {\n\tconstructor(operation, reason, options = {}) {\n\t\t// Handle case where reason is actually options\n\t\tif (typeof reason === 'object' && !options) {\n\t\t\toptions = reason;\n\t\t\treason = undefined;\n\t\t}\n\t\tconst msg = reason ? `Operation '${operation}' is not supported: ${reason}` : `Operation '${operation}' is not supported`;\n\t\tsuper(msg, {\n\t\t\t...options,\n\t\t\tcode: ErrorCodes.OPERATION_NOT_SUPPORTED,\n\t\t\toperation\n\t\t});\n\t\tthis.name = 'OperationNotSupportedError';\n\t}\n}\n\n/**\n * Bad value error\n */\nexport class BadValueError extends MongoError {\n\tconstructor(field, value, reason, options = {}) {\n\t\tsuper(`Bad value for field '${field}': ${reason}`, {\n\t\t\t...options,\n\t\t\tcode: ErrorCodes.BAD_VALUE,\n\t\t\tfield\n\t\t});\n\t\tthis.name = 'BadValueError';\n\t\tthis.value = value;\n\t}\n}\n\n/**\n * Bulk write error\n */\nexport class BulkWriteError extends MongoError {\n\tconstructor(writeErrors = [], options = {}) {\n\t\tconst message = `Bulk write operation error: ${writeErrors.length} error(s)`;\n\t\tsuper(message, options);\n\t\tthis.name = 'BulkWriteError';\n\t\tthis.writeErrors = writeErrors;\n\t\tthis.code = options.code || ErrorCodes.WRITE_CONFLICT;\n\t}\n}\n\n/**\n * Network error (for API compatibility, not functional in micro-mongo)\n */\nexport class MongoNetworkError extends MongoError {\n\tconstructor(message, options = {}) {\n\t\tsuper(message, options);\n\t\tthis.name = 'MongoNetworkError';\n\t\tthis.code = options.code || ErrorCodes.HOST_UNREACHABLE;\n\t}\n}\n\n/**\n * Helper function to create appropriate error\n */\nexport function createError(type, ...args) {\n\tswitch (type) {\n\t\tcase 'duplicate_key':\n\t\t\treturn new DuplicateKeyError(...args);\n\t\tcase 'validation':\n\t\t\treturn new ValidationError(...args);\n\t\tcase 'index_exists':\n\t\t\treturn new IndexExistsError(...args);\n\t\tcase 'index_not_found':\n\t\t\treturn new IndexNotFoundError(...args);\n\t\tcase 'cannot_create_index':\n\t\t\treturn new CannotCreateIndexError(...args);\n\t\tcase 'query':\n\t\t\treturn new QueryError(...args);\n\t\tcase 'type_mismatch':\n\t\t\treturn new TypeMismatchError(...args);\n\t\tcase 'namespace_not_found':\n\t\t\treturn new NamespaceNotFoundError(...args);\n\t\tcase 'invalid_namespace':\n\t\t\treturn new InvalidNamespaceError(...args);\n\t\tcase 'cursor_not_found':\n\t\t\treturn new CursorNotFoundError(...args);\n\t\tcase 'not_implemented':\n\t\t\treturn new NotImplementedError(...args);\n\t\tcase 'operation_not_supported':\n\t\t\treturn new OperationNotSupportedError(...args);\n\t\tcase 'bad_value':\n\t\t\treturn new BadValueError(...args);\n\t\tcase 'write':\n\t\t\treturn new WriteError(...args);\n\t\tdefault:\n\t\t\treturn new MongoError(...args);\n\t}\n}\n","import { EventEmitter } from 'events';\nimport { NotImplementedError } from '../errors.js';\n\n/**\n * ProxyChangeStream listens for forwarded events from the worker.\n */\nexport class ProxyChangeStream extends EventEmitter {\n  static create({ bridge, database, collection, streamId, pipeline = [], options = {} }) {\n    const stream = new ProxyChangeStream({ bridge, streamId });\n    \n    if (!streamId) {\n      // Determine target type based on what we're watching\n      let target, method;\n      if (database === null || database === undefined) {\n        // Client-level watch (all databases and collections)\n        target = 'client';\n        method = 'watch';\n      } else if (collection === null || collection === undefined) {\n        // Database-level watch\n        target = 'db';\n        method = 'watch';\n      } else {\n        // Collection-level watch\n        target = 'collection';\n        method = 'watch';\n      }\n      \n      // Request a change stream from worker asynchronously\n      bridge.sendRequest({\n        target,\n        database,\n        collection,\n        method,\n        args: [pipeline, options]\n      }).then((resp) => {\n        if (resp && resp.streamId) {\n          stream.streamId = resp.streamId; // Update stream with the ID\n        }\n      }).catch(() => {\n        // Ignore errors during async initialization\n      });\n    }\n\n    return stream;\n  }\n\n  constructor({ bridge, streamId }) {\n    super();\n    this.bridge = bridge;\n    this.streamId = streamId;\n    this.closed = false;\n    this._pendingNext = []; // Track pending next() promises\n\n    this._onEvent = this._onEvent.bind(this);\n    this.bridge.on('event', this._onEvent);\n  }\n\n  _onEvent(eventName, payload) {\n    if (eventName !== 'changeStream') return;\n    if (!payload || payload.streamId !== this.streamId) return;\n\n    const { type, data } = payload;\n    if (type === 'change') this.emit('change', data);\n    if (type === 'error') this.emit('error', data);\n    if (type === 'close') {\n      this.emit('close');\n      this._cleanup();\n    }\n  }\n\n  _cleanup() {\n    this.bridge.off('event', this._onEvent);\n  }\n\n  async close() {\n    if (this.closed) return;\n    this.closed = true;\n    \n    // Resolve all pending next() calls with null\n    for (const pending of this._pendingNext) {\n      pending.resolve(null);\n    }\n    this._pendingNext = [];\n    \n    // Send close request to server (don't await to avoid blocking)\n    this.bridge.sendRequest({\n      target: 'changestream',\n      streamId: this.streamId,\n      method: 'close'\n    }).catch(() => {\n      // Ignore errors from server-side close\n    });\n    \n    // Emit close event locally\n    this.emit('close');\n    \n    // Cleanup\n    this._cleanup();\n  }\n\n  async next() {\n    // If already closed, return null immediately\n    if (this.closed) {\n      return null;\n    }\n    \n    // Return a promise that resolves when the next change event arrives\n    return new Promise((resolve, reject) => {\n      const onChange = (change) => {\n        this._removePending(pending);\n        this.off('change', onChange);\n        this.off('error', onError);\n        this.off('close', onClose);\n        resolve(change);\n      };\n      const onError = (error) => {\n        this._removePending(pending);\n        this.off('change', onChange);\n        this.off('error', onError);\n        this.off('close', onClose);\n        reject(error);\n      };\n      const onClose = () => {\n        this._removePending(pending);\n        this.off('change', onChange);\n        this.off('error', onError);\n        this.off('close', onClose);\n        resolve(null);\n      };\n      \n      // Track this pending promise\n      const pending = { resolve, reject };\n      this._pendingNext.push(pending);\n      \n      this.on('change', onChange);\n      this.on('error', onError);\n      this.on('close', onClose);\n    });\n  }\n  \n  _removePending(pending) {\n    const index = this._pendingNext.indexOf(pending);\n    if (index !== -1) {\n      this._pendingNext.splice(index, 1);\n    }\n  }\n}\n","/**\n * ProxyCursor lives on the main thread and batches getMore calls to the worker.\n */\nexport class ProxyCursor {\n  constructor({ bridge, cursorId, batch = [], exhausted = false, batchSize = 100, requestPromise, requestPayload }) {\n    this.bridge = bridge;\n    this.cursorId = cursorId;\n    this.buffer = Array.isArray(batch) ? batch : [];\n    this.exhausted = exhausted || false;\n    this._batchSize = batchSize;\n    this._requestPromise = requestPromise || null;\n    this._requestPayload = requestPayload || null; // Store payload for delayed execution\n    this._initialized = !requestPromise && !requestPayload; // If no requestPromise or payload, already initialized\n  }\n\n  async _ensureInitialized() {\n    if (this._initialized) return;\n    \n    // If we have a payload (delayed execution), build the request with cursor modifiers\n    if (this._requestPayload) {\n      const cursorOpts = {};\n      if (this._limit !== undefined) cursorOpts.limit = this._limit;\n      if (this._skip !== undefined) cursorOpts.skip = this._skip;\n      if (this._sort !== undefined) cursorOpts.sort = this._sort;\n      if (this._min !== undefined) cursorOpts.min = this._min;\n      if (this._max !== undefined) cursorOpts.max = this._max;\n      if (this._hint !== undefined) cursorOpts.hint = this._hint;\n      if (this._comment !== undefined) cursorOpts.comment = this._comment;\n      if (this._maxTimeMS !== undefined) cursorOpts.maxTimeMS = this._maxTimeMS;\n      if (this._maxScan !== undefined) cursorOpts.maxScan = this._maxScan;\n      if (this._returnKey !== undefined) cursorOpts.returnKey = this._returnKey;\n      if (this._showRecordId !== undefined) cursorOpts.showRecordId = this._showRecordId;\n      if (this._collation !== undefined) cursorOpts.collation = this._collation;\n      \n      // Attach cursor options to the payload\n      this._requestPayload.cursorOpts = cursorOpts;\n      \n      const res = await this.bridge.sendRequest(this._requestPayload);\n      this.cursorId = res.cursorId;\n      this.buffer = res.batch || [];\n      this.exhausted = res.exhausted || false;\n      this._batchSize = res.batchSize || 100;\n      this._requestPayload = null;\n      this._initialized = true;\n    } else if (this._requestPromise) {\n      // Legacy path for already-initiated requests\n      const res = await this._requestPromise;\n      this.cursorId = res.cursorId;\n      this.buffer = res.batch || [];\n      this.exhausted = res.exhausted || false;\n      this._batchSize = res.batchSize || 100;\n      this._requestPromise = null;\n      this._initialized = true;\n    }\n  }\n\n  async hasNext() {\n    if (this._closed) return false;\n    await this._ensureInitialized();\n    if (this.buffer.length > 0) return true;\n    if (this.exhausted) return false;\n    await this._getMore();\n    return this.buffer.length > 0;\n  }\n\n  async next() {\n    const has = await this.hasNext();\n    if (!has) return null;\n    return this.buffer.shift();\n  }\n\n  async toArray() {\n    await this._ensureInitialized();\n    const results = [...this.buffer];\n    this.buffer = [];\n    while (!this.exhausted) {\n      await this._getMore();\n      results.push(...this.buffer);\n      this.buffer = [];\n    }\n    return results;\n  }\n\n  async count() {\n    // Fetch all documents and return count\n    const arr = await this.toArray();\n    return arr.length;\n  }\n\n  // Cursor modifiers that return this for chaining\n  limit(n) {\n    this._limit = n;\n    return this;\n  }\n\n  skip(n) {\n    this._skip = n;\n    return this;\n  }\n\n  sort(spec) {\n    this._sort = spec;\n    return this;\n  }\n\n  batchSize(n) {\n    this._batchSize = n;\n    return this;\n  }\n\n  // Cursor metadata methods\n  async close() {\n    this._closed = true;\n    await this._closeRemote();\n    // Return false to match MongoDB behavior (false means not already closed)\n    return false;\n  }\n\n  isClosed() {\n    return this._closed || false;\n  }\n\n  comment(str) {\n    this._comment = str;\n    return this;\n  }\n\n  hint(spec) {\n    this._hint = spec;\n    return this;\n  }\n\n  explain(verbosity = 'queryPlanner') {\n    // Return a basic explanation without sending to worker\n    // Since we already have the cursor initialized, we can provide basic info\n    const result = {\n      queryPlanner: {\n        plannerVersion: 1,\n        namespace: `unknown`,\n        indexFilterSet: false,\n        parsedQuery: {},\n        winningPlan: {\n          stage: 'COLLSCAN'\n        }\n      },\n      ok: 1\n    };\n    \n    if (verbosity === 'executionStats' || verbosity === 'allPlansExecution') {\n      result.executionStats = {\n        executionSuccess: true,\n        nReturned: 0,\n        executionTimeMillis: 0\n      };\n    }\n    \n    return result;\n  }\n\n  async itcount() {\n    // Iterate and count - must respect limit/skip\n    let count = 0;\n    while (await this.hasNext()) {\n      await this.next();\n      count++;\n    }\n    return count;\n  }\n\n  size() {\n    // Return count of documents currently in buffer (without fetching more)\n    return this.buffer.length;\n  }\n\n  min(spec) {\n    this._min = spec;\n    this._minIndexBounds = spec;\n    return this;\n  }\n\n  max(spec) {\n    this._max = spec;\n    this._maxIndexBounds = spec;\n    return this;\n  }\n\n  maxTimeMS(ms) {\n    this._maxTimeMS = ms;\n    return this;\n  }\n\n  maxScan(n) {\n    this._maxScan = n;\n    return this;\n  }\n\n  noCursorTimeout() {\n    this._noCursorTimeout = true;\n    return this;\n  }\n\n  objsLeftInBatch() {\n    return this.buffer.length;\n  }\n\n  pretty() {\n    this._pretty = true;\n    return this;\n  }\n\n  readConcern(level) {\n    this._readConcern = level;\n    return this;\n  }\n\n  readPref(mode, tagSet) {\n    this._readPref = { mode, tagSet };\n    return this;\n  }\n\n  returnKey(bool = true) {\n    this._returnKey = bool;\n    return this;\n  }\n\n  showRecordId(bool = true) {\n    this._showRecordId = bool;\n    return this;\n  }\n\n  allowDiskUse(bool = true) {\n    this._allowDiskUse = bool;\n    return this;\n  }\n\n  collation(spec) {\n    this._collation = spec;\n    return this;\n  }\n\n  async forEach(fn) {\n    while (await this.hasNext()) {\n      const doc = await this.next();\n      await fn(doc);\n    }\n  }\n\n  async map(fn) {\n    const results = [];\n    while (await this.hasNext()) {\n      const doc = await this.next();\n      results.push(await fn(doc));\n    }\n    return results;\n  }\n\n  // Support async iteration\n  async *[Symbol.asyncIterator]() {\n    while (await this.hasNext()) {\n      yield await this.next();\n    }\n  }\n\n  async _getMore() {\n    if (this.exhausted) return;\n    const resp = await this.bridge.sendRequest({\n      target: 'cursor',\n      cursorId: this.cursorId,\n      method: 'getMore',\n      args: [{ batchSize: this._batchSize }]\n    });\n    this.buffer = resp?.batch || [];\n    this.exhausted = !!resp?.exhausted;\n    if (this.exhausted) {\n      // Optionally inform worker to clean up (close)\n      await this._closeRemote();\n    }\n  }\n\n  async _closeRemote() {\n    if (!this.cursorId) return;\n    try {\n      await this.bridge.sendRequest({\n        target: 'cursor',\n        cursorId: this.cursorId,\n        method: 'close'\n      });\n    } catch (_) {\n      // Swallow cleanup errors\n    }\n    this.cursorId = null;\n  }\n}\n","import { ProxyChangeStream } from './ProxyChangeStream.js';\nimport { ProxyCursor } from './ProxyCursor.js';\nimport { NotImplementedError, QueryError, ErrorCodes } from '../errors.js';\n\n/**\n * ProxyCollection lives on the main thread and forwards operations to the worker Server.\n */\nexport class ProxyCollection {\n  constructor({ dbName, name, bridge, db }) {\n    this.dbName = dbName;\n    this.name = name;\n    this.bridge = bridge;\n    this._db = db; // Reference to ProxyDB for registering new collections\n    this.indexes = []; // Track indexes locally\n\n    return new Proxy(this, {\n      get: (target, prop, receiver) => {\n        if (prop in target) return Reflect.get(target, prop, receiver);\n        if (typeof prop === 'symbol' || String(prop).startsWith('_')) return undefined;\n        if (prop === 'watch') {\n          return (...args) => target._watch(...args);\n        }\n        // Special handling for methods that return cursors - return cursor immediately\n        if (prop === 'find' || prop === 'aggregate') {\n          return (...args) => target._cursorMethod(String(prop), args);\n        }\n        return (...args) => target._call(String(prop), args);\n      }\n    });\n  }\n\n  _cursorMethod(method, args = []) {\n    // Validate projection for find() calls to catch errors early\n    if (method === 'find' && args.length >= 2) {\n      this._validateProjection(args[1]);\n    }\n    \n    // Return cursor immediately - it will fetch data asynchronously with delayed execution\n    const requestPayload = {\n      target: 'collection',\n      database: this.dbName,\n      collection: this.name,\n      method,\n      args\n    };\n\n    const cursor = new ProxyCursor({\n      bridge: this.bridge,\n      requestPayload\n    });\n\n    // For aggregate, also make the cursor thenable so await works like in older API\n    if (method === 'aggregate') {\n      cursor.then = function(onFulfilled, onRejected) {\n        return this.toArray().then(onFulfilled, onRejected);\n      };\n    }\n\n    return cursor;\n  }\n\n  _validateProjection(projection) {\n    if (!projection || Object.keys(projection).length === 0) return;\n    \n    const keys = Object.keys(projection);\n    let hasInclusion = false;\n    let hasExclusion = false;\n\n    for (const key of keys) {\n      if (key === '_id') continue; // _id can appear with either style\n      if (projection[key]) hasInclusion = true; else hasExclusion = true;\n      if (hasInclusion && hasExclusion) break;\n    }\n\n    if (hasInclusion && hasExclusion) {\n      throw new QueryError(\"Cannot do exclusion on field in inclusion projection\", {\n        code: ErrorCodes.CANNOT_DO_EXCLUSION_ON_FIELD_ID_IN_INCLUSION_PROJECTION,\n        collection: this.name\n      });\n    }\n  }\n\n  _call(method, args = []) {\n    const promise = this.bridge.sendRequest({\n      target: 'collection',\n      database: this.dbName,\n      collection: this.name,\n      method,\n      args\n    }).then((res) => {\n      if (res && res.cursorId) {\n        return new ProxyCursor({\n          bridge: this.bridge,\n          cursorId: res.cursorId,\n          batch: res.batch,\n          exhausted: res.exhausted,\n          batchSize: res.batchSize\n        });\n      }\n      // If copyTo, register the destination collection locally\n      if (method === 'copyTo' && args.length > 0) {\n        // Access the destination collection to register it\n        // This assumes we have access to the database proxy\n        // We'll need to pass db reference to ProxyCollection\n        if (this._db) {\n          this._db.collection(args[0]);\n        }\n      }\n      // If createIndex, cache the index info\n      if (method === 'createIndex') {\n        const indexSpec = args[0];\n        const indexOptions = args[1] || {};\n        const indexName = indexOptions.name || Object.entries(indexSpec)\n          .map(([k, v]) => `${k}_${v}`)\n          .join('_');\n        \n        // Only add if not already present\n        if (!this.indexes.find(idx => idx.name === indexName)) {\n          this.indexes.push({\n            name: indexName,\n            key: indexSpec,\n            ...indexOptions\n          });\n        }\n      }\n      // If dropIndex or dropIndexes, update cache\n      if (method === 'dropIndex') {\n        const indexName = args[0];\n        this.indexes = this.indexes.filter(idx => idx.name !== indexName);\n      }\n      if (method === 'dropIndexes') {\n        this.indexes = [];\n      }\n      // If drop (collection), clear all cached indexes\n      if (method === 'drop') {\n        this.indexes = [];\n      }\n      return res;\n    });\n    return promise;\n  }\n\n  getIndexes() {\n    // Return cached indexes synchronously\n    return this.indexes;\n  }\n\n  _watch(pipeline = [], options = {}) {\n    return ProxyChangeStream.create({\n      bridge: this.bridge,\n      database: this.dbName,\n      collection: this.name,\n      pipeline,\n      options\n    });\n  }\n}\n","import { ProxyCollection } from './ProxyCollection.js';\nimport { ProxyChangeStream } from './ProxyChangeStream.js';\n\n/**\n * ProxyDB lives on the main thread and forwards operations to the worker Server.\n */\nexport class ProxyDB {\n  constructor({ dbName, bridge, options = {} }) {\n    this.dbName = dbName;\n    this.bridge = bridge;\n    this.options = options;\n    this.collections = new Map();\n\n    // Proxy to auto-create collections on property access\n    const dbMethodNames = new Set([\n      'getCollectionNames',\n      'getCollectionInfos',\n      'createCollection',\n      'dropCollection',\n      'dropDatabase',\n      'collection',\n      'getCollection',\n      'watch'\n    ]);\n\n    this._methodNames = dbMethodNames;\n\n    return new Proxy(this, {\n      get: (target, prop, receiver) => {\n        if (prop in target) return Reflect.get(target, prop, receiver);\n        if (typeof prop === 'symbol' || String(prop).startsWith('_')) return undefined;\n\n        if (dbMethodNames.has(prop)) {\n          // Special handling for collection management methods\n          if (prop === 'createCollection') {\n            return (...args) => {\n              const collName = args[0];\n              target.collection(collName, receiver); // Pass proxy receiver\n              return target._call(String(prop), args); // Still send to worker\n            };\n          }\n          if (prop === 'dropCollection') {\n            return (...args) => {\n              const collName = args[0];\n              target.collections.delete(collName); // Remove synchronously\n              return target._call(String(prop), args); // Still send to worker\n            };\n          }\n          if (prop === 'dropDatabase') {\n            return (...args) => {\n              target.collections.clear(); // Clear all collections synchronously\n              return target._call(String(prop), args); // Still send to worker\n            };\n          }\n          if (prop === 'watch') {\n            return (...args) => target._watch(...args);\n          }\n          return (...args) => target._call(String(prop), args);\n        }\n\n        // Dynamic collection access\n        return target.collection(prop, receiver); // Pass proxy receiver\n      }\n    });\n  }\n\n  collection(name, dbProxy) {\n    if (this.collections.has(name)) return this.collections.get(name);\n    const col = new ProxyCollection({\n      dbName: this.dbName,\n      name,\n      bridge: this.bridge,\n      db: dbProxy || this // Pass DB proxy if available, otherwise this\n    });\n    this.collections.set(name, col);\n    return col;\n  }\n\n  getCollectionNames() {\n    // Return collection names from local cache\n    return Array.from(this.collections.keys());\n  }\n\n  async close() {\n    // No-op on proxy; the worker owns lifecycle\n    return undefined;\n  }\n\n  // Direct forwarding for DB-level methods\n  _call(method, args = []) {\n    const promise = this.bridge.sendRequest({\n      target: 'db',\n      database: this.dbName,\n      method,\n      args\n    }).then((res) => {\n      // Note: Do NOT re-add createCollection here - it's already added synchronously in the proxy handler\n      // Same for dropCollection - already removed in proxy handler\n      \n      if (res && res.streamId) {\n        return ProxyChangeStream.create({\n          bridge: this.bridge,\n          database: this.dbName,\n          collection: null,\n          streamId: res.streamId\n        });\n      }\n      return res;\n    });\n    return promise;\n  }\n\n  _watch(pipeline = [], options = {}) {\n    return ProxyChangeStream.create({\n      bridge: this.bridge,\n      database: this.dbName,\n      collection: null,\n      pipeline,\n      options\n    });\n  }\n}\n","import { EventEmitter } from 'events';\r\nimport { ProxyDB } from './ProxyDB.js';\r\nimport { ProxyChangeStream } from './ProxyChangeStream.js';\r\n\r\nexport class MongoClient extends EventEmitter {\r\n  constructor(uri = 'mongodb://localhost:27017', options = {}) {\r\n    super();\r\n    this.uri = uri;\r\n    this.options = Object.freeze({ ...options }); // Make immutable\r\n    this._isConnected = false;\r\n    this._defaultDb = this._parseDefaultDbName(uri);\r\n    this._databases = new Map(); // Track database instances\r\n    \r\n    // workerBridge is required\r\n    if (!options.workerBridge) {\r\n      throw new Error('workerBridge is required. Create one with: const bridge = await WorkerBridge.create()');\r\n    }\r\n    \r\n    this._bridge = options.workerBridge;\r\n    this._ownsBridge = false; // Never own the bridge - user manages lifecycle\r\n  }\r\n\r\n  static async connect(uri, options = {}) {\r\n    const client = new MongoClient(uri, options);\r\n    await client.connect();\r\n    return client;\r\n  }\r\n\r\n  async connect() {\r\n    if (this._isConnected) return this;\r\n    this._isConnected = true;\r\n    this.emit('open', this);\r\n    return this;\r\n  }\r\n\r\n  // Note that db on real MongoClient is synchronous\r\n  db(name, opts = {}) {\r\n    // Use default from URI if no name provided\r\n    const dbName = name || this._defaultDb;\r\n    if (!dbName) {\r\n      throw new Error('No database name provided and no default in connection string');\r\n    }\r\n    \r\n    // Return cached database instance if it exists\r\n    if (this._databases.has(dbName)) {\r\n      return this._databases.get(dbName);\r\n    }\r\n\r\n    // Always use ProxyDB with worker\r\n    const database = new ProxyDB({\r\n      dbName,\r\n      bridge: this._bridge,\r\n      options: { ...this.options, ...opts }\r\n    });\r\n\r\n    this._databases.set(dbName, database);\r\n    return database;\r\n  }\r\n\r\n  async close() {\r\n    if (this._bridge && this._ownsBridge) {\r\n      // Only terminate if we own the bridge (not shared)\r\n      await this._bridge.terminate();\r\n      this._bridge = null;\r\n    }\r\n    this._isConnected = false;\r\n    this.emit('close');\r\n  }\r\n\r\n  // async _loadExistingDatabases() {\r\n  //   const discoveredNames = await this._discoverDatabases();\r\n  //   console.log('Discovered databases:', discoveredNames);\r\n  //   const names = new Set(discoveredNames);\r\n\r\n  //   // Ensure default DB from URI is loaded when provided\r\n  //   if (this._defaultDb) {\r\n  //     names.add(this._defaultDb);\r\n  //   }\r\n\r\n  //   for (const dbName of names) {\r\n  //     if (this._databases.has(dbName)) continue;\r\n  //     const database = new DB({ ...this.options, dbName });\r\n  //     this._databases.set(dbName, database);\r\n  //   }\r\n  // }\r\n\r\n  // async _discoverDatabases() {\r\n  //   const dbNames = new Set();\r\n  //   const baseFolder = this.options.rootPath || '/micro-mongo';\r\n\r\n  //   const hasOPFS = !!(globalThis.navigator && globalThis.navigator.storage && typeof globalThis.navigator.storage.getDirectory === 'function');\r\n  //   if (!hasOPFS) {\r\n  //     return Array.from(dbNames);\r\n  //   }\r\n\r\n  //   try {\r\n  //     let dir = await globalThis.navigator.storage.getDirectory();\r\n  //     const parts = baseFolder.split('/').filter(Boolean);\r\n  //     for (const part of parts) {\r\n  //       dir = await dir.getDirectoryHandle(part, { create: true });\r\n  //     }\r\n\r\n  //     for await (const [name, handle] of dir.entries()) {\r\n  //       if (handle && handle.kind === 'directory') {\r\n  //         dbNames.add(name);\r\n  //       }\r\n  //     }\r\n  //   } catch (err) {\r\n  //     console.warn('Failed to discover databases', err);\r\n  //   }\r\n\r\n  //   return Array.from(dbNames);\r\n  // }\r\n\r\n  async close(force = false) {\r\n    if (!this._isConnected) return;\r\n    \r\n    // Close all database connections (which closes all collections and indexes)\r\n    for (const [_, database] of this._databases) {\r\n      await database.close();\r\n    }\r\n    this._databases.clear();\r\n    \r\n    this._isConnected = false;\r\n    this.emit('close');\r\n  }\r\n\r\n  // Session management stubs\r\n  startSession(options = {}) {\r\n    // Return minimal session object for compatibility\r\n    return {\r\n      id: crypto.randomUUID(),\r\n      endSession: () => {},\r\n      withTransaction: async (fn) => await fn(this)\r\n    };\r\n  }\r\n\r\n  async withSession(optionsOrExecutor, executor) {\r\n    const session = this.startSession(\r\n      typeof optionsOrExecutor === 'function' ? {} : optionsOrExecutor\r\n    );\r\n    const fn = typeof optionsOrExecutor === 'function' ? optionsOrExecutor : executor;\r\n    \r\n    try {\r\n      return await fn(session);\r\n    } finally {\r\n      session.endSession();\r\n    }\r\n  }\r\n\r\n  // Configuration getters\r\n  get readConcern() { return this.options.readConcern; }\r\n  get writeConcern() { return this.options.writeConcern; }\r\n  get readPreference() { return this.options.readPreference; }\r\n\r\n  /**\r\n   * Watch for changes across all databases and collections\r\n   * @param {Array} pipeline - Aggregation pipeline to filter changes\r\n   * @param {Object} options - Watch options\r\n   * @returns {ProxyChangeStream} A change stream instance\r\n   */\r\n  watch(pipeline = [], options = {}) {\r\n    return ProxyChangeStream.create({\r\n      bridge: this._bridge,\r\n      database: null, // null means watch all databases\r\n      collection: null,\r\n      pipeline,\r\n      options\r\n    });\r\n  }\r\n\r\n  _parseDefaultDbName(uri) {\r\n    // Parse mongodb://host:port/dbname format\r\n    const match = uri.match(/\\/([^/?]+)/);\r\n    return match ? match[1] : null;\r\n  }\r\n\r\n  _parseUriParams(uri) {\r\n    // Parse query parameters from URI\r\n    // e.g., ?useWorker=true becomes { useWorker: true }\r\n    const params = {};\r\n    const queryIndex = uri.indexOf('?');\r\n    if (queryIndex === -1) return params;\r\n    \r\n    const queryString = uri.substring(queryIndex + 1);\r\n    const pairs = queryString.split('&');\r\n    for (const pair of pairs) {\r\n      const [key, value] = pair.split('=');\r\n      if (key) {\r\n        // Convert string booleans to actual booleans\r\n        if (value === 'true') params[key] = true;\r\n        else if (value === 'false') params[key] = false;\r\n        else if (!isNaN(value)) params[key] = Number(value);\r\n        else params[key] = decodeURIComponent(value || '');\r\n      }\r\n    }\r\n    return params;\r\n  }\r\n}","/**\n * Binary JSON Encoder/Decoder\n * \n * Encodes JavaScript values to a compact binary format compatible with\n * Origin Private File System (OPFS).\n */\n\nconst TYPE = {\n  NULL: 0x00,\n  FALSE: 0x01,\n  TRUE: 0x02,\n  INT: 0x03,\n  FLOAT: 0x04,\n  STRING: 0x05,\n  OID: 0x06,\n  DATE: 0x07,\n  POINTER: 0x08,\n  BINARY: 0x09,\n  ARRAY: 0x10,\n  OBJECT: 0x11\n};\n\n\n/**\n * ObjectId class - MongoDB-compatible 24-character hex string identifier\n * Format: 8-char timestamp + 16-char random data\n */\nclass ObjectId {\n  constructor(id) {\n    if (id === undefined || id === null) {\n      // Generate new ObjectId\n      this.id = ObjectId.generate();\n    } else if (typeof id === 'string') {\n      // Create from hex string\n      if (!ObjectId.isValid(id)) {\n        throw new Error(`Argument passed in must be a string of 24 hex characters, got: ${id}`);\n      }\n      this.id = id.toLowerCase();\n    } else if (id instanceof Uint8Array && id.length === 12) {\n      this.id = Array.from(id).map(b => b.toString(16).padStart(2, '0')).join('');\n    } else if (id instanceof ObjectId) {\n      // Copy constructor\n      this.id = id.id;\n    } else {\n      throw new Error(`Argument passed in must be a string of 24 hex characters or an ObjectId`);\n    }\n  }\n\n  /**\n   * Returns the ObjectId as a 24-character hex string\n   */\n  toString() {\n    return this.id;\n  }\n\n  /**\n   * Returns the ObjectId as a 24-character hex string (alias for toString)\n   */\n  toHexString() {\n    return this.id;\n  }\n\n  /**\n   * Returns the timestamp portion of the ObjectId as a Date\n   */\n  getTimestamp() {\n    const timestamp = parseInt(this.id.substring(0, 8), 16);\n    return new Date(timestamp * 1000);\n  }\n\n  equals(other) {\n    if (!(other instanceof ObjectId)) {\n      throw new Error('Can only compare with another ObjectId');\n    }\n    return this.id === other.id;\n  }\n\n  /**\n   * Compares this ObjectId with another for equality\n   */\n  compare(other) {\n    if (!(other instanceof ObjectId)) {\n      throw new Error('Can only compare with another ObjectId');\n    }\n\n    return this.id.localeCompare(other.id);\n  }\n\n  /**\n   * Returns the ObjectId in JSON format (as hex string)\n   */\n  toJSON() {\n    return this.id;\n  }\n\n  /**\n   * Custom inspect for Node.js console.log\n   */\n  inspect() {\n    return `ObjectId(\"${this.id}\")`;\n  }\n\n  toBytes() {\n    const bytes = new Uint8Array(12);\n    for (let i = 0; i < 12; i++) {\n      bytes[i] = parseInt(this.id.substring(i * 2, i * 2 + 2), 16);\n    }\n    return bytes;\n  }\n\n  /**\n   * Validates if a string is a valid ObjectId hex string\n   */\n  static isValid(id) {\n    if (!id) return false;\n    if (typeof id !== 'string') return false;\n    if (id.length !== 24) return false;\n    return /^[0-9a-fA-F]{24}$/.test(id);\n  }\n\n  /**\n   * Creates an ObjectId from a timestamp\n   */\n  static createFromTime(timestamp) {\n    const ts = Math.floor(timestamp / 1000);\n    const tsHex = ('00000000' + ts.toString(16)).slice(-8);\n    const tail = '0000000000000000'; // Zero out the random portion\n    return new ObjectId(tsHex + tail);\n  }\n\n  /**\n   * Generates a new ObjectId hex string\n   * Format: 8-char timestamp (4 bytes) + 16-char random data (8 bytes)\n   */\n  static generate() {\n    const ts = Math.floor(Date.now() / 1000);\n    \n    // Generate 8 random bytes\n    const rand = typeof crypto !== 'undefined' && crypto.getRandomValues ? new Uint8Array(8) : null;\n    let tail = '';\n    \n    if (rand) {\n      crypto.getRandomValues(rand);\n      for (let i = 0; i < rand.length; i++) {\n        tail += ('0' + rand[i].toString(16)).slice(-2);\n      }\n    } else {\n      // Fallback for environments without crypto\n      // Generate two 8-character hex strings\n      tail = Math.random().toString(16).slice(2).padEnd(8, '0').slice(0, 8) +\n             Math.random().toString(16).slice(2).padEnd(8, '0').slice(0, 8);\n    }\n    \n    const tsHex = ('00000000' + ts.toString(16)).slice(-8);\n    return (tsHex + tail).slice(0, 24);\n  }\n}\n\n/**\n * Pointer class - represents a 64-bit file offset pointer\n * Used to store file offsets for referenced data structures\n */\nclass Pointer {\n  constructor(offset) {\n    if (offset === undefined || offset === null) {\n      throw new Error('Pointer offset must be a number');\n    }\n    if (typeof offset !== 'number') {\n      throw new Error('Pointer offset must be a number');\n    }\n    if (!Number.isInteger(offset)) {\n      throw new Error('Pointer offset must be an integer');\n    }\n    if (offset < 0) {\n      throw new Error('Pointer offset must be non-negative');\n    }\n    if (offset > Number.MAX_SAFE_INTEGER) {\n      throw new Error('Pointer offset exceeds maximum safe integer');\n    }\n    this.offset = offset;\n  }\n\n  /**\n   * Returns the pointer offset as a number\n   */\n  valueOf() {\n    return this.offset;\n  }\n\n  /**\n   * Returns the pointer offset as a string\n   */\n  toString() {\n    return this.offset.toString();\n  }\n\n  /**\n   * Returns the pointer in JSON format (as number)\n   */\n  toJSON() {\n    return this.offset;\n  }\n\n  /**\n   * Custom inspect for Node.js console.log\n   */\n  inspect() {\n    return `Pointer(${this.offset})`;\n  }\n\n  /**\n   * Compares this Pointer with another for equality\n   */\n  equals(other) {\n    if (!(other instanceof Pointer)) {\n      return false;\n    }\n    return this.offset === other.offset;\n  }\n}\n\n/**\n * Encode a JavaScript value to binary format\n */\nfunction encode(value) {\n  const buffers = [];\n\n  function encodeValue(val) {\n    if (val === null) {\n      buffers.push(new Uint8Array([TYPE.NULL]));\n    } else if (val === false) {\n      buffers.push(new Uint8Array([TYPE.FALSE]));\n    } else if (val === true) {\n      buffers.push(new Uint8Array([TYPE.TRUE]));\n    } else if (val instanceof ObjectId) {\n      buffers.push(new Uint8Array([TYPE.OID]));\n      buffers.push(val.toBytes());\n    } else if (val instanceof Date) {\n      buffers.push(new Uint8Array([TYPE.DATE]));\n      const buffer = new ArrayBuffer(8);\n      const view = new DataView(buffer);\n      view.setBigInt64(0, BigInt(val.getTime()), true); // little-endian\n      buffers.push(new Uint8Array(buffer));\n    } else if (val instanceof Pointer) {\n      buffers.push(new Uint8Array([TYPE.POINTER]));\n      const buffer = new ArrayBuffer(8);\n      const view = new DataView(buffer);\n      view.setBigUint64(0, BigInt(val.offset), true); // little-endian\n      buffers.push(new Uint8Array(buffer));\n    } else if (val instanceof Uint8Array) {\n      buffers.push(new Uint8Array([TYPE.BINARY]));\n      // Store length as 32-bit integer\n      const lengthBuffer = new ArrayBuffer(4);\n      const lengthView = new DataView(lengthBuffer);\n      lengthView.setUint32(0, val.length, true);\n      buffers.push(new Uint8Array(lengthBuffer));\n      buffers.push(val);\n    } else if (typeof val === 'number') {\n      if (Number.isInteger(val) && Number.isSafeInteger(val)) {\n        // 64-bit signed integer (stored as BigInt64)\n        buffers.push(new Uint8Array([TYPE.INT]));\n        const buffer = new ArrayBuffer(8);\n        const view = new DataView(buffer);\n        view.setBigInt64(0, BigInt(val), true); // little-endian\n        buffers.push(new Uint8Array(buffer));\n      } else {\n        // 64-bit float\n        buffers.push(new Uint8Array([TYPE.FLOAT]));\n        const buffer = new ArrayBuffer(8);\n        const view = new DataView(buffer);\n        view.setFloat64(0, val, true); // little-endian\n        buffers.push(new Uint8Array(buffer));\n      }\n    } else if (typeof val === 'string') {\n      buffers.push(new Uint8Array([TYPE.STRING]));\n      const encoded = new TextEncoder().encode(val);\n      // Store length as 32-bit integer\n      const lengthBuffer = new ArrayBuffer(4);\n      const lengthView = new DataView(lengthBuffer);\n      lengthView.setUint32(0, encoded.length, true);\n      buffers.push(new Uint8Array(lengthBuffer));\n      buffers.push(encoded);\n    } else if (Array.isArray(val)) {\n      // Encode array to temporary buffer to determine size\n      const tempBuffers = [];\n      \n      // Store array length as 32-bit integer\n      const lengthBuffer = new ArrayBuffer(4);\n      const lengthView = new DataView(lengthBuffer);\n      lengthView.setUint32(0, val.length, true);\n      tempBuffers.push(new Uint8Array(lengthBuffer));\n      \n      // Encode each element into temp buffer\n      const startLength = buffers.length;\n      for (const item of val) {\n        encodeValue(item);\n      }\n      // Collect encoded elements\n      const elementBuffers = buffers.splice(startLength);\n      tempBuffers.push(...elementBuffers);\n      \n      // Calculate total size of array content\n      const contentSize = tempBuffers.reduce((sum, buf) => sum + buf.length, 0);\n      \n      // Now write: TYPE + SIZE + CONTENT\n      buffers.push(new Uint8Array([TYPE.ARRAY]));\n      const sizeBuffer = new ArrayBuffer(4);\n      const sizeView = new DataView(sizeBuffer);\n      sizeView.setUint32(0, contentSize, true);\n      buffers.push(new Uint8Array(sizeBuffer));\n      buffers.push(...tempBuffers);\n    } else if (typeof val === 'object') {\n      // Encode object to temporary buffer to determine size\n      const tempBuffers = [];\n      \n      const keys = Object.keys(val);\n      // Store number of keys as 32-bit integer\n      const lengthBuffer = new ArrayBuffer(4);\n      const lengthView = new DataView(lengthBuffer);\n      lengthView.setUint32(0, keys.length, true);\n      tempBuffers.push(new Uint8Array(lengthBuffer));\n      \n      // Encode each key-value pair into temp buffer\n      const startLength = buffers.length;\n      for (const key of keys) {\n        // Encode key as string (without type byte)\n        const encoded = new TextEncoder().encode(key);\n        const keyLengthBuffer = new ArrayBuffer(4);\n        const keyLengthView = new DataView(keyLengthBuffer);\n        keyLengthView.setUint32(0, encoded.length, true);\n        buffers.push(new Uint8Array(keyLengthBuffer));\n        buffers.push(encoded);\n        // Encode value\n        encodeValue(val[key]);\n      }\n      // Collect encoded key-value pairs\n      const kvBuffers = buffers.splice(startLength);\n      tempBuffers.push(...kvBuffers);\n      \n      // Calculate total size of object content\n      const contentSize = tempBuffers.reduce((sum, buf) => sum + buf.length, 0);\n      \n      // Now write: TYPE + SIZE + CONTENT\n      buffers.push(new Uint8Array([TYPE.OBJECT]));\n      const sizeBuffer = new ArrayBuffer(4);\n      const sizeView = new DataView(sizeBuffer);\n      sizeView.setUint32(0, contentSize, true);\n      buffers.push(new Uint8Array(sizeBuffer));\n      buffers.push(...tempBuffers);\n    } else {\n      throw new Error(`Unsupported type: ${typeof val}`);\n    }\n  }\n\n  encodeValue(value);\n\n  // Combine all buffers\n  const totalLength = buffers.reduce((sum, buf) => sum + buf.length, 0);\n  const result = new Uint8Array(totalLength);\n  let offset = 0;\n  for (const buf of buffers) {\n    result.set(buf, offset);\n    offset += buf.length;\n  }\n\n  return result;\n}\n\n/**\n * Decode binary data to JavaScript value\n */\nfunction decode(data) {\n  let offset = 0;\n\n  function decodeValue() {\n    if (offset >= data.length) {\n      throw new Error('Unexpected end of data');\n    }\n\n    const type = data[offset++];\n\n    switch (type) {\n      case TYPE.NULL:\n        return null;\n      \n      case TYPE.FALSE:\n        return false;\n      \n      case TYPE.TRUE:\n        return true;\n      \n      case TYPE.INT: {\n        if (offset + 4 > data.length) {\n          throw new Error('Unexpected end of data for INT');\n        }\n        const view = new DataView(data.buffer, data.byteOffset + offset, 8);\n        const value = view.getBigInt64(0, true);\n        offset += 8;\n        if (value < BigInt(Number.MIN_SAFE_INTEGER) || value > BigInt(Number.MAX_SAFE_INTEGER)) {\n          throw new Error('Decoded integer exceeds safe range');\n        }\n        return Number(value);\n      }\n      \n      case TYPE.FLOAT: {\n        if (offset + 8 > data.length) {\n          throw new Error('Unexpected end of data for FLOAT');\n        }\n        const view = new DataView(data.buffer, data.byteOffset + offset, 8);\n        const value = view.getFloat64(0, true);\n        offset += 8;\n        return value;\n      }\n      \n      case TYPE.STRING: {\n        if (offset + 4 > data.length) {\n          throw new Error('Unexpected end of data for STRING length');\n        }\n        const lengthView = new DataView(data.buffer, data.byteOffset + offset, 4);\n        const length = lengthView.getUint32(0, true);\n        offset += 4;\n        \n        if (offset + length > data.length) {\n          throw new Error('Unexpected end of data for STRING content');\n        }\n        const stringData = data.slice(offset, offset + length);\n        offset += length;\n        return new TextDecoder().decode(stringData);\n      }\n      \n      case TYPE.OID: {\n        if (offset + 12 > data.length) {\n          throw new Error('Unexpected end of data for OID');\n        }\n        const oidBytes = data.slice(offset, offset + 12);\n        offset += 12;\n        return new ObjectId(oidBytes);\n      }\n\n      case TYPE.DATE: {\n        if (offset + 8 > data.length) {\n          throw new Error('Unexpected end of data for DATE');\n        }\n        const view = new DataView(data.buffer, data.byteOffset + offset, 8);\n        const timestamp = view.getBigInt64(0, true);\n        offset += 8;\n        return new Date(Number(timestamp));\n      }\n      \n      case TYPE.POINTER: {\n        if (offset + 8 > data.length) {\n          throw new Error('Unexpected end of data for POINTER');\n        }\n        const view = new DataView(data.buffer, data.byteOffset + offset, 8);\n        const pointerOffset = view.getBigUint64(0, true);\n        offset += 8;\n        // Validate offset is within safe integer range\n        if (pointerOffset > BigInt(Number.MAX_SAFE_INTEGER)) {\n          throw new Error('Pointer offset out of valid range');\n        }\n        return new Pointer(Number(pointerOffset));\n      }\n      \n      case TYPE.BINARY: {\n        if (offset + 4 > data.length) {\n          throw new Error('Unexpected end of data for BINARY length');\n        }\n        const lengthView = new DataView(data.buffer, data.byteOffset + offset, 4);\n        const length = lengthView.getUint32(0, true);\n        offset += 4;\n        \n        if (offset + length > data.length) {\n          throw new Error('Unexpected end of data for BINARY content');\n        }\n        const binaryData = data.slice(offset, offset + length);\n        offset += length;\n        return binaryData;\n      }\n      \n      case TYPE.ARRAY: {\n        if (offset + 4 > data.length) {\n          throw new Error('Unexpected end of data for ARRAY size');\n        }\n        // Read size in bytes\n        const sizeView = new DataView(data.buffer, data.byteOffset + offset, 4);\n        const size = sizeView.getUint32(0, true);\n        offset += 4;\n        \n        if (offset + size > data.length) {\n          throw new Error('Unexpected end of data for ARRAY content');\n        }\n        \n        // Read array length\n        const lengthView = new DataView(data.buffer, data.byteOffset + offset, 4);\n        const length = lengthView.getUint32(0, true);\n        offset += 4;\n        \n        const arr = [];\n        for (let i = 0; i < length; i++) {\n          arr.push(decodeValue());\n        }\n        return arr;\n      }\n      \n      case TYPE.OBJECT: {\n        if (offset + 4 > data.length) {\n          throw new Error('Unexpected end of data for OBJECT size');\n        }\n        // Read size in bytes\n        const sizeView = new DataView(data.buffer, data.byteOffset + offset, 4);\n        const size = sizeView.getUint32(0, true);\n        offset += 4;\n        \n        if (offset + size > data.length) {\n          throw new Error('Unexpected end of data for OBJECT content');\n        }\n        \n        // Read number of keys\n        const lengthView = new DataView(data.buffer, data.byteOffset + offset, 4);\n        const length = lengthView.getUint32(0, true);\n        offset += 4;\n        \n        const obj = {};\n        for (let i = 0; i < length; i++) {\n          // Decode key\n          if (offset + 4 > data.length) {\n            throw new Error('Unexpected end of data for OBJECT key length');\n          }\n          const keyLengthView = new DataView(data.buffer, data.byteOffset + offset, 4);\n          const keyLength = keyLengthView.getUint32(0, true);\n          offset += 4;\n          \n          if (offset + keyLength > data.length) {\n            throw new Error('Unexpected end of data for OBJECT key');\n          }\n          const keyData = data.slice(offset, offset + keyLength);\n          offset += keyLength;\n          const key = new TextDecoder().decode(keyData);\n          \n          // Decode value\n          obj[key] = decodeValue();\n        }\n        return obj;\n      }\n      \n      default:\n        throw new Error(`Unknown type byte: 0x${type.toString(16)}`);\n    }\n  }\n\n  return decodeValue();\n}\n\n/**\n * OPFS File Operations using FileSystemSyncAccessHandle\n * \n * IMPORTANT: This class wraps FileSystemSyncAccessHandle which is only available\n * in Web Workers. It provides synchronous file operations with explicit flush control.\n */\nclass BJsonFile {\n  constructor(syncAccessHandle) {\n    if (!syncAccessHandle) {\n      throw new Error('FileSystemSyncAccessHandle is required');\n    }\n    this.syncAccessHandle = syncAccessHandle;\n  }\n\n\n  /**\n   * Read a range of bytes from the file\n   */\n  #readRange(start, length) {\n    const buffer = new Uint8Array(length);\n    const bytesRead = this.syncAccessHandle.read(buffer, { at: start });\n    if (bytesRead < length) {\n      // Return only the bytes that were actually read\n      return buffer.slice(0, bytesRead);\n    }\n    return buffer;\n  }\n\n  /**\n   * Get the current file size\n   */\n  getFileSize() {\n    return this.syncAccessHandle.getSize();\n  }\n\n  /**\n   * Write data to file, truncating existing content\n   * @param {*} data - Data to encode and write\n   */\n  write(data) {\n    // Encode data to binary\n    const binaryData = encode(data);\n    \n    // Truncate file to 0 bytes (clear existing content)\n    this.syncAccessHandle.truncate(0);\n    \n    // Write data at beginning of file\n    this.syncAccessHandle.write(binaryData, { at: 0 });\n  }\n\n  /**\n   * Read and decode data from file starting at optional pointer offset\n   * @param {Pointer} pointer - Optional offset to start reading from (default: 0)\n   * @returns {*} - Decoded data\n   */\n  read(pointer = new Pointer(0)) {\n    const fileSize = this.getFileSize();\n    \n    if (fileSize === 0) {\n      throw new Error('File is empty');\n    }\n\n    const pointerValue = pointer.valueOf();\n    \n    // Validate pointer offset\n    if (pointerValue < 0 || pointerValue >= fileSize) {\n      throw new Error(`Pointer offset ${pointer} out of file bounds [0, ${fileSize})`);\n    }\n    \n    // Read from pointer offset to end of file\n    const binaryData = this.#readRange(pointerValue, fileSize - pointerValue);\n    \n    // Decode and return the first value\n    return decode(binaryData);\n  }\n\n  /**\n   * Append data to file without truncating existing content\n   * @param {*} data - Data to encode and append\n   */\n  append(data) {\n    // Encode new data to binary\n    const binaryData = encode(data);\n    \n    // Get current file size\n    const existingSize = this.getFileSize();\n    \n    // Write new data at end of file\n    this.syncAccessHandle.write(binaryData, { at: existingSize });\n  }\n\n  /**\n   * Explicitly flush any pending writes to disk\n   */\n  flush() {\n    this.syncAccessHandle.flush();\n  }\n\n  /**\n   * Generator to scan through all records in the file\n   * Each record is decoded and yielded one at a time\n   */\n  *scan() {\n    const fileSize = this.getFileSize();\n      \n      if (fileSize === 0) {\n        return;\n      }\n      \n      let offset = 0;\n      \n      // Scan through and yield each top-level value\n      while (offset < fileSize) {\n        // Helper function to determine how many bytes a value occupies\n        const getValueSize = (readPosition) => {\n          // Read 1 byte for type\n          let tempData = this.#readRange(readPosition, 1);\n          let pos = 1;\n          const type = tempData[0];\n          \n          switch (type) {\n            case TYPE.NULL:\n            case TYPE.FALSE:\n            case TYPE.TRUE:\n              return 1;\n            \n            case TYPE.INT:\n            case TYPE.FLOAT:\n            case TYPE.DATE:\n            case TYPE.POINTER:\n              return 1 + 8;\n\n            case TYPE.OID:\n              return 1 + 12;\n            \n            case TYPE.STRING: {\n              // Read length (4 bytes)\n              tempData = this.#readRange(readPosition + 1, 4);\n              const view = new DataView(tempData.buffer, tempData.byteOffset, 4);\n              const length = view.getUint32(0, true);\n              return 1 + 4 + length;\n            }\n            \n            case TYPE.BINARY: {\n              // Read length (4 bytes)\n              tempData = this.#readRange(readPosition + 1, 4);\n              const view = new DataView(tempData.buffer, tempData.byteOffset, 4);\n              const length = view.getUint32(0, true);\n              return 1 + 4 + length;\n            }\n            \n            case TYPE.ARRAY: {\n              // Read size in bytes (4 bytes)\n              tempData = this.#readRange(readPosition + 1, 4);\n              const view = new DataView(tempData.buffer, tempData.byteOffset, 4);\n              const size = view.getUint32(0, true);\n              return 1 + 4 + size; // type + size + content\n            }\n            \n            case TYPE.OBJECT: {\n              // Read size in bytes (4 bytes)\n              tempData = this.#readRange(readPosition + 1, 4);\n              const view = new DataView(tempData.buffer, tempData.byteOffset, 4);\n              const size = view.getUint32(0, true);\n              return 1 + 4 + size; // type + size + content\n            }\n            \n            default:\n              throw new Error(`Unknown type byte: 0x${type.toString(16)}`);\n          }\n        };\n        \n        // Determine size of the current value\n        const valueSize = getValueSize(offset);\n        \n        // Read only the bytes needed for this value\n        const valueData = this.#readRange(offset, valueSize);\n        offset += valueSize;\n        \n        // Decode and yield this value\n        yield decode(valueData);\n      }\n  }\n}\n\n/**\n * Check if a file exists in OPFS\n * @param {FileSystemFileHandle} fileHandle - The file handle to check\n * @returns {boolean} - True if file exists and is readable\n */\nfunction exists(fileHandle) {\n  try {\n    // If we have a handle, the file exists\n    return fileHandle !== null && fileHandle !== undefined;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Delete a file from OPFS\n * @param {FileSystemDirectoryHandle} dirHandle - The directory handle\n * @param {string} filename - Name of the file to delete\n */\nasync function deleteFile(dirHandle, filename) {\n  try {\n    await dirHandle.removeEntry(filename);\n  } catch (error) {\n    if (error.name === 'NotFoundError') {\n      // File doesn't exist, nothing to delete\n      return;\n    }\n    throw error;\n  }\n}\n\n/**\n * Get or create a file handle from a directory\n * @param {FileSystemDirectoryHandle} dirHandle - The directory handle\n * @param {string} filename - Name of the file\n * @param {Object} options - Options for getFileHandle\n * @returns {FileSystemFileHandle} - The file handle\n */\nasync function getFileHandle(dirHandle, filename, options = {}) {\n  return dirHandle.getFileHandle(filename, options);\n}\n\nexport {\n  TYPE,\n  ObjectId,\n  Pointer,\n  encode,\n  decode,\n  BJsonFile,\n  exists,\n  deleteFile,\n  getFileHandle\n};\n","/**\n * Utility functions for MicroMongoDB\n */\n\nimport { ObjectId } from 'bjson';\n\n/**\n * Compare two values for equality, handling ObjectId instances\n */\nfunction valuesEqual(a, b) {\n\t// Handle ObjectId comparison\n\tif (a instanceof ObjectId || b instanceof ObjectId) {\n\t\tif (a instanceof ObjectId && b instanceof ObjectId) {\n\t\t\treturn a.equals(b);\n\t\t}\n\t\tif (a instanceof ObjectId && typeof b === 'string') {\n\t\t\treturn a.equals(b);\n\t\t}\n\t\tif (b instanceof ObjectId && typeof a === 'string') {\n\t\t\treturn b.equals(a);\n\t\t}\n\t\treturn false;\n\t}\n\t\n\t// Regular equality\n\treturn a == b;\n}\n\n/**\n * Deep copy an object or array\n */\nexport function copy(o) {\n\t// Handle ObjectId\n\tif (o instanceof ObjectId) {\n\t\treturn new ObjectId(o.id);\n\t}\n\t\n\tvar out, v, key;\n\tout = Array.isArray(o) ? [] : {};\n\tfor (key in o) {\n\t\tv = o[key];\n\t\tout[key] = (typeof v === \"object\" && v !== null) ? copy(v) : v;\n\t}\n\treturn out;\n}\n\n/**\n * Get a property from an object using dot notation\n * Supports array element access via numeric indices (e.g., \"items.0.name\")\n */\nexport function getProp(obj, name) {\n\tvar path = name.split(\".\");\n\tvar result = obj[path[0]];\n\tfor (var i = 1; i < path.length; i++) {\n\t\tif (result == undefined || result == null) return result;\n\t\t\n\t\t// Check if this path segment is a numeric index\n\t\tvar pathSegment = path[i];\n\t\tvar numericIndex = parseInt(pathSegment, 10);\n\t\t\n\t\t// If it's a valid array index, use it\n\t\tif (isArray(result) && !isNaN(numericIndex) && numericIndex >= 0 && numericIndex < result.length) {\n\t\t\tresult = result[numericIndex];\n\t\t} else {\n\t\t\tresult = result[pathSegment];\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Get field values for query matching, handling MongoDB-style array traversal\n * When a path traverses an array, this returns all matching values from array elements\n * Returns an array of values if array traversal occurred, otherwise the single value\n * \n * Example:\n *   doc = { items: [{ price: 10 }, { price: 20 }] }\n *   getFieldValues(doc, 'items.price') -> [10, 20]\n */\nexport function getFieldValues(obj, name) {\n\tvar path = name.split(\".\");\n\tvar results = [obj];\n\t\n\tfor (var i = 0; i < path.length; i++) {\n\t\tvar pathSegment = path[i];\n\t\tvar numericIndex = parseInt(pathSegment, 10);\n\t\tvar newResults = [];\n\t\t\n\t\tfor (var j = 0; j < results.length; j++) {\n\t\t\tvar current = results[j];\n\t\t\tif (current == undefined || current == null) continue;\n\t\t\t\n\t\t\t// If this is a numeric index and current is an array, access that element\n\t\t\tif (isArray(current) && !isNaN(numericIndex) && numericIndex >= 0) {\n\t\t\t\tif (numericIndex < current.length) {\n\t\t\t\t\tnewResults.push(current[numericIndex]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If current is an array but path segment is not numeric, traverse all elements\n\t\t\telse if (isArray(current)) {\n\t\t\t\tfor (var k = 0; k < current.length; k++) {\n\t\t\t\t\tif (current[k] != undefined && current[k] != null && typeof current[k] === 'object') {\n\t\t\t\t\t\tnewResults.push(current[k][pathSegment]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Otherwise, normal property access\n\t\t\telse if (typeof current === 'object') {\n\t\t\t\tnewResults.push(current[pathSegment]);\n\t\t\t}\n\t\t}\n\t\t\n\t\tresults = newResults;\n\t}\n\t\n\t// Filter out undefined values\n\tresults = results.filter(function(v) { return v !== undefined; });\n\t\n\t// If we have multiple values, return the array\n\t// If we have exactly one, return it directly\n\t// If we have none, return undefined\n\tif (results.length === 0) return undefined;\n\tif (results.length === 1) return results[0];\n\treturn results;\n}\n\n/**\n * Set a property on an object using dot notation\n * Creates intermediate objects as needed\n * Supports array element access via numeric indices\n * Supports $[] operator to update all array elements\n */\nexport function setProp(obj, name, value) {\n\t// Check if path contains $[] operator\n\tif (name.indexOf('$[]') !== -1) {\n\t\treturn setPropWithAllPositional(obj, name, value);\n\t}\n\t\n\tvar path = name.split(\".\");\n\tvar current = obj;\n\t\n\tfor (var i = 0; i < path.length - 1; i++) {\n\t\tvar pathSegment = path[i];\n\t\tvar numericIndex = parseInt(pathSegment, 10);\n\t\t\n\t\t// If this is a numeric index and current is an array\n\t\tif (isArray(current) && !isNaN(numericIndex) && numericIndex >= 0) {\n\t\t\t// Ensure the array is large enough\n\t\t\twhile (current.length <= numericIndex) {\n\t\t\t\tcurrent.push(undefined);\n\t\t\t}\n\t\t\t// If the element doesn't exist, create an object\n\t\t\tif (current[numericIndex] == undefined || current[numericIndex] == null) {\n\t\t\t\t// Look ahead to see if next segment is numeric (array) or not (object)\n\t\t\t\tvar nextSegment = path[i + 1];\n\t\t\t\tvar nextNumeric = parseInt(nextSegment, 10);\n\t\t\t\tif (!isNaN(nextNumeric) && nextNumeric >= 0) {\n\t\t\t\t\tcurrent[numericIndex] = [];\n\t\t\t\t} else {\n\t\t\t\t\tcurrent[numericIndex] = {};\n\t\t\t\t}\n\t\t\t}\n\t\t\tcurrent = current[numericIndex];\n\t\t}\n\t\t// Regular property access\n\t\telse {\n\t\t\tif (current[pathSegment] == undefined || current[pathSegment] == null) {\n\t\t\t\t// Look ahead to see if next segment is numeric (array) or not (object)\n\t\t\t\tvar nextSegment = path[i + 1];\n\t\t\t\tvar nextNumeric = parseInt(nextSegment, 10);\n\t\t\t\tif (!isNaN(nextNumeric) && nextNumeric >= 0) {\n\t\t\t\t\tcurrent[pathSegment] = [];\n\t\t\t\t} else {\n\t\t\t\t\tcurrent[pathSegment] = {};\n\t\t\t\t}\n\t\t\t}\n\t\t\tcurrent = current[pathSegment];\n\t\t}\n\t}\n\t\n\t// Set the final value\n\tvar lastSegment = path[path.length - 1];\n\tvar lastNumericIndex = parseInt(lastSegment, 10);\n\t\n\tif (isArray(current) && !isNaN(lastNumericIndex) && lastNumericIndex >= 0) {\n\t\twhile (current.length <= lastNumericIndex) {\n\t\t\tcurrent.push(undefined);\n\t\t}\n\t\tcurrent[lastNumericIndex] = value;\n\t} else {\n\t\tcurrent[lastSegment] = value;\n\t}\n}\n\n/**\n * Set a property using the $[] all positional operator\n * Updates all elements in an array\n */\nfunction setPropWithAllPositional(obj, name, value) {\n\tvar path = name.split(\".\");\n\tvar current = obj;\n\t\n\t// Navigate to the $[] operator\n\tfor (var i = 0; i < path.length; i++) {\n\t\tvar pathSegment = path[i];\n\t\t\n\t\tif (pathSegment === '$[]') {\n\t\t\t// Current should be an array - update all elements\n\t\t\tif (!Array.isArray(current)) {\n\t\t\t\tthrow new Error(\"The positional operator did not find the match needed from the query.\");\n\t\t\t}\n\t\t\t\n\t\t\t// Build the remaining path after $[]\n\t\t\tvar remainingPath = path.slice(i + 1).join('.');\n\t\t\t\n\t\t\t// Update all array elements\n\t\t\tfor (var j = 0; j < current.length; j++) {\n\t\t\t\tif (remainingPath) {\n\t\t\t\t\t// There's more path after $[], recursively set on each element\n\t\t\t\t\tsetProp(current[j], remainingPath, value);\n\t\t\t\t} else {\n\t\t\t\t\t// $[] is the last segment, replace each element with value\n\t\t\t\t\tcurrent[j] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// Navigate to the next level\n\t\tvar numericIndex = parseInt(pathSegment, 10);\n\t\t\n\t\tif (isArray(current) && !isNaN(numericIndex) && numericIndex >= 0) {\n\t\t\tcurrent = current[numericIndex];\n\t\t} else {\n\t\t\tif (current[pathSegment] == undefined || current[pathSegment] == null) {\n\t\t\t\t// Create intermediate object or array\n\t\t\t\tvar nextSegment = i + 1 < path.length ? path[i + 1] : null;\n\t\t\t\tif (nextSegment === '$[]') {\n\t\t\t\t\tcurrent[pathSegment] = [];\n\t\t\t\t} else {\n\t\t\t\t\tvar nextNumeric = parseInt(nextSegment, 10);\n\t\t\t\t\tif (!isNaN(nextNumeric) && nextNumeric >= 0) {\n\t\t\t\t\t\tcurrent[pathSegment] = [];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrent[pathSegment] = {};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcurrent = current[pathSegment];\n\t\t}\n\t}\n}\n\n/**\n * Check if value is an array\n */\nexport function isArray(o) {\n\treturn Array == o.constructor;\n}\n\n/**\n * Convert object to array of key-value pairs\n */\nexport function toArray(obj) {\n\tvar arr = [];\n\tfor (var key in obj) {\n\t\tif (obj.hasOwnProperty(key)) {\n\t\t\tvar el = {};\n\t\t\tel[key] = obj[key];\n\t\t\tarr.push(el);\n\t\t}\n\t}\n\treturn arr;\n}\n\n/**\n * Check if a value is in an array\n */\nexport function isIn(val, values) {\n\tfor (var i = 0; i < values.length; i++) {\n\t\tif (valuesEqual(values[i], val)) return true;\n\t}\n\treturn false;\n}\n\n/**\n * Check if two arrays match\n */\nexport function arrayMatches(x, y) {\n\tif (x.length != y.length) return false;\n\tfor (var i = 0; i < x.length; i++) {\n\t\tif (valuesEqual(x[i], y[i])) continue;\n\t\tif (typeof (x[i]) != typeof (y[i])) return false;\n\t\tif (typeof (x[i]) == \"object\" && x[i] !== null) {\n\t\t\tif (isArray(x[i])) {\n\t\t\t\tif (!arrayMatches(x[i], y[i])) return false;\n\t\t\t} else {\n\t\t\t\tif (!objectMatches(x[i], y[i])) return false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (!valuesEqual(x[i], y[i])) return false;\n\t\t}\n\t}\n\treturn true;\n}\n\n/**\n * Check if two objects match\n */\nexport function objectMatches(x, y) {\n\tfor (var p in x) {\n\t\tif (!x.hasOwnProperty(p)) continue;\n\t\tif (!y.hasOwnProperty(p)) return false;\n\t\tif (valuesEqual(x[p], y[p])) continue;\n\t\tif (typeof (x[p]) != typeof (y[p])) return false;\n\t\tif (typeof (x[p]) == \"object\" && x[p] !== null) {\n\t\t\tif (isArray(x[p])) {\n\t\t\t\tif (!arrayMatches(x[p], y[p])) return false;\n\t\t\t} else {\n\t\t\t\tif (!objectMatches(x[p], y[p])) return false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (!valuesEqual(x[p], y[p])) return false;\n\t\t}\n\t}\n\tfor (var p in y) {\n\t\tif (y.hasOwnProperty(p) && !x.hasOwnProperty(p)) return false;\n\t}\n\treturn true;\n}\n\n/**\n * Apply projection to a document\n */\nexport function applyProjection(projection, doc) {\n\tvar result = {};\n\tvar keys = Object.keys(projection);\n\tif (keys.length == 0) return doc;\n\t\n\t// Check for mixed inclusion/exclusion (except _id which can be excluded in inclusion projection)\n\tvar hasInclusion = false;\n\tvar hasExclusion = false;\n\tfor (var i = 0; i < keys.length; i++) {\n\t\tif (keys[i] === '_id') continue; // _id is special\n\t\tif (projection[keys[i]]) hasInclusion = true;\n\t\telse hasExclusion = true;\n\t}\n\t\n\tif (hasInclusion && hasExclusion) {\n\t\tthrow { $err: \"Can't canonicalize query: BadValue Projection cannot have a mix of inclusion and exclusion.\", code: 17287 };\n\t}\n\t\n\tif (projection[keys[0]] || hasInclusion) {\n\t\t// Inclusion projection\n\t\t// Include _id unless explicitly excluded\n\t\tif (projection._id !== 0) {\n\t\t\tresult._id = doc._id;\n\t\t}\n\t\t\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\tif (keys[i] === '_id') continue;\n\t\t\tif (!projection[keys[i]]) continue;\n\t\t\t\n\t\t\tvar fieldPath = keys[i];\n\t\t\tvar value = getProp(doc, fieldPath);\n\t\t\t\n\t\t\tif (value !== undefined) {\n\t\t\t\t// Use setProp to create nested structure\n\t\t\t\tsetProp(result, fieldPath, value);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// Exclusion projection - start with a copy of the document\n\t\tfor (var key in doc) {\n\t\t\tif (doc.hasOwnProperty(key)) {\n\t\t\t\t// Deep copy the value\n\t\t\t\tvar val = doc[key];\n\t\t\t\tif (typeof val === 'object' && val !== null && !isArray(val)) {\n\t\t\t\t\tresult[key] = copy(val);\n\t\t\t\t} else if (isArray(val)) {\n\t\t\t\t\tresult[key] = val.slice(); // shallow copy array\n\t\t\t\t} else {\n\t\t\t\t\tresult[key] = val;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Remove excluded fields\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\tif (projection[keys[i]]) continue; // Skip if value is truthy\n\t\t\t\n\t\t\tvar fieldPath = keys[i];\n\t\t\tvar pathParts = fieldPath.split('.');\n\t\t\t\n\t\t\t// Navigate to the parent object and delete the final property\n\t\t\tif (pathParts.length === 1) {\n\t\t\t\tdelete result[fieldPath];\n\t\t\t} else {\n\t\t\t\tvar parent = result;\n\t\t\t\tfor (var j = 0; j < pathParts.length - 1; j++) {\n\t\t\t\t\tif (parent == undefined || parent == null) break;\n\t\t\t\t\tparent = parent[pathParts[j]];\n\t\t\t\t}\n\t\t\t\tif (parent != undefined && parent != null) {\n\t\t\t\t\tdelete parent[pathParts[pathParts.length - 1]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Convert bbox to GeoJSON\n */\nexport function bboxToGeojson(bbox) {\n\tconst minLon = bbox[0][0];\n\tconst maxLat = bbox[0][1];\n\tconst maxLon = bbox[1][0];\n\tconst minLat = bbox[1][1];\n\treturn {\n\t\ttype: 'FeatureCollection',\n\t\tfeatures: [{\n\t\t\ttype: 'Feature',\n\t\t\tproperties: {},\n\t\t\tgeometry: {\n\t\t\t\ttype: 'Polygon',\n\t\t\t\tcoordinates: [[\n\t\t\t\t\t[minLon, maxLat],\n\t\t\t\t\t[minLon, minLat],\n\t\t\t\t\t[maxLon, minLat],\n\t\t\t\t\t[maxLon, maxLat],\n\t\t\t\t\t[minLon, maxLat]\n\t\t\t\t]]\n\t\t\t}\n\t\t}]\n\t};\n}\n","// Standard suffix manipulations.\n/** @type {Record<string, string>} */\nconst step2list = {\n  ational: 'ate',\n  tional: 'tion',\n  enci: 'ence',\n  anci: 'ance',\n  izer: 'ize',\n  bli: 'ble',\n  alli: 'al',\n  entli: 'ent',\n  eli: 'e',\n  ousli: 'ous',\n  ization: 'ize',\n  ation: 'ate',\n  ator: 'ate',\n  alism: 'al',\n  iveness: 'ive',\n  fulness: 'ful',\n  ousness: 'ous',\n  aliti: 'al',\n  iviti: 'ive',\n  biliti: 'ble',\n  logi: 'log'\n}\n\n/** @type {Record<string, string>} */\nconst step3list = {\n  icate: 'ic',\n  ative: '',\n  alize: 'al',\n  iciti: 'ic',\n  ical: 'ic',\n  ful: '',\n  ness: ''\n}\n\n// Consonant-vowel sequences.\nconst consonant = '[^aeiou]'\nconst vowel = '[aeiouy]'\nconst consonants = '(' + consonant + '[^aeiouy]*)'\nconst vowels = '(' + vowel + '[aeiou]*)'\n\nconst gt0 = new RegExp('^' + consonants + '?' + vowels + consonants)\nconst eq1 = new RegExp(\n  '^' + consonants + '?' + vowels + consonants + vowels + '?$'\n)\nconst gt1 = new RegExp('^' + consonants + '?(' + vowels + consonants + '){2,}')\nconst vowelInStem = new RegExp('^' + consonants + '?' + vowel)\nconst consonantLike = new RegExp('^' + consonants + vowel + '[^aeiouwxy]$')\n\n// Exception expressions.\nconst sfxLl = /ll$/\nconst sfxE = /^(.+?)e$/\nconst sfxY = /^(.+?)y$/\nconst sfxIon = /^(.+?(s|t))(ion)$/\nconst sfxEdOrIng = /^(.+?)(ed|ing)$/\nconst sfxAtOrBlOrIz = /(at|bl|iz)$/\nconst sfxEED = /^(.+?)eed$/\nconst sfxS = /^.+?[^s]s$/\nconst sfxSsesOrIes = /^.+?(ss|i)es$/\nconst sfxMultiConsonantLike = /([^aeiouylsz])\\1$/\nconst step2 =\n  /^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/\nconst step3 = /^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/\nconst step4 =\n  /^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/\n\n/**\n * Get the stem from a given value.\n *\n * @param {string} value\n *   Value to stem.\n * @returns {string}\n *   Stem for `value`\n */\n// eslint-disable-next-line complexity\nexport function stemmer(value) {\n  let result = String(value).toLowerCase()\n\n  // Exit early.\n  if (result.length < 3) {\n    return result\n  }\n\n  /** @type {boolean} */\n  let firstCharacterWasLowerCaseY = false\n\n  // Detect initial `y`, make sure it never matches.\n  if (\n    result.codePointAt(0) === 121 // Lowercase Y\n  ) {\n    firstCharacterWasLowerCaseY = true\n    result = 'Y' + result.slice(1)\n  }\n\n  // Step 1a.\n  if (sfxSsesOrIes.test(result)) {\n    // Remove last two characters.\n    result = result.slice(0, -2)\n  } else if (sfxS.test(result)) {\n    // Remove last character.\n    result = result.slice(0, -1)\n  }\n\n  /** @type {RegExpMatchArray|null} */\n  let match\n\n  // Step 1b.\n  if ((match = sfxEED.exec(result))) {\n    if (gt0.test(match[1])) {\n      // Remove last character.\n      result = result.slice(0, -1)\n    }\n  } else if ((match = sfxEdOrIng.exec(result)) && vowelInStem.test(match[1])) {\n    result = match[1]\n\n    if (sfxAtOrBlOrIz.test(result)) {\n      // Append `e`.\n      result += 'e'\n    } else if (sfxMultiConsonantLike.test(result)) {\n      // Remove last character.\n      result = result.slice(0, -1)\n    } else if (consonantLike.test(result)) {\n      // Append `e`.\n      result += 'e'\n    }\n  }\n\n  // Step 1c.\n  if ((match = sfxY.exec(result)) && vowelInStem.test(match[1])) {\n    // Remove suffixing `y` and append `i`.\n    result = match[1] + 'i'\n  }\n\n  // Step 2.\n  if ((match = step2.exec(result)) && gt0.test(match[1])) {\n    result = match[1] + step2list[match[2]]\n  }\n\n  // Step 3.\n  if ((match = step3.exec(result)) && gt0.test(match[1])) {\n    result = match[1] + step3list[match[2]]\n  }\n\n  // Step 4.\n  if ((match = step4.exec(result))) {\n    if (gt1.test(match[1])) {\n      result = match[1]\n    }\n  } else if ((match = sfxIon.exec(result)) && gt1.test(match[1])) {\n    result = match[1]\n  }\n\n  // Step 5.\n  if (\n    (match = sfxE.exec(result)) &&\n    (gt1.test(match[1]) ||\n      (eq1.test(match[1]) && !consonantLike.test(match[1])))\n  ) {\n    result = match[1]\n  }\n\n  if (sfxLl.test(result) && gt1.test(result)) {\n    result = result.slice(0, -1)\n  }\n\n  // Turn initial `Y` back to `y`.\n  if (firstCharacterWasLowerCaseY) {\n    result = 'y' + result.slice(1)\n  }\n\n  return result\n}\n","import { stemmer } from 'stemmer';\nimport { BPlusTree } from './bplustree.js';\nimport { getFileHandle } from './bjson.js';\n\n// Common English stop words that don't add semantic value to searches\nconst STOPWORDS = new Set([\n  'a', 'about', 'after', 'all', 'also', 'am', 'an', 'and', 'another', 'any', 'are', \n  'around', 'as', 'at', 'be', 'because', 'been', 'before', 'being', 'between', 'both', \n  'but', 'by', 'came', 'can', 'come', 'could', 'did', 'do', 'each', 'for', 'from', \n  'get', 'got', 'has', 'had', 'he', 'have', 'her', 'here', 'him', 'himself', 'his', \n  'how', 'i', 'if', 'in', 'into', 'is', 'it', 'like', 'make', 'many', 'me', 'might', \n  'more', 'most', 'much', 'must', 'my', 'never', 'now', 'of', 'on', 'only', 'or', \n  'other', 'our', 'out', 'over', 'said', 'same', 'see', 'should', 'since', 'some', \n  'still', 'such', 'take', 'than', 'that', 'the', 'their', 'them', 'then', 'there', \n  'these', 'they', 'this', 'those', 'through', 'to', 'too', 'under', 'up', 'very', \n  'was', 'way', 'we', 'well', 'were', 'what', 'where', 'which', 'while', 'who', \n  'with', 'would', 'you', 'your'\n]);\n\n/**\n * Tokenize text into individual words\n * @param {string} text - The text to tokenize\n * @returns {string[]} Array of words\n */\nexport function tokenize(text) {\n  if (typeof text !== 'string') {\n    return [];\n  }\n  // Split on non-word characters and filter out empty strings\n  const words = text.toLowerCase()\n    .split(/\\W+/)\n    .filter(word => word.length > 0);\n  \n  // Filter stop words\n  return words.filter(word => !STOPWORDS.has(word));\n}\n\n/**\n * TextIndex - A text index implementation using Porter stemmer algorithm\n * \n * This class provides full-text search capabilities by indexing terms\n * and associating them with document IDs. It uses the Porter stemmer\n * algorithm to normalize words to their root forms.\n */\nexport class TextIndex {\n  constructor(options = {}) {\n    const {\n      order = 16,\n      trees\n    } = options;\n\n    this.order = order;\n    this.index = trees?.index || null;\n    this.documentTerms = trees?.documentTerms || null;\n    this.documentLengths = trees?.documentLengths || null;\n    this.isOpen = false;\n  }\n\n  async open() {\n    if (this.isOpen) {\n      throw new Error('TextIndex is already open');\n    }\n\n    if (!this.index || !this.documentTerms || !this.documentLengths) {\n      throw new Error('Trees must be initialized before opening');\n    }\n\n    await Promise.all([\n      this.index.open(),\n      this.documentTerms.open(),\n      this.documentLengths.open()\n    ]);\n\n    this.isOpen = true;\n  }\n\n  async close() {\n    if (!this.isOpen) {\n      return;\n    }\n\n    await Promise.all([\n      this.index.close(),\n      this.documentTerms.close(),\n      this.documentLengths.close()\n    ]);\n\n    this.isOpen = false;\n  }\n\n  _ensureOpen() {\n    if (!this.isOpen) {\n      throw new Error('TextIndex is not open');\n    }\n  }\n\n  /**\n   * Add terms from text to the index for a given document ID\n   * @param {string} docId - The document identifier\n   * @param {string} text - The text content to index\n   */\n  async add(docId, text) {\n    this._ensureOpen();\n\n    if (!docId) {\n      throw new Error('Document ID is required');\n    }\n\n    const words = tokenize(text);\n    const termFrequency = new Map();\n\n    words.forEach(word => {\n      const stem = stemmer(word);\n      termFrequency.set(stem, (termFrequency.get(stem) || 0) + 1);\n    });\n\n    for (const [stem, frequency] of termFrequency.entries()) {\n      const postings = (await this.index.search(stem)) || {};\n      postings[docId] = frequency;\n      await this.index.add(stem, postings);\n    }\n\n    const existingTerms = (await this.documentTerms.search(docId)) || {};\n    const mergedTerms = { ...existingTerms };\n    termFrequency.forEach((frequency, stem) => {\n      mergedTerms[stem] = frequency;\n    });\n\n    const docLength = Object.values(mergedTerms).reduce((sum, count) => sum + count, 0);\n\n    await this.documentTerms.add(docId, mergedTerms);\n    await this.documentLengths.add(docId, docLength);\n  }\n\n  /**\n   * Remove all indexed terms for a given document ID\n   * @param {string} docId - The document identifier to remove\n   * @returns {boolean} True if document was found and removed, false otherwise\n   */\n  async remove(docId) {\n    this._ensureOpen();\n\n    const terms = await this.documentTerms.search(docId);\n    if (!terms) {\n      return false;\n    }\n\n    for (const [term] of Object.entries(terms)) {\n      const postings = (await this.index.search(term)) || {};\n      delete postings[docId];\n\n      if (Object.keys(postings).length === 0) {\n        await this.index.delete(term);\n      } else {\n        await this.index.add(term, postings);\n      }\n    }\n\n    await this.documentTerms.delete(docId);\n    await this.documentLengths.delete(docId);\n    return true;\n  }\n\n  /**\n   * Query the index for documents containing the given terms with relevance scoring\n   * @param {string} queryText - The search query text\n   * @param {Object} options - Query options\n   * @param {boolean} options.scored - If true, return scored results; if false, return just IDs (default: true)\n   * @param {boolean} options.requireAll - If true, require ALL terms; if false, rank by relevance (default: false)\n   * @returns {Array} Array of document IDs (if scored=false) or objects with {id, score} (if scored=true)\n   */\n  async query(queryText, options = { scored: true, requireAll: false }) {\n    this._ensureOpen();\n\n    const words = tokenize(queryText);\n    if (words.length === 0) {\n      return [];\n    }\n\n    const stemmedTerms = words.map(word => stemmer(word));\n    const uniqueTerms = [...new Set(stemmedTerms)];\n\n    if (options.requireAll) {\n      const docSets = [];\n      for (const term of uniqueTerms) {\n        const termDocs = await this.index.search(term);\n        docSets.push(new Set(Object.keys(termDocs || {})));\n      }\n\n      if (docSets.length === 0) {\n        return [];\n      }\n\n      const intersection = new Set(docSets[0]);\n      for (let i = 1; i < docSets.length; i++) {\n        for (const docId of [...intersection]) {\n          if (!docSets[i].has(docId)) {\n            intersection.delete(docId);\n          }\n        }\n      }\n\n      return Array.from(intersection);\n    }\n\n    const docLengthEntries = await this.documentLengths.toArray();\n    const docLengthMap = new Map(docLengthEntries.map(({ key, value }) => [String(key), value || 1]));\n    const totalDocs = docLengthEntries.length;\n\n    const idf = new Map();\n    for (const term of uniqueTerms) {\n      const termDocs = await this.index.search(term);\n      const docsWithTerm = termDocs ? Object.keys(termDocs).length : 0;\n      if (docsWithTerm > 0) {\n        idf.set(term, Math.log(totalDocs / docsWithTerm));\n      }\n    }\n\n    const docScores = new Map();\n    for (const term of uniqueTerms) {\n      const termDocs = await this.index.search(term);\n      if (!termDocs) {\n        continue;\n      }\n\n      for (const [docId, termFreq] of Object.entries(termDocs)) {\n        const docLength = docLengthMap.get(docId) || 1;\n        const tf = termFreq / docLength;\n        const termIdf = idf.get(term) || 0;\n        const prev = docScores.get(docId) || 0;\n        docScores.set(docId, prev + tf * termIdf);\n      }\n    }\n\n    for (const [docId, score] of docScores.entries()) {\n      const docTerms = (await this.documentTerms.search(docId)) || {};\n      const matchingTerms = uniqueTerms.filter(term => !!docTerms[term]).length;\n      const coverage = matchingTerms / uniqueTerms.length;\n      docScores.set(docId, score * (1 + coverage));\n    }\n\n    const results = Array.from(docScores.entries())\n      .map(([id, score]) => ({ id, score }))\n      .sort((a, b) => b.score - a.score);\n\n    if (options.scored === false) {\n      return results.map(r => r.id);\n    }\n    \n    return results;\n  }\n\n  /**\n   * Get the number of unique terms in the index\n   * @returns {number} Number of unique terms\n   */\n  async getTermCount() {\n    this._ensureOpen();\n    const terms = await this.index.toArray();\n    return terms.length;\n  }\n\n  /**\n   * Get the number of documents in the index\n   * @returns {number} Number of indexed documents\n   */\n  async getDocumentCount() {\n    this._ensureOpen();\n    const docs = await this.documentTerms.toArray();\n    return docs.length;\n  }\n\n  /**\n   * Clear all data from the index\n   */\n  async clear() {\n    this._ensureOpen();\n\n    const [terms, docs, lengths] = await Promise.all([\n      this.index.toArray(),\n      this.documentTerms.toArray(),\n      this.documentLengths.toArray()\n    ]);\n\n    // Run deletes sequentially to avoid overlapping writes on the same underlying file\n    for (const entry of terms) {\n      await this.index.delete(entry.key);\n    }\n\n    for (const entry of docs) {\n      await this.documentTerms.delete(entry.key);\n    }\n\n    for (const entry of lengths) {\n      await this.documentLengths.delete(entry.key);\n    }\n  }\n\n  /**\n   * Compact all internal B+ trees using provided destination tree instances.\n   * The destination trees should be freshly created (unopened) with new sync handles.\n   * After compaction completes, the destination sync handles will be closed.\n   * @param {Object} options - Compaction options  \n   * @param {BPlusTree} options.index - Fresh destination tree for index data\n   * @param {BPlusTree} options.documentTerms - Fresh destination tree for document terms\n   * @param {BPlusTree} options.documentLengths - Fresh destination tree for document lengths\n   * @returns {Promise<{terms: object, documents: object, lengths: object}>}\n   */\n  async compact({ index: destIndex, documentTerms: destDocTerms, documentLengths: destDocLengths }) {\n    this._ensureOpen();\n\n    if (!destIndex || !destDocTerms || !destDocLengths) {\n      throw new Error('Destination trees must be provided for compaction');\n    }\n\n    // Compact the trees. Note: BPlusTree.compact() will close the destination sync handle\n    // when finished, so these destination trees should be disposable after this call\n    const termsResult = await this.index.compact(destIndex.file.syncAccessHandle);\n    const documentsResult = await this.documentTerms.compact(destDocTerms.file.syncAccessHandle);\n    const lengthsResult = await this.documentLengths.compact(destDocLengths.file.syncAccessHandle);\n\n    // Close the old trees - now the index is closed\n    await this.close();\n    this.isOpen = false;\n\n    return {\n      terms: termsResult,\n      documents: documentsResult,\n      lengths: lengthsResult\n    };\n  }\n\n}\n\n// Re-export the stemmer so consumers can share the exact same implementation\nexport { stemmer };\n","/**\n * Aggregation Expression Evaluator\n * \n * Implements MongoDB aggregation expression operators for use in\n * $project, $addFields, $set, $group, and other pipeline stages.\n */\n\nimport { getProp } from '../utils.js';\n\n/**\n * Evaluate an aggregation expression against a document\n * @param {*} expr - The expression to evaluate (can be literal, field reference, or expression object)\n * @param {Object} doc - The document to evaluate against\n * @returns {*} The evaluated result\n */\nexport function evaluateExpression(expr, doc) {\n\t// Literal values (strings not starting with $, numbers, booleans, null)\n\tif (expr === null || expr === undefined) {\n\t\treturn expr;\n\t}\n\t\n\tif (typeof expr === 'boolean' || typeof expr === 'number') {\n\t\treturn expr;\n\t}\n\t\n\t// Field reference ($fieldName) or variable reference ($$variableName)\n\tif (typeof expr === 'string') {\n\t\tif (expr.startsWith('$$')) {\n\t\t\t// Special system variables for $redact\n\t\t\tif (expr === '$$KEEP' || expr === '$$PRUNE' || expr === '$$DESCEND') {\n\t\t\t\treturn expr;\n\t\t\t}\n\t\t\t// Variable reference ($$var)\n\t\t\treturn getProp(doc, expr.substring(2));\n\t\t} else if (expr.charAt(0) === '$') {\n\t\t\t// Field reference ($field)\n\t\t\treturn getProp(doc, expr.substring(1));\n\t\t}\n\t\treturn expr; // Literal string\n\t}\n\t\n\t// Expression object\n\tif (typeof expr === 'object') {\n\t\t// Check if it's an array literal\n\t\tif (Array.isArray(expr)) {\n\t\t\treturn expr.map(item => evaluateExpression(item, doc));\n\t\t}\n\t\t\n\t\t// Expression operator\n\t\tconst keys = Object.keys(expr);\n\t\tif (keys.length === 0) {\n\t\t\treturn expr; // Empty object literal\n\t\t}\n\t\t\n\t\tconst operator = keys[0];\n\t\t\n\t\t// Check if this is an operator (starts with $) or an object literal\n\t\tif (operator.charAt(0) === '$') {\n\t\t\t// This is an expression operator\n\t\t\tconst operand = expr[operator];\n\t\t\treturn evaluateOperator(operator, operand, doc);\n\t\t} else {\n\t\t\t// This is an object literal - evaluate each field\n\t\t\tconst result = {};\n\t\t\tfor (const key of keys) {\n\t\t\t\tresult[key] = evaluateExpression(expr[key], doc);\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n\t\n\treturn expr;\n}\n\n/**\n * Evaluate a specific operator\n */\nfunction evaluateOperator(operator, operand, doc) {\n\tswitch (operator) {\n\t\t// Arithmetic operators\n\t\tcase '$add': return evalAdd(operand, doc);\n\t\tcase '$subtract': return evalSubtract(operand, doc);\n\t\tcase '$multiply': return evalMultiply(operand, doc);\n\t\tcase '$divide': return evalDivide(operand, doc);\n\t\tcase '$mod': return evalMod(operand, doc);\n\t\tcase '$pow': return evalPow(operand, doc);\n\t\tcase '$sqrt': return evalSqrt(operand, doc);\n\t\tcase '$abs': return evalAbs(operand, doc);\n\t\tcase '$ceil': return evalCeil(operand, doc);\n\t\tcase '$floor': return evalFloor(operand, doc);\n\t\tcase '$trunc': return evalTrunc(operand, doc);\n\t\tcase '$round': return evalRound(operand, doc);\n\t\t\n\t\t// String operators\n\t\tcase '$concat': return evalConcat(operand, doc);\n\t\tcase '$substr': return evalSubstr(operand, doc);\n\t\tcase '$toLower': return evalToLower(operand, doc);\n\t\tcase '$toUpper': return evalToUpper(operand, doc);\n\t\tcase '$trim': return evalTrim(operand, doc);\n\t\tcase '$ltrim': return evalLtrim(operand, doc);\n\t\tcase '$rtrim': return evalRtrim(operand, doc);\n\t\tcase '$split': return evalSplit(operand, doc);\n\t\tcase '$strLenCP': return evalStrLenCP(operand, doc);\n\t\tcase '$strcasecmp': return evalStrcasecmp(operand, doc);\n\t\tcase '$indexOfCP': return evalIndexOfCP(operand, doc);\n\t\tcase '$replaceOne': return evalReplaceOne(operand, doc);\n\t\tcase '$replaceAll': return evalReplaceAll(operand, doc);\n\t\t\n\t\t// Comparison operators\n\t\tcase '$cmp': return evalCmp(operand, doc);\n\t\tcase '$eq': return evalEq(operand, doc);\n\t\tcase '$ne': return evalNe(operand, doc);\n\t\tcase '$gt': return evalGt(operand, doc);\n\t\tcase '$gte': return evalGte(operand, doc);\n\t\tcase '$lt': return evalLt(operand, doc);\n\t\tcase '$lte': return evalLte(operand, doc);\n\t\t\n\t\t// Logical operators\n\t\tcase '$and': return evalAnd(operand, doc);\n\t\tcase '$or': return evalOr(operand, doc);\n\t\tcase '$not': return evalNot(operand, doc);\n\t\t\n\t\t// Conditional operators\n\t\tcase '$cond': return evalCond(operand, doc);\n\t\tcase '$ifNull': return evalIfNull(operand, doc);\n\t\tcase '$switch': return evalSwitch(operand, doc);\n\t\t\n\t\t// Date operators\n\t\tcase '$year': return evalYear(operand, doc);\n\t\tcase '$month': return evalMonth(operand, doc);\n\t\tcase '$dayOfMonth': return evalDayOfMonth(operand, doc);\n\t\tcase '$dayOfWeek': return evalDayOfWeek(operand, doc);\n\t\tcase '$dayOfYear': return evalDayOfYear(operand, doc);\n\t\tcase '$hour': return evalHour(operand, doc);\n\t\tcase '$minute': return evalMinute(operand, doc);\n\t\tcase '$second': return evalSecond(operand, doc);\n\t\tcase '$millisecond': return evalMillisecond(operand, doc);\n\t\tcase '$week': return evalWeek(operand, doc);\n\t\tcase '$isoWeek': return evalIsoWeek(operand, doc);\n\t\tcase '$isoWeekYear': return evalIsoWeekYear(operand, doc);\n\t\tcase '$dateToString': return evalDateToString(operand, doc);\n\t\tcase '$toDate': return evalToDate(operand, doc);\n\t\t\n\t\t// Array operators\n\t\tcase '$arrayElemAt': return evalArrayElemAt(operand, doc);\n\t\tcase '$concatArrays': return evalConcatArrays(operand, doc);\n\t\tcase '$filter': return evalFilter(operand, doc);\n\t\tcase '$in': return evalIn(operand, doc);\n\t\tcase '$indexOfArray': return evalIndexOfArray(operand, doc);\n\t\tcase '$isArray': return evalIsArray(operand, doc);\n\t\tcase '$map': return evalMap(operand, doc);\n\t\tcase '$reduce': return evalReduce(operand, doc);\n\t\tcase '$size': return evalSize(operand, doc);\n\t\tcase '$slice': return evalSlice(operand, doc);\n\t\tcase '$reverseArray': return evalReverseArray(operand, doc);\n\t\tcase '$zip': return evalZip(operand, doc);\n\t\t\n\t\t// Type operators\n\t\tcase '$type': return evalType(operand, doc);\n\t\tcase '$convert': return evalConvert(operand, doc);\n\t\tcase '$toBool': return evalToBool(operand, doc);\n\t\tcase '$toDecimal': return evalToDecimal(operand, doc);\n\t\tcase '$toDouble': return evalToDouble(operand, doc);\n\t\tcase '$toInt': return evalToInt(operand, doc);\n\t\tcase '$toLong': return evalToLong(operand, doc);\n\t\tcase '$toString': return evalToString(operand, doc);\n\t\t\n\t\t// Object operators\n\t\tcase '$objectToArray': return evalObjectToArray(operand, doc);\n\t\tcase '$arrayToObject': return evalArrayToObject(operand, doc);\n\t\tcase '$mergeObjects': return evalMergeObjects(operand, doc);\n\t\t\n\t\t// Literal operator\n\t\tcase '$literal': return operand;\n\t\t\n\t\tdefault:\n\t\t\tthrow new Error(`Unsupported aggregation operator: ${operator}`);\n\t}\n}\n\n// ============================================================================\n// ARITHMETIC OPERATORS\n// ============================================================================\n\nfunction evalAdd(operands, doc) {\n\tif (!Array.isArray(operands)) return null;\n\tlet sum = 0;\n\tfor (const operand of operands) {\n\t\tconst val = evaluateExpression(operand, doc);\n\t\tif (val instanceof Date) {\n\t\t\tsum += val.getTime();\n\t\t} else if (typeof val === 'number') {\n\t\t\tsum += val;\n\t\t}\n\t}\n\treturn sum;\n}\n\nfunction evalSubtract(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst val1 = evaluateExpression(operands[0], doc);\n\tconst val2 = evaluateExpression(operands[1], doc);\n\t\n\tif (val1 instanceof Date && val2 instanceof Date) {\n\t\treturn val1.getTime() - val2.getTime();\n\t} else if (val1 instanceof Date && typeof val2 === 'number') {\n\t\treturn new Date(val1.getTime() - val2);\n\t} else if (typeof val1 === 'number' && typeof val2 === 'number') {\n\t\treturn val1 - val2;\n\t}\n\treturn null;\n}\n\nfunction evalMultiply(operands, doc) {\n\tif (!Array.isArray(operands)) return null;\n\tlet product = 1;\n\tfor (const operand of operands) {\n\t\tconst val = evaluateExpression(operand, doc);\n\t\tif (typeof val === 'number') {\n\t\t\tproduct *= val;\n\t\t}\n\t}\n\treturn product;\n}\n\nfunction evalDivide(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst val1 = evaluateExpression(operands[0], doc);\n\tconst val2 = evaluateExpression(operands[1], doc);\n\tif (typeof val1 === 'number' && typeof val2 === 'number' && val2 !== 0) {\n\t\treturn val1 / val2;\n\t}\n\treturn null;\n}\n\nfunction evalMod(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst val1 = evaluateExpression(operands[0], doc);\n\tconst val2 = evaluateExpression(operands[1], doc);\n\tif (typeof val1 === 'number' && typeof val2 === 'number' && val2 !== 0) {\n\t\treturn val1 % val2;\n\t}\n\treturn null;\n}\n\nfunction evalPow(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst base = evaluateExpression(operands[0], doc);\n\tconst exponent = evaluateExpression(operands[1], doc);\n\tif (typeof base === 'number' && typeof exponent === 'number') {\n\t\treturn Math.pow(base, exponent);\n\t}\n\treturn null;\n}\n\nfunction evalSqrt(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\tif (typeof val === 'number' && val >= 0) {\n\t\treturn Math.sqrt(val);\n\t}\n\treturn null;\n}\n\nfunction evalAbs(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\tif (typeof val === 'number') {\n\t\treturn Math.abs(val);\n\t}\n\treturn null;\n}\n\nfunction evalCeil(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\tif (typeof val === 'number') {\n\t\treturn Math.ceil(val);\n\t}\n\treturn null;\n}\n\nfunction evalFloor(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\tif (typeof val === 'number') {\n\t\treturn Math.floor(val);\n\t}\n\treturn null;\n}\n\nfunction evalTrunc(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\tif (typeof val === 'number') {\n\t\treturn Math.trunc(val);\n\t}\n\treturn null;\n}\n\nfunction evalRound(operands, doc) {\n\tconst val = evaluateExpression(Array.isArray(operands) ? operands[0] : operands, doc);\n\tconst place = Array.isArray(operands) && operands[1] !== undefined \n\t\t? evaluateExpression(operands[1], doc) \n\t\t: 0;\n\t\n\tif (typeof val === 'number' && typeof place === 'number') {\n\t\tconst multiplier = Math.pow(10, place);\n\t\treturn Math.round(val * multiplier) / multiplier;\n\t}\n\treturn null;\n}\n\n// ============================================================================\n// STRING OPERATORS\n// ============================================================================\n\nfunction evalConcat(operands, doc) {\n\tif (!Array.isArray(operands)) return null;\n\tlet result = '';\n\tfor (const operand of operands) {\n\t\tconst val = evaluateExpression(operand, doc);\n\t\tif (val !== null && val !== undefined) {\n\t\t\tresult += String(val);\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction evalSubstr(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length < 3) return null;\n\tconst str = String(evaluateExpression(operands[0], doc) || '');\n\tconst start = evaluateExpression(operands[1], doc);\n\tconst length = evaluateExpression(operands[2], doc);\n\tif (typeof start === 'number' && typeof length === 'number') {\n\t\treturn str.substr(start, length);\n\t}\n\treturn null;\n}\n\nfunction evalToLower(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\treturn val !== null && val !== undefined ? String(val).toLowerCase() : '';\n}\n\nfunction evalToUpper(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\treturn val !== null && val !== undefined ? String(val).toUpperCase() : '';\n}\n\nfunction evalTrim(operand, doc) {\n\tconst val = evaluateExpression(typeof operand === 'object' && operand.input ? operand.input : operand, doc);\n\tconst chars = operand.chars ? evaluateExpression(operand.chars, doc) : null;\n\t\n\tlet str = val !== null && val !== undefined ? String(val) : '';\n\t\n\tif (chars) {\n\t\tconst charsRegex = new RegExp(`^[${escapeRegex(chars)}]+|[${escapeRegex(chars)}]+$`, 'g');\n\t\treturn str.replace(charsRegex, '');\n\t}\n\treturn str.trim();\n}\n\nfunction evalLtrim(operand, doc) {\n\tconst val = evaluateExpression(typeof operand === 'object' && operand.input ? operand.input : operand, doc);\n\tconst chars = operand.chars ? evaluateExpression(operand.chars, doc) : null;\n\t\n\tlet str = val !== null && val !== undefined ? String(val) : '';\n\t\n\tif (chars) {\n\t\tconst charsRegex = new RegExp(`^[${escapeRegex(chars)}]+`, 'g');\n\t\treturn str.replace(charsRegex, '');\n\t}\n\treturn str.replace(/^\\s+/, '');\n}\n\nfunction evalRtrim(operand, doc) {\n\tconst val = evaluateExpression(typeof operand === 'object' && operand.input ? operand.input : operand, doc);\n\tconst chars = operand.chars ? evaluateExpression(operand.chars, doc) : null;\n\t\n\tlet str = val !== null && val !== undefined ? String(val) : '';\n\t\n\tif (chars) {\n\t\tconst charsRegex = new RegExp(`[${escapeRegex(chars)}]+$`, 'g');\n\t\treturn str.replace(charsRegex, '');\n\t}\n\treturn str.replace(/\\s+$/, '');\n}\n\nfunction evalSplit(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst str = String(evaluateExpression(operands[0], doc) || '');\n\tconst delimiter = String(evaluateExpression(operands[1], doc) || '');\n\treturn str.split(delimiter);\n}\n\nfunction evalStrLenCP(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\treturn val !== null && val !== undefined ? String(val).length : 0;\n}\n\nfunction evalStrcasecmp(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst str1 = String(evaluateExpression(operands[0], doc) || '').toLowerCase();\n\tconst str2 = String(evaluateExpression(operands[1], doc) || '').toLowerCase();\n\t\n\tif (str1 < str2) return -1;\n\tif (str1 > str2) return 1;\n\treturn 0;\n}\n\nfunction evalIndexOfCP(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length < 2) return null;\n\tconst str = String(evaluateExpression(operands[0], doc) || '');\n\tconst substr = String(evaluateExpression(operands[1], doc) || '');\n\tconst start = operands[2] !== undefined ? evaluateExpression(operands[2], doc) : 0;\n\tconst end = operands[3] !== undefined ? evaluateExpression(operands[3], doc) : str.length;\n\t\n\tconst searchStr = str.substring(start, end);\n\tconst index = searchStr.indexOf(substr);\n\treturn index === -1 ? -1 : index + start;\n}\n\nfunction evalReplaceOne(operand, doc) {\n\tconst input = String(evaluateExpression(operand.input, doc) || '');\n\tconst find = String(evaluateExpression(operand.find, doc) || '');\n\tconst replacement = String(evaluateExpression(operand.replacement, doc) || '');\n\t\n\treturn input.replace(find, replacement);\n}\n\nfunction evalReplaceAll(operand, doc) {\n\tconst input = String(evaluateExpression(operand.input, doc) || '');\n\tconst find = String(evaluateExpression(operand.find, doc) || '');\n\tconst replacement = String(evaluateExpression(operand.replacement, doc) || '');\n\t\n\treturn input.split(find).join(replacement);\n}\n\nfunction escapeRegex(str) {\n\treturn str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\n// ============================================================================\n// COMPARISON OPERATORS\n// ============================================================================\n\nfunction evalCmp(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst val1 = evaluateExpression(operands[0], doc);\n\tconst val2 = evaluateExpression(operands[1], doc);\n\t\n\tif (val1 < val2) return -1;\n\tif (val1 > val2) return 1;\n\treturn 0;\n}\n\nfunction evalEq(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst val1 = evaluateExpression(operands[0], doc);\n\tconst val2 = evaluateExpression(operands[1], doc);\n\treturn val1 === val2;\n}\n\nfunction evalNe(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst val1 = evaluateExpression(operands[0], doc);\n\tconst val2 = evaluateExpression(operands[1], doc);\n\treturn val1 !== val2;\n}\n\nfunction evalGt(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst val1 = evaluateExpression(operands[0], doc);\n\tconst val2 = evaluateExpression(operands[1], doc);\n\treturn val1 > val2;\n}\n\nfunction evalGte(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst val1 = evaluateExpression(operands[0], doc);\n\tconst val2 = evaluateExpression(operands[1], doc);\n\treturn val1 >= val2;\n}\n\nfunction evalLt(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst val1 = evaluateExpression(operands[0], doc);\n\tconst val2 = evaluateExpression(operands[1], doc);\n\treturn val1 < val2;\n}\n\nfunction evalLte(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst val1 = evaluateExpression(operands[0], doc);\n\tconst val2 = evaluateExpression(operands[1], doc);\n\treturn val1 <= val2;\n}\n\n// ============================================================================\n// LOGICAL OPERATORS\n// ============================================================================\n\nfunction evalAnd(operands, doc) {\n\tif (!Array.isArray(operands)) return null;\n\tfor (const operand of operands) {\n\t\tconst val = evaluateExpression(operand, doc);\n\t\tif (!val) return false;\n\t}\n\treturn true;\n}\n\nfunction evalOr(operands, doc) {\n\tif (!Array.isArray(operands)) return null;\n\tfor (const operand of operands) {\n\t\tconst val = evaluateExpression(operand, doc);\n\t\tif (val) return true;\n\t}\n\treturn false;\n}\n\nfunction evalNot(operand, doc) {\n\tconst val = evaluateExpression(Array.isArray(operand) ? operand[0] : operand, doc);\n\treturn !val;\n}\n\n// ============================================================================\n// CONDITIONAL OPERATORS\n// ============================================================================\n\nfunction evalCond(operand, doc) {\n\t// Supports both array form [if, then, else] and object form {if, then, else}\n\tlet ifExpr, thenExpr, elseExpr;\n\t\n\tif (Array.isArray(operand)) {\n\t\tif (operand.length !== 3) return null;\n\t\t[ifExpr, thenExpr, elseExpr] = operand;\n\t} else if (typeof operand === 'object') {\n\t\tifExpr = operand.if;\n\t\tthenExpr = operand.then;\n\t\telseExpr = operand.else;\n\t} else {\n\t\treturn null;\n\t}\n\t\n\tconst condition = evaluateExpression(ifExpr, doc);\n\treturn condition ? evaluateExpression(thenExpr, doc) : evaluateExpression(elseExpr, doc);\n}\n\nfunction evalIfNull(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length < 2) return null;\n\t\n\tfor (let i = 0; i < operands.length; i++) {\n\t\tconst val = evaluateExpression(operands[i], doc);\n\t\tif (val !== null && val !== undefined) {\n\t\t\treturn val;\n\t\t}\n\t}\n\treturn null;\n}\n\nfunction evalSwitch(operand, doc) {\n\tif (typeof operand !== 'object' || !Array.isArray(operand.branches)) {\n\t\treturn null;\n\t}\n\t\n\tfor (const branch of operand.branches) {\n\t\tconst caseResult = evaluateExpression(branch.case, doc);\n\t\tif (caseResult) {\n\t\t\treturn evaluateExpression(branch.then, doc);\n\t\t}\n\t}\n\t\n\treturn operand.default !== undefined ? evaluateExpression(operand.default, doc) : null;\n}\n\n// ============================================================================\n// DATE OPERATORS\n// ============================================================================\n\nfunction evalYear(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\treturn date.getUTCFullYear();\n\t}\n\treturn null;\n}\n\nfunction evalMonth(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\treturn date.getUTCMonth() + 1; // MongoDB returns 1-12\n\t}\n\treturn null;\n}\n\nfunction evalDayOfMonth(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\treturn date.getUTCDate();\n\t}\n\treturn null;\n}\n\nfunction evalDayOfWeek(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\treturn date.getUTCDay() + 1; // MongoDB returns 1-7 (Sunday is 1)\n\t}\n\treturn null;\n}\n\nfunction evalDayOfYear(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\tconst start = new Date(Date.UTC(date.getUTCFullYear(), 0, 0));\n\t\tconst diff = date - start;\n\t\tconst oneDay = 1000 * 60 * 60 * 24;\n\t\treturn Math.floor(diff / oneDay);\n\t}\n\treturn null;\n}\n\nfunction evalHour(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\treturn date.getUTCHours();\n\t}\n\treturn null;\n}\n\nfunction evalMinute(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\treturn date.getUTCMinutes();\n\t}\n\treturn null;\n}\n\nfunction evalSecond(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\treturn date.getUTCSeconds();\n\t}\n\treturn null;\n}\n\nfunction evalMillisecond(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\treturn date.getUTCMilliseconds();\n\t}\n\treturn null;\n}\n\nfunction evalWeek(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\tconst onejan = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));\n\t\tconst week = Math.ceil((((date - onejan) / 86400000) + onejan.getUTCDay() + 1) / 7);\n\t\treturn week - 1; // MongoDB weeks are 0-indexed\n\t}\n\treturn null;\n}\n\nfunction evalIsoWeek(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\tconst target = new Date(date.valueOf());\n\t\tconst dayNr = (date.getUTCDay() + 6) % 7;\n\t\ttarget.setUTCDate(target.getUTCDate() - dayNr + 3);\n\t\tconst firstThursday = target.valueOf();\n\t\ttarget.setUTCMonth(0, 1);\n\t\tif (target.getUTCDay() !== 4) {\n\t\t\ttarget.setUTCMonth(0, 1 + ((4 - target.getUTCDay()) + 7) % 7);\n\t\t}\n\t\treturn 1 + Math.ceil((firstThursday - target) / 604800000);\n\t}\n\treturn null;\n}\n\nfunction evalIsoWeekYear(operand, doc) {\n\tconst date = evaluateExpression(operand, doc);\n\tif (date instanceof Date) {\n\t\tconst target = new Date(date.valueOf());\n\t\ttarget.setUTCDate(target.getUTCDate() - ((date.getUTCDay() + 6) % 7) + 3);\n\t\treturn target.getUTCFullYear();\n\t}\n\treturn null;\n}\n\nfunction evalDateToString(operand, doc) {\n\tconst format = operand.format ? evaluateExpression(operand.format, doc) : '%Y-%m-%dT%H:%M:%S.%LZ';\n\tconst date = evaluateExpression(operand.date, doc);\n\t\n\tif (!(date instanceof Date)) return null;\n\t\n\t// Simple format string implementation using UTC methods\n\treturn format\n\t\t.replace('%Y', date.getUTCFullYear())\n\t\t.replace('%m', String(date.getUTCMonth() + 1).padStart(2, '0'))\n\t\t.replace('%d', String(date.getUTCDate()).padStart(2, '0'))\n\t\t.replace('%H', String(date.getUTCHours()).padStart(2, '0'))\n\t\t.replace('%M', String(date.getUTCMinutes()).padStart(2, '0'))\n\t\t.replace('%S', String(date.getUTCSeconds()).padStart(2, '0'))\n\t\t.replace('%L', String(date.getUTCMilliseconds()).padStart(3, '0'));\n}\n\nfunction evalToDate(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\tif (val instanceof Date) return val;\n\tif (typeof val === 'string' || typeof val === 'number') {\n\t\tconst date = new Date(val);\n\t\treturn isNaN(date.getTime()) ? null : date;\n\t}\n\treturn null;\n}\n\n// ============================================================================\n// ARRAY OPERATORS\n// ============================================================================\n\nfunction evalArrayElemAt(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst arr = evaluateExpression(operands[0], doc);\n\tconst idx = evaluateExpression(operands[1], doc);\n\t\n\tif (!Array.isArray(arr) || typeof idx !== 'number') return null;\n\t\n\tconst index = idx < 0 ? arr.length + idx : idx;\n\treturn arr[index];\n}\n\nfunction evalConcatArrays(operands, doc) {\n\tif (!Array.isArray(operands)) return null;\n\tconst result = [];\n\tfor (const operand of operands) {\n\t\tconst arr = evaluateExpression(operand, doc);\n\t\tif (Array.isArray(arr)) {\n\t\t\tresult.push(...arr);\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction evalFilter(operand, doc) {\n\tconst input = evaluateExpression(operand.input, doc);\n\tconst asVar = operand.as || 'this';\n\tconst cond = operand.cond;\n\t\n\tif (!Array.isArray(input)) return null;\n\t\n\treturn input.filter(item => {\n\t\tconst itemDoc = { ...doc, [asVar]: item };\n\t\treturn evaluateExpression(cond, itemDoc);\n\t});\n}\n\nfunction evalIn(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length !== 2) return null;\n\tconst value = evaluateExpression(operands[0], doc);\n\tconst arr = evaluateExpression(operands[1], doc);\n\t\n\tif (!Array.isArray(arr)) return false;\n\treturn arr.includes(value);\n}\n\nfunction evalIndexOfArray(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length < 2) return null;\n\tconst arr = evaluateExpression(operands[0], doc);\n\tconst search = evaluateExpression(operands[1], doc);\n\tconst start = operands[2] !== undefined ? evaluateExpression(operands[2], doc) : 0;\n\tconst end = operands[3] !== undefined ? evaluateExpression(operands[3], doc) : arr.length;\n\t\n\tif (!Array.isArray(arr)) return null;\n\t\n\tfor (let i = start; i < end && i < arr.length; i++) {\n\t\tif (arr[i] === search) return i;\n\t}\n\treturn -1;\n}\n\nfunction evalIsArray(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\treturn Array.isArray(val);\n}\n\nfunction evalMap(operand, doc) {\n\tconst input = evaluateExpression(operand.input, doc);\n\tconst asVar = operand.as || 'this';\n\tconst inExpr = operand.in;\n\t\n\tif (!Array.isArray(input)) return null;\n\t\n\treturn input.map(item => {\n\t\tconst itemDoc = { ...doc, [asVar]: item };\n\t\treturn evaluateExpression(inExpr, itemDoc);\n\t});\n}\n\nfunction evalReduce(operand, doc) {\n\tconst input = evaluateExpression(operand.input, doc);\n\tconst initialValue = evaluateExpression(operand.initialValue, doc);\n\tconst inExpr = operand.in;\n\t\n\tif (!Array.isArray(input)) return null;\n\t\n\tlet value = initialValue;\n\tfor (const item of input) {\n\t\tconst itemDoc = { ...doc, value, this: item };\n\t\tvalue = evaluateExpression(inExpr, itemDoc);\n\t}\n\treturn value;\n}\n\nfunction evalSize(operand, doc) {\n\tconst arr = evaluateExpression(operand, doc);\n\treturn Array.isArray(arr) ? arr.length : null;\n}\n\nfunction evalSlice(operands, doc) {\n\tif (!Array.isArray(operands) || operands.length < 2) return null;\n\tconst arr = evaluateExpression(operands[0], doc);\n\t\n\tif (!Array.isArray(arr)) return null;\n\t\n\tif (operands.length === 2) {\n\t\tconst n = evaluateExpression(operands[1], doc);\n\t\treturn n >= 0 ? arr.slice(0, n) : arr.slice(n);\n\t} else {\n\t\tconst position = evaluateExpression(operands[1], doc);\n\t\tconst n = evaluateExpression(operands[2], doc);\n\t\treturn arr.slice(position, position + n);\n\t}\n}\n\nfunction evalReverseArray(operand, doc) {\n\tconst arr = evaluateExpression(operand, doc);\n\treturn Array.isArray(arr) ? arr.slice().reverse() : null;\n}\n\nfunction evalZip(operand, doc) {\n\tconst inputs = operand.inputs ? evaluateExpression(operand.inputs, doc) : null;\n\tconst useLongestLength = operand.useLongestLength || false;\n\tconst defaults = operand.defaults;\n\t\n\tif (!Array.isArray(inputs)) return null;\n\t\n\tconst arrays = inputs.map(input => evaluateExpression(input, doc));\n\tif (!arrays.every(arr => Array.isArray(arr))) return null;\n\t\n\tconst maxLength = Math.max(...arrays.map(arr => arr.length));\n\tconst length = useLongestLength ? maxLength : Math.min(...arrays.map(arr => arr.length));\n\t\n\tconst result = [];\n\tfor (let i = 0; i < length; i++) {\n\t\tconst tuple = [];\n\t\tfor (let j = 0; j < arrays.length; j++) {\n\t\t\tif (i < arrays[j].length) {\n\t\t\t\ttuple.push(arrays[j][i]);\n\t\t\t} else if (defaults && j < defaults.length) {\n\t\t\t\ttuple.push(defaults[j]);\n\t\t\t} else {\n\t\t\t\ttuple.push(null);\n\t\t\t}\n\t\t}\n\t\tresult.push(tuple);\n\t}\n\treturn result;\n}\n\n// ============================================================================\n// TYPE OPERATORS\n// ============================================================================\n\nfunction evalType(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\t\n\tif (val === null) return 'null';\n\tif (val === undefined) return 'missing';\n\tif (typeof val === 'boolean') return 'bool';\n\tif (typeof val === 'number') return Number.isInteger(val) ? 'int' : 'double';\n\tif (typeof val === 'string') return 'string';\n\tif (val instanceof Date) return 'date';\n\tif (Array.isArray(val)) return 'array';\n\tif (typeof val === 'object') return 'object';\n\t\n\treturn 'unknown';\n}\n\nfunction evalConvert(operand, doc) {\n\tconst input = evaluateExpression(operand.input, doc);\n\tconst to = operand.to;\n\tconst onError = operand.onError;\n\tconst onNull = operand.onNull;\n\t\n\tif (input === null) {\n\t\treturn onNull !== undefined ? evaluateExpression(onNull, doc) : null;\n\t}\n\t\n\ttry {\n\t\tswitch (to) {\n\t\t\tcase 'double':\n\t\t\tcase 'decimal':\n\t\t\t\treturn parseFloat(input);\n\t\t\tcase 'int':\n\t\t\tcase 'long':\n\t\t\t\treturn parseInt(input);\n\t\t\tcase 'bool':\n\t\t\t\treturn Boolean(input);\n\t\t\tcase 'string':\n\t\t\t\treturn String(input);\n\t\t\tcase 'date':\n\t\t\t\treturn new Date(input);\n\t\t\tdefault:\n\t\t\t\treturn input;\n\t\t}\n\t} catch (e) {\n\t\treturn onError !== undefined ? evaluateExpression(onError, doc) : null;\n\t}\n}\n\nfunction evalToBool(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\treturn Boolean(val);\n}\n\nfunction evalToDecimal(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\treturn parseFloat(val);\n}\n\nfunction evalToDouble(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\treturn parseFloat(val);\n}\n\nfunction evalToInt(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\treturn parseInt(val);\n}\n\nfunction evalToLong(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\treturn parseInt(val);\n}\n\nfunction evalToString(operand, doc) {\n\tconst val = evaluateExpression(operand, doc);\n\tif (val === null || val === undefined) return null;\n\treturn String(val);\n}\n\n// ============================================================================\n// OBJECT OPERATORS\n// ============================================================================\n\nfunction evalObjectToArray(operand, doc) {\n\tconst obj = evaluateExpression(operand, doc);\n\tif (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n\t\treturn null;\n\t}\n\t\n\treturn Object.keys(obj).map(key => ({ k: key, v: obj[key] }));\n}\n\nfunction evalArrayToObject(operand, doc) {\n\tconst arr = evaluateExpression(operand, doc);\n\tif (!Array.isArray(arr)) return null;\n\t\n\tconst result = {};\n\tfor (const item of arr) {\n\t\tif (Array.isArray(item) && item.length === 2) {\n\t\t\tresult[item[0]] = item[1];\n\t\t} else if (typeof item === 'object' && item.k !== undefined && item.v !== undefined) {\n\t\t\tresult[item.k] = item.v;\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction evalMergeObjects(operands, doc) {\n\tif (!Array.isArray(operands)) {\n\t\t// Single object\n\t\treturn evaluateExpression(operands, doc);\n\t}\n\t\n\tconst result = {};\n\tfor (const operand of operands) {\n\t\tconst obj = evaluateExpression(operand, doc);\n\t\tif (typeof obj === 'object' && obj !== null && !Array.isArray(obj)) {\n\t\t\tObject.assign(result, obj);\n\t\t}\n\t}\n\treturn result;\n}\n","import { getProp, getFieldValues, isArray, arrayMatches, objectMatches, toArray, isIn, bboxToGeojson } from '../utils.js';\nimport { stemmer, tokenize } from 'bjson/textindex';\nimport { ObjectId } from 'bjson';\nimport { evaluateExpression } from './aggregationExpressions.js';\n\n/**\n * BSON type mappings for $type operator\n */\nconst BSON_TYPES = {\n\t1: 'double',\n\t2: 'string',\n\t3: 'object',\n\t4: 'array',\n\t5: 'binData',\n\t6: 'undefined',\n\t7: 'objectId',\n\t8: 'bool',\n\t9: 'date',\n\t10: 'null',\n\t11: 'regex',\n\t13: 'javascript',\n\t15: 'javascriptWithScope',\n\t16: 'int',\n\t17: 'timestamp',\n\t18: 'long',\n\t19: 'decimal',\n\t127: 'maxKey',\n\t'-1': 'minKey'\n};\n\n// Reverse mapping from alias to code\nconst TYPE_ALIASES = Object.entries(BSON_TYPES).reduce((acc, [code, name]) => {\n\tacc[name] = parseInt(code);\n\treturn acc;\n}, {});\n\n/**\n * Check if a value matches a BSON type or type code\n */\nfunction matchesType(value, typeSpec) {\n\t// Handle array of types\n\tif (isArray(typeSpec)) {\n\t\tfor (let i = 0; i < typeSpec.length; i++) {\n\t\t\tif (matchesType(value, typeSpec[i])) return true;\n\t\t}\n\t\treturn false;\n\t}\n\t\n\t// Get type code from spec (can be number or string alias)\n\tconst typeCode = typeof typeSpec === 'number' ? typeSpec : TYPE_ALIASES[typeSpec];\n\tconst typeName = BSON_TYPES[typeCode] || typeSpec;\n\t\n\t// Check value type\n\tif (value === null) return typeName === 'null' || typeCode === 10;\n\tif (value === undefined) return typeName === 'undefined' || typeCode === 6;\n\tif (typeof value === 'number') {\n\t\tif (Number.isInteger(value)) return typeName === 'int' || typeCode === 16;\n\t\treturn typeName === 'double' || typeCode === 1;\n\t}\n\tif (typeof value === 'string') return typeName === 'string' || typeCode === 2;\n\tif (typeof value === 'boolean') return typeName === 'bool' || typeCode === 8;\n\tif (value instanceof Date) return typeName === 'date' || typeCode === 9;\n\tif (value instanceof ObjectId) return typeName === 'objectId' || typeCode === 7;\n\tif (value instanceof RegExp) return typeName === 'regex' || typeCode === 11;\n\tif (isArray(value)) return typeName === 'array' || typeCode === 4;\n\tif (typeof value === 'object') return typeName === 'object' || typeCode === 3;\n\t\n\t// Fallback to simple type check\n\treturn typeof value === typeSpec;\n}\n\n/**\n * Bit query operator helpers\n */\nfunction toBitMask(positions) {\n\tif (isArray(positions)) {\n\t\t// Array of bit positions\n\t\tlet mask = 0;\n\t\tfor (let i = 0; i < positions.length; i++) {\n\t\t\tmask |= (1 << positions[i]);\n\t\t}\n\t\treturn mask;\n\t} else if (typeof positions === 'number') {\n\t\t// Bitmask directly\n\t\treturn positions;\n\t}\n\treturn 0;\n}\n\nfunction matchesBitsAllSet(value, positions) {\n\tif (typeof value !== 'number') return false;\n\tconst mask = toBitMask(positions);\n\treturn (value & mask) === mask;\n}\n\nfunction matchesBitsAllClear(value, positions) {\n\tif (typeof value !== 'number') return false;\n\tconst mask = toBitMask(positions);\n\treturn (value & mask) === 0;\n}\n\nfunction matchesBitsAnySet(value, positions) {\n\tif (typeof value !== 'number') return false;\n\tconst mask = toBitMask(positions);\n\treturn (value & mask) !== 0;\n}\n\nfunction matchesBitsAnyClear(value, positions) {\n\tif (typeof value !== 'number') return false;\n\tconst mask = toBitMask(positions);\n\treturn (value & mask) !== mask;\n}\n\n/**\n * JSON Schema validator (simplified)\n */\nfunction validateJsonSchema(doc, schema) {\n\t// Basic JSON Schema validation\n\tif (schema.type) {\n\t\tconst docType = isArray(doc) ? 'array' : (doc === null ? 'null' : typeof doc);\n\t\tif (schema.type !== docType) return false;\n\t}\n\t\n\tif (schema.required && isArray(schema.required)) {\n\t\tfor (let i = 0; i < schema.required.length; i++) {\n\t\t\tif (!(schema.required[i] in doc)) return false;\n\t\t}\n\t}\n\t\n\tif (schema.properties) {\n\t\tfor (const key in schema.properties) {\n\t\t\t// When using $jsonSchema as a query operator, properties must exist to match\n\t\t\t// (This is different from standard JSON Schema validation where properties are optional)\n\t\t\tif (!(key in doc)) return false;\n\t\t\t\n\t\t\tconst propSchema = schema.properties[key];\n\t\t\tif (!validateJsonSchema(doc[key], propSchema)) return false;\n\t\t}\n\t}\n\t\n\tif (schema.minimum !== undefined && typeof doc === 'number') {\n\t\tif (doc < schema.minimum) return false;\n\t}\n\t\n\tif (schema.maximum !== undefined && typeof doc === 'number') {\n\t\tif (doc > schema.maximum) return false;\n\t}\n\t\n\tif (schema.minLength !== undefined && typeof doc === 'string') {\n\t\tif (doc.length < schema.minLength) return false;\n\t}\n\t\n\tif (schema.maxLength !== undefined && typeof doc === 'string') {\n\t\tif (doc.length > schema.maxLength) return false;\n\t}\n\t\n\tif (schema.pattern && typeof doc === 'string') {\n\t\tconst regex = new RegExp(schema.pattern);\n\t\tif (!regex.test(doc)) return false;\n\t}\n\t\n\tif (schema.enum && isArray(schema.enum)) {\n\t\tif (!schema.enum.includes(doc)) return false;\n\t}\n\t\n\treturn true;\n}\n\n/**\n * Compare two values for equality, handling ObjectId instances\n */\nfunction valuesEqual(a, b) {\n\t// Handle ObjectId comparison\n\tif (a instanceof ObjectId && b instanceof ObjectId) {\n    return a.equals(b);\n\t}\n\t\n\t// Regular equality\n\treturn a == b;\n}\n\n/**\n * Compare two values with a comparison operator, handling ObjectId instances\n */\nfunction compareValues(a, b, operator) {\n\t// Convert ObjectIds to comparable values (use timestamp for ordering)\n\tlet aVal = a;\n\tlet bVal = b;\n\t\n\tif (a instanceof ObjectId) {\n\t\taVal = a.toString();\n\t}\n\tif (b instanceof ObjectId) {\n\t\tbVal = b.toString();\n\t}\n\t\n\tswitch(operator) {\n\t\tcase '>': return aVal > bVal;\n\t\tcase '>=': return aVal >= bVal;\n\t\tcase '<': return aVal < bVal;\n\t\tcase '<=': return aVal <= bVal;\n\t\tdefault: return false;\n\t}\n}\n\n/**\n * Check if a field value (possibly from array traversal) matches a condition\n * Handles both single values and arrays of values (from array traversal)\n */\nfunction fieldValueMatches(fieldValue, checkFn) {\n\t// Use strict equality to allow null values through\n\tif (fieldValue === undefined) return false;\n\t\n\t// Check for null before isArray to avoid crash\n\tif (fieldValue === null) return checkFn(fieldValue);\n\t\n\t// If fieldValue is an array (from array traversal), check if ANY element matches\n\tif (isArray(fieldValue)) {\n\t\tfor (var i = 0; i < fieldValue.length; i++) {\n\t\t\tif (checkFn(fieldValue[i])) return true;\n\t\t}\n\t\treturn false;\n\t}\n\t\n\t// Otherwise check the single value\n\treturn checkFn(fieldValue);\n}\n\n/**\n * Tokenize text for search\n */\nfunction tokenizeText(text) {\n\tif (typeof text !== 'string') return [];\n\n  const words = tokenize(text);\n\treturn words.map(w => stemmer(w));\n}\n\n/**\n * Text search helper\n * Matches if the property contains tokens from the query\n */\nexport function text(prop, queryText) {\n\tif (typeof prop !== 'string') return false;\n\t\n\tconst propTokens = new Set(tokenizeText(prop));\n\tconst queryTokens = tokenizeText(queryText);\n\t\n\t// Match if any query term is in the document\n\treturn queryTokens.some(term => propTokens.has(term));\n}\n\n/**\n * Text search across all string fields in a document\n * Used for top-level $text operator\n */\nfunction textSearchDocument(doc, searchText) {\n\tif (!doc || typeof doc !== 'object') return false;\n\t\n\t// Recursively search all string fields\n\tfunction searchObject(obj) {\n\t\tif (typeof obj === 'string') {\n\t\t\treturn text(obj, searchText);\n\t\t}\n\t\t\n\t\tif (typeof obj !== 'object' || obj === null) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t// Check arrays\n\t\tif (isArray(obj)) {\n\t\t\tfor (let i = 0; i < obj.length; i++) {\n\t\t\t\tif (searchObject(obj[i])) return true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t// Check object properties\n\t\tfor (const key in obj) {\n\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\tif (searchObject(obj[key])) return true;\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn false;\n\t}\n\t\n\treturn searchObject(doc);\n}\n\n/**\n * Geo within helper - using bounding box logic instead of de9im\n * This is a simpler implementation that doesn't require de9im dependency\n */\nexport function geoWithin(prop, query) {\n\ttry {\n\t\t// bbox format: [[minLon, maxLat], [maxLon, minLat]]\n\t\tif (!Array.isArray(query) || query.length !== 2) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst minLon = query[0][0];\n\t\tconst maxLat = query[0][1];\n\t\tconst maxLon = query[1][0];\n\t\tconst minLat = query[1][1];\n\n\t\t// Check if geometry is within bounding box\n\t\treturn isGeometryWithinBBox(prop, minLon, maxLon, minLat, maxLat);\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\n/**\n * Check if a GeoJSON geometry is within a bounding box\n * For Points: checks if the point is within the bbox\n * For Polygons: checks if ALL vertices are within the bbox\n */\nfunction isGeometryWithinBBox(geoJson, minLon, maxLon, minLat, maxLat) {\n\tif (!geoJson) return false;\n\n\t// Handle GeoJSON FeatureCollection\n\tif (geoJson.type === 'FeatureCollection' && geoJson.features && geoJson.features.length > 0) {\n\t\t// All features must be within the bbox\n\t\tfor (const feature of geoJson.features) {\n\t\t\tif (feature.geometry) {\n\t\t\t\tif (!isGeometryWithinBBox(feature.geometry, minLon, maxLon, minLat, maxLat)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t// Handle GeoJSON Feature\n\tif (geoJson.type === 'Feature' && geoJson.geometry) {\n\t\treturn isGeometryWithinBBox(geoJson.geometry, minLon, maxLon, minLat, maxLat);\n\t}\n\n\t// Handle GeoJSON Point\n\tif (geoJson.type === 'Point' && geoJson.coordinates) {\n\t\tconst [lng, lat] = geoJson.coordinates;\n\t\tif (typeof lng === 'number' && typeof lat === 'number') {\n\t\t\treturn lng >= minLon && lng <= maxLon && lat >= minLat && lat <= maxLat;\n\t\t}\n\t}\n\n\t// Handle GeoJSON Polygon - ALL vertices must be within the bbox\n\tif (geoJson.type === 'Polygon' && geoJson.coordinates && geoJson.coordinates.length > 0) {\n\t\tfor (const ring of geoJson.coordinates) {\n\t\t\tfor (const coord of ring) {\n\t\t\t\tconst lng = coord[0];\n\t\t\t\tconst lat = coord[1];\n\t\t\t\tif (lng < minLon || lng > maxLon || lat < minLat || lat > maxLat) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n/**\n * Extract coordinates from a GeoJSON object for indexing purposes\n * This uses centroid for polygons to get a single point to index\n * @param {Object} geoJson - The GeoJSON object\n * @returns {Object|null} Object with lat and lng, or null if invalid\n */\nfunction extractCoordinatesFromGeoJSON(geoJson) {\n\tif (!geoJson) return null;\n\n\t// Handle GeoJSON FeatureCollection\n\tif (geoJson.type === 'FeatureCollection' && geoJson.features && geoJson.features.length > 0) {\n\t\tconst feature = geoJson.features[0];\n\t\tif (feature.geometry) {\n\t\t\treturn extractCoordinatesFromGeoJSON(feature.geometry);\n\t\t}\n\t}\n\n\t// Handle GeoJSON Feature\n\tif (geoJson.type === 'Feature' && geoJson.geometry) {\n\t\treturn extractCoordinatesFromGeoJSON(geoJson.geometry);\n\t}\n\n\t// Handle GeoJSON Point\n\tif (geoJson.type === 'Point' && geoJson.coordinates) {\n\t\tconst [lng, lat] = geoJson.coordinates;\n\t\tif (typeof lng === 'number' && typeof lat === 'number') {\n\t\t\treturn { lat, lng };\n\t\t}\n\t}\n\n\t// Handle GeoJSON Polygon - use centroid of first coordinate ring\n\tif (geoJson.type === 'Polygon' && geoJson.coordinates && geoJson.coordinates.length > 0) {\n\t\tconst ring = geoJson.coordinates[0];\n\t\tif (ring.length > 0) {\n\t\t\tlet sumLat = 0, sumLng = 0;\n\t\t\tfor (const coord of ring) {\n\t\t\t\tsumLng += coord[0];\n\t\t\t\tsumLat += coord[1];\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tlat: sumLat / ring.length,\n\t\t\t\tlng: sumLng / ring.length\n\t\t\t};\n\t\t}\n\t}\n\n\treturn null;\n}\n\n/**\n * Calculate haversine distance between two points in kilometers\n */\nfunction haversineDistance(lat1, lng1, lat2, lng2) {\n\tconst R = 6371; // Earth's radius in kilometers\n\tconst dLat = (lat2 - lat1) * Math.PI / 180;\n\tconst dLng = (lng2 - lng1) * Math.PI / 180;\n\tconst a = \n\t\tMath.sin(dLat / 2) * Math.sin(dLat / 2) +\n\t\tMath.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n\t\tMath.sin(dLng / 2) * Math.sin(dLng / 2);\n\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\treturn R * c;\n}\n\n/**\n * Check if a point is within a certain distance (in meters) of a reference point\n */\nfunction isNear(geoJson, refLng, refLat, maxDistanceMeters) {\n\tconst coords = extractCoordinatesFromGeoJSON(geoJson);\n\tif (!coords) return false;\n\tconst distanceKm = haversineDistance(coords.lat, coords.lng, refLat, refLng);\n\tconst distanceM = distanceKm * 1000;\n\treturn distanceM <= maxDistanceMeters;\n}\n\n/**\n * Check if geometries intersect (simple implementation)\n */\nfunction geoIntersects(geoJson, queryGeo) {\n\tif (!geoJson || !queryGeo) return false;\n\t\n\t// Get coordinates from query geometry\n\tconst queryCoords = extractCoordinatesFromGeoJSON(queryGeo);\n\tif (!queryCoords) return false;\n\t\n\t// Get coordinates from document geometry\n\tconst docCoords = extractCoordinatesFromGeoJSON(geoJson);\n\tif (!docCoords) return false;\n\t\n\t// For now, simple point-in-polygon check for polygons\n\t// If query is a polygon, check if document point is inside\n\tif (queryGeo.type === 'Polygon' && geoJson.type === 'Point') {\n\t\treturn pointInPolygon(docCoords.lng, docCoords.lat, queryGeo.coordinates[0]);\n\t}\n\t\n\t// If document is a polygon and query is a point, check if point is inside\n\tif (geoJson.type === 'Polygon' && queryGeo.type === 'Point') {\n\t\tconst queryPt = queryGeo.coordinates;\n\t\treturn pointInPolygon(queryPt[0], queryPt[1], geoJson.coordinates[0]);\n\t}\n\t\n\t// For points, check if they're the same or very close\n\tif (geoJson.type === 'Point' && queryGeo.type === 'Point') {\n\t\tconst dist = haversineDistance(docCoords.lat, docCoords.lng, queryCoords.lat, queryCoords.lng);\n\t\treturn dist < 0.001; // Within about 1 meter\n\t}\n\t\n\treturn false;\n}\n\n/**\n * Point-in-polygon test using ray casting algorithm\n */\nfunction pointInPolygon(lng, lat, ring) {\n\tlet inside = false;\n\tfor (let i = 0, j = ring.length - 1; i < ring.length; j = i++) {\n\t\tconst xi = ring[i][0], yi = ring[i][1];\n\t\tconst xj = ring[j][0], yj = ring[j][1];\n\t\tconst intersect = ((yi > lat) !== (yj > lat)) && (lng < (xj - xi) * (lat - yi) / (yj - yi) + xi);\n\t\tif (intersect) inside = !inside;\n\t}\n\treturn inside;\n}\n\n/**\n * $where operator implementation\n * SECURITY NOTE: This uses Function constructor which can execute arbitrary code.\n * This is acceptable for a local/in-memory database but should NOT be used\n * in environments where untrusted user input is processed.\n */\nexport function where(doc, value) {\n\tif (typeof value === 'function') {\n\t\ttry {\n\t\t\treturn value.call(doc);\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t} else if (typeof value === 'string') {\n\t\t// Evaluate the string as a function\n\t\ttry {\n\t\t\tvar fn = new Function('return ' + value);\n\t\t\treturn fn.call(doc);\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn false;\n}\n\n/**\n * Top-level match function\n */\nexport function tlMatches(doc, query) {\n\tvar key = Object.keys(query)[0];\n\tvar value = query[key];\n\tif (key.charAt(0) == \"$\") {\n\t\tif (key == \"$and\") return and(doc, value);\n\t\telse if (key == \"$or\") return or(doc, value);\n\t\telse if (key == \"$not\") return not(doc, value);\n\t\telse if (key == \"$nor\") return nor(doc, value);\n\t\telse if (key == \"$where\") return where(doc, value);\n\t\telse if (key == \"$comment\") return true; // $comment is metadata, doesn't filter\n\t\telse if (key == \"$jsonSchema\") return validateJsonSchema(doc, value); // Top-level schema validation\n\t\telse if (key == \"$text\") {\n\t\t\t// Handle $text as top-level operator\n\t\t\t// Searches across all string fields in the document\n\t\t\tconst searchText = value.$search || value;\n\t\t\treturn textSearchDocument(doc, searchText);\n\t\t}\n\t\telse if (key == \"$expr\") {\n\t\t\t// Handle $expr at top level\n\t\t\ttry {\n\t\t\t\treturn evaluateExpression(value, doc);\n\t\t\t} catch (e) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\telse throw { $err: \"Can't canonicalize query: BadValue unknown top level operator: \" + key, code: 17287 };\n\t} else {\n\t\treturn opMatches(doc, key, value);\n\t}\n}\n\n/**\n * Operator match function\n */\nexport function opMatches(doc, key, value) {\n\t// Get field value using array-aware traversal\n\tvar fieldValue = getFieldValues(doc, key);\n\t\n\tif (typeof (value) == \"string\") return fieldValueMatches(fieldValue, function(v) { return valuesEqual(v, value); });\n\telse if (typeof (value) == \"number\") return fieldValueMatches(fieldValue, function(v) { return valuesEqual(v, value); });\n\telse if (typeof (value) == \"boolean\") return fieldValueMatches(fieldValue, function(v) { return valuesEqual(v, value); });\n\telse if (value instanceof ObjectId) return fieldValueMatches(fieldValue, function(v) { return valuesEqual(v, value); });\n\telse if (typeof (value) == \"object\") {\n\t\tif (value instanceof RegExp) return fieldValue != undefined && fieldValueMatches(fieldValue, function(v) { return v && v.match(value); });\n\t\telse if (isArray(value)) return fieldValue != undefined && fieldValueMatches(fieldValue, function(v) { return v && arrayMatches(v, value); });\n\t\telse {\n\t\t\tvar keys = Object.keys(value);\n\t\t\tif (keys[0].charAt(0) == \"$\") {\n\t\t\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\t\t\tvar operator = Object.keys(value)[i];\n\t\t\t\t\tvar operand = value[operator];\n\t\t\t\t\tif (operator == \"$eq\") {\n\t\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return valuesEqual(v, operand); })) return false;\n\t\t\t\t\t} else if (operator == \"$gt\") {\n\t\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return compareValues(v, operand, '>'); })) return false;\n\t\t\t\t\t} else if (operator == \"$gte\") {\n\t\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return compareValues(v, operand, '>='); })) return false;\n\t\t\t\t\t} else if (operator == \"$lt\") {\n\t\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return compareValues(v, operand, '<'); })) return false;\n\t\t\t\t\t} else if (operator == \"$lte\") {\n\t\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return compareValues(v, operand, '<='); })) return false;\n\t\t\t\t\t} else if (operator == \"$ne\") {\n\t\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return !valuesEqual(v, operand); })) return false;\n\t\t\t\t\t} else if (operator == \"$in\") {\n\t\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return isIn(v, operand); })) return false;\n\t\t\t\t\t} else if (operator == \"$nin\") {\n\t\t\t\t\t\tif (fieldValueMatches(fieldValue, function(v) { return isIn(v, operand); })) return false;\n\t\t\t\t\t} else if (operator == \"$exists\") {\n\t\t\t\t\t\t// For $exists, we need to use getProp which returns undefined if field doesn't exist\n\t\t\t\t\t\t// getFieldValues might return an array which would be truthy\n\t\t\t\t\tvar rawValue = getProp(doc, key);\n\t\t\t\t\tif (operand ? rawValue == undefined : rawValue != undefined) return false;\n\t\t\t\t} else if (operator == \"$type\") {\n\t\t\t\t\t// Support both BSON type codes and aliases\n\t\t\t\t\t// Note: $type checks the field value itself, not array elements\n\t\t\t\t\t// If field doesn't exist (undefined), it can only match type 'undefined' (6)\n\t\t\t\t\tif (fieldValue === undefined) {\n\t\t\t\t\t\tconst expectedTypeCode = typeof operand === 'number' ? operand : TYPE_ALIASES[operand];\n\t\t\t\t\t\tif (expectedTypeCode !== 6) return false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!matchesType(fieldValue, operand)) return false;\n\t\t\t\t\t}\n\t\t\t\t} else if (operator == \"$mod\") {\n\t\t\t\t\tif (operand.length != 2) throw { $err: \"Can't canonicalize query: BadValue malformed mod, not enough elements\", code: 17287 };\n\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return v != undefined && (v % operand[0] == operand[1]); })) return false;\n\t\t\t\t} else if (operator == \"$regex\") {\n\t\t\t\t\t// Support string pattern with optional $options\n\t\t\t\t\tvar pattern = operand;\n\t\t\t\t\tvar flags = value.$options || '';\n\t\t\t\t\tvar regex = (typeof pattern === 'string') ? new RegExp(pattern, flags) : pattern;\n\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return v != undefined && regex.test(v); })) return false;\n\t\t\t\t} else if (operator == \"$options\") {\n\t\t\t\t\t// $options is handled with $regex, skip here\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if (operator == \"$text\") {\n\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return v != undefined && text(v, operand); })) return false;\n\t\t\t\t} else if (operator == \"$expr\") {\n\t\t\t\t\t// Evaluate aggregation expression against the document\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst result = evaluateExpression(operand, doc);\n\t\t\t\t\t\tif (!result) return false;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// If expression evaluation fails, don't match\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else if (operator == \"$geoWithin\") {\n\t\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return v != undefined && geoWithin(v, operand); })) return false;\n\t\t\t\t\t} else if (operator == \"$near\" || operator == \"$nearSphere\") {\n\t\t\t\t\t\t// Handle $near and $nearSphere with distance calculation\n\t\t\t\t\t\tlet coordinates;\n\t\t\t\t\t\tif (operand.$geometry) {\n\t\t\t\t\t\t\tcoordinates = operand.$geometry.coordinates;\n\t\t\t\t\t\t} else if (operand.coordinates) {\n\t\t\t\t\t\t\tcoordinates = operand.coordinates;\n\t\t\t\t\t\t} else if (Array.isArray(operand)) {\n\t\t\t\t\t\t\tcoordinates = operand;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (coordinates && coordinates.length >= 2) {\n\t\t\t\t\t\t\tconst [lng, lat] = coordinates;\n\t\t\t\t\t\t\tconst maxDistanceMeters = operand.$maxDistance || 1000000; // Default to 1000km\n\t\t\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return v != undefined && isNear(v, lng, lat, maxDistanceMeters); })) return false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (operator == \"$geoIntersects\") {\n\t\t\t\t\t\t// Handle $geoIntersects\n\t\t\t\t\t\tconst geometry = operand.$geometry || operand;\n\t\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return v != undefined && geoIntersects(v, geometry); })) return false;\n\t\t\t\t\t} else if (operator == \"$not\") {\n\t\t\t\t\t\tif (opMatches(doc, key, operand)) return false;\n\t\t\t\t\t} else if (operator == \"$all\") {\n\t\t\t\t\t\t// $all requires the field to be an array, use getProp not getFieldValues\n\t\t\t\t\t\tvar arrayFieldValue = getProp(doc, key);\n\t\t\t\t\t\tif (arrayFieldValue == undefined || !isArray(arrayFieldValue)) return false;\n\t\t\t\t\t\tfor (var j = 0; j < operand.length; j++) {\n\t\t\t\t\t\t\tif (!isIn(operand[j], arrayFieldValue)) return false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (operator == \"$elemMatch\") {\n\t\t\t\t\t\t// $elemMatch requires the field to be an array, use getProp not getFieldValues\n\t\t\t\t\t\tvar arrayFieldValue = getProp(doc, key);\n\t\t\t\t\t\tif (arrayFieldValue == undefined || !isArray(arrayFieldValue)) return false;\n\t\t\t\t\t\tvar found = false;\n\t\t\t\t\t\tfor (var j = 0; j < arrayFieldValue.length; j++) {\n\t\t\t\t\t\t\tvar element = arrayFieldValue[j];\n\t\t\t\t\t\t\t// Check if element matches the query\n\t\t\t\t\t\t\tif (typeof element === 'object' && !isArray(element)) {\n\t\t\t\t\t\t\t\t// For objects, use matches\n\t\t\t\t\t\t\t\tif (matches(element, operand)) {\n\t\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// For primitive values, check operators directly\n\t\t\t\t\t\t\t\tvar matchesPrimitive = true;\n\t\t\t\t\t\t\t\tvar opKeys = Object.keys(operand);\n\t\t\t\t\t\t\t\tfor (var k = 0; k < opKeys.length; k++) {\n\t\t\t\t\t\t\t\t\tvar op = opKeys[k];\n\t\t\t\t\t\t\t\t\tvar opValue = operand[op];\n\t\t\t\t\t\t\t\t\tif (op == \"$gte\" && !(element >= opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$gt\" && !(element > opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$lte\" && !(element <= opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$lt\" && !(element < opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$eq\" && !(element == opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$ne\" && !(element != opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$in\" && !isIn(element, opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$nin\" && isIn(element, opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (matchesPrimitive) {\n\t\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!found) return false;\n\t\t\t\t} else if (operator == \"$size\") {\n\t\t\t\t\tvar sizeFieldValue = getProp(doc, key);\n\t\t\t\t\tif (sizeFieldValue == undefined || !isArray(sizeFieldValue)) return false;\n\t\t\t\t\tif (sizeFieldValue.length != operand) return false;\n\t\t\t\t} else if (operator == \"$bitsAllSet\") {\n\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return matchesBitsAllSet(v, operand); })) return false;\n\t\t\t\t} else if (operator == \"$bitsAllClear\") {\n\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return matchesBitsAllClear(v, operand); })) return false;\n\t\t\t\t} else if (operator == \"$bitsAnySet\") {\n\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return matchesBitsAnySet(v, operand); })) return false;\n\t\t\t\t} else if (operator == \"$bitsAnyClear\") {\n\t\t\t\t\tif (!fieldValueMatches(fieldValue, function(v) { return matchesBitsAnyClear(v, operand); })) return false;\n\t\t\t\t} else {\n\t\t\t\t\t\tthrow { $err: \"Can't canonicalize query: BadValue unknown operator: \" + operator, code: 17287 };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn getProp(doc, key) && objectMatches(getProp(doc, key), value);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * $not operator\n */\nexport function not(doc, value) {\n\treturn !tlMatches(doc, value);\n}\n\n/**\n * $and operator\n */\nexport function and(doc, els) {\n\tfor (var i = 0; i < els.length; i++) {\n\t\tif (!tlMatches(doc, els[i])) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\n/**\n * $or operator\n */\nexport function or(doc, els) {\n\tfor (var i = 0; i < els.length; i++) {\n\t\tif (tlMatches(doc, els[i])) return true;\n\t}\n\treturn false;\n}\n\n/**\n * $nor operator\n */\nexport function nor(doc, els) {\n\tfor (var i = 0; i < els.length; i++) {\n\t\tif (tlMatches(doc, els[i])) return false;\n\t}\n\treturn true;\n}\n\n/**\n * Main matches function - query structure: (top level operators ( \"age\" : (operators) ))\n * top, top level query, implicit $and\n */\nexport function matches(doc, query) {\n\treturn and(doc, toArray(query));\n}\n\n/**\n * Enhanced matching function that also tracks which array index matched for positional operator ($)\n * Returns an object with:\n *   - matched: boolean indicating if the query matched\n *   - arrayFilters: object mapping field paths to the first matched array index\n * \n * Example: if query is { \"grades\": { $gte: 85 } } and doc is { grades: [80, 90, 85] }\n * Returns: { matched: true, arrayFilters: { \"grades\": 1 } } (index 1 is 90, first to match)\n */\nexport function matchWithArrayIndices(doc, query) {\n\tconst arrayFilters = {};\n\tconst matched = andWithTracking(doc, toArray(query), arrayFilters);\n\treturn { matched, arrayFilters };\n}\n\n/**\n * Helper to track array indices during AND matching\n */\nfunction andWithTracking(doc, els, arrayFilters) {\n\tfor (var i = 0; i < els.length; i++) {\n\t\tif (!tlMatchesWithTracking(doc, els[i], arrayFilters)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\n/**\n * Top level match with tracking\n */\nfunction tlMatchesWithTracking(doc, query, arrayFilters) {\n\tvar key = Object.keys(query)[0];\n\tvar value = query[key];\n\tif (key.charAt(0) == \"$\") {\n\t\tif (key == \"$and\") return andWithTracking(doc, value, arrayFilters);\n\t\telse if (key == \"$or\") return orWithTracking(doc, value, arrayFilters);\n\t\telse if (key == \"$not\") {\n\t\t\t// For $not, we don't track positions as it's a negation\n\t\t\treturn !tlMatches(doc, value);\n\t\t}\n\t\telse if (key == \"$nor\") return norWithTracking(doc, value, arrayFilters);\n\t\telse if (key == \"$where\") return where(doc, value);\n\t\telse if (key == \"$comment\") return true;\n\t\telse if (key == \"$jsonSchema\") return validateJsonSchema(doc, value);\n\t\telse if (key == \"$expr\") {\n\t\t\ttry {\n\t\t\t\treturn evaluateExpression(value, doc);\n\t\t\t} catch (e) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\telse throw { $err: \"Can't canonicalize query: BadValue unknown top level operator: \" + key, code: 17287 };\n\t} else {\n\t\treturn opMatchesWithTracking(doc, key, value, arrayFilters);\n\t}\n}\n\n/**\n * OR operator with tracking - track positions from the first matching clause\n */\nfunction orWithTracking(doc, els, arrayFilters) {\n\tfor (var i = 0; i < els.length; i++) {\n\t\tif (tlMatchesWithTracking(doc, els[i], arrayFilters)) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\n/**\n * NOR operator with tracking\n */\nfunction norWithTracking(doc, els, arrayFilters) {\n\tfor (var i = 0; i < els.length; i++) {\n\t\tif (tlMatchesWithTracking(doc, els[i], arrayFilters)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\n/**\n * Operator match with array index tracking\n */\nfunction opMatchesWithTracking(doc, key, value, arrayFilters) {\n\t// Get the base field (before any dots)\n\tconst baseField = key.split('.')[0];\n\tconst fieldValue = getFieldValues(doc, key);\n\t\n\t// Helper to track which index matched\n\tconst trackMatchingIndex = (fieldValue, checkFn) => {\n\t\tif (fieldValue === undefined) return false;\n\t\tif (fieldValue === null) return checkFn(fieldValue);\n\t\t\n\t\t// If fieldValue is an array from array traversal\n\t\tif (isArray(fieldValue)) {\n\t\t\t// Check if the base field itself is an array in the document\n\t\t\tconst baseValue = getProp(doc, baseField);\n\t\t\tif (isArray(baseValue)) {\n\t\t\t\t// Find first matching index\n\t\t\t\tfor (var i = 0; i < fieldValue.length; i++) {\n\t\t\t\t\tif (checkFn(fieldValue[i])) {\n\t\t\t\t\t\t// Track this as the matched index for this field\n\t\t\t\t\t\tarrayFilters[key] = i;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Otherwise use regular matching\n\t\treturn fieldValueMatches(fieldValue, checkFn);\n\t};\n\t\n\t// Now perform the actual matching with tracking\n\tif (typeof (value) == \"string\") return trackMatchingIndex(fieldValue, function(v) { return valuesEqual(v, value); });\n\telse if (typeof (value) == \"number\") return trackMatchingIndex(fieldValue, function(v) { return valuesEqual(v, value); });\n\telse if (typeof (value) == \"boolean\") return trackMatchingIndex(fieldValue, function(v) { return valuesEqual(v, value); });\n\telse if (value instanceof ObjectId) return trackMatchingIndex(fieldValue, function(v) { return valuesEqual(v, value); });\n\telse if (typeof (value) == \"object\") {\n\t\tif (value instanceof RegExp) return fieldValue != undefined && trackMatchingIndex(fieldValue, function(v) { return v && v.match(value); });\n\t\telse if (isArray(value)) return fieldValue != undefined && trackMatchingIndex(fieldValue, function(v) { return v && arrayMatches(v, value); });\n\t\telse {\n\t\t\tvar keys = Object.keys(value);\n\t\t\tif (keys[0].charAt(0) == \"$\") {\n\t\t\t\t// Handle operators\n\t\t\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\t\t\tvar operator = keys[i];\n\t\t\t\t\tvar operand = value[operator];\n\t\t\t\t\tif (operator == \"$eq\") {\n\t\t\t\t\t\tif (!trackMatchingIndex(fieldValue, function(v) { return valuesEqual(v, operand); })) return false;\n\t\t\t\t\t} else if (operator == \"$gt\") {\n\t\t\t\t\t\tif (!trackMatchingIndex(fieldValue, function(v) { return compareValues(v, operand, '>'); })) return false;\n\t\t\t\t\t} else if (operator == \"$gte\") {\n\t\t\t\t\t\tif (!trackMatchingIndex(fieldValue, function(v) { return compareValues(v, operand, '>='); })) return false;\n\t\t\t\t\t} else if (operator == \"$lt\") {\n\t\t\t\t\t\tif (!trackMatchingIndex(fieldValue, function(v) { return compareValues(v, operand, '<'); })) return false;\n\t\t\t\t\t} else if (operator == \"$lte\") {\n\t\t\t\t\t\tif (!trackMatchingIndex(fieldValue, function(v) { return compareValues(v, operand, '<='); })) return false;\n\t\t\t\t\t} else if (operator == \"$ne\") {\n\t\t\t\t\t\tif (!trackMatchingIndex(fieldValue, function(v) { return !valuesEqual(v, operand); })) return false;\n\t\t\t\t\t} else if (operator == \"$in\") {\n\t\t\t\t\t\tif (!trackMatchingIndex(fieldValue, function(v) { return isIn(v, operand); })) return false;\n\t\t\t\t\t} else if (operator == \"$nin\") {\n\t\t\t\t\t\tif (trackMatchingIndex(fieldValue, function(v) { return isIn(v, operand); })) return false;\n\t\t\t\t\t} else if (operator == \"$elemMatch\") {\n\t\t\t\t\t\t// Special handling for $elemMatch\n\t\t\t\t\t\tvar arrayFieldValue = getProp(doc, key);\n\t\t\t\t\t\tif (arrayFieldValue == undefined || !isArray(arrayFieldValue)) return false;\n\t\t\t\t\t\tfor (var j = 0; j < arrayFieldValue.length; j++) {\n\t\t\t\t\t\t\tvar element = arrayFieldValue[j];\n\t\t\t\t\t\t\t// Check if element matches the query\n\t\t\t\t\t\t\tif (typeof element === 'object' && !isArray(element)) {\n\t\t\t\t\t\t\t\t// For objects, use matches\n\t\t\t\t\t\t\t\tif (matches(element, operand)) {\n\t\t\t\t\t\t\t\t\tarrayFilters[key] = j;\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// For primitive values, check operators directly\n\t\t\t\t\t\t\t\tvar matchesPrimitive = true;\n\t\t\t\t\t\t\t\tvar opKeys = Object.keys(operand);\n\t\t\t\t\t\t\t\tfor (var k = 0; k < opKeys.length; k++) {\n\t\t\t\t\t\t\t\t\tvar op = opKeys[k];\n\t\t\t\t\t\t\t\t\tvar opValue = operand[op];\n\t\t\t\t\t\t\t\t\tif (op == \"$gte\" && !(element >= opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$gt\" && !(element > opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$lte\" && !(element <= opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$lt\" && !(element < opValue)) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$eq\" && element != opValue) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t\telse if (op == \"$ne\" && element == opValue) matchesPrimitive = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (matchesPrimitive) {\n\t\t\t\t\t\t\t\t\tarrayFilters[key] = j;\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// For other operators, use standard matching\n\t\t\t\t\t\tif (!opMatches(doc, key, value)) return false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\t// Object equality\n\t\t\t\treturn fieldValue != undefined && trackMatchingIndex(fieldValue, function(v) { return objectMatches(v, value); });\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n}\n","import { EventEmitter } from 'events';\nimport { matches } from './queryMatcher.js';\n\n/**\n * ChangeStream watches for changes in collections and emits change events\n * Compatible with MongoDB Change Streams API\n */\nexport class ChangeStream extends EventEmitter {\n\tconstructor(target, pipeline = [], options = {}) {\n\t\tsuper();\n\t\t\n\t\tthis.target = target; // MongoClient, DB, or Collection\n\t\tthis.pipeline = pipeline;\n\t\tthis.options = options;\n\t\tthis.closed = false;\n\t\tthis._listeners = new Map();\n\t\tthis._changeCounter = 0;\n\t\t\n\t\t// Start watching immediately (synchronously)\n\t\tthis._startWatching();\n\t}\n\n\t/**\n\t * Start watching for changes\n\t * @private\n\t */\n\t_startWatching() {\n\t\tif (this.closed) return;\n\t\t\n\t\tconst collections = this._getCollectionsToWatch();\n\t\t\n\t\tfor (const collection of collections) {\n\t\t\tthis._watchCollection(collection);\n\t\t}\n\t\t\n\t\t// For Server watching, intercept _getDB calls\n\t\tif (this.target.constructor.name === 'Server') {\n\t\t\tthis._interceptServerDBCreation();\n\t\t}\n\t\t\n\t\t// For DB watching, we also need to intercept new collection creation\n\t\tif (this.target.constructor.name === 'DB') {\n\t\t\tthis._interceptDBCollectionCreation();\n\t\t}\n\t\t\n\t\t// For MongoClient watching, intercept db() calls\n\t\tif (this.target.constructor.name === 'MongoClient') {\n\t\t\tthis._interceptClientDBCreation();\n\t\t}\n\t}\n\n\t/**\n\t * Get collections to watch based on target type\n\t * @private\n\t */\n\t_getCollectionsToWatch() {\n\t\tconst collections = [];\n\t\t\n\t\t// Server - watch all collections in all databases\n\t\tif (this.target.constructor.name === 'Server') {\n\t\t\t// Watch all existing databases\n\t\t\tfor (const [dbName, db] of this.target.databases) {\n\t\t\t\tconst collectionNames = db.getCollectionNames();\n\t\t\t\tfor (const name of collectionNames) {\n\t\t\t\t\tconst collection = db[name];\n\t\t\t\t\tif (collection && collection.isCollection) {\n\t\t\t\t\t\tcollections.push(collection);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn collections;\n\t\t}\n\t\t\n\t\t// MongoClient - watch all collections in all databases\n\t\tif (this.target.constructor.name === 'MongoClient') {\n\t\t\t// Store reference to monitor for new databases/collections\n\t\t\tthis._monitorClient();\n\t\t\treturn collections;\n\t\t}\n\t\t\n\t\t// DB - watch all collections in the database\n\t\tif (this.target.constructor.name === 'DB') {\n\t\t\tconst collectionNames = this.target.getCollectionNames();\n\t\t\tfor (const name of collectionNames) {\n\t\t\t\tconst collection = this.target[name];\n\t\t\t\tif (collection && collection.isCollection) {\n\t\t\t\t\tcollections.push(collection);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Also monitor for new collections\n\t\t\tthis._monitorDB();\n\t\t}\n\t\t\n\t\t// Collection - watch specific collection\n\t\tif (this.target.isCollection) {\n\t\t\tcollections.push(this.target);\n\t\t}\n\t\t\n\t\treturn collections;\n\t}\n\n\t/**\n\t * Watch a specific collection for changes\n\t * @private\n\t */\n\t_watchCollection(collection) {\n\t\tif (this.closed) return;\n\t\tif (!collection) return; // Skip null/undefined\n\t\tif (typeof collection.on !== 'function') return; // Skip non-EventEmitters\n\t\tif (!collection.isCollection) return; // Skip non-collections\n\t\tif (this._listeners.has(collection)) return; // Already watching\n\t\t\n\t\tconst handlers = {\n\t\t\tinsert: (doc) => this._emitChange('insert', collection, doc),\n\t\t\tupdate: (doc, updateDescription) => this._emitChange('update', collection, doc, updateDescription),\n\t\t\treplace: (doc) => this._emitChange('replace', collection, doc),\n\t\t\tdelete: (doc) => this._emitChange('delete', collection, doc)\n\t\t};\n\t\t\n\t\t// Store handlers for cleanup\n\t\tthis._listeners.set(collection, handlers);\n\t\t\n\t\t// Listen to collection change events\n\t\tcollection.on('insert', handlers.insert);\n\t\tcollection.on('update', handlers.update);\n\t\tcollection.on('replace', handlers.replace);\n\t\tcollection.on('delete', handlers.delete);\n\t}\n\n\t/**\n\t * Emit a change event\n\t * @private\n\t */\n\t_emitChange(operationType, collection, doc, updateDescription = null) {\n\t\tif (this.closed) return;\n\t\t\n\t\tconst changeEvent = this._createChangeEvent(\n\t\t\toperationType,\n\t\t\tcollection,\n\t\t\tdoc,\n\t\t\tupdateDescription\n\t\t);\n\t\t\n\t\t// Apply pipeline filters if any\n\t\tif (!this._matchesPipeline(changeEvent)) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis.emit('change', changeEvent);\n\t}\n\n\t/**\n\t * Create a MongoDB-compatible change event document\n\t * @private\n\t */\n\t_createChangeEvent(operationType, collection, doc, updateDescription) {\n\t\tconst event = {\n\t\t\t_id: {\n\t\t\t\t_data: Buffer.from(String(++this._changeCounter)).toString('base64')\n\t\t\t},\n\t\t\toperationType,\n\t\t\tclusterTime: new Date(),\n\t\t\tns: {\n\t\t\t\tdb: collection.db.dbName,\n\t\t\t\tcoll: collection.name\n\t\t\t},\n\t\t\tdocumentKey: {\n\t\t\t\t_id: doc._id\n\t\t\t}\n\t\t};\n\t\t\n\t\tswitch (operationType) {\n\t\t\tcase 'insert':\n\t\t\t\tevent.fullDocument = doc;\n\t\t\t\tbreak;\n\t\t\t\t\n\t\t\tcase 'update':\n\t\t\t\tevent.updateDescription = updateDescription || {\n\t\t\t\t\tupdatedFields: {},\n\t\t\t\t\tremovedFields: [],\n\t\t\t\t\ttruncatedArrays: []\n\t\t\t\t};\n\t\t\t\t// Include full document if requested\n\t\t\t\tif (this.options.fullDocument === 'updateLookup') {\n\t\t\t\t\tevent.fullDocument = doc;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t\t\n\t\t\tcase 'replace':\n\t\t\t\tevent.fullDocument = doc;\n\t\t\t\tbreak;\n\t\t\t\t\n\t\t\tcase 'delete':\n\t\t\t\t// For delete, doc contains the deleted document's _id\n\t\t\t\tbreak;\n\t\t}\n\t\t\n\t\treturn event;\n\t}\n\n\t/**\n\t * Check if change event matches pipeline filters\n\t * @private\n\t */\n\t_matchesPipeline(changeEvent) {\n\t\tif (!this.pipeline || this.pipeline.length === 0) {\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\t// Process pipeline stages\n\t\tfor (const stage of this.pipeline) {\n\t\t\tif (stage.$match) {\n\t\t\t\t// Use the same query matcher as find()\n\t\t\t\t// Note: matches(document, query) - document first, query second\n\t\t\t\tif (!matches(changeEvent, stage.$match)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn true;\n\t}\n\n\t/**\n\t * Get nested value from object using dot notation\n\t * @private\n\t */\n\t_getNestedValue(obj, path) {\n\t\treturn path.split('.').reduce((current, part) => current?.[part], obj);\n\t}\n\n\t/**\n\t * Monitor client for new databases/collections (simplified)\n\t * @private\n\t */\n\t_monitorClient() {\n\t\t// Handled by _interceptClientDBCreation\n\t}\n\n\t/**\n\t * Intercept DB creation on a MongoClient\n\t * @private\n\t */\n\t_interceptClientDBCreation() {\n\t\tconst client = this.target;\n\t\tconst originalDb = client.db.bind(client);\n\t\tconst self = this;\n\t\t\n\t\t// Track databases we're watching\n\t\tthis._watchedDBs = new Map();\n\t\t\n\t\t// Override db() method to watch new databases\n\t\tclient.db = function(name, opts) {\n\t\t\tconst database = originalDb(name, opts);\n\t\t\tconst dbName = database.dbName;\n\t\t\t\n\t\t\t// Only set up watch once per database\n\t\t\tif (!self._watchedDBs.has(dbName)) {\n\t\t\t\tself._watchedDBs.set(dbName, database);\n\t\t\t\t\n\t\t\t\t// Watch existing collections in this database\n\t\t\t\tconst collectionNames = database.getCollectionNames();\n\t\t\t\tfor (const colName of collectionNames) {\n\t\t\t\t\tconst col = database[colName];\n\t\t\t\t\tif (col && col.isCollection && !self._listeners.has(col)) {\n\t\t\t\t\t\tself._watchCollection(col);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Intercept new collection creation on this database\n\t\t\t\tself._interceptDBCollectionCreationForClient(database);\n\t\t\t}\n\t\t\t\n\t\t\treturn database;\n\t\t};\n\t\t\n\t\t// Store original for cleanup\n\t\tthis._originalClientMethods = { db: originalDb };\n\t}\n\n\t/**\n\t * Intercept DB creation on a Server\n\t * @private\n\t */\n\t_interceptServerDBCreation() {\n\t\tconst server = this.target;\n\t\tconst originalGetDB = server._getDB.bind(server);\n\t\tconst self = this;\n\t\t\n\t\t// Track databases we're watching\n\t\tthis._watchedDBs = new Map();\n\t\t\n\t\t// Override _getDB() method to watch new databases\n\t\tserver._getDB = function(dbName) {\n\t\t\tconst db = originalGetDB(dbName);\n\t\t\t\n\t\t\t// Only set up watch once per database\n\t\t\tif (!self._watchedDBs.has(dbName)) {\n\t\t\t\tself._watchedDBs.set(dbName, db);\n\t\t\t\t\n\t\t\t\t// Watch existing collections in this database\n\t\t\t\tconst collectionNames = db.getCollectionNames();\n\t\t\t\tfor (const colName of collectionNames) {\n\t\t\t\t\tconst col = db[colName];\n\t\t\t\t\tif (col && col.isCollection && !self._listeners.has(col)) {\n\t\t\t\t\t\tself._watchCollection(col);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Intercept new collection creation on this database\n\t\t\t\tself._interceptDBCollectionCreationForServer(db);\n\t\t\t}\n\t\t\t\n\t\t\treturn db;\n\t\t};\n\t\t\n\t\t// Store original for cleanup\n\t\tthis._originalServerMethods = { _getDB: originalGetDB };\n\t}\n\n\t/**\n\t * Intercept collection creation for a database in server watch mode\n\t * @private\n\t */\n\t_interceptDBCollectionCreationForServer(db) {\n\t\tconst originalCollection = db.collection.bind(db);\n\t\tconst originalCreateCollection = db.createCollection.bind(db);\n\t\tconst self = this;\n\t\t\n\t\tdb.collection = function(name) {\n\t\t\tconst col = originalCollection(name);\n\t\t\tif (col && col.isCollection && !self._listeners.has(col)) {\n\t\t\t\tself._watchCollection(col);\n\t\t\t}\n\t\t\treturn col;\n\t\t};\n\t\t\n\t\tdb.createCollection = function(name) {\n\t\t\toriginalCreateCollection(name);\n\t\t\tconst col = db[name];\n\t\t\tif (col && col.isCollection && !self._listeners.has(col)) {\n\t\t\t\tself._watchCollection(col);\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Intercept collection creation for a database in client watch mode\n\t * @private\n\t */\n\t_interceptDBCollectionCreationForClient(db) {\n\t\tconst originalCollection = db.collection.bind(db);\n\t\tconst originalCreateCollection = db.createCollection.bind(db);\n\t\tconst self = this;\n\t\t\n\t\tdb.collection = function(name) {\n\t\t\tconst col = originalCollection(name);\n\t\t\tif (col && col.isCollection && !self._listeners.has(col)) {\n\t\t\t\tself._watchCollection(col);\n\t\t\t}\n\t\t\treturn col;\n\t\t};\n\t\t\n\t\tdb.createCollection = function(name) {\n\t\t\toriginalCreateCollection(name);\n\t\t\tconst col = db[name];\n\t\t\tif (col && col.isCollection && !self._listeners.has(col)) {\n\t\t\t\tself._watchCollection(col);\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Monitor database for new collections\n\t * @private\n\t */\n\t_monitorDB() {\n\t\t// Handled by _interceptDBCollectionCreation\n\t}\n\n\t/**\n\t * Intercept new collection creation on a DB\n\t * @private\n\t */\n\t_interceptDBCollectionCreation() {\n\t\tconst db = this.target;\n\t\tconst originalCollection = db.collection.bind(db);\n\t\tconst originalCreateCollection = db.createCollection.bind(db);\n\t\tconst self = this;\n\t\t\n\t\t// Override collection() method to watch new collections\n\t\tdb.collection = function(name) {\n\t\t\tconst col = originalCollection(name);\n\t\t\t// Watch this collection if we haven't already\n\t\t\tif (col && col.isCollection && !self._listeners.has(col)) {\n\t\t\t\tself._watchCollection(col);\n\t\t\t}\n\t\t\treturn col;\n\t\t};\n\t\t\n\t\t// Override createCollection() method\n\t\tdb.createCollection = function(name) {\n\t\t\toriginalCreateCollection(name);\n\t\t\tconst col = db[name];\n\t\t\tif (col && col.isCollection && !self._listeners.has(col)) {\n\t\t\t\tself._watchCollection(col);\n\t\t\t}\n\t\t};\n\t\t\n\t\t// Store originals for cleanup\n\t\tthis._originalDBMethods = { collection: originalCollection, createCollection: originalCreateCollection };\n\t}\n\n\t/**\n\t * Close the change stream\n\t */\n\tclose() {\n\t\tif (this.closed) return;\n\t\t\n\t\tthis.closed = true;\n\t\t\n\t\t// Remove all collection listeners\n\t\tfor (const [collection, handlers] of this._listeners) {\n\t\t\tcollection.off('insert', handlers.insert);\n\t\t\tcollection.off('update', handlers.update);\n\t\t\tcollection.off('replace', handlers.replace);\n\t\t\tcollection.off('delete', handlers.delete);\n\t\t}\n\t\t\n\t\tthis._listeners.clear();\n\t\t\n\t\t// Restore original Server methods if we intercepted them\n\t\tif (this._originalServerMethods && this.target.constructor.name === 'Server') {\n\t\t\tthis.target._getDB = this._originalServerMethods._getDB;\n\t\t}\n\t\t\n\t\t// Restore original DB methods if we intercepted them\n\t\tif (this._originalDBMethods && this.target.constructor.name === 'DB') {\n\t\t\tthis.target.collection = this._originalDBMethods.collection;\n\t\t\tthis.target.createCollection = this._originalDBMethods.createCollection;\n\t\t}\n\t\t\n\t\t// Restore original MongoClient methods if we intercepted them\n\t\tif (this._originalClientMethods && this.target.constructor.name === 'MongoClient') {\n\t\t\tthis.target.db = this._originalClientMethods.db;\n\t\t}\n\t\t\n\t\t// Emit close before removing all listeners\n\t\tthis.emit('close');\n\t\tthis.removeAllListeners();\n\t}\n\n\t/**\n\t * Check if the stream is closed\n\t */\n\tget isClosed() {\n\t\treturn this.closed;\n\t}\n\n\t/**\n\t * Async iterator support for for-await-of loops\n\t */\n\tasync *[Symbol.asyncIterator]() {\n\t\tconst queue = [];\n\t\tlet resolveNext = null;\n\t\tlet streamClosed = false;\n\t\t\n\t\tconst onChange = (change) => {\n\t\t\tif (resolveNext) {\n\t\t\t\tresolveNext({ value: change, done: false });\n\t\t\t\tresolveNext = null;\n\t\t\t} else {\n\t\t\t\tqueue.push(change);\n\t\t\t}\n\t\t};\n\t\t\n\t\tconst onClose = () => {\n\t\t\tstreamClosed = true;\n\t\t\tif (resolveNext) {\n\t\t\t\tresolveNext({ done: true });\n\t\t\t\tresolveNext = null;\n\t\t\t}\n\t\t};\n\t\t\n\t\tconst onError = (error) => {\n\t\t\tif (resolveNext) {\n\t\t\t\tresolveNext(Promise.reject(error));\n\t\t\t\tresolveNext = null;\n\t\t\t}\n\t\t};\n\t\t\n\t\tthis.on('change', onChange);\n\t\tthis.on('close', onClose);\n\t\tthis.on('error', onError);\n\t\t\n\t\ttry {\n\t\t\twhile (!streamClosed) {\n\t\t\t\tif (queue.length > 0) {\n\t\t\t\t\tyield queue.shift();\n\t\t\t\t} else {\n\t\t\t\t\tconst next = await new Promise((resolve) => {\n\t\t\t\t\t\tresolveNext = resolve;\n\t\t\t\t\t\t// Check if stream was closed while waiting\n\t\t\t\t\t\tif (streamClosed) {\n\t\t\t\t\t\t\tresolve({ done: true });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif (next.done) break;\n\t\t\t\t\tyield next.value;\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tthis.off('change', onChange);\n\t\t\tthis.off('close', onClose);\n\t\t\tthis.off('error', onError);\n\t\t}\n\t}\n\n\t/**\n\t * Get next change (for compatibility)\n\t */\n\tasync next() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst onChange = (change) => {\n\t\t\t\tcleanup();\n\t\t\t\tresolve(change);\n\t\t\t};\n\t\t\t\n\t\t\tconst onClose = () => {\n\t\t\t\tcleanup();\n\t\t\t\tresolve(null);\n\t\t\t};\n\t\t\t\n\t\t\tconst onError = (error) => {\n\t\t\t\tcleanup();\n\t\t\t\treject(error);\n\t\t\t};\n\t\t\t\n\t\t\tconst cleanup = () => {\n\t\t\t\tthis.off('change', onChange);\n\t\t\t\tthis.off('close', onClose);\n\t\t\t\tthis.off('error', onError);\n\t\t\t};\n\t\t\t\n\t\t\tif (this.closed) {\n\t\t\t\tresolve(null);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tthis.once('change', onChange);\n\t\t\tthis.once('close', onClose);\n\t\t\tthis.once('error', onError);\n\t\t});\n\t}\n}\n","import { EventEmitter } from 'events';\nimport { ObjectId } from 'bjson';\n\n/**\n * Serialize ObjectId and Date instances for worker communication\n */\nfunction serializePayload(obj) {\n  if (obj === null || obj === undefined) return obj;\n  if (typeof obj === 'function') {\n    return { __function: obj.toString() };\n  }\n  if (obj instanceof ObjectId) {\n    return { __objectId: obj.toString() };\n  }\n  if (obj instanceof Date) {\n    return { __date: obj.toISOString() };\n  }\n  if (Array.isArray(obj)) {\n    return obj.map(serializePayload);\n  }\n  if (typeof obj === 'object') {\n    const result = {};\n    for (const [key, value] of Object.entries(obj)) {\n      result[key] = serializePayload(value);\n    }\n    return result;\n  }\n  return obj;\n}\n\n/**\n * Deserialize ObjectId and Date instances from worker communication\n */\nfunction deserializePayload(obj) {\n  if (obj === null || obj === undefined) return obj;\n  if (typeof obj === 'object' && obj.__function) {\n    return typeof obj.__function === 'string' ? `(${obj.__function}).call(this)` : undefined;\n  }\n  if (typeof obj === 'object' && obj.__objectId) {\n    return new ObjectId(obj.__objectId);\n  }\n  if (typeof obj === 'object' && obj.__date) {\n    return new Date(obj.__date);\n  }\n  if (Array.isArray(obj)) {\n    return obj.map(deserializePayload);\n  }\n  if (typeof obj === 'object') {\n    const result = {};\n    for (const [key, value] of Object.entries(obj)) {\n      result[key] = deserializePayload(value);\n    }\n    return result;\n  }\n  return obj;\n}\n\n/**\n * WorkerBridge provides a unified message-based transport between the main thread\n * and a worker (Web Worker in browsers, Worker Thread in Node.js).\n */\nexport class WorkerBridge extends EventEmitter {\n  constructor(worker) {\n    super();\n    this.worker = worker;\n    this._nextId = 1;\n    this._pending = new Map();\n    this._terminating = false;\n\n    this._handleMessage = this._handleMessage.bind(this);\n    this._handleError = this._handleError.bind(this);\n\n    this._attach();\n  }\n\n  static async create(options = {}) {\n    // Check if running in browser\n    if (typeof window !== 'undefined' && typeof globalThis.Worker !== 'undefined') {\n      return new BrowserWorkerBridge(options);\n    }\n\n    // Node.js environment - dynamically import to avoid browser compatibility issues\n    const { Worker: NodeWorker } = await import('worker_threads');\n    const { fileURLToPath } = await import('url');\n    \n    // Default to built worker artifact; use proper absolute path for Node worker\n    let workerPath = options.workerPath;\n    if (!workerPath) {\n      const buildUrl = new URL('../../build/micro-mongo-server-worker.js', import.meta.url);\n      workerPath = fileURLToPath(buildUrl);\n    }\n    const worker = new NodeWorker(workerPath, {\n      workerData: options.workerData,\n    });\n    return new NodeWorkerBridge(worker);\n  }\n\n  /**\n   * Send a request to the worker and await the response.\n   * @param {Object} payload - Arbitrary payload for the worker.\n   * @param {Object} [opts]\n   * @param {number} [opts.timeout] - Optional timeout in ms.\n   */\n  sendRequest(payload, opts = {}) {\n    const id = this._nextId++;\n    const serializedPayload = serializePayload(payload);\n    const message = { type: 'request', id, payload: serializedPayload };\n\n    return new Promise((resolve, reject) => {\n      let timeoutHandle;\n      if (opts.timeout) {\n        timeoutHandle = setTimeout(() => {\n          this._pending.delete(id);\n          reject(new Error(`Worker request timed out after ${opts.timeout}ms`));\n        }, opts.timeout);\n      }\n\n      this._pending.set(id, { resolve, reject, timeoutHandle });\n      this._post(message);\n    });\n  }\n\n  /**\n   * Gracefully close the worker without rejecting pending requests.\n   * Any pending requests will simply be abandoned without error messages.\n   */\n  async terminate() {\n    this._terminating = true;\n    // Clear pending requests without rejecting them to avoid unhandled rejection warnings\n    for (const [id, pending] of this._pending.entries()) {\n      clearTimeout(pending.timeoutHandle);\n    }\n    this._pending.clear();\n    await this._terminateImpl();\n  }\n\n  _handleMessage(event) {\n    const data = event?.data ?? event; // Browser sends { data }, Node sends the raw object\n    if (!data) return;\n\n    if (data.type === 'response') {\n      const pending = this._pending.get(data.id);\n      if (!pending) return;\n      this._pending.delete(data.id);\n      clearTimeout(pending.timeoutHandle);\n      if (data.success) {\n        const deserializedResult = deserializePayload(data.result);\n        pending.resolve(deserializedResult);\n      } else {\n        const error = new Error(data.error?.message || 'Worker error');\n        if (data.error?.name) error.name = data.error.name;\n        if (data.error?.stack) error.stack = data.error.stack;\n        if (data.error?.code) error.code = data.error.code;\n        if (data.error?.$err) error.$err = data.error.$err;\n        pending.reject(error);\n      }\n      return;\n    }\n\n    // Forward events (e.g., change streams)\n    if (data.type === 'event') {\n      const deserializedPayload = deserializePayload(data.payload);\n      this.emit('event', data.event, deserializedPayload);\n    }\n  }\n\n  _handleError(error) {\n    // Don't emit errors if we're intentionally terminating\n    if (this._terminating) return;\n    \n    // Reject all pending requests on fatal worker error\n    for (const [id, pending] of this._pending.entries()) {\n      clearTimeout(pending.timeoutHandle);\n      pending.reject(error);\n    }\n    this._pending.clear();\n    this.emit('error', error);\n  }\n\n  // Abstract hooks per environment\n  _attach() { throw new Error('Not implemented'); }\n  _post() { throw new Error('Not implemented'); }\n  _terminateImpl() { throw new Error('Not implemented'); }\n}\n\nclass BrowserWorkerBridge extends WorkerBridge {\n  constructor(options = {}) {\n    // Use globalThis.Worker to explicitly reference the Web Worker API\n    const WebWorkerCtor = globalThis.Worker;\n    if (!WebWorkerCtor) {\n      throw new Error('Worker API is not available in this environment');\n    }\n    \n    // Default to built worker artifact; allow override for custom hosting\n    // Use absolute path from server root for consistent resolution in dev and prod\n    const workerUrl = options.workerUrl || '/build/micro-mongo-server-worker.js';\n    const worker = new WebWorkerCtor(workerUrl, { type: 'module' });\n    super(worker);\n  }\n\n  _attach() {\n    this.worker.onmessage = this._handleMessage;\n    this.worker.onerror = this._handleError;\n  }\n\n  _post(message) {\n    this.worker.postMessage(message);\n  }\n\n  _terminateImpl() {\n    this.worker.terminate();\n  }\n}\n\nclass NodeWorkerBridge extends WorkerBridge {\n  constructor(worker) {\n    super(worker);\n  }\n\n  _attach() {\n    this.worker.on('message', this._handleMessage);\n    this.worker.on('error', this._handleError);\n    this.worker.on('exit', (code) => {\n      if (code !== 0 && !this._terminating) {\n        this._handleError(new Error(`Worker stopped with exit code ${code}`));\n      }\n    });\n  }\n\n  _post(message) {\n    this.worker.postMessage(message);\n  }\n\n  _terminateImpl() {\n    return this.worker.terminate();\n  }\n}\n"],"names":["ReflectApply","ReflectOwnKeys","NumberIsNaN","eventsModule","events","once","EventEmitter","valuesEqual","text"],"mappings":";;;;;AAuBA,MAAI,IAAI,OAAO,YAAY,WAAW,UAAU;AAChD,MAAI,eAAe,KAAK,OAAO,EAAE,UAAU,aACvC,EAAE,QACF,SAASA,cAAa,QAAQ,UAAU,MAAM;AAC9C,WAAO,SAAS,UAAU,MAAM,KAAK,QAAQ,UAAU,IAAI;AAAA,EAC/D;AAEA,MAAI;AACJ,MAAI,KAAK,OAAO,EAAE,YAAY,YAAY;AACxC,qBAAiB,EAAE;AAAA,EACrB,WAAW,OAAO,uBAAuB;AACvC,qBAAiB,SAASC,gBAAe,QAAQ;AAC/C,aAAO,OAAO,oBAAoB,MAAM,EACrC,OAAO,OAAO,sBAAsB,MAAM,CAAC;AAAA,IAClD;AAAA,EACA,OAAO;AACL,qBAAiB,SAASA,gBAAe,QAAQ;AAC/C,aAAO,OAAO,oBAAoB,MAAM;AAAA,IAC5C;AAAA,EACA;AAEA,WAAS,mBAAmB,SAAS;AACnC,QAAI,WAAW,QAAQ,KAAM,SAAQ,KAAK,OAAO;AAAA,EACnD;AAEA,MAAI,cAAc,OAAO,SAAS,SAASC,aAAY,OAAO;AAC5D,WAAO,UAAU;AAAA,EACnB;AAEA,WAAS,eAAe;AACtB,iBAAa,KAAK,KAAK,IAAI;AAAA,EAC7B;AACAC,SAAA,UAAiB;AACjBA,SAAA,QAAA,OAAsB;AAGtB,eAAa,eAAe;AAE5B,eAAa,UAAU,UAAU;AACjC,eAAa,UAAU,eAAe;AACtC,eAAa,UAAU,gBAAgB;AAIvC,MAAI,sBAAsB;AAE1B,WAAS,cAAc,UAAU;AAC/B,QAAI,OAAO,aAAa,YAAY;AAClC,YAAM,IAAI,UAAU,qEAAqE,OAAO,QAAQ;AAAA,IAC5G;AAAA,EACA;AAEA,SAAO,eAAe,cAAc,uBAAuB;AAAA,IACzD,YAAY;AAAA,IACZ,KAAK,WAAW;AACd,aAAO;AAAA,IACX;AAAA,IACE,KAAK,SAAS,KAAK;AACjB,UAAI,OAAO,QAAQ,YAAY,MAAM,KAAK,YAAY,GAAG,GAAG;AAC1D,cAAM,IAAI,WAAW,oGAAoG,MAAM,GAAG;AAAA,MACxI;AACI,4BAAsB;AAAA,IAC1B;AAAA,EACA,CAAC;AAED,eAAa,OAAO,WAAW;AAE7B,QAAI,KAAK,YAAY,UACjB,KAAK,YAAY,OAAO,eAAe,IAAI,EAAE,SAAS;AACxD,WAAK,UAAU,uBAAO,OAAO,IAAI;AACjC,WAAK,eAAe;AAAA,IACxB;AAEE,SAAK,gBAAgB,KAAK,iBAAiB;AAAA,EAC7C;AAIA,eAAa,UAAU,kBAAkB,SAAS,gBAAgB,GAAG;AACnE,QAAI,OAAO,MAAM,YAAY,IAAI,KAAK,YAAY,CAAC,GAAG;AACpD,YAAM,IAAI,WAAW,kFAAkF,IAAI,GAAG;AAAA,IAClH;AACE,SAAK,gBAAgB;AACrB,WAAO;AAAA,EACT;AAEA,WAAS,iBAAiB,MAAM;AAC9B,QAAI,KAAK,kBAAkB;AACzB,aAAO,aAAa;AACtB,WAAO,KAAK;AAAA,EACd;AAEA,eAAa,UAAU,kBAAkB,SAAS,kBAAkB;AAClE,WAAO,iBAAiB,IAAI;AAAA,EAC9B;AAEA,eAAa,UAAU,OAAO,SAAS,KAAK,MAAM;AAChD,QAAI,OAAO,CAAA;AACX,aAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,IAAK,MAAK,KAAK,UAAU,CAAC,CAAC;AACjE,QAAI,UAAW,SAAS;AAExB,QAAIC,UAAS,KAAK;AAClB,QAAIA,YAAW;AACb,gBAAW,WAAWA,QAAO,UAAU;AAAA,aAChC,CAAC;AACR,aAAO;AAGT,QAAI,SAAS;AACX,UAAI;AACJ,UAAI,KAAK,SAAS;AAChB,aAAK,KAAK,CAAC;AACb,UAAI,cAAc,OAAO;AAGvB,cAAM;AAAA,MACZ;AAEI,UAAI,MAAM,IAAI,MAAM,sBAAsB,KAAK,OAAO,GAAG,UAAU,MAAM,GAAG;AAC5E,UAAI,UAAU;AACd,YAAM;AAAA,IACV;AAEE,QAAI,UAAUA,QAAO,IAAI;AAEzB,QAAI,YAAY;AACd,aAAO;AAET,QAAI,OAAO,YAAY,YAAY;AACjC,mBAAa,SAAS,MAAM,IAAI;AAAA,IACpC,OAAS;AACL,UAAI,MAAM,QAAQ;AAClB,UAAI,YAAY,WAAW,SAAS,GAAG;AACvC,eAAS,IAAI,GAAG,IAAI,KAAK,EAAE;AACzB,qBAAa,UAAU,CAAC,GAAG,MAAM,IAAI;AAAA,IAC3C;AAEE,WAAO;AAAA,EACT;AAEA,WAAS,aAAa,QAAQ,MAAM,UAAU,SAAS;AACrD,QAAI;AACJ,QAAIA;AACJ,QAAI;AAEJ,kBAAc,QAAQ;AAEtB,IAAAA,UAAS,OAAO;AAChB,QAAIA,YAAW,QAAW;AACxB,MAAAA,UAAS,OAAO,UAAU,uBAAO,OAAO,IAAI;AAC5C,aAAO,eAAe;AAAA,IAC1B,OAAS;AAGL,UAAIA,QAAO,gBAAgB,QAAW;AACpC,eAAO;AAAA,UAAK;AAAA,UAAe;AAAA,UACf,SAAS,WAAW,SAAS,WAAW;AAAA,QAAQ;AAI5D,QAAAA,UAAS,OAAO;AAAA,MACtB;AACI,iBAAWA,QAAO,IAAI;AAAA,IAC1B;AAEE,QAAI,aAAa,QAAW;AAE1B,iBAAWA,QAAO,IAAI,IAAI;AAC1B,QAAE,OAAO;AAAA,IACb,OAAS;AACL,UAAI,OAAO,aAAa,YAAY;AAElC,mBAAWA,QAAO,IAAI,IACpB,UAAU,CAAC,UAAU,QAAQ,IAAI,CAAC,UAAU,QAAQ;AAAA,MAE5D,WAAe,SAAS;AAClB,iBAAS,QAAQ,QAAQ;AAAA,MAC/B,OAAW;AACL,iBAAS,KAAK,QAAQ;AAAA,MAC5B;AAGI,UAAI,iBAAiB,MAAM;AAC3B,UAAI,IAAI,KAAK,SAAS,SAAS,KAAK,CAAC,SAAS,QAAQ;AACpD,iBAAS,SAAS;AAGlB,YAAI,IAAI,IAAI,MAAM,iDACE,SAAS,SAAS,MAAM,OAAO,IAAI,IAAI,mEAEvB;AACpC,UAAE,OAAO;AACT,UAAE,UAAU;AACZ,UAAE,OAAO;AACT,UAAE,QAAQ,SAAS;AACnB,2BAAmB,CAAC;AAAA,MAC1B;AAAA,IACA;AAEE,WAAO;AAAA,EACT;AAEA,eAAa,UAAU,cAAc,SAAS,YAAY,MAAM,UAAU;AACxE,WAAO,aAAa,MAAM,MAAM,UAAU,KAAK;AAAA,EACjD;AAEA,eAAa,UAAU,KAAK,aAAa,UAAU;AAEnD,eAAa,UAAU,kBACnB,SAAS,gBAAgB,MAAM,UAAU;AACvC,WAAO,aAAa,MAAM,MAAM,UAAU,IAAI;AAAA,EACpD;AAEA,WAAS,cAAc;AACrB,QAAI,CAAC,KAAK,OAAO;AACf,WAAK,OAAO,eAAe,KAAK,MAAM,KAAK,MAAM;AACjD,WAAK,QAAQ;AACb,UAAI,UAAU,WAAW;AACvB,eAAO,KAAK,SAAS,KAAK,KAAK,MAAM;AACvC,aAAO,KAAK,SAAS,MAAM,KAAK,QAAQ,SAAS;AAAA,IACrD;AAAA,EACA;AAEA,WAAS,UAAU,QAAQ,MAAM,UAAU;AACzC,QAAI,QAAQ,EAAE,OAAO,OAAO,QAAQ,QAAW,QAAgB,MAAY,SAAkB;AAC7F,QAAI,UAAU,YAAY,KAAK,KAAK;AACpC,YAAQ,WAAW;AACnB,UAAM,SAAS;AACf,WAAO;AAAA,EACT;AAEA,eAAa,UAAU,OAAO,SAASC,MAAK,MAAM,UAAU;AAC1D,kBAAc,QAAQ;AACtB,SAAK,GAAG,MAAM,UAAU,MAAM,MAAM,QAAQ,CAAC;AAC7C,WAAO;AAAA,EACT;AAEA,eAAa,UAAU,sBACnB,SAAS,oBAAoB,MAAM,UAAU;AAC3C,kBAAc,QAAQ;AACtB,SAAK,gBAAgB,MAAM,UAAU,MAAM,MAAM,QAAQ,CAAC;AAC1D,WAAO;AAAA,EACb;AAGA,eAAa,UAAU,iBACnB,SAAS,eAAe,MAAM,UAAU;AACtC,QAAI,MAAMD,SAAQ,UAAU,GAAG;AAE/B,kBAAc,QAAQ;AAEtB,IAAAA,UAAS,KAAK;AACd,QAAIA,YAAW;AACb,aAAO;AAET,WAAOA,QAAO,IAAI;AAClB,QAAI,SAAS;AACX,aAAO;AAET,QAAI,SAAS,YAAY,KAAK,aAAa,UAAU;AACnD,UAAI,EAAE,KAAK,iBAAiB;AAC1B,aAAK,UAAU,uBAAO,OAAO,IAAI;AAAA,WAC9B;AACH,eAAOA,QAAO,IAAI;AAClB,YAAIA,QAAO;AACT,eAAK,KAAK,kBAAkB,MAAM,KAAK,YAAY,QAAQ;AAAA,MACvE;AAAA,IACA,WAAiB,OAAO,SAAS,YAAY;AACrC,iBAAW;AAEX,WAAK,IAAI,KAAK,SAAS,GAAG,KAAK,GAAG,KAAK;AACrC,YAAI,KAAK,CAAC,MAAM,YAAY,KAAK,CAAC,EAAE,aAAa,UAAU;AACzD,6BAAmB,KAAK,CAAC,EAAE;AAC3B,qBAAW;AACX;AAAA,QACZ;AAAA,MACA;AAEQ,UAAI,WAAW;AACb,eAAO;AAET,UAAI,aAAa;AACf,aAAK,MAAK;AAAA,WACP;AACH,kBAAU,MAAM,QAAQ;AAAA,MAClC;AAEQ,UAAI,KAAK,WAAW;AAClB,QAAAA,QAAO,IAAI,IAAI,KAAK,CAAC;AAEvB,UAAIA,QAAO,mBAAmB;AAC5B,aAAK,KAAK,kBAAkB,MAAM,oBAAoB,QAAQ;AAAA,IACxE;AAEM,WAAO;AAAA,EACb;AAEA,eAAa,UAAU,MAAM,aAAa,UAAU;AAEpD,eAAa,UAAU,qBACnB,SAAS,mBAAmB,MAAM;AAChC,QAAI,WAAWA,SAAQ;AAEvB,IAAAA,UAAS,KAAK;AACd,QAAIA,YAAW;AACb,aAAO;AAGT,QAAIA,QAAO,mBAAmB,QAAW;AACvC,UAAI,UAAU,WAAW,GAAG;AAC1B,aAAK,UAAU,uBAAO,OAAO,IAAI;AACjC,aAAK,eAAe;AAAA,MAC9B,WAAmBA,QAAO,IAAI,MAAM,QAAW;AACrC,YAAI,EAAE,KAAK,iBAAiB;AAC1B,eAAK,UAAU,uBAAO,OAAO,IAAI;AAAA;AAEjC,iBAAOA,QAAO,IAAI;AAAA,MAC9B;AACQ,aAAO;AAAA,IACf;AAGM,QAAI,UAAU,WAAW,GAAG;AAC1B,UAAI,OAAO,OAAO,KAAKA,OAAM;AAC7B,UAAI;AACJ,WAAK,IAAI,GAAG,IAAI,KAAK,QAAQ,EAAE,GAAG;AAChC,cAAM,KAAK,CAAC;AACZ,YAAI,QAAQ,iBAAkB;AAC9B,aAAK,mBAAmB,GAAG;AAAA,MACrC;AACQ,WAAK,mBAAmB,gBAAgB;AACxC,WAAK,UAAU,uBAAO,OAAO,IAAI;AACjC,WAAK,eAAe;AACpB,aAAO;AAAA,IACf;AAEM,gBAAYA,QAAO,IAAI;AAEvB,QAAI,OAAO,cAAc,YAAY;AACnC,WAAK,eAAe,MAAM,SAAS;AAAA,IAC3C,WAAiB,cAAc,QAAW;AAElC,WAAK,IAAI,UAAU,SAAS,GAAG,KAAK,GAAG,KAAK;AAC1C,aAAK,eAAe,MAAM,UAAU,CAAC,CAAC;AAAA,MAChD;AAAA,IACA;AAEM,WAAO;AAAA,EACb;AAEA,WAAS,WAAW,QAAQ,MAAM,QAAQ;AACxC,QAAIA,UAAS,OAAO;AAEpB,QAAIA,YAAW;AACb,aAAO,CAAA;AAET,QAAI,aAAaA,QAAO,IAAI;AAC5B,QAAI,eAAe;AACjB,aAAO,CAAA;AAET,QAAI,OAAO,eAAe;AACxB,aAAO,SAAS,CAAC,WAAW,YAAY,UAAU,IAAI,CAAC,UAAU;AAEnE,WAAO,SACL,gBAAgB,UAAU,IAAI,WAAW,YAAY,WAAW,MAAM;AAAA,EAC1E;AAEA,eAAa,UAAU,YAAY,SAAS,UAAU,MAAM;AAC1D,WAAO,WAAW,MAAM,MAAM,IAAI;AAAA,EACpC;AAEA,eAAa,UAAU,eAAe,SAAS,aAAa,MAAM;AAChE,WAAO,WAAW,MAAM,MAAM,KAAK;AAAA,EACrC;AAEA,eAAa,gBAAgB,SAAS,SAAS,MAAM;AACnD,QAAI,OAAO,QAAQ,kBAAkB,YAAY;AAC/C,aAAO,QAAQ,cAAc,IAAI;AAAA,IACrC,OAAS;AACL,aAAO,cAAc,KAAK,SAAS,IAAI;AAAA,IAC3C;AAAA,EACA;AAEA,eAAa,UAAU,gBAAgB;AACvC,WAAS,cAAc,MAAM;AAC3B,QAAIA,UAAS,KAAK;AAElB,QAAIA,YAAW,QAAW;AACxB,UAAI,aAAaA,QAAO,IAAI;AAE5B,UAAI,OAAO,eAAe,YAAY;AACpC,eAAO;AAAA,MACb,WAAe,eAAe,QAAW;AACnC,eAAO,WAAW;AAAA,MACxB;AAAA,IACA;AAEE,WAAO;AAAA,EACT;AAEA,eAAa,UAAU,aAAa,SAAS,aAAa;AACxD,WAAO,KAAK,eAAe,IAAI,eAAe,KAAK,OAAO,IAAI,CAAA;AAAA,EAChE;AAEA,WAAS,WAAW,KAAK,GAAG;AAC1B,QAAI,OAAO,IAAI,MAAM,CAAC;AACtB,aAAS,IAAI,GAAG,IAAI,GAAG,EAAE;AACvB,WAAK,CAAC,IAAI,IAAI,CAAC;AACjB,WAAO;AAAA,EACT;AAEA,WAAS,UAAU,MAAM,OAAO;AAC9B,WAAO,QAAQ,IAAI,KAAK,QAAQ;AAC9B,WAAK,KAAK,IAAI,KAAK,QAAQ,CAAC;AAC9B,SAAK,IAAG;AAAA,EACV;AAEA,WAAS,gBAAgB,KAAK;AAC5B,QAAI,MAAM,IAAI,MAAM,IAAI,MAAM;AAC9B,aAAS,IAAI,GAAG,IAAI,IAAI,QAAQ,EAAE,GAAG;AACnC,UAAI,CAAC,IAAI,IAAI,CAAC,EAAE,YAAY,IAAI,CAAC;AAAA,IACrC;AACE,WAAO;AAAA,EACT;AAEA,WAAS,KAAK,SAAS,MAAM;AAC3B,WAAO,IAAI,QAAQ,SAAU,SAAS,QAAQ;AAC5C,eAAS,cAAc,KAAK;AAC1B,gBAAQ,eAAe,MAAM,QAAQ;AACrC,eAAO,GAAG;AAAA,MAChB;AAEI,eAAS,WAAW;AAClB,YAAI,OAAO,QAAQ,mBAAmB,YAAY;AAChD,kBAAQ,eAAe,SAAS,aAAa;AAAA,QACrD;AACM,gBAAQ,CAAA,EAAG,MAAM,KAAK,SAAS,CAAC;AAAA,MACtC;AAEI,qCAA+B,SAAS,MAAM,UAAU,EAAE,MAAM,MAAM;AACtE,UAAI,SAAS,SAAS;AACpB,sCAA8B,SAAS,eAAe,EAAE,MAAM,KAAI,CAAE;AAAA,MAC1E;AAAA,IACA,CAAG;AAAA,EACH;AAEA,WAAS,8BAA8B,SAAS,SAAS,OAAO;AAC9D,QAAI,OAAO,QAAQ,OAAO,YAAY;AACpC,qCAA+B,SAAS,SAAS,SAAS,KAAK;AAAA,IACnE;AAAA,EACA;AAEA,WAAS,+BAA+B,SAAS,MAAM,UAAU,OAAO;AACtE,QAAI,OAAO,QAAQ,OAAO,YAAY;AACpC,UAAI,MAAM,MAAM;AACd,gBAAQ,KAAK,MAAM,QAAQ;AAAA,MACjC,OAAW;AACL,gBAAQ,GAAG,MAAM,QAAQ;AAAA,MAC/B;AAAA,IACA,WAAa,OAAO,QAAQ,qBAAqB,YAAY;AAGzD,cAAQ,iBAAiB,MAAM,SAAS,aAAa,KAAK;AAGxD,YAAI,MAAM,MAAM;AACd,kBAAQ,oBAAoB,MAAM,YAAY;AAAA,QACtD;AACM,iBAAS,GAAG;AAAA,MAClB,CAAK;AAAA,IACL,OAAS;AACL,YAAM,IAAI,UAAU,wEAAwE,OAAO,OAAO;AAAA,IAC9G;AAAA,EACA;;;;ACveY,MAAC,aAAa;AAAA;AAAA,EAEzB,IAAI;AAAA,EACJ,gBAAgB;AAAA,EAChB,WAAW;AAAA,EACX,aAAa;AAAA,EACb,sBAAsB;AAAA,EACtB,kBAAkB;AAAA,EAClB,gBAAgB;AAAA,EAChB,eAAe;AAAA,EACf,iBAAiB;AAAA;AAAA,EACjB,sBAAsB;AAAA,EACtB,gBAAgB;AAAA,EAChB,oBAAoB;AAAA,EACpB,cAAc;AAAA,EACd,eAAe;AAAA,EACf,UAAU;AAAA,EACV,gBAAgB;AAAA,EAChB,gBAAgB;AAAA,EAChB,uBAAuB;AAAA,EACvB,mBAAmB;AAAA,EACnB,qBAAqB;AAAA,EACrB,iBAAiB;AAAA,EACjB,iBAAiB;AAAA,EACjB,qBAAqB;AAAA,EACrB,sBAAsB;AAAA,EACtB,cAAc;AAAA,EACd,mBAAmB;AAAA,EACnB,kBAAkB;AAAA,EAClB,mBAAmB;AAAA,EACnB,wBAAwB;AAAA,EACxB,oCAAoC;AAAA;AAAA,EAGpC,gBAAgB;AAAA,EAChB,eAAe;AAAA,EACf,sBAAsB;AAAA;AAAA,EAGtB,6BAA6B;AAAA;AAAA,EAG7B,WAAW;AAAA,EACX,8BAA8B;AAAA;AAAA,EAG9B,kBAAkB;AAAA;AAAA,EAGlB,qBAAqB;AAAA,EACpB,yDAAyD;AAAA;AAAA,EAG1D,iBAAiB;AAAA,EACjB,yBAAyB;AAC1B;AAKO,MAAM,mBAAmB,MAAM;AAAA,EACrC,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,OAAO;AACb,SAAK,OAAO;AACZ,SAAK,OAAO,QAAQ,QAAQ,WAAW;AACvC,SAAK,WAAW,KAAK,aAAa,KAAK,IAAI;AAG3C,SAAK,OAAO;AAGZ,QAAI,QAAQ,WAAY,MAAK,aAAa,QAAQ;AAClD,QAAI,QAAQ,SAAU,MAAK,WAAW,QAAQ;AAC9C,QAAI,QAAQ,UAAW,MAAK,YAAY,QAAQ;AAChD,QAAI,QAAQ,MAAO,MAAK,QAAQ,QAAQ;AACxC,QAAI,QAAQ,SAAU,MAAK,WAAW,QAAQ;AAC9C,QAAI,QAAQ,MAAO,MAAK,QAAQ,QAAQ;AACxC,QAAI,QAAQ,MAAO,MAAK,QAAQ,QAAQ;AAGxC,QAAI,MAAM,mBAAmB;AAC5B,YAAM,kBAAkB,MAAM,KAAK,WAAW;AAAA,IAC/C;AAAA,EACD;AAAA,EAEA,aAAa,MAAM;AAClB,UAAM,aAAa;AAAA,MAClB,GAAG;AAAA,MACH,GAAG;AAAA,MACH,GAAG;AAAA,MACH,GAAG;AAAA,MACH,GAAG;AAAA,MACH,GAAG;AAAA,MACH,GAAG;AAAA,MACH,GAAG;AAAA,MACH,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,MAAO;AAAA,MACP,OAAO;AAAA,MACP,OAAO;AAAA,IACV;AACE,WAAO,WAAW,IAAI,KAAK;AAAA,EAC5B;AAAA,EAEA,SAAS;AACR,UAAM,OAAO;AAAA,MACZ,MAAM,KAAK;AAAA,MACX,SAAS,KAAK;AAAA,MACd,MAAM,KAAK;AAAA,MACX,UAAU,KAAK;AAAA,IAClB;AAGE,QAAI,KAAK,WAAY,MAAK,aAAa,KAAK;AAC5C,QAAI,KAAK,SAAU,MAAK,WAAW,KAAK;AACxC,QAAI,KAAK,UAAW,MAAK,YAAY,KAAK;AAC1C,QAAI,KAAK,MAAO,MAAK,QAAQ,KAAK;AAClC,QAAI,KAAK,UAAW,MAAK,YAAY,KAAK;AAC1C,QAAI,KAAK,MAAO,MAAK,QAAQ,KAAK;AAClC,QAAI,KAAK,MAAO,MAAK,QAAQ,KAAK;AAClC,QAAI,KAAK,SAAU,MAAK,WAAW,KAAK;AACxC,QAAI,KAAK,UAAW,MAAK,YAAY,KAAK;AAC1C,QAAI,KAAK,SAAU,MAAK,WAAW,KAAK;AACxC,QAAI,KAAK,QAAS,MAAK,UAAU,KAAK;AACtC,QAAI,KAAK,WAAY,MAAK,aAAa,KAAK;AAC5C,QAAI,KAAK,SAAU,MAAK,WAAW,KAAK;AACxC,QAAI,KAAK,YAAa,MAAK,cAAc,KAAK;AAE9C,WAAO;AAAA,EACR;AACD;AAKO,MAAM,yBAAyB,WAAW;AAAA,EAChD,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO;AAAA,EACb;AACD;AAKO,MAAM,yBAAyB,WAAW;AAAA,EAChD,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO;AACZ,SAAK,OAAO,QAAQ,QAAQ,WAAW;AAAA,EACxC;AACD;AAKO,MAAM,mBAAmB,WAAW;AAAA,EAC1C,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO;AACZ,SAAK,OAAO,QAAQ,QAAQ,WAAW;AAAA,EACxC;AACD;AAKO,MAAM,0BAA0B,WAAW;AAAA,EACjD,YAAY,KAAK,UAAU,IAAI;AAC9B,UAAM,SAAS,KAAK,UAAU,GAAG;AACjC,UAAM,UAAU,6BAA6B,QAAQ,aAAa,gBAAgB,QAAQ,UAAU,KAAK,EAAE,WAAW,MAAM,aAAa,MAAM;AAC/I,UAAM,SAAS,EAAE,GAAG,SAAS,MAAM,WAAW,eAAe;AAC7D,SAAK,OAAO;AACZ,SAAK,aAAa;AAClB,SAAK,WAAW,QAAQ,YAAY;AAAA,EACrC;AACD;AAKO,MAAM,wBAAwB,WAAW;AAAA,EAC/C,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO;AACZ,SAAK,OAAO,QAAQ,QAAQ,WAAW;AACvC,SAAK,mBAAmB,QAAQ,oBAAoB,CAAA;AAAA,EACrD;AACD;AAKO,MAAM,mBAAmB,WAAW;AAAA,EAC1C,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO;AAAA,EACb;AACD;AAKO,MAAM,yBAAyB,WAAW;AAAA,EAChD,YAAY,WAAW,UAAU,IAAI;AACpC,UAAM,oBAAoB,SAAS,oBAAoB;AAAA,MACtD,GAAG;AAAA,MACH,MAAM,WAAW;AAAA,IACpB,CAAG;AACD,SAAK,OAAO;AACZ,SAAK,YAAY;AAAA,EAClB;AACD;AAKO,MAAM,2BAA2B,WAAW;AAAA,EAClD,YAAY,WAAW,UAAU,IAAI;AACpC,UAAM,UAAU,SAAS,eAAe;AAAA,MACvC,GAAG;AAAA,MACH,MAAM,WAAW;AAAA,MACjB,OAAO;AAAA,IACV,CAAG;AACD,SAAK,OAAO;AACZ,SAAK,YAAY;AAAA,EAClB;AACD;AAKO,MAAM,+BAA+B,WAAW;AAAA,EACtD,YAAY,QAAQ,UAAU,IAAI;AACjC,UAAM,wBAAwB,MAAM,IAAI;AAAA,MACvC,GAAG;AAAA,MACH,MAAM,WAAW;AAAA,IACpB,CAAG;AACD,SAAK,OAAO;AAAA,EACb;AACD;AAKO,MAAM,mBAAmB,WAAW;AAAA,EAC1C,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO;AACZ,SAAK,OAAO,QAAQ,QAAQ,WAAW;AAAA,EACxC;AACD;AAKO,MAAM,0BAA0B,WAAW;AAAA,EACjD,YAAY,OAAO,cAAc,YAAY,UAAU,CAAA,GAAI;AAC1D;AAAA,MACC,4BAA4B,KAAK,eAAe,YAAY,SAAS,UAAU;AAAA,MAC/E,EAAE,GAAG,SAAS,MAAM,WAAW,eAAe,MAAK;AAAA,IACtD;AACE,SAAK,OAAO;AACZ,SAAK,eAAe;AACpB,SAAK,aAAa;AAAA,EACnB;AACD;AAKO,MAAM,uBAAuB,WAAW;AAAA,EAC9C,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO;AAAA,EACb;AACD;AAKO,MAAM,+BAA+B,eAAe;AAAA,EAC1D,YAAY,WAAW,UAAU,IAAI;AACpC,UAAM,cAAc,SAAS,eAAe;AAAA,MAC3C,GAAG;AAAA,MACH,MAAM,WAAW;AAAA,IACpB,CAAG;AACD,SAAK,OAAO;AACZ,SAAK,YAAY;AAAA,EAClB;AACD;AAKO,MAAM,8BAA8B,eAAe;AAAA,EACzD,YAAY,WAAW,QAAQ,UAAU,CAAA,GAAI;AAE5C,QAAI,OAAO,WAAW,YAAY,CAAC,SAAS;AAC3C,gBAAU;AACV,eAAS;AAAA,IACV;AACA,UAAM,MAAM,SAAS,sBAAsB,SAAS,MAAM,MAAM,KAAK,sBAAsB,SAAS;AACpG,UAAM,KAAK;AAAA,MACV,GAAG;AAAA,MACH,MAAM,WAAW;AAAA,IACpB,CAAG;AACD,SAAK,OAAO;AACZ,SAAK,YAAY;AAAA,EAClB;AACD;AAKO,MAAM,oBAAoB,WAAW;AAAA,EAC3C,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO;AAAA,EACb;AACD;AAKO,MAAM,4BAA4B,YAAY;AAAA,EACpD,YAAY,UAAU,UAAU,IAAI;AACnC,UAAM,UAAU,QAAQ,cAAc;AAAA,MACrC,GAAG;AAAA,MACH,MAAM,WAAW;AAAA,IACpB,CAAG;AACD,SAAK,OAAO;AACZ,SAAK,WAAW;AAAA,EACjB;AACD;AAKO,MAAM,4BAA4B,WAAW;AAAA,EACnD,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,GAAG,OAAO,sCAAsC;AAAA,MACrD,GAAG;AAAA,MACH,MAAM,WAAW;AAAA,IACpB,CAAG;AACD,SAAK,OAAO;AACZ,SAAK,UAAU;AAAA,EAChB;AACD;AAKO,MAAM,mCAAmC,WAAW;AAAA,EAC1D,YAAY,WAAW,QAAQ,UAAU,CAAA,GAAI;AAE5C,QAAI,OAAO,WAAW,YAAY,CAAC,SAAS;AAC3C,gBAAU;AACV,eAAS;AAAA,IACV;AACA,UAAM,MAAM,SAAS,cAAc,SAAS,uBAAuB,MAAM,KAAK,cAAc,SAAS;AACrG,UAAM,KAAK;AAAA,MACV,GAAG;AAAA,MACH,MAAM,WAAW;AAAA,MACjB;AAAA,IACH,CAAG;AACD,SAAK,OAAO;AAAA,EACb;AACD;AAKO,MAAM,sBAAsB,WAAW;AAAA,EAC7C,YAAY,OAAO,OAAO,QAAQ,UAAU,CAAA,GAAI;AAC/C,UAAM,wBAAwB,KAAK,MAAM,MAAM,IAAI;AAAA,MAClD,GAAG;AAAA,MACH,MAAM,WAAW;AAAA,MACjB;AAAA,IACH,CAAG;AACD,SAAK,OAAO;AACZ,SAAK,QAAQ;AAAA,EACd;AACD;AAKO,MAAM,uBAAuB,WAAW;AAAA,EAC9C,YAAY,cAAc,IAAI,UAAU,CAAA,GAAI;AAC3C,UAAM,UAAU,+BAA+B,YAAY,MAAM;AACjE,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO;AACZ,SAAK,cAAc;AACnB,SAAK,OAAO,QAAQ,QAAQ,WAAW;AAAA,EACxC;AACD;AAKO,MAAM,0BAA0B,WAAW;AAAA,EACjD,YAAY,SAAS,UAAU,IAAI;AAClC,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO;AACZ,SAAK,OAAO,QAAQ,QAAQ,WAAW;AAAA,EACxC;AACD;AClbO,MAAM,0BAA0BE,cAAAA,aAAa;AAAA,EAClD,OAAO,OAAO,EAAE,QAAQ,UAAU,YAAY,UAAU,WAAW,CAAA,GAAI,UAAU,CAAA,KAAM;AACrF,UAAM,SAAS,IAAI,kBAAkB,EAAE,QAAQ,SAAQ,CAAE;AAEzD,QAAI,CAAC,UAAU;AAEb,UAAI,QAAQ;AACZ,UAAI,aAAa,QAAQ,aAAa,QAAW;AAE/C,iBAAS;AACT,iBAAS;AAAA,MACX,WAAW,eAAe,QAAQ,eAAe,QAAW;AAE1D,iBAAS;AACT,iBAAS;AAAA,MACX,OAAO;AAEL,iBAAS;AACT,iBAAS;AAAA,MACX;AAGA,aAAO,YAAY;AAAA,QACjB;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,MAAM,CAAC,UAAU,OAAO;AAAA,MAChC,CAAO,EAAE,KAAK,CAAC,SAAS;AAChB,YAAI,QAAQ,KAAK,UAAU;AACzB,iBAAO,WAAW,KAAK;AAAA,QACzB;AAAA,MACF,CAAC,EAAE,MAAM,MAAM;AAAA,MAEf,CAAC;AAAA,IACH;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,YAAY,EAAE,QAAQ,YAAY;AAChC,UAAK;AACL,SAAK,SAAS;AACd,SAAK,WAAW;AAChB,SAAK,SAAS;AACd,SAAK,eAAe;AAEpB,SAAK,WAAW,KAAK,SAAS,KAAK,IAAI;AACvC,SAAK,OAAO,GAAG,SAAS,KAAK,QAAQ;AAAA,EACvC;AAAA,EAEA,SAAS,WAAW,SAAS;AAC3B,QAAI,cAAc,eAAgB;AAClC,QAAI,CAAC,WAAW,QAAQ,aAAa,KAAK,SAAU;AAEpD,UAAM,EAAE,MAAM,KAAI,IAAK;AACvB,QAAI,SAAS,SAAU,MAAK,KAAK,UAAU,IAAI;AAC/C,QAAI,SAAS,QAAS,MAAK,KAAK,SAAS,IAAI;AAC7C,QAAI,SAAS,SAAS;AACpB,WAAK,KAAK,OAAO;AACjB,WAAK,SAAQ;AAAA,IACf;AAAA,EACF;AAAA,EAEA,WAAW;AACT,SAAK,OAAO,IAAI,SAAS,KAAK,QAAQ;AAAA,EACxC;AAAA,EAEA,MAAM,QAAQ;AACZ,QAAI,KAAK,OAAQ;AACjB,SAAK,SAAS;AAGd,eAAW,WAAW,KAAK,cAAc;AACvC,cAAQ,QAAQ,IAAI;AAAA,IACtB;AACA,SAAK,eAAe,CAAA;AAGpB,SAAK,OAAO,YAAY;AAAA,MACtB,QAAQ;AAAA,MACR,UAAU,KAAK;AAAA,MACf,QAAQ;AAAA,IACd,CAAK,EAAE,MAAM,MAAM;AAAA,IAEf,CAAC;AAGD,SAAK,KAAK,OAAO;AAGjB,SAAK,SAAQ;AAAA,EACf;AAAA,EAEA,MAAM,OAAO;AAEX,QAAI,KAAK,QAAQ;AACf,aAAO;AAAA,IACT;AAGA,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,YAAM,WAAW,CAAC,WAAW;AAC3B,aAAK,eAAe,OAAO;AAC3B,aAAK,IAAI,UAAU,QAAQ;AAC3B,aAAK,IAAI,SAAS,OAAO;AACzB,aAAK,IAAI,SAAS,OAAO;AACzB,gBAAQ,MAAM;AAAA,MAChB;AACA,YAAM,UAAU,CAAC,UAAU;AACzB,aAAK,eAAe,OAAO;AAC3B,aAAK,IAAI,UAAU,QAAQ;AAC3B,aAAK,IAAI,SAAS,OAAO;AACzB,aAAK,IAAI,SAAS,OAAO;AACzB,eAAO,KAAK;AAAA,MACd;AACA,YAAM,UAAU,MAAM;AACpB,aAAK,eAAe,OAAO;AAC3B,aAAK,IAAI,UAAU,QAAQ;AAC3B,aAAK,IAAI,SAAS,OAAO;AACzB,aAAK,IAAI,SAAS,OAAO;AACzB,gBAAQ,IAAI;AAAA,MACd;AAGA,YAAM,UAAU,EAAE,SAAS,OAAM;AACjC,WAAK,aAAa,KAAK,OAAO;AAE9B,WAAK,GAAG,UAAU,QAAQ;AAC1B,WAAK,GAAG,SAAS,OAAO;AACxB,WAAK,GAAG,SAAS,OAAO;AAAA,IAC1B,CAAC;AAAA,EACH;AAAA,EAEA,eAAe,SAAS;AACtB,UAAM,QAAQ,KAAK,aAAa,QAAQ,OAAO;AAC/C,QAAI,UAAU,IAAI;AAChB,WAAK,aAAa,OAAO,OAAO,CAAC;AAAA,IACnC;AAAA,EACF;AACF;AC/IO,MAAM,YAAY;AAAA,EACvB,YAAY,EAAE,QAAQ,UAAU,QAAQ,CAAA,GAAI,YAAY,OAAO,YAAY,KAAK,gBAAgB,eAAc,GAAI;AAChH,SAAK,SAAS;AACd,SAAK,WAAW;AAChB,SAAK,SAAS,MAAM,QAAQ,KAAK,IAAI,QAAQ,CAAA;AAC7C,SAAK,YAAY,aAAa;AAC9B,SAAK,aAAa;AAClB,SAAK,kBAAkB,kBAAkB;AACzC,SAAK,kBAAkB,kBAAkB;AACzC,SAAK,eAAe,CAAC,kBAAkB,CAAC;AAAA,EAC1C;AAAA,EAEA,MAAM,qBAAqB;AACzB,QAAI,KAAK,aAAc;AAGvB,QAAI,KAAK,iBAAiB;AACxB,YAAM,aAAa,CAAA;AACnB,UAAI,KAAK,WAAW,OAAW,YAAW,QAAQ,KAAK;AACvD,UAAI,KAAK,UAAU,OAAW,YAAW,OAAO,KAAK;AACrD,UAAI,KAAK,UAAU,OAAW,YAAW,OAAO,KAAK;AACrD,UAAI,KAAK,SAAS,OAAW,YAAW,MAAM,KAAK;AACnD,UAAI,KAAK,SAAS,OAAW,YAAW,MAAM,KAAK;AACnD,UAAI,KAAK,UAAU,OAAW,YAAW,OAAO,KAAK;AACrD,UAAI,KAAK,aAAa,OAAW,YAAW,UAAU,KAAK;AAC3D,UAAI,KAAK,eAAe,OAAW,YAAW,YAAY,KAAK;AAC/D,UAAI,KAAK,aAAa,OAAW,YAAW,UAAU,KAAK;AAC3D,UAAI,KAAK,eAAe,OAAW,YAAW,YAAY,KAAK;AAC/D,UAAI,KAAK,kBAAkB,OAAW,YAAW,eAAe,KAAK;AACrE,UAAI,KAAK,eAAe,OAAW,YAAW,YAAY,KAAK;AAG/D,WAAK,gBAAgB,aAAa;AAElC,YAAM,MAAM,MAAM,KAAK,OAAO,YAAY,KAAK,eAAe;AAC9D,WAAK,WAAW,IAAI;AACpB,WAAK,SAAS,IAAI,SAAS,CAAA;AAC3B,WAAK,YAAY,IAAI,aAAa;AAClC,WAAK,aAAa,IAAI,aAAa;AACnC,WAAK,kBAAkB;AACvB,WAAK,eAAe;AAAA,IACtB,WAAW,KAAK,iBAAiB;AAE/B,YAAM,MAAM,MAAM,KAAK;AACvB,WAAK,WAAW,IAAI;AACpB,WAAK,SAAS,IAAI,SAAS,CAAA;AAC3B,WAAK,YAAY,IAAI,aAAa;AAClC,WAAK,aAAa,IAAI,aAAa;AACnC,WAAK,kBAAkB;AACvB,WAAK,eAAe;AAAA,IACtB;AAAA,EACF;AAAA,EAEA,MAAM,UAAU;AACd,QAAI,KAAK,QAAS,QAAO;AACzB,UAAM,KAAK,mBAAkB;AAC7B,QAAI,KAAK,OAAO,SAAS,EAAG,QAAO;AACnC,QAAI,KAAK,UAAW,QAAO;AAC3B,UAAM,KAAK,SAAQ;AACnB,WAAO,KAAK,OAAO,SAAS;AAAA,EAC9B;AAAA,EAEA,MAAM,OAAO;AACX,UAAM,MAAM,MAAM,KAAK,QAAO;AAC9B,QAAI,CAAC,IAAK,QAAO;AACjB,WAAO,KAAK,OAAO,MAAK;AAAA,EAC1B;AAAA,EAEA,MAAM,UAAU;AACd,UAAM,KAAK,mBAAkB;AAC7B,UAAM,UAAU,CAAC,GAAG,KAAK,MAAM;AAC/B,SAAK,SAAS,CAAA;AACd,WAAO,CAAC,KAAK,WAAW;AACtB,YAAM,KAAK,SAAQ;AACnB,cAAQ,KAAK,GAAG,KAAK,MAAM;AAC3B,WAAK,SAAS,CAAA;AAAA,IAChB;AACA,WAAO;AAAA,EACT;AAAA,EAEA,MAAM,QAAQ;AAEZ,UAAM,MAAM,MAAM,KAAK,QAAO;AAC9B,WAAO,IAAI;AAAA,EACb;AAAA;AAAA,EAGA,MAAM,GAAG;AACP,SAAK,SAAS;AACd,WAAO;AAAA,EACT;AAAA,EAEA,KAAK,GAAG;AACN,SAAK,QAAQ;AACb,WAAO;AAAA,EACT;AAAA,EAEA,KAAK,MAAM;AACT,SAAK,QAAQ;AACb,WAAO;AAAA,EACT;AAAA,EAEA,UAAU,GAAG;AACX,SAAK,aAAa;AAClB,WAAO;AAAA,EACT;AAAA;AAAA,EAGA,MAAM,QAAQ;AACZ,SAAK,UAAU;AACf,UAAM,KAAK,aAAY;AAEvB,WAAO;AAAA,EACT;AAAA,EAEA,WAAW;AACT,WAAO,KAAK,WAAW;AAAA,EACzB;AAAA,EAEA,QAAQ,KAAK;AACX,SAAK,WAAW;AAChB,WAAO;AAAA,EACT;AAAA,EAEA,KAAK,MAAM;AACT,SAAK,QAAQ;AACb,WAAO;AAAA,EACT;AAAA,EAEA,QAAQ,YAAY,gBAAgB;AAGlC,UAAM,SAAS;AAAA,MACb,cAAc;AAAA,QACZ,gBAAgB;AAAA,QAChB,WAAW;AAAA,QACX,gBAAgB;AAAA,QAChB,aAAa,CAAA;AAAA,QACb,aAAa;AAAA,UACX,OAAO;AAAA,QACjB;AAAA,MACA;AAAA,MACM,IAAI;AAAA,IACV;AAEI,QAAI,cAAc,oBAAoB,cAAc,qBAAqB;AACvE,aAAO,iBAAiB;AAAA,QACtB,kBAAkB;AAAA,QAClB,WAAW;AAAA,QACX,qBAAqB;AAAA,MAC7B;AAAA,IACI;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,MAAM,UAAU;AAEd,QAAI,QAAQ;AACZ,WAAO,MAAM,KAAK,WAAW;AAC3B,YAAM,KAAK,KAAI;AACf;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EAEA,OAAO;AAEL,WAAO,KAAK,OAAO;AAAA,EACrB;AAAA,EAEA,IAAI,MAAM;AACR,SAAK,OAAO;AACZ,SAAK,kBAAkB;AACvB,WAAO;AAAA,EACT;AAAA,EAEA,IAAI,MAAM;AACR,SAAK,OAAO;AACZ,SAAK,kBAAkB;AACvB,WAAO;AAAA,EACT;AAAA,EAEA,UAAU,IAAI;AACZ,SAAK,aAAa;AAClB,WAAO;AAAA,EACT;AAAA,EAEA,QAAQ,GAAG;AACT,SAAK,WAAW;AAChB,WAAO;AAAA,EACT;AAAA,EAEA,kBAAkB;AAChB,SAAK,mBAAmB;AACxB,WAAO;AAAA,EACT;AAAA,EAEA,kBAAkB;AAChB,WAAO,KAAK,OAAO;AAAA,EACrB;AAAA,EAEA,SAAS;AACP,SAAK,UAAU;AACf,WAAO;AAAA,EACT;AAAA,EAEA,YAAY,OAAO;AACjB,SAAK,eAAe;AACpB,WAAO;AAAA,EACT;AAAA,EAEA,SAAS,MAAM,QAAQ;AACrB,SAAK,YAAY,EAAE,MAAM,OAAM;AAC/B,WAAO;AAAA,EACT;AAAA,EAEA,UAAU,OAAO,MAAM;AACrB,SAAK,aAAa;AAClB,WAAO;AAAA,EACT;AAAA,EAEA,aAAa,OAAO,MAAM;AACxB,SAAK,gBAAgB;AACrB,WAAO;AAAA,EACT;AAAA,EAEA,aAAa,OAAO,MAAM;AACxB,SAAK,gBAAgB;AACrB,WAAO;AAAA,EACT;AAAA,EAEA,UAAU,MAAM;AACd,SAAK,aAAa;AAClB,WAAO;AAAA,EACT;AAAA,EAEA,MAAM,QAAQ,IAAI;AAChB,WAAO,MAAM,KAAK,WAAW;AAC3B,YAAM,MAAM,MAAM,KAAK,KAAI;AAC3B,YAAM,GAAG,GAAG;AAAA,IACd;AAAA,EACF;AAAA,EAEA,MAAM,IAAI,IAAI;AACZ,UAAM,UAAU,CAAA;AAChB,WAAO,MAAM,KAAK,WAAW;AAC3B,YAAM,MAAM,MAAM,KAAK,KAAI;AAC3B,cAAQ,KAAK,MAAM,GAAG,GAAG,CAAC;AAAA,IAC5B;AACA,WAAO;AAAA,EACT;AAAA;AAAA,EAGA,QAAQ,OAAO,aAAa,IAAI;AAC9B,WAAO,MAAM,KAAK,WAAW;AAC3B,YAAM,MAAM,KAAK,KAAI;AAAA,IACvB;AAAA,EACF;AAAA,EAEA,MAAM,WAAW;AACf,QAAI,KAAK,UAAW;AACpB,UAAM,OAAO,MAAM,KAAK,OAAO,YAAY;AAAA,MACzC,QAAQ;AAAA,MACR,UAAU,KAAK;AAAA,MACf,QAAQ;AAAA,MACR,MAAM,CAAC,EAAE,WAAW,KAAK,WAAU,CAAE;AAAA,IAC3C,CAAK;AACD,SAAK,SAAS,MAAM,SAAS,CAAA;AAC7B,SAAK,YAAY,CAAC,CAAC,MAAM;AACzB,QAAI,KAAK,WAAW;AAElB,YAAM,KAAK,aAAY;AAAA,IACzB;AAAA,EACF;AAAA,EAEA,MAAM,eAAe;AACnB,QAAI,CAAC,KAAK,SAAU;AACpB,QAAI;AACF,YAAM,KAAK,OAAO,YAAY;AAAA,QAC5B,QAAQ;AAAA,QACR,UAAU,KAAK;AAAA,QACf,QAAQ;AAAA,MAChB,CAAO;AAAA,IACH,SAAS,GAAG;AAAA,IAEZ;AACA,SAAK,WAAW;AAAA,EAClB;AACF;AC7RO,MAAM,gBAAgB;AAAA,EAC3B,YAAY,EAAE,QAAQ,MAAM,QAAQ,GAAE,GAAI;AACxC,SAAK,SAAS;AACd,SAAK,OAAO;AACZ,SAAK,SAAS;AACd,SAAK,MAAM;AACX,SAAK,UAAU;AAEf,WAAO,IAAI,MAAM,MAAM;AAAA,MACrB,KAAK,CAAC,QAAQ,MAAM,aAAa;AAC/B,YAAI,QAAQ,OAAQ,QAAO,QAAQ,IAAI,QAAQ,MAAM,QAAQ;AAC7D,YAAI,OAAO,SAAS,YAAY,OAAO,IAAI,EAAE,WAAW,GAAG,EAAG,QAAO;AACrE,YAAI,SAAS,SAAS;AACpB,iBAAO,IAAI,SAAS,OAAO,OAAO,GAAG,IAAI;AAAA,QAC3C;AAEA,YAAI,SAAS,UAAU,SAAS,aAAa;AAC3C,iBAAO,IAAI,SAAS,OAAO,cAAc,OAAO,IAAI,GAAG,IAAI;AAAA,QAC7D;AACA,eAAO,IAAI,SAAS,OAAO,MAAM,OAAO,IAAI,GAAG,IAAI;AAAA,MACrD;AAAA,IACN,CAAK;AAAA,EACH;AAAA,EAEA,cAAc,QAAQ,OAAO,IAAI;AAE/B,QAAI,WAAW,UAAU,KAAK,UAAU,GAAG;AACzC,WAAK,oBAAoB,KAAK,CAAC,CAAC;AAAA,IAClC;AAGA,UAAM,iBAAiB;AAAA,MACrB,QAAQ;AAAA,MACR,UAAU,KAAK;AAAA,MACf,YAAY,KAAK;AAAA,MACjB;AAAA,MACA;AAAA,IACN;AAEI,UAAM,SAAS,IAAI,YAAY;AAAA,MAC7B,QAAQ,KAAK;AAAA,MACb;AAAA,IACN,CAAK;AAGD,QAAI,WAAW,aAAa;AAC1B,aAAO,OAAO,SAAS,aAAa,YAAY;AAC9C,eAAO,KAAK,QAAO,EAAG,KAAK,aAAa,UAAU;AAAA,MACpD;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,oBAAoB,YAAY;AAC9B,QAAI,CAAC,cAAc,OAAO,KAAK,UAAU,EAAE,WAAW,EAAG;AAEzD,UAAM,OAAO,OAAO,KAAK,UAAU;AACnC,QAAI,eAAe;AACnB,QAAI,eAAe;AAEnB,eAAW,OAAO,MAAM;AACtB,UAAI,QAAQ,MAAO;AACnB,UAAI,WAAW,GAAG,EAAG,gBAAe;AAAA,UAAW,gBAAe;AAC9D,UAAI,gBAAgB,aAAc;AAAA,IACpC;AAEA,QAAI,gBAAgB,cAAc;AAChC,YAAM,IAAI,WAAW,wDAAwD;AAAA,QAC3E,MAAM,WAAW;AAAA,QACjB,YAAY,KAAK;AAAA,MACzB,CAAO;AAAA,IACH;AAAA,EACF;AAAA,EAEA,MAAM,QAAQ,OAAO,IAAI;AACvB,UAAM,UAAU,KAAK,OAAO,YAAY;AAAA,MACtC,QAAQ;AAAA,MACR,UAAU,KAAK;AAAA,MACf,YAAY,KAAK;AAAA,MACjB;AAAA,MACA;AAAA,IACN,CAAK,EAAE,KAAK,CAAC,QAAQ;AACf,UAAI,OAAO,IAAI,UAAU;AACvB,eAAO,IAAI,YAAY;AAAA,UACrB,QAAQ,KAAK;AAAA,UACb,UAAU,IAAI;AAAA,UACd,OAAO,IAAI;AAAA,UACX,WAAW,IAAI;AAAA,UACf,WAAW,IAAI;AAAA,QACzB,CAAS;AAAA,MACH;AAEA,UAAI,WAAW,YAAY,KAAK,SAAS,GAAG;AAI1C,YAAI,KAAK,KAAK;AACZ,eAAK,IAAI,WAAW,KAAK,CAAC,CAAC;AAAA,QAC7B;AAAA,MACF;AAEA,UAAI,WAAW,eAAe;AAC5B,cAAM,YAAY,KAAK,CAAC;AACxB,cAAM,eAAe,KAAK,CAAC,KAAK,CAAA;AAChC,cAAM,YAAY,aAAa,QAAQ,OAAO,QAAQ,SAAS,EAC5D,IAAI,CAAC,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,EAAE,EAC3B,KAAK,GAAG;AAGX,YAAI,CAAC,KAAK,QAAQ,KAAK,SAAO,IAAI,SAAS,SAAS,GAAG;AACrD,eAAK,QAAQ,KAAK;AAAA,YAChB,MAAM;AAAA,YACN,KAAK;AAAA,YACL,GAAG;AAAA,UACf,CAAW;AAAA,QACH;AAAA,MACF;AAEA,UAAI,WAAW,aAAa;AAC1B,cAAM,YAAY,KAAK,CAAC;AACxB,aAAK,UAAU,KAAK,QAAQ,OAAO,SAAO,IAAI,SAAS,SAAS;AAAA,MAClE;AACA,UAAI,WAAW,eAAe;AAC5B,aAAK,UAAU,CAAA;AAAA,MACjB;AAEA,UAAI,WAAW,QAAQ;AACrB,aAAK,UAAU,CAAA;AAAA,MACjB;AACA,aAAO;AAAA,IACT,CAAC;AACD,WAAO;AAAA,EACT;AAAA,EAEA,aAAa;AAEX,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,OAAO,WAAW,IAAI,UAAU,CAAA,GAAI;AAClC,WAAO,kBAAkB,OAAO;AAAA,MAC9B,QAAQ,KAAK;AAAA,MACb,UAAU,KAAK;AAAA,MACf,YAAY,KAAK;AAAA,MACjB;AAAA,MACA;AAAA,IACN,CAAK;AAAA,EACH;AACF;ACtJO,MAAM,QAAQ;AAAA,EACnB,YAAY,EAAE,QAAQ,QAAQ,UAAU,CAAA,EAAE,GAAI;AAC5C,SAAK,SAAS;AACd,SAAK,SAAS;AACd,SAAK,UAAU;AACf,SAAK,cAAc,oBAAI,IAAG;AAG1B,UAAM,gBAAgB,oBAAI,IAAI;AAAA,MAC5B;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACN,CAAK;AAED,SAAK,eAAe;AAEpB,WAAO,IAAI,MAAM,MAAM;AAAA,MACrB,KAAK,CAAC,QAAQ,MAAM,aAAa;AAC/B,YAAI,QAAQ,OAAQ,QAAO,QAAQ,IAAI,QAAQ,MAAM,QAAQ;AAC7D,YAAI,OAAO,SAAS,YAAY,OAAO,IAAI,EAAE,WAAW,GAAG,EAAG,QAAO;AAErE,YAAI,cAAc,IAAI,IAAI,GAAG;AAE3B,cAAI,SAAS,oBAAoB;AAC/B,mBAAO,IAAI,SAAS;AAClB,oBAAM,WAAW,KAAK,CAAC;AACvB,qBAAO,WAAW,UAAU,QAAQ;AACpC,qBAAO,OAAO,MAAM,OAAO,IAAI,GAAG,IAAI;AAAA,YACxC;AAAA,UACF;AACA,cAAI,SAAS,kBAAkB;AAC7B,mBAAO,IAAI,SAAS;AAClB,oBAAM,WAAW,KAAK,CAAC;AACvB,qBAAO,YAAY,OAAO,QAAQ;AAClC,qBAAO,OAAO,MAAM,OAAO,IAAI,GAAG,IAAI;AAAA,YACxC;AAAA,UACF;AACA,cAAI,SAAS,gBAAgB;AAC3B,mBAAO,IAAI,SAAS;AAClB,qBAAO,YAAY;AACnB,qBAAO,OAAO,MAAM,OAAO,IAAI,GAAG,IAAI;AAAA,YACxC;AAAA,UACF;AACA,cAAI,SAAS,SAAS;AACpB,mBAAO,IAAI,SAAS,OAAO,OAAO,GAAG,IAAI;AAAA,UAC3C;AACA,iBAAO,IAAI,SAAS,OAAO,MAAM,OAAO,IAAI,GAAG,IAAI;AAAA,QACrD;AAGA,eAAO,OAAO,WAAW,MAAM,QAAQ;AAAA,MACzC;AAAA,IACN,CAAK;AAAA,EACH;AAAA,EAEA,WAAW,MAAM,SAAS;AACxB,QAAI,KAAK,YAAY,IAAI,IAAI,EAAG,QAAO,KAAK,YAAY,IAAI,IAAI;AAChE,UAAM,MAAM,IAAI,gBAAgB;AAAA,MAC9B,QAAQ,KAAK;AAAA,MACb;AAAA,MACA,QAAQ,KAAK;AAAA,MACb,IAAI,WAAW;AAAA;AAAA,IACrB,CAAK;AACD,SAAK,YAAY,IAAI,MAAM,GAAG;AAC9B,WAAO;AAAA,EACT;AAAA,EAEA,qBAAqB;AAEnB,WAAO,MAAM,KAAK,KAAK,YAAY,KAAI,CAAE;AAAA,EAC3C;AAAA,EAEA,MAAM,QAAQ;AAEZ,WAAO;AAAA,EACT;AAAA;AAAA,EAGA,MAAM,QAAQ,OAAO,IAAI;AACvB,UAAM,UAAU,KAAK,OAAO,YAAY;AAAA,MACtC,QAAQ;AAAA,MACR,UAAU,KAAK;AAAA,MACf;AAAA,MACA;AAAA,IACN,CAAK,EAAE,KAAK,CAAC,QAAQ;AAIf,UAAI,OAAO,IAAI,UAAU;AACvB,eAAO,kBAAkB,OAAO;AAAA,UAC9B,QAAQ,KAAK;AAAA,UACb,UAAU,KAAK;AAAA,UACf,YAAY;AAAA,UACZ,UAAU,IAAI;AAAA,QACxB,CAAS;AAAA,MACH;AACA,aAAO;AAAA,IACT,CAAC;AACD,WAAO;AAAA,EACT;AAAA,EAEA,OAAO,WAAW,IAAI,UAAU,CAAA,GAAI;AAClC,WAAO,kBAAkB,OAAO;AAAA,MAC9B,QAAQ,KAAK;AAAA,MACb,UAAU,KAAK;AAAA,MACf,YAAY;AAAA,MACZ;AAAA,MACA;AAAA,IACN,CAAK;AAAA,EACH;AACF;ACrHO,MAAM,oBAAoBA,cAAAA,aAAa;AAAA,EAC5C,YAAY,MAAM,6BAA6B,UAAU,CAAA,GAAI;AAC3D;AACA,SAAK,MAAM;AACX,SAAK,UAAU,OAAO,OAAO,EAAE,GAAG,QAAO,CAAE;AAC3C,SAAK,eAAe;AACpB,SAAK,aAAa,KAAK,oBAAoB,GAAG;AAC9C,SAAK,aAAa,oBAAI;AAGtB,QAAI,CAAC,QAAQ,cAAc;AACzB,YAAM,IAAI,MAAM,uFAAuF;AAAA,IACzG;AAEA,SAAK,UAAU,QAAQ;AACvB,SAAK,cAAc;AAAA,EACrB;AAAA,EAEA,aAAa,QAAQ,KAAK,UAAU,IAAI;AACtC,UAAM,SAAS,IAAI,YAAY,KAAK,OAAO;AAC3C,UAAM,OAAO;AACb,WAAO;AAAA,EACT;AAAA,EAEA,MAAM,UAAU;AACd,QAAI,KAAK,aAAc,QAAO;AAC9B,SAAK,eAAe;AACpB,SAAK,KAAK,QAAQ,IAAI;AACtB,WAAO;AAAA,EACT;AAAA;AAAA,EAGA,GAAG,MAAM,OAAO,IAAI;AAElB,UAAM,SAAS,QAAQ,KAAK;AAC5B,QAAI,CAAC,QAAQ;AACX,YAAM,IAAI,MAAM,+DAA+D;AAAA,IACjF;AAGA,QAAI,KAAK,WAAW,IAAI,MAAM,GAAG;AAC/B,aAAO,KAAK,WAAW,IAAI,MAAM;AAAA,IACnC;AAGA,UAAM,WAAW,IAAI,QAAQ;AAAA,MAC3B;AAAA,MACA,QAAQ,KAAK;AAAA,MACb,SAAS,EAAE,GAAG,KAAK,SAAS,GAAG,KAAI;AAAA,IACzC,CAAK;AAED,SAAK,WAAW,IAAI,QAAQ,QAAQ;AACpC,WAAO;AAAA,EACT;AAAA,EAEA,MAAM,QAAQ;AACZ,QAAI,KAAK,WAAW,KAAK,aAAa;AAEpC,YAAM,KAAK,QAAQ;AACnB,WAAK,UAAU;AAAA,IACjB;AACA,SAAK,eAAe;AACpB,SAAK,KAAK,OAAO;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA+CA,MAAM,MAAM,QAAQ,OAAO;AACzB,QAAI,CAAC,KAAK,aAAc;AAGxB,eAAW,CAAC,GAAG,QAAQ,KAAK,KAAK,YAAY;AAC3C,YAAM,SAAS;IACjB;AACA,SAAK,WAAW;AAEhB,SAAK,eAAe;AACpB,SAAK,KAAK,OAAO;AAAA,EACnB;AAAA;AAAA,EAGA,aAAa,UAAU,IAAI;AAEzB,WAAO;AAAA,MACL,IAAI,OAAO,WAAU;AAAA,MACrB,YAAY,MAAM;AAAA,MAAC;AAAA,MACnB,iBAAiB,OAAO,OAAO,MAAM,GAAG,IAAI;AAAA,IAClD;AAAA,EACE;AAAA,EAEA,MAAM,YAAY,mBAAmB,UAAU;AAC7C,UAAM,UAAU,KAAK;AAAA,MACnB,OAAO,sBAAsB,aAAa,CAAA,IAAK;AAAA,IACrD;AACI,UAAM,KAAK,OAAO,sBAAsB,aAAa,oBAAoB;AAEzE,QAAI;AACF,aAAO,MAAM,GAAG,OAAO;AAAA,IACzB,UAAC;AACC,cAAQ,WAAU;AAAA,IACpB;AAAA,EACF;AAAA;AAAA,EAGA,IAAI,cAAc;AAAE,WAAO,KAAK,QAAQ;AAAA,EAAa;AAAA,EACrD,IAAI,eAAe;AAAE,WAAO,KAAK,QAAQ;AAAA,EAAc;AAAA,EACvD,IAAI,iBAAiB;AAAE,WAAO,KAAK,QAAQ;AAAA,EAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQ3D,MAAM,WAAW,IAAI,UAAU,CAAA,GAAI;AACjC,WAAO,kBAAkB,OAAO;AAAA,MAC9B,QAAQ,KAAK;AAAA,MACb,UAAU;AAAA;AAAA,MACV,YAAY;AAAA,MACZ;AAAA,MACA;AAAA,IACN,CAAK;AAAA,EACH;AAAA,EAEA,oBAAoB,KAAK;AAEvB,UAAM,QAAQ,IAAI,MAAM,YAAY;AACpC,WAAO,QAAQ,MAAM,CAAC,IAAI;AAAA,EAC5B;AAAA,EAEA,gBAAgB,KAAK;AAGnB,UAAM,SAAS,CAAA;AACf,UAAM,aAAa,IAAI,QAAQ,GAAG;AAClC,QAAI,eAAe,GAAI,QAAO;AAE9B,UAAM,cAAc,IAAI,UAAU,aAAa,CAAC;AAChD,UAAM,QAAQ,YAAY,MAAM,GAAG;AACnC,eAAW,QAAQ,OAAO;AACxB,YAAM,CAAC,KAAK,KAAK,IAAI,KAAK,MAAM,GAAG;AACnC,UAAI,KAAK;AAEP,YAAI,UAAU,OAAQ,QAAO,GAAG,IAAI;AAAA,iBAC3B,UAAU,QAAS,QAAO,GAAG,IAAI;AAAA,iBACjC,CAAC,MAAM,KAAK,EAAG,QAAO,GAAG,IAAI,OAAO,KAAK;AAAA,YAC7C,QAAO,GAAG,IAAI,mBAAmB,SAAS,EAAE;AAAA,MACnD;AAAA,IACF;AACA,WAAO;AAAA,EACT;AACF;AC3KA,MAAM,SAAS;AAAA,EACb,YAAY,IAAI;AACd,QAAI,OAAO,UAAa,OAAO,MAAM;AAEnC,WAAK,KAAK,SAAS,SAAQ;AAAA,IAC7B,WAAW,OAAO,OAAO,UAAU;AAEjC,UAAI,CAAC,SAAS,QAAQ,EAAE,GAAG;AACzB,cAAM,IAAI,MAAM,kEAAkE,EAAE,EAAE;AAAA,MACxF;AACA,WAAK,KAAK,GAAG,YAAW;AAAA,IAC1B,WAAW,cAAc,cAAc,GAAG,WAAW,IAAI;AACvD,WAAK,KAAK,MAAM,KAAK,EAAE,EAAE,IAAI,OAAK,EAAE,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG,CAAC,EAAE,KAAK,EAAE;AAAA,IAC5E,WAAW,cAAc,UAAU;AAEjC,WAAK,KAAK,GAAG;AAAA,IACf,OAAO;AACL,YAAM,IAAI,MAAM,yEAAyE;AAAA,IAC3F;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW;AACT,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc;AACZ,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe;AACb,UAAM,YAAY,SAAS,KAAK,GAAG,UAAU,GAAG,CAAC,GAAG,EAAE;AACtD,WAAO,IAAI,KAAK,YAAY,GAAI;AAAA,EAClC;AAAA,EAEA,OAAO,OAAO;AACZ,QAAI,EAAE,iBAAiB,WAAW;AAChC,YAAM,IAAI,MAAM,wCAAwC;AAAA,IAC1D;AACA,WAAO,KAAK,OAAO,MAAM;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ,OAAO;AACb,QAAI,EAAE,iBAAiB,WAAW;AAChC,YAAM,IAAI,MAAM,wCAAwC;AAAA,IAC1D;AAEA,WAAO,KAAK,GAAG,cAAc,MAAM,EAAE;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS;AACP,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU;AACR,WAAO,aAAa,KAAK,EAAE;AAAA,EAC7B;AAAA,EAEA,UAAU;AACR,UAAM,QAAQ,IAAI,WAAW,EAAE;AAC/B,aAAS,IAAI,GAAG,IAAI,IAAI,KAAK;AAC3B,YAAM,CAAC,IAAI,SAAS,KAAK,GAAG,UAAU,IAAI,GAAG,IAAI,IAAI,CAAC,GAAG,EAAE;AAAA,IAC7D;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,QAAQ,IAAI;AACjB,QAAI,CAAC,GAAI,QAAO;AAChB,QAAI,OAAO,OAAO,SAAU,QAAO;AACnC,QAAI,GAAG,WAAW,GAAI,QAAO;AAC7B,WAAO,oBAAoB,KAAK,EAAE;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,eAAe,WAAW;AAC/B,UAAM,KAAK,KAAK,MAAM,YAAY,GAAI;AACtC,UAAM,SAAS,aAAa,GAAG,SAAS,EAAE,GAAG,MAAM,EAAE;AACrD,UAAM,OAAO;AACb,WAAO,IAAI,SAAS,QAAQ,IAAI;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAO,WAAW;AAChB,UAAM,KAAK,KAAK,MAAM,KAAK,IAAG,IAAK,GAAI;AAGvC,UAAM,OAAO,OAAO,WAAW,eAAe,OAAO,kBAAkB,IAAI,WAAW,CAAC,IAAI;AAC3F,QAAI,OAAO;AAEX,QAAI,MAAM;AACR,aAAO,gBAAgB,IAAI;AAC3B,eAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACpC,iBAAS,MAAM,KAAK,CAAC,EAAE,SAAS,EAAE,GAAG,MAAM,EAAE;AAAA,MAC/C;AAAA,IACF,OAAO;AAGL,aAAO,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,MAAM,CAAC,EAAE,OAAO,GAAG,GAAG,EAAE,MAAM,GAAG,CAAC,IAC7D,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,MAAM,CAAC,EAAE,OAAO,GAAG,GAAG,EAAE,MAAM,GAAG,CAAC;AAAA,IACtE;AAEA,UAAM,SAAS,aAAa,GAAG,SAAS,EAAE,GAAG,MAAM,EAAE;AACrD,YAAQ,QAAQ,MAAM,MAAM,GAAG,EAAE;AAAA,EACnC;AACF;ACnJA,SAASC,cAAY,GAAG,GAAG;AAE1B,MAAI,aAAa,YAAY,aAAa,UAAU;AACnD,QAAI,aAAa,YAAY,aAAa,UAAU;AACnD,aAAO,EAAE,OAAO,CAAC;AAAA,IAClB;AACA,QAAI,aAAa,YAAY,OAAO,MAAM,UAAU;AACnD,aAAO,EAAE,OAAO,CAAC;AAAA,IAClB;AACA,QAAI,aAAa,YAAY,OAAO,MAAM,UAAU;AACnD,aAAO,EAAE,OAAO,CAAC;AAAA,IAClB;AACA,WAAO;AAAA,EACR;AAGA,SAAO,KAAK;AACb;AAwBO,SAAS,QAAQ,KAAK,MAAM;AAClC,MAAI,OAAO,KAAK,MAAM,GAAG;AACzB,MAAI,SAAS,IAAI,KAAK,CAAC,CAAC;AACxB,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACrC,QAAI,UAAU,UAAa,UAAU,KAAM,QAAO;AAGlD,QAAI,cAAc,KAAK,CAAC;AACxB,QAAI,eAAe,SAAS,aAAa,EAAE;AAG3C,QAAI,QAAQ,MAAM,KAAK,CAAC,MAAM,YAAY,KAAK,gBAAgB,KAAK,eAAe,OAAO,QAAQ;AACjG,eAAS,OAAO,YAAY;AAAA,IAC7B,OAAO;AACN,eAAS,OAAO,WAAW;AAAA,IAC5B;AAAA,EACD;AACA,SAAO;AACR;AAWO,SAAS,eAAe,KAAK,MAAM;AACzC,MAAI,OAAO,KAAK,MAAM,GAAG;AACzB,MAAI,UAAU,CAAC,GAAG;AAElB,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACrC,QAAI,cAAc,KAAK,CAAC;AACxB,QAAI,eAAe,SAAS,aAAa,EAAE;AAC3C,QAAI,aAAa,CAAA;AAEjB,aAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACxC,UAAI,UAAU,QAAQ,CAAC;AACvB,UAAI,WAAW,UAAa,WAAW,KAAM;AAG7C,UAAI,QAAQ,OAAO,KAAK,CAAC,MAAM,YAAY,KAAK,gBAAgB,GAAG;AAClE,YAAI,eAAe,QAAQ,QAAQ;AAClC,qBAAW,KAAK,QAAQ,YAAY,CAAC;AAAA,QACtC;AAAA,MACD,WAES,QAAQ,OAAO,GAAG;AAC1B,iBAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACxC,cAAI,QAAQ,CAAC,KAAK,UAAa,QAAQ,CAAC,KAAK,QAAQ,OAAO,QAAQ,CAAC,MAAM,UAAU;AACpF,uBAAW,KAAK,QAAQ,CAAC,EAAE,WAAW,CAAC;AAAA,UACxC;AAAA,QACD;AAAA,MACD,WAES,OAAO,YAAY,UAAU;AACrC,mBAAW,KAAK,QAAQ,WAAW,CAAC;AAAA,MACrC;AAAA,IACD;AAEA,cAAU;AAAA,EACX;AAGA,YAAU,QAAQ,OAAO,SAAS,GAAG;AAAE,WAAO,MAAM;AAAA,EAAW,CAAC;AAKhE,MAAI,QAAQ,WAAW,EAAG,QAAO;AACjC,MAAI,QAAQ,WAAW,EAAG,QAAO,QAAQ,CAAC;AAC1C,SAAO;AACR;AAoIO,SAAS,QAAQ,GAAG;AAC1B,SAAO,SAAS,EAAE;AACnB;AAKO,SAAS,QAAQ,KAAK;AAC5B,MAAI,MAAM,CAAA;AACV,WAAS,OAAO,KAAK;AACpB,QAAI,IAAI,eAAe,GAAG,GAAG;AAC5B,UAAI,KAAK,CAAA;AACT,SAAG,GAAG,IAAI,IAAI,GAAG;AACjB,UAAI,KAAK,EAAE;AAAA,IACZ;AAAA,EACD;AACA,SAAO;AACR;AAKO,SAAS,KAAK,KAAK,QAAQ;AACjC,WAAS,IAAI,GAAG,IAAI,OAAO,QAAQ,KAAK;AACvC,QAAIA,cAAY,OAAO,CAAC,GAAG,GAAG,EAAG,QAAO;AAAA,EACzC;AACA,SAAO;AACR;AAKO,SAAS,aAAa,GAAG,GAAG;AAClC,MAAI,EAAE,UAAU,EAAE,OAAQ,QAAO;AACjC,WAAS,IAAI,GAAG,IAAI,EAAE,QAAQ,KAAK;AAClC,QAAIA,cAAY,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,EAAG;AAC7B,QAAI,OAAQ,EAAE,CAAC,KAAM,OAAQ,EAAE,CAAC,EAAI,QAAO;AAC3C,QAAI,OAAQ,EAAE,CAAC,KAAM,YAAY,EAAE,CAAC,MAAM,MAAM;AAC/C,UAAI,QAAQ,EAAE,CAAC,CAAC,GAAG;AAClB,YAAI,CAAC,aAAa,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,EAAG,QAAO;AAAA,MACvC,OAAO;AACN,YAAI,CAAC,cAAc,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,EAAG,QAAO;AAAA,MACxC;AAAA,IACD,OAAO;AACN,UAAI,CAACA,cAAY,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,EAAG,QAAO;AAAA,IACtC;AAAA,EACD;AACA,SAAO;AACR;AAKO,SAAS,cAAc,GAAG,GAAG;AACnC,WAAS,KAAK,GAAG;AAChB,QAAI,CAAC,EAAE,eAAe,CAAC,EAAG;AAC1B,QAAI,CAAC,EAAE,eAAe,CAAC,EAAG,QAAO;AACjC,QAAIA,cAAY,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,EAAG;AAC7B,QAAI,OAAQ,EAAE,CAAC,KAAM,OAAQ,EAAE,CAAC,EAAI,QAAO;AAC3C,QAAI,OAAQ,EAAE,CAAC,KAAM,YAAY,EAAE,CAAC,MAAM,MAAM;AAC/C,UAAI,QAAQ,EAAE,CAAC,CAAC,GAAG;AAClB,YAAI,CAAC,aAAa,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,EAAG,QAAO;AAAA,MACvC,OAAO;AACN,YAAI,CAAC,cAAc,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,EAAG,QAAO;AAAA,MACxC;AAAA,IACD,OAAO;AACN,UAAI,CAACA,cAAY,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,EAAG,QAAO;AAAA,IACtC;AAAA,EACD;AACA,WAAS,KAAK,GAAG;AAChB,QAAI,EAAE,eAAe,CAAC,KAAK,CAAC,EAAE,eAAe,CAAC,EAAG,QAAO;AAAA,EACzD;AACA,SAAO;AACR;ACvUA,MAAM,YAAY;AAAA,EAChB,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,KAAK;AAAA,EACL,MAAM;AAAA,EACN,OAAO;AAAA,EACP,KAAK;AAAA,EACL,OAAO;AAAA,EACP,SAAS;AAAA,EACT,OAAO;AAAA,EACP,MAAM;AAAA,EACN,OAAO;AAAA,EACP,SAAS;AAAA,EACT,SAAS;AAAA,EACT,SAAS;AAAA,EACT,OAAO;AAAA,EACP,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,MAAM;AACR;AAGA,MAAM,YAAY;AAAA,EAChB,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,MAAM;AAAA,EACN,KAAK;AAAA,EACL,MAAM;AACR;AAGA,MAAM,YAAY;AAClB,MAAM,QAAQ;AACd,MAAM,aAAa,MAAM,YAAY;AACrC,MAAM,SAAS,MAAM,QAAQ;AAE7B,MAAM,MAAM,IAAI,OAAO,MAAM,aAAa,MAAM,SAAS,UAAU;AACnE,MAAM,MAAM,IAAI;AAAA,EACd,MAAM,aAAa,MAAM,SAAS,aAAa,SAAS;AAC1D;AACA,MAAM,MAAM,IAAI,OAAO,MAAM,aAAa,OAAO,SAAS,aAAa,OAAO;AAC9E,MAAM,cAAc,IAAI,OAAO,MAAM,aAAa,MAAM,KAAK;AAC7D,MAAM,gBAAgB,IAAI,OAAO,MAAM,aAAa,QAAQ,cAAc;AAG1E,MAAM,QAAQ;AACd,MAAM,OAAO;AACb,MAAM,OAAO;AACb,MAAM,SAAS;AACf,MAAM,aAAa;AACnB,MAAM,gBAAgB;AACtB,MAAM,SAAS;AACf,MAAM,OAAO;AACb,MAAM,eAAe;AACrB,MAAM,wBAAwB;AAC9B,MAAM,QACJ;AACF,MAAM,QAAQ;AACd,MAAM,QACJ;AAWK,SAAS,QAAQ,OAAO;AAC7B,MAAI,SAAS,OAAO,KAAK,EAAE,YAAW;AAGtC,MAAI,OAAO,SAAS,GAAG;AACrB,WAAO;AAAA,EACT;AAGA,MAAI,8BAA8B;AAGlC,MACE,OAAO,YAAY,CAAC,MAAM,KAC1B;AACA,kCAA8B;AAC9B,aAAS,MAAM,OAAO,MAAM,CAAC;AAAA,EAC/B;AAGA,MAAI,aAAa,KAAK,MAAM,GAAG;AAE7B,aAAS,OAAO,MAAM,GAAG,EAAE;AAAA,EAC7B,WAAW,KAAK,KAAK,MAAM,GAAG;AAE5B,aAAS,OAAO,MAAM,GAAG,EAAE;AAAA,EAC7B;AAGA,MAAI;AAGJ,MAAK,QAAQ,OAAO,KAAK,MAAM,GAAI;AACjC,QAAI,IAAI,KAAK,MAAM,CAAC,CAAC,GAAG;AAEtB,eAAS,OAAO,MAAM,GAAG,EAAE;AAAA,IAC7B;AAAA,EACF,YAAY,QAAQ,WAAW,KAAK,MAAM,MAAM,YAAY,KAAK,MAAM,CAAC,CAAC,GAAG;AAC1E,aAAS,MAAM,CAAC;AAEhB,QAAI,cAAc,KAAK,MAAM,GAAG;AAE9B,gBAAU;AAAA,IACZ,WAAW,sBAAsB,KAAK,MAAM,GAAG;AAE7C,eAAS,OAAO,MAAM,GAAG,EAAE;AAAA,IAC7B,WAAW,cAAc,KAAK,MAAM,GAAG;AAErC,gBAAU;AAAA,IACZ;AAAA,EACF;AAGA,OAAK,QAAQ,KAAK,KAAK,MAAM,MAAM,YAAY,KAAK,MAAM,CAAC,CAAC,GAAG;AAE7D,aAAS,MAAM,CAAC,IAAI;AAAA,EACtB;AAGA,OAAK,QAAQ,MAAM,KAAK,MAAM,MAAM,IAAI,KAAK,MAAM,CAAC,CAAC,GAAG;AACtD,aAAS,MAAM,CAAC,IAAI,UAAU,MAAM,CAAC,CAAC;AAAA,EACxC;AAGA,OAAK,QAAQ,MAAM,KAAK,MAAM,MAAM,IAAI,KAAK,MAAM,CAAC,CAAC,GAAG;AACtD,aAAS,MAAM,CAAC,IAAI,UAAU,MAAM,CAAC,CAAC;AAAA,EACxC;AAGA,MAAK,QAAQ,MAAM,KAAK,MAAM,GAAI;AAChC,QAAI,IAAI,KAAK,MAAM,CAAC,CAAC,GAAG;AACtB,eAAS,MAAM,CAAC;AAAA,IAClB;AAAA,EACF,YAAY,QAAQ,OAAO,KAAK,MAAM,MAAM,IAAI,KAAK,MAAM,CAAC,CAAC,GAAG;AAC9D,aAAS,MAAM,CAAC;AAAA,EAClB;AAGA,OACG,QAAQ,KAAK,KAAK,MAAM,OACxB,IAAI,KAAK,MAAM,CAAC,CAAC,KACf,IAAI,KAAK,MAAM,CAAC,CAAC,KAAK,CAAC,cAAc,KAAK,MAAM,CAAC,CAAC,IACrD;AACA,aAAS,MAAM,CAAC;AAAA,EAClB;AAEA,MAAI,MAAM,KAAK,MAAM,KAAK,IAAI,KAAK,MAAM,GAAG;AAC1C,aAAS,OAAO,MAAM,GAAG,EAAE;AAAA,EAC7B;AAGA,MAAI,6BAA6B;AAC/B,aAAS,MAAM,OAAO,MAAM,CAAC;AAAA,EAC/B;AAEA,SAAO;AACT;ACxKA,MAAM,YAAY,oBAAI,IAAI;AAAA,EACxB;AAAA,EAAK;AAAA,EAAS;AAAA,EAAS;AAAA,EAAO;AAAA,EAAQ;AAAA,EAAM;AAAA,EAAM;AAAA,EAAO;AAAA,EAAW;AAAA,EAAO;AAAA,EAC3E;AAAA,EAAU;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAW;AAAA,EAAQ;AAAA,EAAU;AAAA,EAAS;AAAA,EAAW;AAAA,EAC7E;AAAA,EAAO;AAAA,EAAM;AAAA,EAAQ;AAAA,EAAO;AAAA,EAAQ;AAAA,EAAS;AAAA,EAAO;AAAA,EAAM;AAAA,EAAQ;AAAA,EAAO;AAAA,EACzE;AAAA,EAAO;AAAA,EAAO;AAAA,EAAO;AAAA,EAAO;AAAA,EAAM;AAAA,EAAQ;AAAA,EAAO;AAAA,EAAQ;AAAA,EAAO;AAAA,EAAW;AAAA,EAC3E;AAAA,EAAO;AAAA,EAAK;AAAA,EAAM;AAAA,EAAM;AAAA,EAAQ;AAAA,EAAM;AAAA,EAAM;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAM;AAAA,EAC1E;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAM;AAAA,EAAS;AAAA,EAAO;AAAA,EAAM;AAAA,EAAM;AAAA,EAAQ;AAAA,EAC1E;AAAA,EAAS;AAAA,EAAO;AAAA,EAAO;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAO;AAAA,EAAU;AAAA,EAAS;AAAA,EACzE;AAAA,EAAS;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAO;AAAA,EAAS;AAAA,EAAQ;AAAA,EAAQ;AAAA,EACzE;AAAA,EAAS;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAS;AAAA,EAAW;AAAA,EAAM;AAAA,EAAO;AAAA,EAAS;AAAA,EAAM;AAAA,EACzE;AAAA,EAAO;AAAA,EAAO;AAAA,EAAM;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACvE;AAAA,EAAQ;AAAA,EAAS;AAAA,EAAO;AAC1B,CAAC;AAOM,SAAS,SAASC,OAAM;AAC7B,MAAI,OAAOA,UAAS,UAAU;AAC5B,WAAO,CAAA;AAAA,EACT;AAEA,QAAM,QAAQA,MAAK,YAAW,EAC3B,MAAM,KAAK,EACX,OAAO,UAAQ,KAAK,SAAS,CAAC;AAGjC,SAAO,MAAM,OAAO,UAAQ,CAAC,UAAU,IAAI,IAAI,CAAC;AAClD;ACpBO,SAAS,mBAAmB,MAAM,KAAK;AAE7C,MAAI,SAAS,QAAQ,SAAS,QAAW;AACxC,WAAO;AAAA,EACR;AAEA,MAAI,OAAO,SAAS,aAAa,OAAO,SAAS,UAAU;AAC1D,WAAO;AAAA,EACR;AAGA,MAAI,OAAO,SAAS,UAAU;AAC7B,QAAI,KAAK,WAAW,IAAI,GAAG;AAE1B,UAAI,SAAS,YAAY,SAAS,aAAa,SAAS,aAAa;AACpE,eAAO;AAAA,MACR;AAEA,aAAO,QAAQ,KAAK,KAAK,UAAU,CAAC,CAAC;AAAA,IACtC,WAAW,KAAK,OAAO,CAAC,MAAM,KAAK;AAElC,aAAO,QAAQ,KAAK,KAAK,UAAU,CAAC,CAAC;AAAA,IACtC;AACA,WAAO;AAAA,EACR;AAGA,MAAI,OAAO,SAAS,UAAU;AAE7B,QAAI,MAAM,QAAQ,IAAI,GAAG;AACxB,aAAO,KAAK,IAAI,UAAQ,mBAAmB,MAAM,GAAG,CAAC;AAAA,IACtD;AAGA,UAAM,OAAO,OAAO,KAAK,IAAI;AAC7B,QAAI,KAAK,WAAW,GAAG;AACtB,aAAO;AAAA,IACR;AAEA,UAAM,WAAW,KAAK,CAAC;AAGvB,QAAI,SAAS,OAAO,CAAC,MAAM,KAAK;AAE/B,YAAM,UAAU,KAAK,QAAQ;AAC7B,aAAO,iBAAiB,UAAU,SAAS,GAAG;AAAA,IAC/C,OAAO;AAEN,YAAM,SAAS,CAAA;AACf,iBAAW,OAAO,MAAM;AACvB,eAAO,GAAG,IAAI,mBAAmB,KAAK,GAAG,GAAG,GAAG;AAAA,MAChD;AACA,aAAO;AAAA,IACR;AAAA,EACD;AAEA,SAAO;AACR;AAKA,SAAS,iBAAiB,UAAU,SAAS,KAAK;AACjD,UAAQ,UAAQ;AAAA;AAAA,IAEf,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA,IACxC,KAAK;AAAa,aAAO,aAAa,SAAS,GAAG;AAAA,IAClD,KAAK;AAAa,aAAO,aAAa,SAAS,GAAG;AAAA,IAClD,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA,IAC9C,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA,IACxC,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA,IACxC,KAAK;AAAS,aAAO,SAAS,SAAS,GAAG;AAAA,IAC1C,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA,IACxC,KAAK;AAAS,aAAO,SAAS,SAAS,GAAG;AAAA,IAC1C,KAAK;AAAU,aAAO,UAAU,SAAS,GAAG;AAAA,IAC5C,KAAK;AAAU,aAAO,UAAU,SAAS,GAAG;AAAA,IAC5C,KAAK;AAAU,aAAO,UAAU,SAAS,GAAG;AAAA;AAAA,IAG5C,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA,IAC9C,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA,IAC9C,KAAK;AAAY,aAAO,YAAY,SAAS,GAAG;AAAA,IAChD,KAAK;AAAY,aAAO,YAAY,SAAS,GAAG;AAAA,IAChD,KAAK;AAAS,aAAO,SAAS,SAAS,GAAG;AAAA,IAC1C,KAAK;AAAU,aAAO,UAAU,SAAS,GAAG;AAAA,IAC5C,KAAK;AAAU,aAAO,UAAU,SAAS,GAAG;AAAA,IAC5C,KAAK;AAAU,aAAO,UAAU,SAAS,GAAG;AAAA,IAC5C,KAAK;AAAa,aAAO,aAAa,SAAS,GAAG;AAAA,IAClD,KAAK;AAAe,aAAO,eAAe,SAAS,GAAG;AAAA,IACtD,KAAK;AAAc,aAAO,cAAc,SAAS,GAAG;AAAA,IACpD,KAAK;AAAe,aAAO,eAAe,SAAS,GAAG;AAAA,IACtD,KAAK;AAAe,aAAO,eAAe,SAAS,GAAG;AAAA;AAAA,IAGtD,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA,IACxC,KAAK;AAAO,aAAO,OAAO,SAAS,GAAG;AAAA,IACtC,KAAK;AAAO,aAAO,OAAO,SAAS,GAAG;AAAA,IACtC,KAAK;AAAO,aAAO,OAAO,SAAS,GAAG;AAAA,IACtC,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA,IACxC,KAAK;AAAO,aAAO,OAAO,SAAS,GAAG;AAAA,IACtC,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA;AAAA,IAGxC,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA,IACxC,KAAK;AAAO,aAAO,OAAO,SAAS,GAAG;AAAA,IACtC,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA;AAAA,IAGxC,KAAK;AAAS,aAAO,SAAS,SAAS,GAAG;AAAA,IAC1C,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA,IAC9C,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA;AAAA,IAG9C,KAAK;AAAS,aAAO,SAAS,SAAS,GAAG;AAAA,IAC1C,KAAK;AAAU,aAAO,UAAU,SAAS,GAAG;AAAA,IAC5C,KAAK;AAAe,aAAO,eAAe,SAAS,GAAG;AAAA,IACtD,KAAK;AAAc,aAAO,cAAc,SAAS,GAAG;AAAA,IACpD,KAAK;AAAc,aAAO,cAAc,SAAS,GAAG;AAAA,IACpD,KAAK;AAAS,aAAO,SAAS,SAAS,GAAG;AAAA,IAC1C,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA,IAC9C,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA,IAC9C,KAAK;AAAgB,aAAO,gBAAgB,SAAS,GAAG;AAAA,IACxD,KAAK;AAAS,aAAO,SAAS,SAAS,GAAG;AAAA,IAC1C,KAAK;AAAY,aAAO,YAAY,SAAS,GAAG;AAAA,IAChD,KAAK;AAAgB,aAAO,gBAAgB,SAAS,GAAG;AAAA,IACxD,KAAK;AAAiB,aAAO,iBAAiB,SAAS,GAAG;AAAA,IAC1D,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA;AAAA,IAG9C,KAAK;AAAgB,aAAO,gBAAgB,SAAS,GAAG;AAAA,IACxD,KAAK;AAAiB,aAAO,iBAAiB,SAAS,GAAG;AAAA,IAC1D,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA,IAC9C,KAAK;AAAO,aAAO,OAAO,SAAS,GAAG;AAAA,IACtC,KAAK;AAAiB,aAAO,iBAAiB,SAAS,GAAG;AAAA,IAC1D,KAAK;AAAY,aAAO,YAAY,SAAS,GAAG;AAAA,IAChD,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA,IACxC,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA,IAC9C,KAAK;AAAS,aAAO,SAAS,SAAS,GAAG;AAAA,IAC1C,KAAK;AAAU,aAAO,UAAU,SAAS,GAAG;AAAA,IAC5C,KAAK;AAAiB,aAAO,iBAAiB,SAAS,GAAG;AAAA,IAC1D,KAAK;AAAQ,aAAO,QAAQ,SAAS,GAAG;AAAA;AAAA,IAGxC,KAAK;AAAS,aAAO,SAAS,SAAS,GAAG;AAAA,IAC1C,KAAK;AAAY,aAAO,YAAY,SAAS,GAAG;AAAA,IAChD,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA,IAC9C,KAAK;AAAc,aAAO,cAAc,SAAS,GAAG;AAAA,IACpD,KAAK;AAAa,aAAO,aAAa,SAAS,GAAG;AAAA,IAClD,KAAK;AAAU,aAAO,UAAU,SAAS,GAAG;AAAA,IAC5C,KAAK;AAAW,aAAO,WAAW,SAAS,GAAG;AAAA,IAC9C,KAAK;AAAa,aAAO,aAAa,SAAS,GAAG;AAAA;AAAA,IAGlD,KAAK;AAAkB,aAAO,kBAAkB,SAAS,GAAG;AAAA,IAC5D,KAAK;AAAkB,aAAO,kBAAkB,SAAS,GAAG;AAAA,IAC5D,KAAK;AAAiB,aAAO,iBAAiB,SAAS,GAAG;AAAA;AAAA,IAG1D,KAAK;AAAY,aAAO;AAAA,IAExB;AACC,YAAM,IAAI,MAAM,qCAAqC,QAAQ,EAAE;AAAA,EAClE;AACA;AAMA,SAAS,QAAQ,UAAU,KAAK;AAC/B,MAAI,CAAC,MAAM,QAAQ,QAAQ,EAAG,QAAO;AACrC,MAAI,MAAM;AACV,aAAW,WAAW,UAAU;AAC/B,UAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,QAAI,eAAe,MAAM;AACxB,aAAO,IAAI,QAAO;AAAA,IACnB,WAAW,OAAO,QAAQ,UAAU;AACnC,aAAO;AAAA,IACR;AAAA,EACD;AACA,SAAO;AACR;AAEA,SAAS,aAAa,UAAU,KAAK;AACpC,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAEhD,MAAI,gBAAgB,QAAQ,gBAAgB,MAAM;AACjD,WAAO,KAAK,YAAY,KAAK,QAAO;AAAA,EACrC,WAAW,gBAAgB,QAAQ,OAAO,SAAS,UAAU;AAC5D,WAAO,IAAI,KAAK,KAAK,QAAO,IAAK,IAAI;AAAA,EACtC,WAAW,OAAO,SAAS,YAAY,OAAO,SAAS,UAAU;AAChE,WAAO,OAAO;AAAA,EACf;AACA,SAAO;AACR;AAEA,SAAS,aAAa,UAAU,KAAK;AACpC,MAAI,CAAC,MAAM,QAAQ,QAAQ,EAAG,QAAO;AACrC,MAAI,UAAU;AACd,aAAW,WAAW,UAAU;AAC/B,UAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,QAAI,OAAO,QAAQ,UAAU;AAC5B,iBAAW;AAAA,IACZ;AAAA,EACD;AACA,SAAO;AACR;AAEA,SAAS,WAAW,UAAU,KAAK;AAClC,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,MAAI,OAAO,SAAS,YAAY,OAAO,SAAS,YAAY,SAAS,GAAG;AACvE,WAAO,OAAO;AAAA,EACf;AACA,SAAO;AACR;AAEA,SAAS,QAAQ,UAAU,KAAK;AAC/B,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,MAAI,OAAO,SAAS,YAAY,OAAO,SAAS,YAAY,SAAS,GAAG;AACvE,WAAO,OAAO;AAAA,EACf;AACA,SAAO;AACR;AAEA,SAAS,QAAQ,UAAU,KAAK;AAC/B,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,WAAW,mBAAmB,SAAS,CAAC,GAAG,GAAG;AACpD,MAAI,OAAO,SAAS,YAAY,OAAO,aAAa,UAAU;AAC7D,WAAO,KAAK,IAAI,MAAM,QAAQ;AAAA,EAC/B;AACA,SAAO;AACR;AAEA,SAAS,SAAS,SAAS,KAAK;AAC/B,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,MAAI,OAAO,QAAQ,YAAY,OAAO,GAAG;AACxC,WAAO,KAAK,KAAK,GAAG;AAAA,EACrB;AACA,SAAO;AACR;AAEA,SAAS,QAAQ,SAAS,KAAK;AAC9B,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,MAAI,OAAO,QAAQ,UAAU;AAC5B,WAAO,KAAK,IAAI,GAAG;AAAA,EACpB;AACA,SAAO;AACR;AAEA,SAAS,SAAS,SAAS,KAAK;AAC/B,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,MAAI,OAAO,QAAQ,UAAU;AAC5B,WAAO,KAAK,KAAK,GAAG;AAAA,EACrB;AACA,SAAO;AACR;AAEA,SAAS,UAAU,SAAS,KAAK;AAChC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,MAAI,OAAO,QAAQ,UAAU;AAC5B,WAAO,KAAK,MAAM,GAAG;AAAA,EACtB;AACA,SAAO;AACR;AAEA,SAAS,UAAU,SAAS,KAAK;AAChC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,MAAI,OAAO,QAAQ,UAAU;AAC5B,WAAO,KAAK,MAAM,GAAG;AAAA,EACtB;AACA,SAAO;AACR;AAEA,SAAS,UAAU,UAAU,KAAK;AACjC,QAAM,MAAM,mBAAmB,MAAM,QAAQ,QAAQ,IAAI,SAAS,CAAC,IAAI,UAAU,GAAG;AACpF,QAAM,QAAQ,MAAM,QAAQ,QAAQ,KAAK,SAAS,CAAC,MAAM,SACtD,mBAAmB,SAAS,CAAC,GAAG,GAAG,IACnC;AAEH,MAAI,OAAO,QAAQ,YAAY,OAAO,UAAU,UAAU;AACzD,UAAM,aAAa,KAAK,IAAI,IAAI,KAAK;AACrC,WAAO,KAAK,MAAM,MAAM,UAAU,IAAI;AAAA,EACvC;AACA,SAAO;AACR;AAMA,SAAS,WAAW,UAAU,KAAK;AAClC,MAAI,CAAC,MAAM,QAAQ,QAAQ,EAAG,QAAO;AACrC,MAAI,SAAS;AACb,aAAW,WAAW,UAAU;AAC/B,UAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,QAAI,QAAQ,QAAQ,QAAQ,QAAW;AACtC,gBAAU,OAAO,GAAG;AAAA,IACrB;AAAA,EACD;AACA,SAAO;AACR;AAEA,SAAS,WAAW,UAAU,KAAK;AAClC,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,SAAS,EAAG,QAAO;AAC5D,QAAM,MAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG,KAAK,EAAE;AAC7D,QAAM,QAAQ,mBAAmB,SAAS,CAAC,GAAG,GAAG;AACjD,QAAM,SAAS,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAClD,MAAI,OAAO,UAAU,YAAY,OAAO,WAAW,UAAU;AAC5D,WAAO,IAAI,OAAO,OAAO,MAAM;AAAA,EAChC;AACA,SAAO;AACR;AAEA,SAAS,YAAY,SAAS,KAAK;AAClC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,QAAQ,QAAQ,QAAQ,SAAY,OAAO,GAAG,EAAE,YAAW,IAAK;AACxE;AAEA,SAAS,YAAY,SAAS,KAAK;AAClC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,QAAQ,QAAQ,QAAQ,SAAY,OAAO,GAAG,EAAE,YAAW,IAAK;AACxE;AAEA,SAAS,SAAS,SAAS,KAAK;AAC/B,QAAM,MAAM,mBAAmB,OAAO,YAAY,YAAY,QAAQ,QAAQ,QAAQ,QAAQ,SAAS,GAAG;AAC1G,QAAM,QAAQ,QAAQ,QAAQ,mBAAmB,QAAQ,OAAO,GAAG,IAAI;AAEvE,MAAI,MAAM,QAAQ,QAAQ,QAAQ,SAAY,OAAO,GAAG,IAAI;AAE5D,MAAI,OAAO;AACV,UAAM,aAAa,IAAI,OAAO,KAAK,YAAY,KAAK,CAAC,OAAO,YAAY,KAAK,CAAC,OAAO,GAAG;AACxF,WAAO,IAAI,QAAQ,YAAY,EAAE;AAAA,EAClC;AACA,SAAO,IAAI,KAAI;AAChB;AAEA,SAAS,UAAU,SAAS,KAAK;AAChC,QAAM,MAAM,mBAAmB,OAAO,YAAY,YAAY,QAAQ,QAAQ,QAAQ,QAAQ,SAAS,GAAG;AAC1G,QAAM,QAAQ,QAAQ,QAAQ,mBAAmB,QAAQ,OAAO,GAAG,IAAI;AAEvE,MAAI,MAAM,QAAQ,QAAQ,QAAQ,SAAY,OAAO,GAAG,IAAI;AAE5D,MAAI,OAAO;AACV,UAAM,aAAa,IAAI,OAAO,KAAK,YAAY,KAAK,CAAC,MAAM,GAAG;AAC9D,WAAO,IAAI,QAAQ,YAAY,EAAE;AAAA,EAClC;AACA,SAAO,IAAI,QAAQ,QAAQ,EAAE;AAC9B;AAEA,SAAS,UAAU,SAAS,KAAK;AAChC,QAAM,MAAM,mBAAmB,OAAO,YAAY,YAAY,QAAQ,QAAQ,QAAQ,QAAQ,SAAS,GAAG;AAC1G,QAAM,QAAQ,QAAQ,QAAQ,mBAAmB,QAAQ,OAAO,GAAG,IAAI;AAEvE,MAAI,MAAM,QAAQ,QAAQ,QAAQ,SAAY,OAAO,GAAG,IAAI;AAE5D,MAAI,OAAO;AACV,UAAM,aAAa,IAAI,OAAO,IAAI,YAAY,KAAK,CAAC,OAAO,GAAG;AAC9D,WAAO,IAAI,QAAQ,YAAY,EAAE;AAAA,EAClC;AACA,SAAO,IAAI,QAAQ,QAAQ,EAAE;AAC9B;AAEA,SAAS,UAAU,UAAU,KAAK;AACjC,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,MAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG,KAAK,EAAE;AAC7D,QAAM,YAAY,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG,KAAK,EAAE;AACnE,SAAO,IAAI,MAAM,SAAS;AAC3B;AAEA,SAAS,aAAa,SAAS,KAAK;AACnC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,QAAQ,QAAQ,QAAQ,SAAY,OAAO,GAAG,EAAE,SAAS;AACjE;AAEA,SAAS,eAAe,UAAU,KAAK;AACtC,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG,KAAK,EAAE,EAAE,YAAW;AAC3E,QAAM,OAAO,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG,KAAK,EAAE,EAAE,YAAW;AAE3E,MAAI,OAAO,KAAM,QAAO;AACxB,MAAI,OAAO,KAAM,QAAO;AACxB,SAAO;AACR;AAEA,SAAS,cAAc,UAAU,KAAK;AACrC,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,SAAS,EAAG,QAAO;AAC5D,QAAM,MAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG,KAAK,EAAE;AAC7D,QAAM,SAAS,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG,KAAK,EAAE;AAChE,QAAM,QAAQ,SAAS,CAAC,MAAM,SAAY,mBAAmB,SAAS,CAAC,GAAG,GAAG,IAAI;AACjF,QAAM,MAAM,SAAS,CAAC,MAAM,SAAY,mBAAmB,SAAS,CAAC,GAAG,GAAG,IAAI,IAAI;AAEnF,QAAM,YAAY,IAAI,UAAU,OAAO,GAAG;AAC1C,QAAM,QAAQ,UAAU,QAAQ,MAAM;AACtC,SAAO,UAAU,KAAK,KAAK,QAAQ;AACpC;AAEA,SAAS,eAAe,SAAS,KAAK;AACrC,QAAM,QAAQ,OAAO,mBAAmB,QAAQ,OAAO,GAAG,KAAK,EAAE;AACjE,QAAM,OAAO,OAAO,mBAAmB,QAAQ,MAAM,GAAG,KAAK,EAAE;AAC/D,QAAM,cAAc,OAAO,mBAAmB,QAAQ,aAAa,GAAG,KAAK,EAAE;AAE7E,SAAO,MAAM,QAAQ,MAAM,WAAW;AACvC;AAEA,SAAS,eAAe,SAAS,KAAK;AACrC,QAAM,QAAQ,OAAO,mBAAmB,QAAQ,OAAO,GAAG,KAAK,EAAE;AACjE,QAAM,OAAO,OAAO,mBAAmB,QAAQ,MAAM,GAAG,KAAK,EAAE;AAC/D,QAAM,cAAc,OAAO,mBAAmB,QAAQ,aAAa,GAAG,KAAK,EAAE;AAE7E,SAAO,MAAM,MAAM,IAAI,EAAE,KAAK,WAAW;AAC1C;AAEA,SAAS,YAAY,KAAK;AACzB,SAAO,IAAI,QAAQ,uBAAuB,MAAM;AACjD;AAMA,SAAS,QAAQ,UAAU,KAAK;AAC/B,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAEhD,MAAI,OAAO,KAAM,QAAO;AACxB,MAAI,OAAO,KAAM,QAAO;AACxB,SAAO;AACR;AAEA,SAAS,OAAO,UAAU,KAAK;AAC9B,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,SAAO,SAAS;AACjB;AAEA,SAAS,OAAO,UAAU,KAAK;AAC9B,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,SAAO,SAAS;AACjB;AAEA,SAAS,OAAO,UAAU,KAAK;AAC9B,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,SAAO,OAAO;AACf;AAEA,SAAS,QAAQ,UAAU,KAAK;AAC/B,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,SAAO,QAAQ;AAChB;AAEA,SAAS,OAAO,UAAU,KAAK;AAC9B,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,SAAO,OAAO;AACf;AAEA,SAAS,QAAQ,UAAU,KAAK;AAC/B,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,QAAM,OAAO,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAChD,SAAO,QAAQ;AAChB;AAMA,SAAS,QAAQ,UAAU,KAAK;AAC/B,MAAI,CAAC,MAAM,QAAQ,QAAQ,EAAG,QAAO;AACrC,aAAW,WAAW,UAAU;AAC/B,UAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,QAAI,CAAC,IAAK,QAAO;AAAA,EAClB;AACA,SAAO;AACR;AAEA,SAAS,OAAO,UAAU,KAAK;AAC9B,MAAI,CAAC,MAAM,QAAQ,QAAQ,EAAG,QAAO;AACrC,aAAW,WAAW,UAAU;AAC/B,UAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,QAAI,IAAK,QAAO;AAAA,EACjB;AACA,SAAO;AACR;AAEA,SAAS,QAAQ,SAAS,KAAK;AAC9B,QAAM,MAAM,mBAAmB,MAAM,QAAQ,OAAO,IAAI,QAAQ,CAAC,IAAI,SAAS,GAAG;AACjF,SAAO,CAAC;AACT;AAMA,SAAS,SAAS,SAAS,KAAK;AAE/B,MAAI,QAAQ,UAAU;AAEtB,MAAI,MAAM,QAAQ,OAAO,GAAG;AAC3B,QAAI,QAAQ,WAAW,EAAG,QAAO;AACjC,KAAC,QAAQ,UAAU,QAAQ,IAAI;AAAA,EAChC,WAAW,OAAO,YAAY,UAAU;AACvC,aAAS,QAAQ;AACjB,eAAW,QAAQ;AACnB,eAAW,QAAQ;AAAA,EACpB,OAAO;AACN,WAAO;AAAA,EACR;AAEA,QAAM,YAAY,mBAAmB,QAAQ,GAAG;AAChD,SAAO,YAAY,mBAAmB,UAAU,GAAG,IAAI,mBAAmB,UAAU,GAAG;AACxF;AAEA,SAAS,WAAW,UAAU,KAAK;AAClC,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,SAAS,EAAG,QAAO;AAE5D,WAAS,IAAI,GAAG,IAAI,SAAS,QAAQ,KAAK;AACzC,UAAM,MAAM,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAC/C,QAAI,QAAQ,QAAQ,QAAQ,QAAW;AACtC,aAAO;AAAA,IACR;AAAA,EACD;AACA,SAAO;AACR;AAEA,SAAS,WAAW,SAAS,KAAK;AACjC,MAAI,OAAO,YAAY,YAAY,CAAC,MAAM,QAAQ,QAAQ,QAAQ,GAAG;AACpE,WAAO;AAAA,EACR;AAEA,aAAW,UAAU,QAAQ,UAAU;AACtC,UAAM,aAAa,mBAAmB,OAAO,MAAM,GAAG;AACtD,QAAI,YAAY;AACf,aAAO,mBAAmB,OAAO,MAAM,GAAG;AAAA,IAC3C;AAAA,EACD;AAEA,SAAO,QAAQ,YAAY,SAAY,mBAAmB,QAAQ,SAAS,GAAG,IAAI;AACnF;AAMA,SAAS,SAAS,SAAS,KAAK;AAC/B,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,WAAO,KAAK,eAAc;AAAA,EAC3B;AACA,SAAO;AACR;AAEA,SAAS,UAAU,SAAS,KAAK;AAChC,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,WAAO,KAAK,YAAW,IAAK;AAAA,EAC7B;AACA,SAAO;AACR;AAEA,SAAS,eAAe,SAAS,KAAK;AACrC,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,WAAO,KAAK,WAAU;AAAA,EACvB;AACA,SAAO;AACR;AAEA,SAAS,cAAc,SAAS,KAAK;AACpC,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,WAAO,KAAK,UAAS,IAAK;AAAA,EAC3B;AACA,SAAO;AACR;AAEA,SAAS,cAAc,SAAS,KAAK;AACpC,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,UAAM,QAAQ,IAAI,KAAK,KAAK,IAAI,KAAK,eAAc,GAAI,GAAG,CAAC,CAAC;AAC5D,UAAM,OAAO,OAAO;AACpB,UAAM,SAAS,MAAO,KAAK,KAAK;AAChC,WAAO,KAAK,MAAM,OAAO,MAAM;AAAA,EAChC;AACA,SAAO;AACR;AAEA,SAAS,SAAS,SAAS,KAAK;AAC/B,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,WAAO,KAAK,YAAW;AAAA,EACxB;AACA,SAAO;AACR;AAEA,SAAS,WAAW,SAAS,KAAK;AACjC,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,WAAO,KAAK,cAAa;AAAA,EAC1B;AACA,SAAO;AACR;AAEA,SAAS,WAAW,SAAS,KAAK;AACjC,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,WAAO,KAAK,cAAa;AAAA,EAC1B;AACA,SAAO;AACR;AAEA,SAAS,gBAAgB,SAAS,KAAK;AACtC,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,WAAO,KAAK,mBAAkB;AAAA,EAC/B;AACA,SAAO;AACR;AAEA,SAAS,SAAS,SAAS,KAAK;AAC/B,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,UAAM,SAAS,IAAI,KAAK,KAAK,IAAI,KAAK,eAAc,GAAI,GAAG,CAAC,CAAC;AAC7D,UAAM,OAAO,KAAK,OAAQ,OAAO,UAAU,QAAY,OAAO,cAAc,KAAK,CAAC;AAClF,WAAO,OAAO;AAAA,EACf;AACA,SAAO;AACR;AAEA,SAAS,YAAY,SAAS,KAAK;AAClC,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,UAAM,SAAS,IAAI,KAAK,KAAK,QAAO,CAAE;AACtC,UAAM,SAAS,KAAK,UAAS,IAAK,KAAK;AACvC,WAAO,WAAW,OAAO,WAAU,IAAK,QAAQ,CAAC;AACjD,UAAM,gBAAgB,OAAO,QAAO;AACpC,WAAO,YAAY,GAAG,CAAC;AACvB,QAAI,OAAO,UAAS,MAAO,GAAG;AAC7B,aAAO,YAAY,GAAG,KAAM,IAAI,OAAO,UAAS,IAAM,KAAK,CAAC;AAAA,IAC7D;AACA,WAAO,IAAI,KAAK,MAAM,gBAAgB,UAAU,MAAS;AAAA,EAC1D;AACA,SAAO;AACR;AAEA,SAAS,gBAAgB,SAAS,KAAK;AACtC,QAAM,OAAO,mBAAmB,SAAS,GAAG;AAC5C,MAAI,gBAAgB,MAAM;AACzB,UAAM,SAAS,IAAI,KAAK,KAAK,QAAO,CAAE;AACtC,WAAO,WAAW,OAAO,gBAAiB,KAAK,cAAc,KAAK,IAAK,CAAC;AACxE,WAAO,OAAO,eAAc;AAAA,EAC7B;AACA,SAAO;AACR;AAEA,SAAS,iBAAiB,SAAS,KAAK;AACvC,QAAM,SAAS,QAAQ,SAAS,mBAAmB,QAAQ,QAAQ,GAAG,IAAI;AAC1E,QAAM,OAAO,mBAAmB,QAAQ,MAAM,GAAG;AAEjD,MAAI,EAAE,gBAAgB,MAAO,QAAO;AAGpC,SAAO,OACL,QAAQ,MAAM,KAAK,eAAc,CAAE,EACnC,QAAQ,MAAM,OAAO,KAAK,gBAAgB,CAAC,EAAE,SAAS,GAAG,GAAG,CAAC,EAC7D,QAAQ,MAAM,OAAO,KAAK,WAAU,CAAE,EAAE,SAAS,GAAG,GAAG,CAAC,EACxD,QAAQ,MAAM,OAAO,KAAK,YAAW,CAAE,EAAE,SAAS,GAAG,GAAG,CAAC,EACzD,QAAQ,MAAM,OAAO,KAAK,cAAa,CAAE,EAAE,SAAS,GAAG,GAAG,CAAC,EAC3D,QAAQ,MAAM,OAAO,KAAK,cAAa,CAAE,EAAE,SAAS,GAAG,GAAG,CAAC,EAC3D,QAAQ,MAAM,OAAO,KAAK,mBAAkB,CAAE,EAAE,SAAS,GAAG,GAAG,CAAC;AACnE;AAEA,SAAS,WAAW,SAAS,KAAK;AACjC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,MAAI,eAAe,KAAM,QAAO;AAChC,MAAI,OAAO,QAAQ,YAAY,OAAO,QAAQ,UAAU;AACvD,UAAM,OAAO,IAAI,KAAK,GAAG;AACzB,WAAO,MAAM,KAAK,QAAO,CAAE,IAAI,OAAO;AAAA,EACvC;AACA,SAAO;AACR;AAMA,SAAS,gBAAgB,UAAU,KAAK;AACvC,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,MAAM,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAC/C,QAAM,MAAM,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAE/C,MAAI,CAAC,MAAM,QAAQ,GAAG,KAAK,OAAO,QAAQ,SAAU,QAAO;AAE3D,QAAM,QAAQ,MAAM,IAAI,IAAI,SAAS,MAAM;AAC3C,SAAO,IAAI,KAAK;AACjB;AAEA,SAAS,iBAAiB,UAAU,KAAK;AACxC,MAAI,CAAC,MAAM,QAAQ,QAAQ,EAAG,QAAO;AACrC,QAAM,SAAS,CAAA;AACf,aAAW,WAAW,UAAU;AAC/B,UAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,QAAI,MAAM,QAAQ,GAAG,GAAG;AACvB,aAAO,KAAK,GAAG,GAAG;AAAA,IACnB;AAAA,EACD;AACA,SAAO;AACR;AAEA,SAAS,WAAW,SAAS,KAAK;AACjC,QAAM,QAAQ,mBAAmB,QAAQ,OAAO,GAAG;AACnD,QAAM,QAAQ,QAAQ,MAAM;AAC5B,QAAM,OAAO,QAAQ;AAErB,MAAI,CAAC,MAAM,QAAQ,KAAK,EAAG,QAAO;AAElC,SAAO,MAAM,OAAO,UAAQ;AAC3B,UAAM,UAAU,EAAE,GAAG,KAAK,CAAC,KAAK,GAAG,KAAI;AACvC,WAAO,mBAAmB,MAAM,OAAO;AAAA,EACxC,CAAC;AACF;AAEA,SAAS,OAAO,UAAU,KAAK;AAC9B,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG,QAAO;AAC9D,QAAM,QAAQ,mBAAmB,SAAS,CAAC,GAAG,GAAG;AACjD,QAAM,MAAM,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAE/C,MAAI,CAAC,MAAM,QAAQ,GAAG,EAAG,QAAO;AAChC,SAAO,IAAI,SAAS,KAAK;AAC1B;AAEA,SAAS,iBAAiB,UAAU,KAAK;AACxC,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,SAAS,EAAG,QAAO;AAC5D,QAAM,MAAM,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAC/C,QAAM,SAAS,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAClD,QAAM,QAAQ,SAAS,CAAC,MAAM,SAAY,mBAAmB,SAAS,CAAC,GAAG,GAAG,IAAI;AACjF,QAAM,MAAM,SAAS,CAAC,MAAM,SAAY,mBAAmB,SAAS,CAAC,GAAG,GAAG,IAAI,IAAI;AAEnF,MAAI,CAAC,MAAM,QAAQ,GAAG,EAAG,QAAO;AAEhC,WAAS,IAAI,OAAO,IAAI,OAAO,IAAI,IAAI,QAAQ,KAAK;AACnD,QAAI,IAAI,CAAC,MAAM,OAAQ,QAAO;AAAA,EAC/B;AACA,SAAO;AACR;AAEA,SAAS,YAAY,SAAS,KAAK;AAClC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,MAAM,QAAQ,GAAG;AACzB;AAEA,SAAS,QAAQ,SAAS,KAAK;AAC9B,QAAM,QAAQ,mBAAmB,QAAQ,OAAO,GAAG;AACnD,QAAM,QAAQ,QAAQ,MAAM;AAC5B,QAAM,SAAS,QAAQ;AAEvB,MAAI,CAAC,MAAM,QAAQ,KAAK,EAAG,QAAO;AAElC,SAAO,MAAM,IAAI,UAAQ;AACxB,UAAM,UAAU,EAAE,GAAG,KAAK,CAAC,KAAK,GAAG,KAAI;AACvC,WAAO,mBAAmB,QAAQ,OAAO;AAAA,EAC1C,CAAC;AACF;AAEA,SAAS,WAAW,SAAS,KAAK;AACjC,QAAM,QAAQ,mBAAmB,QAAQ,OAAO,GAAG;AACnD,QAAM,eAAe,mBAAmB,QAAQ,cAAc,GAAG;AACjE,QAAM,SAAS,QAAQ;AAEvB,MAAI,CAAC,MAAM,QAAQ,KAAK,EAAG,QAAO;AAElC,MAAI,QAAQ;AACZ,aAAW,QAAQ,OAAO;AACzB,UAAM,UAAU,EAAE,GAAG,KAAK,OAAO,MAAM,KAAI;AAC3C,YAAQ,mBAAmB,QAAQ,OAAO;AAAA,EAC3C;AACA,SAAO;AACR;AAEA,SAAS,SAAS,SAAS,KAAK;AAC/B,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,MAAM,QAAQ,GAAG,IAAI,IAAI,SAAS;AAC1C;AAEA,SAAS,UAAU,UAAU,KAAK;AACjC,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,SAAS,EAAG,QAAO;AAC5D,QAAM,MAAM,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAE/C,MAAI,CAAC,MAAM,QAAQ,GAAG,EAAG,QAAO;AAEhC,MAAI,SAAS,WAAW,GAAG;AAC1B,UAAM,IAAI,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAC7C,WAAO,KAAK,IAAI,IAAI,MAAM,GAAG,CAAC,IAAI,IAAI,MAAM,CAAC;AAAA,EAC9C,OAAO;AACN,UAAM,WAAW,mBAAmB,SAAS,CAAC,GAAG,GAAG;AACpD,UAAM,IAAI,mBAAmB,SAAS,CAAC,GAAG,GAAG;AAC7C,WAAO,IAAI,MAAM,UAAU,WAAW,CAAC;AAAA,EACxC;AACD;AAEA,SAAS,iBAAiB,SAAS,KAAK;AACvC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,MAAM,QAAQ,GAAG,IAAI,IAAI,MAAK,EAAG,QAAO,IAAK;AACrD;AAEA,SAAS,QAAQ,SAAS,KAAK;AAC9B,QAAM,SAAS,QAAQ,SAAS,mBAAmB,QAAQ,QAAQ,GAAG,IAAI;AAC1E,QAAM,mBAAmB,QAAQ,oBAAoB;AACrD,QAAM,WAAW,QAAQ;AAEzB,MAAI,CAAC,MAAM,QAAQ,MAAM,EAAG,QAAO;AAEnC,QAAM,SAAS,OAAO,IAAI,WAAS,mBAAmB,OAAO,GAAG,CAAC;AACjE,MAAI,CAAC,OAAO,MAAM,SAAO,MAAM,QAAQ,GAAG,CAAC,EAAG,QAAO;AAErD,QAAM,YAAY,KAAK,IAAI,GAAG,OAAO,IAAI,SAAO,IAAI,MAAM,CAAC;AAC3D,QAAM,SAAS,mBAAmB,YAAY,KAAK,IAAI,GAAG,OAAO,IAAI,SAAO,IAAI,MAAM,CAAC;AAEvF,QAAM,SAAS,CAAA;AACf,WAAS,IAAI,GAAG,IAAI,QAAQ,KAAK;AAChC,UAAM,QAAQ,CAAA;AACd,aAAS,IAAI,GAAG,IAAI,OAAO,QAAQ,KAAK;AACvC,UAAI,IAAI,OAAO,CAAC,EAAE,QAAQ;AACzB,cAAM,KAAK,OAAO,CAAC,EAAE,CAAC,CAAC;AAAA,MACxB,WAAW,YAAY,IAAI,SAAS,QAAQ;AAC3C,cAAM,KAAK,SAAS,CAAC,CAAC;AAAA,MACvB,OAAO;AACN,cAAM,KAAK,IAAI;AAAA,MAChB;AAAA,IACD;AACA,WAAO,KAAK,KAAK;AAAA,EAClB;AACA,SAAO;AACR;AAMA,SAAS,SAAS,SAAS,KAAK;AAC/B,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAE3C,MAAI,QAAQ,KAAM,QAAO;AACzB,MAAI,QAAQ,OAAW,QAAO;AAC9B,MAAI,OAAO,QAAQ,UAAW,QAAO;AACrC,MAAI,OAAO,QAAQ,SAAU,QAAO,OAAO,UAAU,GAAG,IAAI,QAAQ;AACpE,MAAI,OAAO,QAAQ,SAAU,QAAO;AACpC,MAAI,eAAe,KAAM,QAAO;AAChC,MAAI,MAAM,QAAQ,GAAG,EAAG,QAAO;AAC/B,MAAI,OAAO,QAAQ,SAAU,QAAO;AAEpC,SAAO;AACR;AAEA,SAAS,YAAY,SAAS,KAAK;AAClC,QAAM,QAAQ,mBAAmB,QAAQ,OAAO,GAAG;AACnD,QAAM,KAAK,QAAQ;AACnB,QAAM,UAAU,QAAQ;AACxB,QAAM,SAAS,QAAQ;AAEvB,MAAI,UAAU,MAAM;AACnB,WAAO,WAAW,SAAY,mBAAmB,QAAQ,GAAG,IAAI;AAAA,EACjE;AAEA,MAAI;AACH,YAAQ,IAAE;AAAA,MACT,KAAK;AAAA,MACL,KAAK;AACJ,eAAO,WAAW,KAAK;AAAA,MACxB,KAAK;AAAA,MACL,KAAK;AACJ,eAAO,SAAS,KAAK;AAAA,MACtB,KAAK;AACJ,eAAO,QAAQ,KAAK;AAAA,MACrB,KAAK;AACJ,eAAO,OAAO,KAAK;AAAA,MACpB,KAAK;AACJ,eAAO,IAAI,KAAK,KAAK;AAAA,MACtB;AACC,eAAO;AAAA,IACX;AAAA,EACC,SAAS,GAAG;AACX,WAAO,YAAY,SAAY,mBAAmB,SAAS,GAAG,IAAI;AAAA,EACnE;AACD;AAEA,SAAS,WAAW,SAAS,KAAK;AACjC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,QAAQ,GAAG;AACnB;AAEA,SAAS,cAAc,SAAS,KAAK;AACpC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,WAAW,GAAG;AACtB;AAEA,SAAS,aAAa,SAAS,KAAK;AACnC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,WAAW,GAAG;AACtB;AAEA,SAAS,UAAU,SAAS,KAAK;AAChC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,SAAS,GAAG;AACpB;AAEA,SAAS,WAAW,SAAS,KAAK;AACjC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,SAAO,SAAS,GAAG;AACpB;AAEA,SAAS,aAAa,SAAS,KAAK;AACnC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,MAAI,QAAQ,QAAQ,QAAQ,OAAW,QAAO;AAC9C,SAAO,OAAO,GAAG;AAClB;AAMA,SAAS,kBAAkB,SAAS,KAAK;AACxC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,MAAI,OAAO,QAAQ,YAAY,QAAQ,QAAQ,MAAM,QAAQ,GAAG,GAAG;AAClE,WAAO;AAAA,EACR;AAEA,SAAO,OAAO,KAAK,GAAG,EAAE,IAAI,UAAQ,EAAE,GAAG,KAAK,GAAG,IAAI,GAAG,EAAC,EAAG;AAC7D;AAEA,SAAS,kBAAkB,SAAS,KAAK;AACxC,QAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,MAAI,CAAC,MAAM,QAAQ,GAAG,EAAG,QAAO;AAEhC,QAAM,SAAS,CAAA;AACf,aAAW,QAAQ,KAAK;AACvB,QAAI,MAAM,QAAQ,IAAI,KAAK,KAAK,WAAW,GAAG;AAC7C,aAAO,KAAK,CAAC,CAAC,IAAI,KAAK,CAAC;AAAA,IACzB,WAAW,OAAO,SAAS,YAAY,KAAK,MAAM,UAAa,KAAK,MAAM,QAAW;AACpF,aAAO,KAAK,CAAC,IAAI,KAAK;AAAA,IACvB;AAAA,EACD;AACA,SAAO;AACR;AAEA,SAAS,iBAAiB,UAAU,KAAK;AACxC,MAAI,CAAC,MAAM,QAAQ,QAAQ,GAAG;AAE7B,WAAO,mBAAmB,UAAU,GAAG;AAAA,EACxC;AAEA,QAAM,SAAS,CAAA;AACf,aAAW,WAAW,UAAU;AAC/B,UAAM,MAAM,mBAAmB,SAAS,GAAG;AAC3C,QAAI,OAAO,QAAQ,YAAY,QAAQ,QAAQ,CAAC,MAAM,QAAQ,GAAG,GAAG;AACnE,aAAO,OAAO,QAAQ,GAAG;AAAA,IAC1B;AAAA,EACD;AACA,SAAO;AACR;ACt9BA,MAAM,aAAa;AAAA,EAClB,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,KAAK;AAAA,EACL,MAAM;AACP;AAGA,MAAM,eAAe,OAAO,QAAQ,UAAU,EAAE,OAAO,CAAC,KAAK,CAAC,MAAM,IAAI,MAAM;AAC7E,MAAI,IAAI,IAAI,SAAS,IAAI;AACzB,SAAO;AACR,GAAG,EAAE;AAKL,SAAS,YAAY,OAAO,UAAU;AAErC,MAAI,QAAQ,QAAQ,GAAG;AACtB,aAAS,IAAI,GAAG,IAAI,SAAS,QAAQ,KAAK;AACzC,UAAI,YAAY,OAAO,SAAS,CAAC,CAAC,EAAG,QAAO;AAAA,IAC7C;AACA,WAAO;AAAA,EACR;AAGA,QAAM,WAAW,OAAO,aAAa,WAAW,WAAW,aAAa,QAAQ;AAChF,QAAM,WAAW,WAAW,QAAQ,KAAK;AAGzC,MAAI,UAAU,KAAM,QAAO,aAAa,UAAU,aAAa;AAC/D,MAAI,UAAU,OAAW,QAAO,aAAa,eAAe,aAAa;AACzE,MAAI,OAAO,UAAU,UAAU;AAC9B,QAAI,OAAO,UAAU,KAAK,EAAG,QAAO,aAAa,SAAS,aAAa;AACvE,WAAO,aAAa,YAAY,aAAa;AAAA,EAC9C;AACA,MAAI,OAAO,UAAU,SAAU,QAAO,aAAa,YAAY,aAAa;AAC5E,MAAI,OAAO,UAAU,UAAW,QAAO,aAAa,UAAU,aAAa;AAC3E,MAAI,iBAAiB,KAAM,QAAO,aAAa,UAAU,aAAa;AACtE,MAAI,iBAAiB,SAAU,QAAO,aAAa,cAAc,aAAa;AAC9E,MAAI,iBAAiB,OAAQ,QAAO,aAAa,WAAW,aAAa;AACzE,MAAI,QAAQ,KAAK,EAAG,QAAO,aAAa,WAAW,aAAa;AAChE,MAAI,OAAO,UAAU,SAAU,QAAO,aAAa,YAAY,aAAa;AAG5E,SAAO,OAAO,UAAU;AACzB;AAKA,SAAS,UAAU,WAAW;AAC7B,MAAI,QAAQ,SAAS,GAAG;AAEvB,QAAI,OAAO;AACX,aAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AAC1C,cAAS,KAAK,UAAU,CAAC;AAAA,IAC1B;AACA,WAAO;AAAA,EACR,WAAW,OAAO,cAAc,UAAU;AAEzC,WAAO;AAAA,EACR;AACA,SAAO;AACR;AAEA,SAAS,kBAAkB,OAAO,WAAW;AAC5C,MAAI,OAAO,UAAU,SAAU,QAAO;AACtC,QAAM,OAAO,UAAU,SAAS;AAChC,UAAQ,QAAQ,UAAU;AAC3B;AAEA,SAAS,oBAAoB,OAAO,WAAW;AAC9C,MAAI,OAAO,UAAU,SAAU,QAAO;AACtC,QAAM,OAAO,UAAU,SAAS;AAChC,UAAQ,QAAQ,UAAU;AAC3B;AAEA,SAAS,kBAAkB,OAAO,WAAW;AAC5C,MAAI,OAAO,UAAU,SAAU,QAAO;AACtC,QAAM,OAAO,UAAU,SAAS;AAChC,UAAQ,QAAQ,UAAU;AAC3B;AAEA,SAAS,oBAAoB,OAAO,WAAW;AAC9C,MAAI,OAAO,UAAU,SAAU,QAAO;AACtC,QAAM,OAAO,UAAU,SAAS;AAChC,UAAQ,QAAQ,UAAU;AAC3B;AAKA,SAAS,mBAAmB,KAAK,QAAQ;AAExC,MAAI,OAAO,MAAM;AAChB,UAAM,UAAU,QAAQ,GAAG,IAAI,UAAW,QAAQ,OAAO,SAAS,OAAO;AACzE,QAAI,OAAO,SAAS,QAAS,QAAO;AAAA,EACrC;AAEA,MAAI,OAAO,YAAY,QAAQ,OAAO,QAAQ,GAAG;AAChD,aAAS,IAAI,GAAG,IAAI,OAAO,SAAS,QAAQ,KAAK;AAChD,UAAI,EAAE,OAAO,SAAS,CAAC,KAAK,KAAM,QAAO;AAAA,IAC1C;AAAA,EACD;AAEA,MAAI,OAAO,YAAY;AACtB,eAAW,OAAO,OAAO,YAAY;AAGpC,UAAI,EAAE,OAAO,KAAM,QAAO;AAE1B,YAAM,aAAa,OAAO,WAAW,GAAG;AACxC,UAAI,CAAC,mBAAmB,IAAI,GAAG,GAAG,UAAU,EAAG,QAAO;AAAA,IACvD;AAAA,EACD;AAEA,MAAI,OAAO,YAAY,UAAa,OAAO,QAAQ,UAAU;AAC5D,QAAI,MAAM,OAAO,QAAS,QAAO;AAAA,EAClC;AAEA,MAAI,OAAO,YAAY,UAAa,OAAO,QAAQ,UAAU;AAC5D,QAAI,MAAM,OAAO,QAAS,QAAO;AAAA,EAClC;AAEA,MAAI,OAAO,cAAc,UAAa,OAAO,QAAQ,UAAU;AAC9D,QAAI,IAAI,SAAS,OAAO,UAAW,QAAO;AAAA,EAC3C;AAEA,MAAI,OAAO,cAAc,UAAa,OAAO,QAAQ,UAAU;AAC9D,QAAI,IAAI,SAAS,OAAO,UAAW,QAAO;AAAA,EAC3C;AAEA,MAAI,OAAO,WAAW,OAAO,QAAQ,UAAU;AAC9C,UAAM,QAAQ,IAAI,OAAO,OAAO,OAAO;AACvC,QAAI,CAAC,MAAM,KAAK,GAAG,EAAG,QAAO;AAAA,EAC9B;AAEA,MAAI,OAAO,QAAQ,QAAQ,OAAO,IAAI,GAAG;AACxC,QAAI,CAAC,OAAO,KAAK,SAAS,GAAG,EAAG,QAAO;AAAA,EACxC;AAEA,SAAO;AACR;AAKA,SAAS,YAAY,GAAG,GAAG;AAE1B,MAAI,aAAa,YAAY,aAAa,UAAU;AACjD,WAAO,EAAE,OAAO,CAAC;AAAA,EACpB;AAGA,SAAO,KAAK;AACb;AAKA,SAAS,cAAc,GAAG,GAAG,UAAU;AAEtC,MAAI,OAAO;AACX,MAAI,OAAO;AAEX,MAAI,aAAa,UAAU;AAC1B,WAAO,EAAE,SAAQ;AAAA,EAClB;AACA,MAAI,aAAa,UAAU;AAC1B,WAAO,EAAE,SAAQ;AAAA,EAClB;AAEA,UAAO,UAAQ;AAAA,IACd,KAAK;AAAK,aAAO,OAAO;AAAA,IACxB,KAAK;AAAM,aAAO,QAAQ;AAAA,IAC1B,KAAK;AAAK,aAAO,OAAO;AAAA,IACxB,KAAK;AAAM,aAAO,QAAQ;AAAA,IAC1B;AAAS,aAAO;AAAA,EAClB;AACA;AAMA,SAAS,kBAAkB,YAAY,SAAS;AAE/C,MAAI,eAAe,OAAW,QAAO;AAGrC,MAAI,eAAe,KAAM,QAAO,QAAQ,UAAU;AAGlD,MAAI,QAAQ,UAAU,GAAG;AACxB,aAAS,IAAI,GAAG,IAAI,WAAW,QAAQ,KAAK;AAC3C,UAAI,QAAQ,WAAW,CAAC,CAAC,EAAG,QAAO;AAAA,IACpC;AACA,WAAO;AAAA,EACR;AAGA,SAAO,QAAQ,UAAU;AAC1B;AAKA,SAAS,aAAaA,OAAM;AAC3B,MAAI,OAAOA,UAAS,SAAU,QAAO,CAAA;AAEpC,QAAM,QAAQ,SAASA,KAAI;AAC5B,SAAO,MAAM,IAAI,OAAK,QAAQ,CAAC,CAAC;AACjC;AAMO,SAAS,KAAK,MAAM,WAAW;AACrC,MAAI,OAAO,SAAS,SAAU,QAAO;AAErC,QAAM,aAAa,IAAI,IAAI,aAAa,IAAI,CAAC;AAC7C,QAAM,cAAc,aAAa,SAAS;AAG1C,SAAO,YAAY,KAAK,UAAQ,WAAW,IAAI,IAAI,CAAC;AACrD;AAMA,SAAS,mBAAmB,KAAK,YAAY;AAC5C,MAAI,CAAC,OAAO,OAAO,QAAQ,SAAU,QAAO;AAG5C,WAAS,aAAa,KAAK;AAC1B,QAAI,OAAO,QAAQ,UAAU;AAC5B,aAAO,KAAK,KAAK,UAAU;AAAA,IAC5B;AAEA,QAAI,OAAO,QAAQ,YAAY,QAAQ,MAAM;AAC5C,aAAO;AAAA,IACR;AAGA,QAAI,QAAQ,GAAG,GAAG;AACjB,eAAS,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAK;AACpC,YAAI,aAAa,IAAI,CAAC,CAAC,EAAG,QAAO;AAAA,MAClC;AACA,aAAO;AAAA,IACR;AAGA,eAAW,OAAO,KAAK;AACtB,UAAI,IAAI,eAAe,GAAG,GAAG;AAC5B,YAAI,aAAa,IAAI,GAAG,CAAC,EAAG,QAAO;AAAA,MACpC;AAAA,IACD;AAEA,WAAO;AAAA,EACR;AAEA,SAAO,aAAa,GAAG;AACxB;AAMO,SAAS,UAAU,MAAM,OAAO;AACtC,MAAI;AAEH,QAAI,CAAC,MAAM,QAAQ,KAAK,KAAK,MAAM,WAAW,GAAG;AAChD,aAAO;AAAA,IACR;AAEA,UAAM,SAAS,MAAM,CAAC,EAAE,CAAC;AACzB,UAAM,SAAS,MAAM,CAAC,EAAE,CAAC;AACzB,UAAM,SAAS,MAAM,CAAC,EAAE,CAAC;AACzB,UAAM,SAAS,MAAM,CAAC,EAAE,CAAC;AAGzB,WAAO,qBAAqB,MAAM,QAAQ,QAAQ,QAAQ,MAAM;AAAA,EACjE,SAAS,GAAG;AACX,WAAO;AAAA,EACR;AACD;AAOA,SAAS,qBAAqB,SAAS,QAAQ,QAAQ,QAAQ,QAAQ;AACtE,MAAI,CAAC,QAAS,QAAO;AAGrB,MAAI,QAAQ,SAAS,uBAAuB,QAAQ,YAAY,QAAQ,SAAS,SAAS,GAAG;AAE5F,eAAW,WAAW,QAAQ,UAAU;AACvC,UAAI,QAAQ,UAAU;AACrB,YAAI,CAAC,qBAAqB,QAAQ,UAAU,QAAQ,QAAQ,QAAQ,MAAM,GAAG;AAC5E,iBAAO;AAAA,QACR;AAAA,MACD;AAAA,IACD;AACA,WAAO;AAAA,EACR;AAGA,MAAI,QAAQ,SAAS,aAAa,QAAQ,UAAU;AACnD,WAAO,qBAAqB,QAAQ,UAAU,QAAQ,QAAQ,QAAQ,MAAM;AAAA,EAC7E;AAGA,MAAI,QAAQ,SAAS,WAAW,QAAQ,aAAa;AACpD,UAAM,CAAC,KAAK,GAAG,IAAI,QAAQ;AAC3B,QAAI,OAAO,QAAQ,YAAY,OAAO,QAAQ,UAAU;AACvD,aAAO,OAAO,UAAU,OAAO,UAAU,OAAO,UAAU,OAAO;AAAA,IAClE;AAAA,EACD;AAGA,MAAI,QAAQ,SAAS,aAAa,QAAQ,eAAe,QAAQ,YAAY,SAAS,GAAG;AACxF,eAAW,QAAQ,QAAQ,aAAa;AACvC,iBAAW,SAAS,MAAM;AACzB,cAAM,MAAM,MAAM,CAAC;AACnB,cAAM,MAAM,MAAM,CAAC;AACnB,YAAI,MAAM,UAAU,MAAM,UAAU,MAAM,UAAU,MAAM,QAAQ;AACjE,iBAAO;AAAA,QACR;AAAA,MACD;AAAA,IACD;AACA,WAAO;AAAA,EACR;AAEA,SAAO;AACR;AAQA,SAAS,8BAA8B,SAAS;AAC/C,MAAI,CAAC,QAAS,QAAO;AAGrB,MAAI,QAAQ,SAAS,uBAAuB,QAAQ,YAAY,QAAQ,SAAS,SAAS,GAAG;AAC5F,UAAM,UAAU,QAAQ,SAAS,CAAC;AAClC,QAAI,QAAQ,UAAU;AACrB,aAAO,8BAA8B,QAAQ,QAAQ;AAAA,IACtD;AAAA,EACD;AAGA,MAAI,QAAQ,SAAS,aAAa,QAAQ,UAAU;AACnD,WAAO,8BAA8B,QAAQ,QAAQ;AAAA,EACtD;AAGA,MAAI,QAAQ,SAAS,WAAW,QAAQ,aAAa;AACpD,UAAM,CAAC,KAAK,GAAG,IAAI,QAAQ;AAC3B,QAAI,OAAO,QAAQ,YAAY,OAAO,QAAQ,UAAU;AACvD,aAAO,EAAE,KAAK,IAAG;AAAA,IAClB;AAAA,EACD;AAGA,MAAI,QAAQ,SAAS,aAAa,QAAQ,eAAe,QAAQ,YAAY,SAAS,GAAG;AACxF,UAAM,OAAO,QAAQ,YAAY,CAAC;AAClC,QAAI,KAAK,SAAS,GAAG;AACpB,UAAI,SAAS,GAAG,SAAS;AACzB,iBAAW,SAAS,MAAM;AACzB,kBAAU,MAAM,CAAC;AACjB,kBAAU,MAAM,CAAC;AAAA,MAClB;AACA,aAAO;AAAA,QACN,KAAK,SAAS,KAAK;AAAA,QACnB,KAAK,SAAS,KAAK;AAAA,MACvB;AAAA,IACE;AAAA,EACD;AAEA,SAAO;AACR;AAKA,SAAS,kBAAkB,MAAM,MAAM,MAAM,MAAM;AAClD,QAAM,IAAI;AACV,QAAM,QAAQ,OAAO,QAAQ,KAAK,KAAK;AACvC,QAAM,QAAQ,OAAO,QAAQ,KAAK,KAAK;AACvC,QAAM,IACL,KAAK,IAAI,OAAO,CAAC,IAAI,KAAK,IAAI,OAAO,CAAC,IACtC,KAAK,IAAI,OAAO,KAAK,KAAK,GAAG,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK,GAAG,IAC9D,KAAK,IAAI,OAAO,CAAC,IAAI,KAAK,IAAI,OAAO,CAAC;AACvC,QAAM,IAAI,IAAI,KAAK,MAAM,KAAK,KAAK,CAAC,GAAG,KAAK,KAAK,IAAI,CAAC,CAAC;AACvD,SAAO,IAAI;AACZ;AAKA,SAAS,OAAO,SAAS,QAAQ,QAAQ,mBAAmB;AAC3D,QAAM,SAAS,8BAA8B,OAAO;AACpD,MAAI,CAAC,OAAQ,QAAO;AACpB,QAAM,aAAa,kBAAkB,OAAO,KAAK,OAAO,KAAK,QAAQ,MAAM;AAC3E,QAAM,YAAY,aAAa;AAC/B,SAAO,aAAa;AACrB;AAKA,SAAS,cAAc,SAAS,UAAU;AACzC,MAAI,CAAC,WAAW,CAAC,SAAU,QAAO;AAGlC,QAAM,cAAc,8BAA8B,QAAQ;AAC1D,MAAI,CAAC,YAAa,QAAO;AAGzB,QAAM,YAAY,8BAA8B,OAAO;AACvD,MAAI,CAAC,UAAW,QAAO;AAIvB,MAAI,SAAS,SAAS,aAAa,QAAQ,SAAS,SAAS;AAC5D,WAAO,eAAe,UAAU,KAAK,UAAU,KAAK,SAAS,YAAY,CAAC,CAAC;AAAA,EAC5E;AAGA,MAAI,QAAQ,SAAS,aAAa,SAAS,SAAS,SAAS;AAC5D,UAAM,UAAU,SAAS;AACzB,WAAO,eAAe,QAAQ,CAAC,GAAG,QAAQ,CAAC,GAAG,QAAQ,YAAY,CAAC,CAAC;AAAA,EACrE;AAGA,MAAI,QAAQ,SAAS,WAAW,SAAS,SAAS,SAAS;AAC1D,UAAM,OAAO,kBAAkB,UAAU,KAAK,UAAU,KAAK,YAAY,KAAK,YAAY,GAAG;AAC7F,WAAO,OAAO;AAAA,EACf;AAEA,SAAO;AACR;AAKA,SAAS,eAAe,KAAK,KAAK,MAAM;AACvC,MAAI,SAAS;AACb,WAAS,IAAI,GAAG,IAAI,KAAK,SAAS,GAAG,IAAI,KAAK,QAAQ,IAAI,KAAK;AAC9D,UAAM,KAAK,KAAK,CAAC,EAAE,CAAC,GAAG,KAAK,KAAK,CAAC,EAAE,CAAC;AACrC,UAAM,KAAK,KAAK,CAAC,EAAE,CAAC,GAAG,KAAK,KAAK,CAAC,EAAE,CAAC;AACrC,UAAM,YAAc,KAAK,QAAU,KAAK,OAAU,OAAO,KAAK,OAAO,MAAM,OAAO,KAAK,MAAM;AAC7F,QAAI,UAAW,UAAS,CAAC;AAAA,EAC1B;AACA,SAAO;AACR;AAQO,SAAS,MAAM,KAAK,OAAO;AACjC,MAAI,OAAO,UAAU,YAAY;AAChC,QAAI;AACH,aAAO,MAAM,KAAK,GAAG;AAAA,IACtB,SAAS,GAAG;AACX,aAAO;AAAA,IACR;AAAA,EACD,WAAW,OAAO,UAAU,UAAU;AAErC,QAAI;AACH,UAAI,KAAK,IAAI,SAAS,YAAY,KAAK;AACvC,aAAO,GAAG,KAAK,GAAG;AAAA,IACnB,SAAS,GAAG;AACX,aAAO;AAAA,IACR;AAAA,EACD;AACA,SAAO;AACR;AAKO,SAAS,UAAU,KAAK,OAAO;AACrC,MAAI,MAAM,OAAO,KAAK,KAAK,EAAE,CAAC;AAC9B,MAAI,QAAQ,MAAM,GAAG;AACrB,MAAI,IAAI,OAAO,CAAC,KAAK,KAAK;AACzB,QAAI,OAAO,OAAQ,QAAO,IAAI,KAAK,KAAK;AAAA,aAC/B,OAAO,MAAO,QAAO,GAAG,KAAK,KAAK;AAAA,aAClC,OAAO,OAAQ,QAAO,IAAI,KAAK,KAAK;AAAA,aACpC,OAAO,OAAQ,QAAO,IAAI,KAAK,KAAK;AAAA,aACpC,OAAO,SAAU,QAAO,MAAM,KAAK,KAAK;AAAA,aACxC,OAAO,WAAY,QAAO;AAAA,aAC1B,OAAO,cAAe,QAAO,mBAAmB,KAAK,KAAK;AAAA,aAC1D,OAAO,SAAS;AAGxB,YAAM,aAAa,MAAM,WAAW;AACpC,aAAO,mBAAmB,KAAK,UAAU;AAAA,IAC1C,WACS,OAAO,SAAS;AAExB,UAAI;AACH,eAAO,mBAAmB,OAAO,GAAG;AAAA,MACrC,SAAS,GAAG;AACX,eAAO;AAAA,MACR;AAAA,IACD,MACK,OAAM,EAAE,MAAM,oEAAoE,KAAK,MAAM,MAAK;AAAA,EACxG,OAAO;AACN,WAAO,UAAU,KAAK,KAAK,KAAK;AAAA,EACjC;AACD;AAKO,SAAS,UAAU,KAAK,KAAK,OAAO;AAE1C,MAAI,aAAa,eAAe,KAAK,GAAG;AAExC,MAAI,OAAQ,SAAU,SAAU,QAAO,kBAAkB,YAAY,SAAS,GAAG;AAAE,WAAO,YAAY,GAAG,KAAK;AAAA,EAAG,CAAC;AAAA,WACzG,OAAQ,SAAU,SAAU,QAAO,kBAAkB,YAAY,SAAS,GAAG;AAAE,WAAO,YAAY,GAAG,KAAK;AAAA,EAAG,CAAC;AAAA,WAC9G,OAAQ,SAAU,UAAW,QAAO,kBAAkB,YAAY,SAAS,GAAG;AAAE,WAAO,YAAY,GAAG,KAAK;AAAA,EAAG,CAAC;AAAA,WAC/G,iBAAiB,SAAU,QAAO,kBAAkB,YAAY,SAAS,GAAG;AAAE,WAAO,YAAY,GAAG,KAAK;AAAA,EAAG,CAAC;AAAA,WAC7G,OAAQ,SAAU,UAAU;AACpC,QAAI,iBAAiB,OAAQ,QAAO,cAAc,UAAa,kBAAkB,YAAY,SAAS,GAAG;AAAE,aAAO,KAAK,EAAE,MAAM,KAAK;AAAA,IAAG,CAAC;AAAA,aAC/H,QAAQ,KAAK,EAAG,QAAO,cAAc,UAAa,kBAAkB,YAAY,SAAS,GAAG;AAAE,aAAO,KAAK,aAAa,GAAG,KAAK;AAAA,IAAG,CAAC;AAAA,SACvI;AACJ,UAAI,OAAO,OAAO,KAAK,KAAK;AAC5B,UAAI,KAAK,CAAC,EAAE,OAAO,CAAC,KAAK,KAAK;AAC7B,iBAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACrC,cAAI,WAAW,OAAO,KAAK,KAAK,EAAE,CAAC;AACnC,cAAI,UAAU,MAAM,QAAQ;AAC5B,cAAI,YAAY,OAAO;AACtB,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,YAAY,GAAG,OAAO;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UAC7F,WAAW,YAAY,OAAO;AAC7B,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,cAAc,GAAG,SAAS,GAAG;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACpG,WAAW,YAAY,QAAQ;AAC9B,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,cAAc,GAAG,SAAS,IAAI;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACrG,WAAW,YAAY,OAAO;AAC7B,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,cAAc,GAAG,SAAS,GAAG;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACpG,WAAW,YAAY,QAAQ;AAC9B,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,cAAc,GAAG,SAAS,IAAI;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACrG,WAAW,YAAY,OAAO;AAC7B,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,CAAC,YAAY,GAAG,OAAO;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UAC9F,WAAW,YAAY,OAAO;AAC7B,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,KAAK,GAAG,OAAO;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACtF,WAAW,YAAY,QAAQ;AAC9B,gBAAI,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,KAAK,GAAG,OAAO;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACrF,WAAW,YAAY,WAAW;AAGlC,gBAAI,WAAW,QAAQ,KAAK,GAAG;AAC/B,gBAAI,UAAU,YAAY,SAAY,YAAY,OAAW,QAAO;AAAA,UACrE,WAAW,YAAY,SAAS;AAI/B,gBAAI,eAAe,QAAW;AAC7B,oBAAM,mBAAmB,OAAO,YAAY,WAAW,UAAU,aAAa,OAAO;AACrF,kBAAI,qBAAqB,EAAG,QAAO;AAAA,YACpC,OAAO;AACN,kBAAI,CAAC,YAAY,YAAY,OAAO,EAAG,QAAO;AAAA,YAC/C;AAAA,UACD,WAAW,YAAY,QAAQ;AAC9B,gBAAI,QAAQ,UAAU,EAAG,OAAM,EAAE,MAAM,yEAAyE,MAAM,MAAK;AAC3H,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,KAAK,UAAc,IAAI,QAAQ,CAAC,KAAK,QAAQ,CAAC;AAAA,YAAI,CAAC,EAAG,QAAO;AAAA,UACtH,WAAW,YAAY,UAAU;AAEhC,gBAAI,UAAU;AACd,gBAAI,QAAQ,MAAM,YAAY;AAC9B,gBAAI,QAAS,OAAO,YAAY,WAAY,IAAI,OAAO,SAAS,KAAK,IAAI;AACzE,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,KAAK,UAAa,MAAM,KAAK,CAAC;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACrG,WAAW,YAAY,YAAY;AAElC;AAAA,UACD,WAAW,YAAY,SAAS;AAC/B,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,KAAK,UAAa,KAAK,GAAG,OAAO;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACxG,WAAW,YAAY,SAAS;AAE/B,gBAAI;AACH,oBAAM,SAAS,mBAAmB,SAAS,GAAG;AAC9C,kBAAI,CAAC,OAAQ,QAAO;AAAA,YACrB,SAAS,GAAG;AAEX,qBAAO;AAAA,YACR;AAAA,UACD,WAAW,YAAY,cAAc;AACnC,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,KAAK,UAAa,UAAU,GAAG,OAAO;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UAC7G,WAAW,YAAY,WAAW,YAAY,eAAe;AAE5D,gBAAI;AACJ,gBAAI,QAAQ,WAAW;AACtB,4BAAc,QAAQ,UAAU;AAAA,YACjC,WAAW,QAAQ,aAAa;AAC/B,4BAAc,QAAQ;AAAA,YACvB,WAAW,MAAM,QAAQ,OAAO,GAAG;AAClC,4BAAc;AAAA,YACf;AAEA,gBAAI,eAAe,YAAY,UAAU,GAAG;AAC3C,oBAAM,CAAC,KAAK,GAAG,IAAI;AACnB,oBAAM,oBAAoB,QAAQ,gBAAgB;AAClD,kBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,uBAAO,KAAK,UAAa,OAAO,GAAG,KAAK,KAAK,iBAAiB;AAAA,cAAG,CAAC,EAAG,QAAO;AAAA,YAC9H,OAAO;AACN,qBAAO;AAAA,YACR;AAAA,UACD,WAAW,YAAY,kBAAkB;AAExC,kBAAM,WAAW,QAAQ,aAAa;AACtC,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,KAAK,UAAa,cAAc,GAAG,QAAQ;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UAClH,WAAW,YAAY,QAAQ;AAC9B,gBAAI,UAAU,KAAK,KAAK,OAAO,EAAG,QAAO;AAAA,UAC1C,WAAW,YAAY,QAAQ;AAE9B,gBAAI,kBAAkB,QAAQ,KAAK,GAAG;AACtC,gBAAI,mBAAmB,UAAa,CAAC,QAAQ,eAAe,EAAG,QAAO;AACtE,qBAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACxC,kBAAI,CAAC,KAAK,QAAQ,CAAC,GAAG,eAAe,EAAG,QAAO;AAAA,YAChD;AAAA,UACD,WAAW,YAAY,cAAc;AAEpC,gBAAI,kBAAkB,QAAQ,KAAK,GAAG;AACtC,gBAAI,mBAAmB,UAAa,CAAC,QAAQ,eAAe,EAAG,QAAO;AACtE,gBAAI,QAAQ;AACZ,qBAAS,IAAI,GAAG,IAAI,gBAAgB,QAAQ,KAAK;AAChD,kBAAI,UAAU,gBAAgB,CAAC;AAE/B,kBAAI,OAAO,YAAY,YAAY,CAAC,QAAQ,OAAO,GAAG;AAErD,oBAAI,QAAQ,SAAS,OAAO,GAAG;AAC9B,0BAAQ;AACR;AAAA,gBACD;AAAA,cACD,OAAO;AAEN,oBAAI,mBAAmB;AACvB,oBAAI,SAAS,OAAO,KAAK,OAAO;AAChC,yBAAS,IAAI,GAAG,IAAI,OAAO,QAAQ,KAAK;AACvC,sBAAI,KAAK,OAAO,CAAC;AACjB,sBAAI,UAAU,QAAQ,EAAE;AACxB,sBAAI,MAAM,UAAU,EAAE,WAAW,SAAU,oBAAmB;AAAA,2BACrD,MAAM,SAAS,EAAE,UAAU,SAAU,oBAAmB;AAAA,2BACxD,MAAM,UAAU,EAAE,WAAW,SAAU,oBAAmB;AAAA,2BAC1D,MAAM,SAAS,EAAE,UAAU,SAAU,oBAAmB;AAAA,2BACxD,MAAM,SAAS,EAAE,WAAW,SAAU,oBAAmB;AAAA,2BACzD,MAAM,SAAS,EAAE,WAAW,SAAU,oBAAmB;AAAA,2BACzD,MAAM,SAAS,CAAC,KAAK,SAAS,OAAO,EAAG,oBAAmB;AAAA,2BAC3D,MAAM,UAAU,KAAK,SAAS,OAAO,EAAG,oBAAmB;AAAA,gBACrE;AACA,oBAAI,kBAAkB;AACrB,0BAAQ;AACR;AAAA,gBACD;AAAA,cACD;AAAA,YACD;AACA,gBAAI,CAAC,MAAO,QAAO;AAAA,UACrB,WAAW,YAAY,SAAS;AAC/B,gBAAI,iBAAiB,QAAQ,KAAK,GAAG;AACrC,gBAAI,kBAAkB,UAAa,CAAC,QAAQ,cAAc,EAAG,QAAO;AACpE,gBAAI,eAAe,UAAU,QAAS,QAAO;AAAA,UAC9C,WAAW,YAAY,eAAe;AACrC,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,kBAAkB,GAAG,OAAO;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACnG,WAAW,YAAY,iBAAiB;AACvC,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,oBAAoB,GAAG,OAAO;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACrG,WAAW,YAAY,eAAe;AACrC,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,kBAAkB,GAAG,OAAO;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACnG,WAAW,YAAY,iBAAiB;AACvC,gBAAI,CAAC,kBAAkB,YAAY,SAAS,GAAG;AAAE,qBAAO,oBAAoB,GAAG,OAAO;AAAA,YAAG,CAAC,EAAG,QAAO;AAAA,UACrG,OAAO;AACL,kBAAM,EAAE,MAAM,0DAA0D,UAAU,MAAM,MAAK;AAAA,UAC9F;AAAA,QACD;AACA,eAAO;AAAA,MACR,OAAO;AACN,eAAO,QAAQ,KAAK,GAAG,KAAK,cAAc,QAAQ,KAAK,GAAG,GAAG,KAAK;AAAA,MACnE;AAAA,IACD;AAAA,EACD;AACD;AAKO,SAAS,IAAI,KAAK,OAAO;AAC/B,SAAO,CAAC,UAAU,KAAK,KAAK;AAC7B;AAKO,SAAS,IAAI,KAAK,KAAK;AAC7B,WAAS,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAK;AACpC,QAAI,CAAC,UAAU,KAAK,IAAI,CAAC,CAAC,GAAG;AAC5B,aAAO;AAAA,IACR;AAAA,EACD;AACA,SAAO;AACR;AAKO,SAAS,GAAG,KAAK,KAAK;AAC5B,WAAS,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAK;AACpC,QAAI,UAAU,KAAK,IAAI,CAAC,CAAC,EAAG,QAAO;AAAA,EACpC;AACA,SAAO;AACR;AAKO,SAAS,IAAI,KAAK,KAAK;AAC7B,WAAS,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAK;AACpC,QAAI,UAAU,KAAK,IAAI,CAAC,CAAC,EAAG,QAAO;AAAA,EACpC;AACA,SAAO;AACR;AAMO,SAAS,QAAQ,KAAK,OAAO;AACnC,SAAO,IAAI,KAAK,QAAQ,KAAK,CAAC;AAC/B;ACjvBO,MAAM,qBAAqBF,cAAAA,aAAa;AAAA,EAC9C,YAAY,QAAQ,WAAW,CAAA,GAAI,UAAU,CAAA,GAAI;AAChD,UAAK;AAEL,SAAK,SAAS;AACd,SAAK,WAAW;AAChB,SAAK,UAAU;AACf,SAAK,SAAS;AACd,SAAK,aAAa,oBAAI,IAAG;AACzB,SAAK,iBAAiB;AAGtB,SAAK,eAAc;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,iBAAiB;AAChB,QAAI,KAAK,OAAQ;AAEjB,UAAM,cAAc,KAAK,uBAAsB;AAE/C,eAAW,cAAc,aAAa;AACrC,WAAK,iBAAiB,UAAU;AAAA,IACjC;AAGA,QAAI,KAAK,OAAO,YAAY,SAAS,UAAU;AAC9C,WAAK,2BAA0B;AAAA,IAChC;AAGA,QAAI,KAAK,OAAO,YAAY,SAAS,MAAM;AAC1C,WAAK,+BAA8B;AAAA,IACpC;AAGA,QAAI,KAAK,OAAO,YAAY,SAAS,eAAe;AACnD,WAAK,2BAA0B;AAAA,IAChC;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,yBAAyB;AACxB,UAAM,cAAc,CAAA;AAGpB,QAAI,KAAK,OAAO,YAAY,SAAS,UAAU;AAE9C,iBAAW,CAAC,QAAQ,EAAE,KAAK,KAAK,OAAO,WAAW;AACjD,cAAM,kBAAkB,GAAG,mBAAkB;AAC7C,mBAAW,QAAQ,iBAAiB;AACnC,gBAAM,aAAa,GAAG,IAAI;AAC1B,cAAI,cAAc,WAAW,cAAc;AAC1C,wBAAY,KAAK,UAAU;AAAA,UAC5B;AAAA,QACD;AAAA,MACD;AACA,aAAO;AAAA,IACR;AAGA,QAAI,KAAK,OAAO,YAAY,SAAS,eAAe;AAEnD,WAAK,eAAc;AACnB,aAAO;AAAA,IACR;AAGA,QAAI,KAAK,OAAO,YAAY,SAAS,MAAM;AAC1C,YAAM,kBAAkB,KAAK,OAAO,mBAAkB;AACtD,iBAAW,QAAQ,iBAAiB;AACnC,cAAM,aAAa,KAAK,OAAO,IAAI;AACnC,YAAI,cAAc,WAAW,cAAc;AAC1C,sBAAY,KAAK,UAAU;AAAA,QAC5B;AAAA,MACD;AAEA,WAAK,WAAU;AAAA,IAChB;AAGA,QAAI,KAAK,OAAO,cAAc;AAC7B,kBAAY,KAAK,KAAK,MAAM;AAAA,IAC7B;AAEA,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,iBAAiB,YAAY;AAC5B,QAAI,KAAK,OAAQ;AACjB,QAAI,CAAC,WAAY;AACjB,QAAI,OAAO,WAAW,OAAO,WAAY;AACzC,QAAI,CAAC,WAAW,aAAc;AAC9B,QAAI,KAAK,WAAW,IAAI,UAAU,EAAG;AAErC,UAAM,WAAW;AAAA,MAChB,QAAQ,CAAC,QAAQ,KAAK,YAAY,UAAU,YAAY,GAAG;AAAA,MAC3D,QAAQ,CAAC,KAAK,sBAAsB,KAAK,YAAY,UAAU,YAAY,KAAK,iBAAiB;AAAA,MACjG,SAAS,CAAC,QAAQ,KAAK,YAAY,WAAW,YAAY,GAAG;AAAA,MAC7D,QAAQ,CAAC,QAAQ,KAAK,YAAY,UAAU,YAAY,GAAG;AAAA,IAC9D;AAGE,SAAK,WAAW,IAAI,YAAY,QAAQ;AAGxC,eAAW,GAAG,UAAU,SAAS,MAAM;AACvC,eAAW,GAAG,UAAU,SAAS,MAAM;AACvC,eAAW,GAAG,WAAW,SAAS,OAAO;AACzC,eAAW,GAAG,UAAU,SAAS,MAAM;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,YAAY,eAAe,YAAY,KAAK,oBAAoB,MAAM;AACrE,QAAI,KAAK,OAAQ;AAEjB,UAAM,cAAc,KAAK;AAAA,MACxB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACH;AAGE,QAAI,CAAC,KAAK,iBAAiB,WAAW,GAAG;AACxC;AAAA,IACD;AAEA,SAAK,KAAK,UAAU,WAAW;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,mBAAmB,eAAe,YAAY,KAAK,mBAAmB;AACrE,UAAM,QAAQ;AAAA,MACb,KAAK;AAAA,QACJ,OAAO,OAAO,KAAK,OAAO,EAAE,KAAK,cAAc,CAAC,EAAE,SAAS,QAAQ;AAAA,MACvE;AAAA,MACG;AAAA,MACA,aAAa,oBAAI,KAAI;AAAA,MACrB,IAAI;AAAA,QACH,IAAI,WAAW,GAAG;AAAA,QAClB,MAAM,WAAW;AAAA,MACrB;AAAA,MACG,aAAa;AAAA,QACZ,KAAK,IAAI;AAAA,MACb;AAAA,IACA;AAEE,YAAQ,eAAa;AAAA,MACpB,KAAK;AACJ,cAAM,eAAe;AACrB;AAAA,MAED,KAAK;AACJ,cAAM,oBAAoB,qBAAqB;AAAA,UAC9C,eAAe,CAAA;AAAA,UACf,eAAe,CAAA;AAAA,UACf,iBAAiB,CAAA;AAAA,QACtB;AAEI,YAAI,KAAK,QAAQ,iBAAiB,gBAAgB;AACjD,gBAAM,eAAe;AAAA,QACtB;AACA;AAAA,MAED,KAAK;AACJ,cAAM,eAAe;AACrB;AAAA,IAKJ;AAEE,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,iBAAiB,aAAa;AAC7B,QAAI,CAAC,KAAK,YAAY,KAAK,SAAS,WAAW,GAAG;AACjD,aAAO;AAAA,IACR;AAGA,eAAW,SAAS,KAAK,UAAU;AAClC,UAAI,MAAM,QAAQ;AAGjB,YAAI,CAAC,QAAQ,aAAa,MAAM,MAAM,GAAG;AACxC,iBAAO;AAAA,QACR;AAAA,MACD;AAAA,IACD;AAEA,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,gBAAgB,KAAK,MAAM;AAC1B,WAAO,KAAK,MAAM,GAAG,EAAE,OAAO,CAAC,SAAS,SAAS,UAAU,IAAI,GAAG,GAAG;AAAA,EACtE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,iBAAiB;AAAA,EAEjB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,6BAA6B;AAC5B,UAAM,SAAS,KAAK;AACpB,UAAM,aAAa,OAAO,GAAG,KAAK,MAAM;AACxC,UAAM,OAAO;AAGb,SAAK,cAAc,oBAAI,IAAG;AAG1B,WAAO,KAAK,SAAS,MAAM,MAAM;AAChC,YAAM,WAAW,WAAW,MAAM,IAAI;AACtC,YAAM,SAAS,SAAS;AAGxB,UAAI,CAAC,KAAK,YAAY,IAAI,MAAM,GAAG;AAClC,aAAK,YAAY,IAAI,QAAQ,QAAQ;AAGrC,cAAM,kBAAkB,SAAS,mBAAkB;AACnD,mBAAW,WAAW,iBAAiB;AACtC,gBAAM,MAAM,SAAS,OAAO;AAC5B,cAAI,OAAO,IAAI,gBAAgB,CAAC,KAAK,WAAW,IAAI,GAAG,GAAG;AACzD,iBAAK,iBAAiB,GAAG;AAAA,UAC1B;AAAA,QACD;AAGA,aAAK,wCAAwC,QAAQ;AAAA,MACtD;AAEA,aAAO;AAAA,IACR;AAGA,SAAK,yBAAyB,EAAE,IAAI,WAAU;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,6BAA6B;AAC5B,UAAM,SAAS,KAAK;AACpB,UAAM,gBAAgB,OAAO,OAAO,KAAK,MAAM;AAC/C,UAAM,OAAO;AAGb,SAAK,cAAc,oBAAI,IAAG;AAG1B,WAAO,SAAS,SAAS,QAAQ;AAChC,YAAM,KAAK,cAAc,MAAM;AAG/B,UAAI,CAAC,KAAK,YAAY,IAAI,MAAM,GAAG;AAClC,aAAK,YAAY,IAAI,QAAQ,EAAE;AAG/B,cAAM,kBAAkB,GAAG,mBAAkB;AAC7C,mBAAW,WAAW,iBAAiB;AACtC,gBAAM,MAAM,GAAG,OAAO;AACtB,cAAI,OAAO,IAAI,gBAAgB,CAAC,KAAK,WAAW,IAAI,GAAG,GAAG;AACzD,iBAAK,iBAAiB,GAAG;AAAA,UAC1B;AAAA,QACD;AAGA,aAAK,wCAAwC,EAAE;AAAA,MAChD;AAEA,aAAO;AAAA,IACR;AAGA,SAAK,yBAAyB,EAAE,QAAQ,cAAa;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,wCAAwC,IAAI;AAC3C,UAAM,qBAAqB,GAAG,WAAW,KAAK,EAAE;AAChD,UAAM,2BAA2B,GAAG,iBAAiB,KAAK,EAAE;AAC5D,UAAM,OAAO;AAEb,OAAG,aAAa,SAAS,MAAM;AAC9B,YAAM,MAAM,mBAAmB,IAAI;AACnC,UAAI,OAAO,IAAI,gBAAgB,CAAC,KAAK,WAAW,IAAI,GAAG,GAAG;AACzD,aAAK,iBAAiB,GAAG;AAAA,MAC1B;AACA,aAAO;AAAA,IACR;AAEA,OAAG,mBAAmB,SAAS,MAAM;AACpC,+BAAyB,IAAI;AAC7B,YAAM,MAAM,GAAG,IAAI;AACnB,UAAI,OAAO,IAAI,gBAAgB,CAAC,KAAK,WAAW,IAAI,GAAG,GAAG;AACzD,aAAK,iBAAiB,GAAG;AAAA,MAC1B;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,wCAAwC,IAAI;AAC3C,UAAM,qBAAqB,GAAG,WAAW,KAAK,EAAE;AAChD,UAAM,2BAA2B,GAAG,iBAAiB,KAAK,EAAE;AAC5D,UAAM,OAAO;AAEb,OAAG,aAAa,SAAS,MAAM;AAC9B,YAAM,MAAM,mBAAmB,IAAI;AACnC,UAAI,OAAO,IAAI,gBAAgB,CAAC,KAAK,WAAW,IAAI,GAAG,GAAG;AACzD,aAAK,iBAAiB,GAAG;AAAA,MAC1B;AACA,aAAO;AAAA,IACR;AAEA,OAAG,mBAAmB,SAAS,MAAM;AACpC,+BAAyB,IAAI;AAC7B,YAAM,MAAM,GAAG,IAAI;AACnB,UAAI,OAAO,IAAI,gBAAgB,CAAC,KAAK,WAAW,IAAI,GAAG,GAAG;AACzD,aAAK,iBAAiB,GAAG;AAAA,MAC1B;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,aAAa;AAAA,EAEb;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,iCAAiC;AAChC,UAAM,KAAK,KAAK;AAChB,UAAM,qBAAqB,GAAG,WAAW,KAAK,EAAE;AAChD,UAAM,2BAA2B,GAAG,iBAAiB,KAAK,EAAE;AAC5D,UAAM,OAAO;AAGb,OAAG,aAAa,SAAS,MAAM;AAC9B,YAAM,MAAM,mBAAmB,IAAI;AAEnC,UAAI,OAAO,IAAI,gBAAgB,CAAC,KAAK,WAAW,IAAI,GAAG,GAAG;AACzD,aAAK,iBAAiB,GAAG;AAAA,MAC1B;AACA,aAAO;AAAA,IACR;AAGA,OAAG,mBAAmB,SAAS,MAAM;AACpC,+BAAyB,IAAI;AAC7B,YAAM,MAAM,GAAG,IAAI;AACnB,UAAI,OAAO,IAAI,gBAAgB,CAAC,KAAK,WAAW,IAAI,GAAG,GAAG;AACzD,aAAK,iBAAiB,GAAG;AAAA,MAC1B;AAAA,IACD;AAGA,SAAK,qBAAqB,EAAE,YAAY,oBAAoB,kBAAkB,yBAAwB;AAAA,EACvG;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ;AACP,QAAI,KAAK,OAAQ;AAEjB,SAAK,SAAS;AAGd,eAAW,CAAC,YAAY,QAAQ,KAAK,KAAK,YAAY;AACrD,iBAAW,IAAI,UAAU,SAAS,MAAM;AACxC,iBAAW,IAAI,UAAU,SAAS,MAAM;AACxC,iBAAW,IAAI,WAAW,SAAS,OAAO;AAC1C,iBAAW,IAAI,UAAU,SAAS,MAAM;AAAA,IACzC;AAEA,SAAK,WAAW,MAAK;AAGrB,QAAI,KAAK,0BAA0B,KAAK,OAAO,YAAY,SAAS,UAAU;AAC7E,WAAK,OAAO,SAAS,KAAK,uBAAuB;AAAA,IAClD;AAGA,QAAI,KAAK,sBAAsB,KAAK,OAAO,YAAY,SAAS,MAAM;AACrE,WAAK,OAAO,aAAa,KAAK,mBAAmB;AACjD,WAAK,OAAO,mBAAmB,KAAK,mBAAmB;AAAA,IACxD;AAGA,QAAI,KAAK,0BAA0B,KAAK,OAAO,YAAY,SAAS,eAAe;AAClF,WAAK,OAAO,KAAK,KAAK,uBAAuB;AAAA,IAC9C;AAGA,SAAK,KAAK,OAAO;AACjB,SAAK,mBAAkB;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,WAAW;AACd,WAAO,KAAK;AAAA,EACb;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ,OAAO,aAAa,IAAI;AAC/B,UAAM,QAAQ,CAAA;AACd,QAAI,cAAc;AAClB,QAAI,eAAe;AAEnB,UAAM,WAAW,CAAC,WAAW;AAC5B,UAAI,aAAa;AAChB,oBAAY,EAAE,OAAO,QAAQ,MAAM,MAAK,CAAE;AAC1C,sBAAc;AAAA,MACf,OAAO;AACN,cAAM,KAAK,MAAM;AAAA,MAClB;AAAA,IACD;AAEA,UAAM,UAAU,MAAM;AACrB,qBAAe;AACf,UAAI,aAAa;AAChB,oBAAY,EAAE,MAAM,MAAM;AAC1B,sBAAc;AAAA,MACf;AAAA,IACD;AAEA,UAAM,UAAU,CAAC,UAAU;AAC1B,UAAI,aAAa;AAChB,oBAAY,QAAQ,OAAO,KAAK,CAAC;AACjC,sBAAc;AAAA,MACf;AAAA,IACD;AAEA,SAAK,GAAG,UAAU,QAAQ;AAC1B,SAAK,GAAG,SAAS,OAAO;AACxB,SAAK,GAAG,SAAS,OAAO;AAExB,QAAI;AACH,aAAO,CAAC,cAAc;AACrB,YAAI,MAAM,SAAS,GAAG;AACrB,gBAAM,MAAM,MAAK;AAAA,QAClB,OAAO;AACN,gBAAM,OAAO,MAAM,IAAI,QAAQ,CAAC,YAAY;AAC3C,0BAAc;AAEd,gBAAI,cAAc;AACjB,sBAAQ,EAAE,MAAM,MAAM;AAAA,YACvB;AAAA,UACD,CAAC;AAED,cAAI,KAAK,KAAM;AACf,gBAAM,KAAK;AAAA,QACZ;AAAA,MACD;AAAA,IACD,UAAC;AACA,WAAK,IAAI,UAAU,QAAQ;AAC3B,WAAK,IAAI,SAAS,OAAO;AACzB,WAAK,IAAI,SAAS,OAAO;AAAA,IAC1B;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO;AACZ,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvC,YAAM,WAAW,CAAC,WAAW;AAC5B,gBAAO;AACP,gBAAQ,MAAM;AAAA,MACf;AAEA,YAAM,UAAU,MAAM;AACrB,gBAAO;AACP,gBAAQ,IAAI;AAAA,MACb;AAEA,YAAM,UAAU,CAAC,UAAU;AAC1B,gBAAO;AACP,eAAO,KAAK;AAAA,MACb;AAEA,YAAM,UAAU,MAAM;AACrB,aAAK,IAAI,UAAU,QAAQ;AAC3B,aAAK,IAAI,SAAS,OAAO;AACzB,aAAK,IAAI,SAAS,OAAO;AAAA,MAC1B;AAEA,UAAI,KAAK,QAAQ;AAChB,gBAAQ,IAAI;AACZ;AAAA,MACD;AAEA,WAAK,KAAK,UAAU,QAAQ;AAC5B,WAAK,KAAK,SAAS,OAAO;AAC1B,WAAK,KAAK,SAAS,OAAO;AAAA,IAC3B,CAAC;AAAA,EACF;AACD;ACriBA,SAAS,iBAAiB,KAAK;AAC7B,MAAI,QAAQ,QAAQ,QAAQ,OAAW,QAAO;AAC9C,MAAI,OAAO,QAAQ,YAAY;AAC7B,WAAO,EAAE,YAAY,IAAI,WAAU;AAAA,EACrC;AACA,MAAI,eAAe,UAAU;AAC3B,WAAO,EAAE,YAAY,IAAI,WAAU;AAAA,EACrC;AACA,MAAI,eAAe,MAAM;AACvB,WAAO,EAAE,QAAQ,IAAI,cAAa;AAAA,EACpC;AACA,MAAI,MAAM,QAAQ,GAAG,GAAG;AACtB,WAAO,IAAI,IAAI,gBAAgB;AAAA,EACjC;AACA,MAAI,OAAO,QAAQ,UAAU;AAC3B,UAAM,SAAS,CAAA;AACf,eAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,GAAG,GAAG;AAC9C,aAAO,GAAG,IAAI,iBAAiB,KAAK;AAAA,IACtC;AACA,WAAO;AAAA,EACT;AACA,SAAO;AACT;AAKA,SAAS,mBAAmB,KAAK;AAC/B,MAAI,QAAQ,QAAQ,QAAQ,OAAW,QAAO;AAC9C,MAAI,OAAO,QAAQ,YAAY,IAAI,YAAY;AAC7C,WAAO,OAAO,IAAI,eAAe,WAAW,IAAI,IAAI,UAAU,iBAAiB;AAAA,EACjF;AACA,MAAI,OAAO,QAAQ,YAAY,IAAI,YAAY;AAC7C,WAAO,IAAI,SAAS,IAAI,UAAU;AAAA,EACpC;AACA,MAAI,OAAO,QAAQ,YAAY,IAAI,QAAQ;AACzC,WAAO,IAAI,KAAK,IAAI,MAAM;AAAA,EAC5B;AACA,MAAI,MAAM,QAAQ,GAAG,GAAG;AACtB,WAAO,IAAI,IAAI,kBAAkB;AAAA,EACnC;AACA,MAAI,OAAO,QAAQ,UAAU;AAC3B,UAAM,SAAS,CAAA;AACf,eAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,GAAG,GAAG;AAC9C,aAAO,GAAG,IAAI,mBAAmB,KAAK;AAAA,IACxC;AACA,WAAO;AAAA,EACT;AACA,SAAO;AACT;AAMO,MAAM,qBAAqBA,cAAAA,aAAa;AAAA,EAC7C,YAAY,QAAQ;AAClB,UAAK;AACL,SAAK,SAAS;AACd,SAAK,UAAU;AACf,SAAK,WAAW,oBAAI,IAAG;AACvB,SAAK,eAAe;AAEpB,SAAK,iBAAiB,KAAK,eAAe,KAAK,IAAI;AACnD,SAAK,eAAe,KAAK,aAAa,KAAK,IAAI;AAE/C,SAAK,QAAO;AAAA,EACd;AAAA,EAEA,aAAa,OAAO,UAAU,IAAI;AAEhC,QAAI,OAAO,WAAW,eAAe,OAAO,WAAW,WAAW,aAAa;AAC7E,aAAO,IAAI,oBAAoB,OAAO;AAAA,IACxC;AAGA,UAAM,EAAE,QAAQ,eAAe,MAAM,OAAO,gBAAgB;AAC5D,UAAM,EAAE,cAAa,IAAK,MAAM,OAAO,KAAK;AAG5C,QAAI,aAAa,QAAQ;AACzB,QAAI,CAAC,YAAY;AACf,YAAM,WAAW,IAAA,IAAA,4CAAA,YAAA,GAAA;AACjB,mBAAa,cAAc,QAAQ;AAAA,IACrC;AACA,UAAM,SAAS,IAAI,WAAW,YAAY;AAAA,MACxC,YAAY,QAAQ;AAAA,IAC1B,CAAK;AACD,WAAO,IAAI,iBAAiB,MAAM;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,YAAY,SAAS,OAAO,IAAI;AAC9B,UAAM,KAAK,KAAK;AAChB,UAAM,oBAAoB,iBAAiB,OAAO;AAClD,UAAM,UAAU,EAAE,MAAM,WAAW,IAAI,SAAS,kBAAiB;AAEjE,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,UAAI;AACJ,UAAI,KAAK,SAAS;AAChB,wBAAgB,WAAW,MAAM;AAC/B,eAAK,SAAS,OAAO,EAAE;AACvB,iBAAO,IAAI,MAAM,kCAAkC,KAAK,OAAO,IAAI,CAAC;AAAA,QACtE,GAAG,KAAK,OAAO;AAAA,MACjB;AAEA,WAAK,SAAS,IAAI,IAAI,EAAE,SAAS,QAAQ,eAAe;AACxD,WAAK,MAAM,OAAO;AAAA,IACpB,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,YAAY;AAChB,SAAK,eAAe;AAEpB,eAAW,CAAC,IAAI,OAAO,KAAK,KAAK,SAAS,WAAW;AACnD,mBAAa,QAAQ,aAAa;AAAA,IACpC;AACA,SAAK,SAAS,MAAK;AACnB,UAAM,KAAK,eAAc;AAAA,EAC3B;AAAA,EAEA,eAAe,OAAO;AACpB,UAAM,OAAO,OAAO,QAAQ;AAC5B,QAAI,CAAC,KAAM;AAEX,QAAI,KAAK,SAAS,YAAY;AAC5B,YAAM,UAAU,KAAK,SAAS,IAAI,KAAK,EAAE;AACzC,UAAI,CAAC,QAAS;AACd,WAAK,SAAS,OAAO,KAAK,EAAE;AAC5B,mBAAa,QAAQ,aAAa;AAClC,UAAI,KAAK,SAAS;AAChB,cAAM,qBAAqB,mBAAmB,KAAK,MAAM;AACzD,gBAAQ,QAAQ,kBAAkB;AAAA,MACpC,OAAO;AACL,cAAM,QAAQ,IAAI,MAAM,KAAK,OAAO,WAAW,cAAc;AAC7D,YAAI,KAAK,OAAO,KAAM,OAAM,OAAO,KAAK,MAAM;AAC9C,YAAI,KAAK,OAAO,MAAO,OAAM,QAAQ,KAAK,MAAM;AAChD,YAAI,KAAK,OAAO,KAAM,OAAM,OAAO,KAAK,MAAM;AAC9C,YAAI,KAAK,OAAO,KAAM,OAAM,OAAO,KAAK,MAAM;AAC9C,gBAAQ,OAAO,KAAK;AAAA,MACtB;AACA;AAAA,IACF;AAGA,QAAI,KAAK,SAAS,SAAS;AACzB,YAAM,sBAAsB,mBAAmB,KAAK,OAAO;AAC3D,WAAK,KAAK,SAAS,KAAK,OAAO,mBAAmB;AAAA,IACpD;AAAA,EACF;AAAA,EAEA,aAAa,OAAO;AAElB,QAAI,KAAK,aAAc;AAGvB,eAAW,CAAC,IAAI,OAAO,KAAK,KAAK,SAAS,WAAW;AACnD,mBAAa,QAAQ,aAAa;AAClC,cAAQ,OAAO,KAAK;AAAA,IACtB;AACA,SAAK,SAAS,MAAK;AACnB,SAAK,KAAK,SAAS,KAAK;AAAA,EAC1B;AAAA;AAAA,EAGA,UAAU;AAAE,UAAM,IAAI,MAAM,iBAAiB;AAAA,EAAG;AAAA,EAChD,QAAQ;AAAE,UAAM,IAAI,MAAM,iBAAiB;AAAA,EAAG;AAAA,EAC9C,iBAAiB;AAAE,UAAM,IAAI,MAAM,iBAAiB;AAAA,EAAG;AACzD;AAEA,MAAM,4BAA4B,aAAa;AAAA,EAC7C,YAAY,UAAU,IAAI;AAExB,UAAM,gBAAgB,WAAW;AACjC,QAAI,CAAC,eAAe;AAClB,YAAM,IAAI,MAAM,iDAAiD;AAAA,IACnE;AAIA,UAAM,YAAY,QAAQ,aAAa;AACvC,UAAM,SAAS,IAAI,cAAc,WAAW,EAAE,MAAM,UAAU;AAC9D,UAAM,MAAM;AAAA,EACd;AAAA,EAEA,UAAU;AACR,SAAK,OAAO,YAAY,KAAK;AAC7B,SAAK,OAAO,UAAU,KAAK;AAAA,EAC7B;AAAA,EAEA,MAAM,SAAS;AACb,SAAK,OAAO,YAAY,OAAO;AAAA,EACjC;AAAA,EAEA,iBAAiB;AACf,SAAK,OAAO,UAAS;AAAA,EACvB;AACF;AAEA,MAAM,yBAAyB,aAAa;AAAA,EAC1C,YAAY,QAAQ;AAClB,UAAM,MAAM;AAAA,EACd;AAAA,EAEA,UAAU;AACR,SAAK,OAAO,GAAG,WAAW,KAAK,cAAc;AAC7C,SAAK,OAAO,GAAG,SAAS,KAAK,YAAY;AACzC,SAAK,OAAO,GAAG,QAAQ,CAAC,SAAS;AAC/B,UAAI,SAAS,KAAK,CAAC,KAAK,cAAc;AACpC,aAAK,aAAa,IAAI,MAAM,iCAAiC,IAAI,EAAE,CAAC;AAAA,MACtE;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,SAAS;AACb,SAAK,OAAO,YAAY,OAAO;AAAA,EACjC;AAAA,EAEA,iBAAiB;AACf,WAAO,KAAK,OAAO,UAAS;AAAA,EAC9B;AACF;","x_google_ignoreList":[0,7,9,10]}