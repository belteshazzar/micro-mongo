var l,b={exports:{}};var Z=function(){if(l)return b.exports;l=1;var Z,d="object"==typeof Reflect?Reflect:null,c=d&&"function"==typeof d.apply?d.apply:function(l,b,Z){return Function.prototype.apply.call(l,b,Z)};Z=d&&"function"==typeof d.ownKeys?d.ownKeys:Object.getOwnPropertySymbols?function(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:function(l){return Object.getOwnPropertyNames(l)};var i=Number.isNaN||function(l){return l!=l};function m(){m.init.call(this)}b.exports=m,b.exports.once=function(l,b){return new Promise(function(Z,d){function c(Z){l.removeListener(b,i),d(Z)}function i(){"function"==typeof l.removeListener&&l.removeListener("error",c),Z([].slice.call(arguments))}o(l,b,i,{once:!0}),"error"!==b&&function(l,b,Z){"function"==typeof l.on&&o(l,"error",b,Z)}(l,c,{once:!0})})},m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var G=10;function X(l){if("function"!=typeof l)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof l)}function t(l){return void 0===l._maxListeners?m.defaultMaxListeners:l._maxListeners}function u(l,b,Z,d){var c,i,m,G;if(X(Z),void 0===(i=l._events)?(i=l._events=/* @__PURE__ */Object.create(null),l._eventsCount=0):(void 0!==i.newListener&&(l.emit("newListener",b,Z.listener?Z.listener:Z),i=l._events),m=i[b]),void 0===m)m=i[b]=Z,++l._eventsCount;else if("function"==typeof m?m=i[b]=d?[Z,m]:[m,Z]:d?m.unshift(Z):m.push(Z),(c=t(l))>0&&m.length>c&&!m.warned){m.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=l,u.type=b,u.count=m.length,G=u,console&&console.warn&&console.warn(G)}return l}function n(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function W(l,b,Z){var d={fired:!1,wrapFn:void 0,target:l,type:b,listener:Z},c=n.bind(d);return c.listener=Z,d.wrapFn=c,c}function e(l,b,Z){var d=l._events;if(void 0===d)return[];var c=d[b];return void 0===c?[]:"function"==typeof c?Z?[c.listener||c]:[c]:Z?function(l){for(var b=new Array(l.length),Z=0;Z<b.length;++Z)b[Z]=l[Z].listener||l[Z];return b}(c):a(c,c.length)}function p(l){var b=this._events;if(void 0!==b){var Z=b[l];if("function"==typeof Z)return 1;if(void 0!==Z)return Z.length}return 0}function a(l,b){for(var Z=new Array(b),d=0;d<b;++d)Z[d]=l[d];return Z}function o(l,b,Z,d){if("function"==typeof l.on)d.once?l.once(b,Z):l.on(b,Z);else{if("function"!=typeof l.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof l);l.addEventListener(b,function c(i){d.once&&l.removeEventListener(b,c),Z(i)})}}return Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return G},set:function(l){if("number"!=typeof l||l<0||i(l))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+l+".");G=l}}),m.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=/* @__PURE__ */Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(l){if("number"!=typeof l||l<0||i(l))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+l+".");return this._maxListeners=l,this},m.prototype.getMaxListeners=function(){return t(this)},m.prototype.emit=function(l){for(var b=[],Z=1;Z<arguments.length;Z++)b.push(arguments[Z]);var d="error"===l,i=this._events;if(void 0!==i)d=d&&void 0===i.error;else if(!d)return!1;if(d){var m;if(b.length>0&&(m=b[0]),m instanceof Error)throw m;var G=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw G.context=m,G}var X=i[l];if(void 0===X)return!1;if("function"==typeof X)c(X,this,b);else{var t=X.length,u=a(X,t);for(Z=0;Z<t;++Z)c(u[Z],this,b)}return!0},m.prototype.addListener=function(l,b){return u(this,l,b,!1)},m.prototype.on=m.prototype.addListener,m.prototype.prependListener=function(l,b){return u(this,l,b,!0)},m.prototype.once=function(l,b){return X(b),this.on(l,W(this,l,b)),this},m.prototype.prependOnceListener=function(l,b){return X(b),this.prependListener(l,W(this,l,b)),this},m.prototype.removeListener=function(l,b){var Z,d,c,i,m;if(X(b),void 0===(d=this._events))return this;if(void 0===(Z=d[l]))return this;if(Z===b||Z.listener===b)0===--this._eventsCount?this._events=/* @__PURE__ */Object.create(null):(delete d[l],d.removeListener&&this.emit("removeListener",l,Z.listener||b));else if("function"!=typeof Z){for(c=-1,i=Z.length-1;i>=0;i--)if(Z[i]===b||Z[i].listener===b){m=Z[i].listener,c=i;break}if(c<0)return this;0===c?Z.shift():function(l,b){for(;b+1<l.length;b++)l[b]=l[b+1];l.pop()}(Z,c),1===Z.length&&(d[l]=Z[0]),void 0!==d.removeListener&&this.emit("removeListener",l,m||b)}return this},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(l){var b,Z,d;if(void 0===(Z=this._events))return this;if(void 0===Z.removeListener)return 0===arguments.length?(this._events=/* @__PURE__ */Object.create(null),this._eventsCount=0):void 0!==Z[l]&&(0===--this._eventsCount?this._events=/* @__PURE__ */Object.create(null):delete Z[l]),this;if(0===arguments.length){var c,i=Object.keys(Z);for(d=0;d<i.length;++d)"removeListener"!==(c=i[d])&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=/* @__PURE__ */Object.create(null),this._eventsCount=0,this}if("function"==typeof(b=Z[l]))this.removeListener(l,b);else if(void 0!==b)for(d=b.length-1;d>=0;d--)this.removeListener(l,b[d]);return this},m.prototype.listeners=function(l){return e(this,l,!0)},m.prototype.rawListeners=function(l){return e(this,l,!1)},m.listenerCount=function(l,b){return"function"==typeof l.listenerCount?l.listenerCount(b):p.call(l,b)},m.prototype.listenerCount=p,m.prototype.eventNames=function(){return this._eventsCount>0?Z(this._events):[]},b.exports}();const d={OK:0,INTERNAL_ERROR:1,BAD_VALUE:2,NO_SUCH_KEY:4,GRAPH_CONTAINS_CYCLE:5,HOST_UNREACHABLE:6,HOST_NOT_FOUND:7,UNKNOWN_ERROR:8,FAILED_TO_PARSE:17287,CANNOT_MUTATE_OBJECT:10,USER_NOT_FOUND:11,UNSUPPORTED_FORMAT:12,UNAUTHORIZED:13,TYPE_MISMATCH:14,OVERFLOW:15,INVALID_LENGTH:16,PROTOCOL_ERROR:17,AUTHENTICATION_FAILED:18,ILLEGAL_OPERATION:20,NAMESPACE_NOT_FOUND:26,INDEX_NOT_FOUND:27,PATH_NOT_VIABLE:28,CANNOT_CREATE_INDEX:67,INDEX_ALREADY_EXISTS:68,INDEX_EXISTS:68,COMMAND_NOT_FOUND:59,NAMESPACE_EXISTS:48,INVALID_NAMESPACE:73,INDEX_OPTIONS_CONFLICT:85,INVALID_INDEX_SPECIFICATION_OPTION:197,WRITE_CONFLICT:112,DUPLICATE_KEY:11e3,DUPLICATE_KEY_UPDATE:11001,DOCUMENT_VALIDATION_FAILURE:121,BAD_QUERY:2,CANNOT_INDEX_PARALLEL_ARRAYS:171,CURSOR_NOT_FOUND:43,COLLECTION_IS_EMPTY:26,CANNOT_DO_EXCLUSION_ON_FIELD_ID_IN_INCLUSION_PROJECTION:31254,NOT_IMPLEMENTED:999,OPERATION_NOT_SUPPORTED:998};class c extends Error{constructor(l,b={}){super(l),this.name="MongoError",this.code=b.code||d.UNKNOWN_ERROR,this.codeName=this._getCodeName(this.code),this.$err=l,b.collection&&(this.collection=b.collection),b.database&&(this.database=b.database),b.operation&&(this.operation=b.operation),b.query&&(this.query=b.query),b.document&&(this.document=b.document),b.field&&(this.field=b.field),b.index&&(this.index=b.index),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}_getCodeName(l){return{0:"OK",1:"InternalError",2:"BadValue",4:"NoSuchKey",5:"GraphContainsCycle",6:"HostUnreachable",7:"HostNotFound",8:"UnknownError",10:"CannotMutateObject",11:"UserNotFound",12:"UnsupportedFormat",13:"Unauthorized",14:"TypeMismatch",15:"Overflow",16:"InvalidLength",17:"ProtocolError",18:"AuthenticationFailed",20:"IllegalOperation",26:"NamespaceNotFound",27:"IndexNotFound",28:"PathNotViable",43:"CursorNotFound",48:"NamespaceExists",59:"CommandNotFound",67:"CannotCreateIndex",68:"IndexExists",73:"InvalidNamespace",85:"IndexOptionsConflict",112:"WriteConflict",121:"DocumentValidationFailure",171:"CannotIndexParallelArrays",197:"InvalidIndexSpecificationOption",998:"OperationNotSupported",999:"NotImplemented",11e3:"DuplicateKey",11001:"DuplicateKeyUpdate",17287:"FailedToParse"}[l]||"UnknownError"}toJSON(){const l={name:this.name,message:this.message,code:this.code,codeName:this.codeName};return this.collection&&(l.collection=this.collection),this.database&&(l.database=this.database),this.operation&&(l.operation=this.operation),this.index&&(l.index=this.index),this.indexName&&(l.indexName=this.indexName),this.field&&(l.field=this.field),this.query&&(l.query=this.query),this.document&&(l.document=this.document),this.namespace&&(l.namespace=this.namespace),this.cursorId&&(l.cursorId=this.cursorId),this.feature&&(l.feature=this.feature),this.keyPattern&&(l.keyPattern=this.keyPattern),this.keyValue&&(l.keyValue=this.keyValue),this.writeErrors&&(l.writeErrors=this.writeErrors),l}}class i extends c{constructor(l,b={}){super(l,b),this.name="MongoServerError"}}class m extends c{constructor(l,b={}){super(l,b),this.name="MongoDriverError",this.code=b.code||d.INTERNAL_ERROR}}class G extends c{constructor(l,b={}){super(l,b),this.name="WriteError",this.code=b.code||d.WRITE_CONFLICT}}class X extends G{constructor(l,b={}){const Z=JSON.stringify(l);super(`E11000 duplicate key error${b.collection?` collection: ${b.collection}`:""} index: ${Z} dup key: ${Z}`,{...b,code:d.DUPLICATE_KEY}),this.name="DuplicateKeyError",this.keyPattern=l,this.keyValue=b.keyValue||l}}class t extends c{constructor(l,b={}){super(l,b),this.name="ValidationError",this.code=b.code||d.DOCUMENT_VALIDATION_FAILURE,this.validationErrors=b.validationErrors||[]}}class u extends c{constructor(l,b={}){super(l,b),this.name="IndexError"}}class n extends u{constructor(l,b={}){super(`Index with name '${l}' already exists`,{...b,code:d.INDEX_EXISTS}),this.name="IndexExistsError",this.indexName=l}}class W extends u{constructor(l,b={}){super(`Index '${l}' not found`,{...b,code:d.INDEX_NOT_FOUND,index:l}),this.name="IndexNotFoundError",this.indexName=l}}class e extends u{constructor(l,b={}){super(`Cannot create index: ${l}`,{...b,code:d.CANNOT_CREATE_INDEX}),this.name="CannotCreateIndexError"}}class p extends c{constructor(l,b={}){super(l,b),this.name="QueryError",this.code=b.code||d.BAD_QUERY}}class a extends c{constructor(l,b,Z,c={}){super(`Type mismatch for field '${l}': expected ${b}, got ${Z}`,{...c,code:d.TYPE_MISMATCH,field:l}),this.name="TypeMismatchError",this.expectedType=b,this.actualType=Z}}class o extends c{constructor(l,b={}){super(l,b),this.name="NamespaceError"}}class h extends o{constructor(l,b={}){super(`Namespace '${l}' not found`,{...b,code:d.NAMESPACE_NOT_FOUND}),this.name="NamespaceNotFoundError",this.namespace=l}}class s extends o{constructor(l,b,Z={}){"object"!=typeof b||Z||(Z=b,b=void 0);super(b?`Invalid namespace '${l}': ${b}`:`Invalid namespace '${l}'`,{...Z,code:d.INVALID_NAMESPACE}),this.name="InvalidNamespaceError",this.namespace=l}}class V extends c{constructor(l,b={}){super(l,b),this.name="CursorError"}}class y extends V{constructor(l,b={}){super(`Cursor ${l} not found`,{...b,code:d.CURSOR_NOT_FOUND}),this.name="CursorNotFoundError",this.cursorId=l}}class I extends c{constructor(l,b={}){super(`${l} is not implemented in micro-mongo`,{...b,code:d.NOT_IMPLEMENTED}),this.name="NotImplementedError",this.feature=l}}class Y extends c{constructor(l,b,Z={}){"object"!=typeof b||Z||(Z=b,b=void 0);super(b?`Operation '${l}' is not supported: ${b}`:`Operation '${l}' is not supported`,{...Z,code:d.OPERATION_NOT_SUPPORTED,operation:l}),this.name="OperationNotSupportedError"}}class K extends c{constructor(l,b,Z,c={}){super(`Bad value for field '${l}': ${Z}`,{...c,code:d.BAD_VALUE,field:l}),this.name="BadValueError",this.value=b}}class R extends c{constructor(l=[],b={}){super(`Bulk write operation error: ${l.length} error(s)`,b),this.name="BulkWriteError",this.writeErrors=l,this.code=b.code||d.WRITE_CONFLICT}}class r extends c{constructor(l,b={}){super(l,b),this.name="MongoNetworkError",this.code=b.code||d.HOST_UNREACHABLE}}class g extends Z.EventEmitter{static create({bridge:l,database:b,collection:Z,streamId:d,pipeline:c=[],options:i={}}){const m=new g({bridge:l,streamId:d});if(!d){let d,G;null==b?(d="client",G="watch"):null==Z?(d="db",G="watch"):(d="collection",G="watch"),l.sendRequest({target:d,database:b,collection:Z,method:G,args:[c,i]}).then(l=>{l&&l.streamId&&(m.streamId=l.streamId)}).catch(()=>{})}return m}constructor({bridge:l,streamId:b}){super(),this.bridge=l,this.streamId=b,this.closed=!1,this._pendingNext=[],this._onEvent=this._onEvent.bind(this),this.bridge.on("event",this._onEvent)}_onEvent(l,b){if("changeStream"!==l)return;if(!b||b.streamId!==this.streamId)return;const{type:Z,data:d}=b;"change"===Z&&this.emit("change",d),"error"===Z&&this.emit("error",d),"close"===Z&&(this.emit("close"),this._cleanup())}_cleanup(){this.bridge.off("event",this._onEvent)}async close(){if(!this.closed){this.closed=!0;for(const l of this._pendingNext)l.resolve(null);this._pendingNext=[],this.bridge.sendRequest({target:"changestream",streamId:this.streamId,method:"close"}).catch(()=>{}),this.emit("close"),this._cleanup()}}async next(){return this.closed?null:new Promise((l,b)=>{const Z=b=>{this._removePending(i),this.off("change",Z),this.off("error",d),this.off("close",c),l(b)},d=l=>{this._removePending(i),this.off("change",Z),this.off("error",d),this.off("close",c),b(l)},c=()=>{this._removePending(i),this.off("change",Z),this.off("error",d),this.off("close",c),l(null)},i={resolve:l,reject:b};this._pendingNext.push(i),this.on("change",Z),this.on("error",d),this.on("close",c)})}_removePending(l){const b=this._pendingNext.indexOf(l);-1!==b&&this._pendingNext.splice(b,1)}async*[Symbol.asyncIterator](){for(;!this.closed;){const l=await this.next();if(null===l)break;yield l}}}class J{constructor({bridge:l,cursorId:b,batch:Z=[],exhausted:d=!1,batchSize:c=100,requestPromise:i,requestPayload:m}){this.bridge=l,this.cursorId=b,this.buffer=Array.isArray(Z)?Z:[],this.exhausted=d||!1,this._batchSize=c,this._requestPromise=i||null,this._requestPayload=m||null,this._initialized=!i&&!m}async _ensureInitialized(){if(!this._initialized)if(this._requestPayload){const l={};void 0!==this._limit&&(l.limit=this._limit),void 0!==this._skip&&(l.skip=this._skip),void 0!==this._sort&&(l.sort=this._sort),void 0!==this._min&&(l.min=this._min),void 0!==this._max&&(l.max=this._max),void 0!==this._hint&&(l.hint=this._hint),void 0!==this._comment&&(l.comment=this._comment),void 0!==this._maxTimeMS&&(l.maxTimeMS=this._maxTimeMS),void 0!==this._maxScan&&(l.maxScan=this._maxScan),void 0!==this._returnKey&&(l.returnKey=this._returnKey),void 0!==this._showRecordId&&(l.showRecordId=this._showRecordId),void 0!==this._collation&&(l.collation=this._collation),this._requestPayload.cursorOpts=l;const b=await this.bridge.sendRequest(this._requestPayload);this.cursorId=b.cursorId,this.buffer=b.batch||[],this.exhausted=b.exhausted||!1,this._batchSize=b.batchSize||100,this._requestPayload=null,this._initialized=!0}else if(this._requestPromise){const l=await this._requestPromise;this.cursorId=l.cursorId,this.buffer=l.batch||[],this.exhausted=l.exhausted||!1,this._batchSize=l.batchSize||100,this._requestPromise=null,this._initialized=!0}}async hasNext(){return!this._closed&&(await this._ensureInitialized(),this.buffer.length>0||!this.exhausted&&(await this._getMore(),this.buffer.length>0))}async next(){return await this.hasNext()?this.buffer.shift():null}async toArray(){await this._ensureInitialized();const l=[...this.buffer];for(this.buffer=[];!this.exhausted;)await this._getMore(),l.push(...this.buffer),this.buffer=[];return l}async count(){return(await this.toArray()).length}limit(l){return this._limit=l,this}skip(l){return this._skip=l,this}sort(l){return this._sort=l,this}batchSize(l){return this._batchSize=l,this}async close(){return this._closed=!0,await this._closeRemote(),!1}isClosed(){return this._closed||!1}comment(l){return this._comment=l,this}hint(l){return this._hint=l,this}explain(l="queryPlanner"){const b={queryPlanner:{plannerVersion:1,namespace:"unknown",indexFilterSet:!1,parsedQuery:{},winningPlan:{stage:"COLLSCAN"}},ok:1};return"executionStats"!==l&&"allPlansExecution"!==l||(b.executionStats={executionSuccess:!0,nReturned:0,executionTimeMillis:0}),b}async itcount(){let l=0;for(;await this.hasNext();)await this.next(),l++;return l}size(){return this.buffer.length}min(l){return this._min=l,this._minIndexBounds=l,this}max(l){return this._max=l,this._maxIndexBounds=l,this}maxTimeMS(l){return this._maxTimeMS=l,this}maxScan(l){return this._maxScan=l,this}noCursorTimeout(){return this._noCursorTimeout=!0,this}objsLeftInBatch(){return this.buffer.length}pretty(){return this._pretty=!0,this}readConcern(l){return this._readConcern=l,this}readPref(l,b){return this._readPref={mode:l,tagSet:b},this}returnKey(l=!0){return this._returnKey=l,this}showRecordId(l=!0){return this._showRecordId=l,this}allowDiskUse(l=!0){return this._allowDiskUse=l,this}collation(l){return this._collation=l,this}async forEach(l){for(;await this.hasNext();){const b=await this.next();await l(b)}}async map(l){const b=[];for(;await this.hasNext();){const Z=await this.next();b.push(await l(Z))}return b}async*[Symbol.asyncIterator](){for(;await this.hasNext();)yield await this.next()}async _getMore(){if(this.exhausted)return;const l=await this.bridge.sendRequest({target:"cursor",cursorId:this.cursorId,method:"getMore",args:[{batchSize:this._batchSize}]});this.buffer=l?.batch||[],this.exhausted=!!l?.exhausted,this.exhausted&&await this._closeRemote()}async _closeRemote(){if(this.cursorId){try{await this.bridge.sendRequest({target:"cursor",cursorId:this.cursorId,method:"close"})}catch(l){}this.cursorId=null}}}class S{constructor({dbName:l,name:b,bridge:Z,db:d}){return this.dbName=l,this.name=b,this.bridge=Z,this._db=d,this.indexes=[],new Proxy(this,{get:(l,b,Z)=>b in l?Reflect.get(l,b,Z):"symbol"==typeof b||String(b).startsWith("_")?void 0:"watch"===b?(...b)=>l._watch(...b):"find"===b||"aggregate"===b?(...Z)=>l._cursorMethod(String(b),Z):(...Z)=>l._call(String(b),Z)})}_cursorMethod(l,b=[]){"find"===l&&b.length>=2&&this._validateProjection(b[1]);const Z={target:"collection",database:this.dbName,collection:this.name,method:l,args:b},d=new J({bridge:this.bridge,requestPayload:Z});return"aggregate"===l&&(d.then=function(l,b){return this.toArray().then(l,b)}),d}_validateProjection(l){if(!l||0===Object.keys(l).length)return;const b=Object.keys(l);let Z=!1,c=!1;for(const d of b)if("_id"!==d&&(l[d]?Z=!0:c=!0,Z&&c))break;if(Z&&c)throw new p("Cannot do exclusion on field in inclusion projection",{code:d.CANNOT_DO_EXCLUSION_ON_FIELD_ID_IN_INCLUSION_PROJECTION,collection:this.name})}_call(l,b=[]){return this.bridge.sendRequest({target:"collection",database:this.dbName,collection:this.name,method:l,args:b}).then(Z=>{if(Z&&Z.cursorId)return new J({bridge:this.bridge,cursorId:Z.cursorId,batch:Z.batch,exhausted:Z.exhausted,batchSize:Z.batchSize});if("copyTo"===l&&b.length>0&&this._db&&this._db.collection(b[0]),"createIndex"===l){const l=b[0],Z=b[1]||{},d=Z.name||Object.entries(l).map(([l,b])=>`${l}_${b}`).join("_");this.indexes.find(l=>l.name===d)||this.indexes.push({name:d,key:l,...Z})}if("dropIndex"===l){const l=b[0];this.indexes=this.indexes.filter(b=>b.name!==l)}return"dropIndexes"===l&&(this.indexes=[]),"drop"===l&&(this.indexes=[]),Z})}getIndexes(){return this.indexes}_watch(l=[],b={}){return g.create({bridge:this.bridge,database:this.dbName,collection:this.name,pipeline:l,options:b})}}class C{constructor({dbName:l,bridge:b,options:Z={}}){this.dbName=l,this.bridge=b,this.options=Z,this.collections=/* @__PURE__ */new Map;const d=/* @__PURE__ */new Set(["getCollectionNames","getCollectionInfos","createCollection","dropCollection","dropDatabase","collection","getCollection","watch"]);return this._methodNames=d,new Proxy(this,{get:(l,b,Z)=>b in l?Reflect.get(l,b,Z):"symbol"==typeof b||String(b).startsWith("_")?void 0:d.has(b)?"createCollection"===b?(...d)=>{const c=d[0];return l.collection(c,Z),l._call(String(b),d)}:"dropCollection"===b?(...Z)=>{const d=Z[0];return l.collections.delete(d),l._call(String(b),Z)}:"dropDatabase"===b?(...Z)=>(l.collections.clear(),l._call(String(b),Z)):"watch"===b?(...b)=>l._watch(...b):(...Z)=>l._call(String(b),Z):l.collection(b,Z)})}collection(l,b){if(this.collections.has(l))return this.collections.get(l);const Z=new S({dbName:this.dbName,name:l,bridge:this.bridge,db:b||this});return this.collections.set(l,Z),Z}getCollectionNames(){return Array.from(this.collections.keys())}async close(){}_call(l,b=[]){return this.bridge.sendRequest({target:"db",database:this.dbName,method:l,args:b}).then(l=>l&&l.streamId?g.create({bridge:this.bridge,database:this.dbName,collection:null,streamId:l.streamId}):l)}_watch(l=[],b={}){return g.create({bridge:this.bridge,database:this.dbName,collection:null,pipeline:l,options:b})}}class N extends Z.EventEmitter{constructor(l="mongodb://localhost:27017",b={}){if(super(),this.uri=l,this.options=Object.freeze({...b}),this._isConnected=!1,this._defaultDb=this._parseDefaultDbName(l),this._databases=/* @__PURE__ */new Map,!b.workerBridge)throw new Error("workerBridge is required. Create one with: const bridge = await WorkerBridge.create()");this._bridge=b.workerBridge,this._ownsBridge=!1}static async connect(l,b={}){const Z=new N(l,b);return await Z.connect(),Z}async connect(){return this._isConnected||(this._isConnected=!0,this.emit("open",this)),this}db(l,b={}){const Z=l||this._defaultDb;if(!Z)throw new Error("No database name provided and no default in connection string");if(this._databases.has(Z))return this._databases.get(Z);const d=new C({dbName:Z,bridge:this._bridge,options:{...this.options,...b}});return this._databases.set(Z,d),d}async close(){this._bridge&&this._ownsBridge&&(await this._bridge.terminate(),this._bridge=null),this._isConnected=!1,this.emit("close")}async close(l=!1){if(this._isConnected){for(const[l,b]of this._databases)await b.close();this._databases.clear(),this._isConnected=!1,this.emit("close")}}startSession(l={}){return{id:crypto.randomUUID(),endSession:()=>{},withTransaction:async l=>await l(this)}}async withSession(l,b){const Z=this.startSession("function"==typeof l?{}:l),d="function"==typeof l?l:b;try{return await d(Z)}finally{Z.endSession()}}get readConcern(){return this.options.readConcern}get writeConcern(){return this.options.writeConcern}get readPreference(){return this.options.readPreference}watch(l=[],b={}){return g.create({bridge:this._bridge,database:null,collection:null,pipeline:l,options:b})}_parseDefaultDbName(l){const b=l.match(/\/([^/?]+)/);return b?b[1]:null}_parseUriParams(l){const b={},Z=l.indexOf("?");if(-1===Z)return b;const d=l.substring(Z+1).split("&");for(const c of d){const[l,Z]=c.split("=");l&&("true"===Z?b[l]=!0:"false"===Z?b[l]=!1:isNaN(Z)?b[l]=decodeURIComponent(Z||""):b[l]=Number(Z))}return b}}class L{constructor(l){if(null==l)this.id=L.generate();else if("string"==typeof l){if(!L.isValid(l))throw new Error(`Argument passed in must be a string of 24 hex characters, got: ${l}`);this.id=l.toLowerCase()}else if(l instanceof Uint8Array&&12===l.length)this.id=Array.from(l).map(l=>l.toString(16).padStart(2,"0")).join("");else{if(!(l instanceof L))throw new Error("Argument passed in must be a string of 24 hex characters or an ObjectId");this.id=l.id}}toString(){return this.id}toHexString(){return this.id}getTimestamp(){const l=parseInt(this.id.substring(0,8),16);return new Date(1e3*l)}equals(l){if(!(l instanceof L))throw new Error("Can only compare with another ObjectId");return this.id===l.id}compare(l){if(!(l instanceof L))throw new Error("Can only compare with another ObjectId");return this.id.localeCompare(l.id)}toJSON(){return this.id}inspect(){return`ObjectId("${this.id}")`}toBytes(){const l=new Uint8Array(12);for(let b=0;b<12;b++)l[b]=parseInt(this.id.substring(2*b,2*b+2),16);return l}static isValid(l){return!!l&&("string"==typeof l&&(24===l.length&&/^[0-9a-fA-F]{24}$/.test(l)))}static createFromTime(l){const b=("00000000"+Math.floor(l/1e3).toString(16)).slice(-8);return new L(b+"0000000000000000")}static generate(){const l=Math.floor(Date.now()/1e3),b="undefined"!=typeof crypto&&crypto.getRandomValues?new Uint8Array(8):null;let Z="";if(b){crypto.getRandomValues(b);for(let l=0;l<b.length;l++)Z+=("0"+b[l].toString(16)).slice(-2)}else Z=Math.random().toString(16).slice(2).padEnd(8,"0").slice(0,8)+Math.random().toString(16).slice(2).padEnd(8,"0").slice(0,8);return(("00000000"+l.toString(16)).slice(-8)+Z).slice(0,24)}}function H(l,b){return l instanceof L||b instanceof L?l instanceof L&&b instanceof L||l instanceof L&&"string"==typeof b?l.equals(b):b instanceof L&&"string"==typeof l&&b.equals(l):l==b}function x(l,b){for(var Z=b.split("."),d=l[Z[0]],c=1;c<Z.length;c++){if(null==d||null==d)return d;var i=Z[c],m=parseInt(i,10);d=k(d)&&!isNaN(m)&&m>=0&&m<d.length?d[m]:d[i]}return d}function k(l){return Array==l.constructor}function z(l,b){for(var Z=0;Z<b.length;Z++)if(H(b[Z],l))return!0;return!1}function T(l,b){if(l.length!=b.length)return!1;for(var Z=0;Z<l.length;Z++)if(!H(l[Z],b[Z])){if(typeof l[Z]!=typeof b[Z])return!1;if("object"==typeof l[Z]&&null!==l[Z]){if(k(l[Z])){if(!T(l[Z],b[Z]))return!1}else if(!F(l[Z],b[Z]))return!1}else if(!H(l[Z],b[Z]))return!1}return!0}function F(l,b){for(var Z in l)if(l.hasOwnProperty(Z)){if(!b.hasOwnProperty(Z))return!1;if(!H(l[Z],b[Z])){if(typeof l[Z]!=typeof b[Z])return!1;if("object"==typeof l[Z]&&null!==l[Z]){if(k(l[Z])){if(!T(l[Z],b[Z]))return!1}else if(!F(l[Z],b[Z]))return!1}else if(!H(l[Z],b[Z]))return!1}}for(var Z in b)if(b.hasOwnProperty(Z)&&!l.hasOwnProperty(Z))return!1;return!0}const v={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},B={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},Q="[aeiouy]",U="([^aeiou][^aeiouy]*)",f="("+Q+"[aeiou]*)",j=new RegExp("^"+U+"?"+f+U),P=new RegExp("^"+U+"?"+f+U+f+"?$"),M=new RegExp("^"+U+"?("+f+U+"){2,}"),O=new RegExp("^"+U+"?"+Q),w=new RegExp("^"+U+Q+"[^aeiouwxy]$"),E=/ll$/,D=/^(.+?)e$/,A=/^(.+?)y$/,_=/^(.+?(s|t))(ion)$/,$=/^(.+?)(ed|ing)$/,q=/(at|bl|iz)$/,ll=/^(.+?)eed$/,bl=/^.+?[^s]s$/,Zl=/^.+?(ss|i)es$/,dl=/([^aeiouylsz])\1$/,cl=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,il=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,ml=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;const Gl=/* @__PURE__ */new Set(["a","about","after","all","also","am","an","and","another","any","are","around","as","at","be","because","been","before","being","between","both","but","by","came","can","come","could","did","do","each","for","from","get","got","has","had","he","have","her","here","him","himself","his","how","i","if","in","into","is","it","like","make","many","me","might","more","most","much","must","my","never","now","of","on","only","or","other","our","out","over","said","same","see","should","since","some","still","such","take","than","that","the","their","them","then","there","these","they","this","those","through","to","too","under","up","very","was","way","we","well","were","what","where","which","while","who","with","would","you","your"]);function Xl(l,b){if(null==l)return l;if("boolean"==typeof l||"number"==typeof l)return l;if("string"==typeof l)return l.startsWith("$$")?"$$KEEP"===l||"$$PRUNE"===l||"$$DESCEND"===l?l:x(b,l.substring(2)):"$"===l.charAt(0)?x(b,l.substring(1)):l;if("object"==typeof l){if(Array.isArray(l))return l.map(l=>Xl(l,b));const Z=Object.keys(l);if(0===Z.length)return l;const d=Z[0];if("$"===d.charAt(0)){return function(l,b,Z){switch(l){case"$add":return function(l,b){if(!Array.isArray(l))return null;let Z=0;for(const d of l){const l=Xl(d,b);l instanceof Date?Z+=l.getTime():"number"==typeof l&&(Z+=l)}return Z}(b,Z);case"$subtract":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);if(Z instanceof Date&&d instanceof Date)return Z.getTime()-d.getTime();if(Z instanceof Date&&"number"==typeof d)return new Date(Z.getTime()-d);if("number"==typeof Z&&"number"==typeof d)return Z-d;return null}(b,Z);case"$multiply":return function(l,b){if(!Array.isArray(l))return null;let Z=1;for(const d of l){const l=Xl(d,b);"number"==typeof l&&(Z*=l)}return Z}(b,Z);case"$divide":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);if("number"==typeof Z&&"number"==typeof d&&0!==d)return Z/d;return null}(b,Z);case"$mod":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);if("number"==typeof Z&&"number"==typeof d&&0!==d)return Z%d;return null}(b,Z);case"$pow":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);if("number"==typeof Z&&"number"==typeof d)return Math.pow(Z,d);return null}(b,Z);case"$sqrt":return function(l,b){const Z=Xl(l,b);if("number"==typeof Z&&Z>=0)return Math.sqrt(Z);return null}(b,Z);case"$abs":return function(l,b){const Z=Xl(l,b);if("number"==typeof Z)return Math.abs(Z);return null}(b,Z);case"$ceil":return function(l,b){const Z=Xl(l,b);if("number"==typeof Z)return Math.ceil(Z);return null}(b,Z);case"$floor":return function(l,b){const Z=Xl(l,b);if("number"==typeof Z)return Math.floor(Z);return null}(b,Z);case"$trunc":return function(l,b){const Z=Xl(l,b);if("number"==typeof Z)return Math.trunc(Z);return null}(b,Z);case"$round":return function(l,b){const Z=Xl(Array.isArray(l)?l[0]:l,b),d=Array.isArray(l)&&void 0!==l[1]?Xl(l[1],b):0;if("number"==typeof Z&&"number"==typeof d){const l=Math.pow(10,d);return Math.round(Z*l)/l}return null}(b,Z);case"$concat":return function(l,b){if(!Array.isArray(l))return null;let Z="";for(const d of l){const l=Xl(d,b);null!=l&&(Z+=String(l))}return Z}(b,Z);case"$substr":return function(l,b){if(!Array.isArray(l)||l.length<3)return null;const Z=String(Xl(l[0],b)||""),d=Xl(l[1],b),c=Xl(l[2],b);if("number"==typeof d&&"number"==typeof c)return Z.substr(d,c);return null}(b,Z);case"$toLower":return function(l,b){const Z=Xl(l,b);return null!=Z?String(Z).toLowerCase():""}(b,Z);case"$toUpper":return function(l,b){const Z=Xl(l,b);return null!=Z?String(Z).toUpperCase():""}(b,Z);case"$trim":return function(l,b){const Z=Xl("object"==typeof l&&l.input?l.input:l,b),d=l.chars?Xl(l.chars,b):null;let c=null!=Z?String(Z):"";if(d){const l=new RegExp(`^[${tl(d)}]+|[${tl(d)}]+$`,"g");return c.replace(l,"")}return c.trim()}(b,Z);case"$ltrim":return function(l,b){const Z=Xl("object"==typeof l&&l.input?l.input:l,b),d=l.chars?Xl(l.chars,b):null;let c=null!=Z?String(Z):"";if(d){const l=new RegExp(`^[${tl(d)}]+`,"g");return c.replace(l,"")}return c.replace(/^\s+/,"")}(b,Z);case"$rtrim":return function(l,b){const Z=Xl("object"==typeof l&&l.input?l.input:l,b),d=l.chars?Xl(l.chars,b):null;let c=null!=Z?String(Z):"";if(d){const l=new RegExp(`[${tl(d)}]+$`,"g");return c.replace(l,"")}return c.replace(/\s+$/,"")}(b,Z);case"$split":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=String(Xl(l[0],b)||""),d=String(Xl(l[1],b)||"");return Z.split(d)}(b,Z);case"$strLenCP":return function(l,b){const Z=Xl(l,b);return null!=Z?String(Z).length:0}(b,Z);case"$strcasecmp":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=String(Xl(l[0],b)||"").toLowerCase(),d=String(Xl(l[1],b)||"").toLowerCase();return Z<d?-1:Z>d?1:0}(b,Z);case"$indexOfCP":return function(l,b){if(!Array.isArray(l)||l.length<2)return null;const Z=String(Xl(l[0],b)||""),d=String(Xl(l[1],b)||""),c=void 0!==l[2]?Xl(l[2],b):0,i=void 0!==l[3]?Xl(l[3],b):Z.length,m=Z.substring(c,i).indexOf(d);return-1===m?-1:m+c}(b,Z);case"$replaceOne":return function(l,b){const Z=String(Xl(l.input,b)||""),d=String(Xl(l.find,b)||""),c=String(Xl(l.replacement,b)||"");return Z.replace(d,c)}(b,Z);case"$replaceAll":return function(l,b){const Z=String(Xl(l.input,b)||""),d=String(Xl(l.find,b)||""),c=String(Xl(l.replacement,b)||"");return Z.split(d).join(c)}(b,Z);case"$cmp":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);return Z<d?-1:Z>d?1:0}(b,Z);case"$eq":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);return Z===d}(b,Z);case"$ne":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);return Z!==d}(b,Z);case"$gt":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);return Z>d}(b,Z);case"$gte":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);return Z>=d}(b,Z);case"$lt":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);return Z<d}(b,Z);case"$lte":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);return Z<=d}(b,Z);case"$and":return function(l,b){if(!Array.isArray(l))return null;for(const Z of l){if(!Xl(Z,b))return!1}return!0}(b,Z);case"$or":return function(l,b){if(!Array.isArray(l))return null;for(const Z of l){if(Xl(Z,b))return!0}return!1}(b,Z);case"$not":return function(l,b){const Z=Xl(Array.isArray(l)?l[0]:l,b);return!Z}(b,Z);case"$cond":return function(l,b){let Z,d,c;if(Array.isArray(l)){if(3!==l.length)return null;[Z,d,c]=l}else{if("object"!=typeof l)return null;Z=l.if,d=l.then,c=l.else}const i=Xl(Z,b);return Xl(i?d:c,b)}(b,Z);case"$ifNull":return function(l,b){if(!Array.isArray(l)||l.length<2)return null;for(let Z=0;Z<l.length;Z++){const d=Xl(l[Z],b);if(null!=d)return d}return null}(b,Z);case"$switch":return function(l,b){if("object"!=typeof l||!Array.isArray(l.branches))return null;for(const Z of l.branches){if(Xl(Z.case,b))return Xl(Z.then,b)}return void 0!==l.default?Xl(l.default,b):null}(b,Z);case"$year":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date)return Z.getUTCFullYear();return null}(b,Z);case"$month":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date)return Z.getUTCMonth()+1;return null}(b,Z);case"$dayOfMonth":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date)return Z.getUTCDate();return null}(b,Z);case"$dayOfWeek":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date)return Z.getUTCDay()+1;return null}(b,Z);case"$dayOfYear":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date){const l=new Date(Date.UTC(Z.getUTCFullYear(),0,0)),b=Z-l,d=864e5;return Math.floor(b/d)}return null}(b,Z);case"$hour":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date)return Z.getUTCHours();return null}(b,Z);case"$minute":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date)return Z.getUTCMinutes();return null}(b,Z);case"$second":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date)return Z.getUTCSeconds();return null}(b,Z);case"$millisecond":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date)return Z.getUTCMilliseconds();return null}(b,Z);case"$week":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date){const l=new Date(Date.UTC(Z.getUTCFullYear(),0,1));return Math.ceil(((Z-l)/864e5+l.getUTCDay()+1)/7)-1}return null}(b,Z);case"$isoWeek":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date){const l=new Date(Z.valueOf()),b=(Z.getUTCDay()+6)%7;l.setUTCDate(l.getUTCDate()-b+3);const d=l.valueOf();return l.setUTCMonth(0,1),4!==l.getUTCDay()&&l.setUTCMonth(0,1+(4-l.getUTCDay()+7)%7),1+Math.ceil((d-l)/6048e5)}return null}(b,Z);case"$isoWeekYear":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date){const l=new Date(Z.valueOf());return l.setUTCDate(l.getUTCDate()-(Z.getUTCDay()+6)%7+3),l.getUTCFullYear()}return null}(b,Z);case"$dateToString":return function(l,b){const Z=l.format?Xl(l.format,b):"%Y-%m-%dT%H:%M:%S.%LZ",d=Xl(l.date,b);return d instanceof Date?Z.replace("%Y",d.getUTCFullYear()).replace("%m",String(d.getUTCMonth()+1).padStart(2,"0")).replace("%d",String(d.getUTCDate()).padStart(2,"0")).replace("%H",String(d.getUTCHours()).padStart(2,"0")).replace("%M",String(d.getUTCMinutes()).padStart(2,"0")).replace("%S",String(d.getUTCSeconds()).padStart(2,"0")).replace("%L",String(d.getUTCMilliseconds()).padStart(3,"0")):null}(b,Z);case"$toDate":return function(l,b){const Z=Xl(l,b);if(Z instanceof Date)return Z;if("string"==typeof Z||"number"==typeof Z){const l=new Date(Z);return isNaN(l.getTime())?null:l}return null}(b,Z);case"$arrayElemAt":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);if(!Array.isArray(Z)||"number"!=typeof d)return null;const c=d<0?Z.length+d:d;return Z[c]}(b,Z);case"$concatArrays":return function(l,b){if(!Array.isArray(l))return null;const Z=[];for(const d of l){const l=Xl(d,b);Array.isArray(l)&&Z.push(...l)}return Z}(b,Z);case"$filter":return function(l,b){const Z=Xl(l.input,b),d=l.as||"this",c=l.cond;return Array.isArray(Z)?Z.filter(l=>{const Z={...b,[d]:l};return Xl(c,Z)}):null}(b,Z);case"$in":return function(l,b){if(!Array.isArray(l)||2!==l.length)return null;const Z=Xl(l[0],b),d=Xl(l[1],b);return!!Array.isArray(d)&&d.includes(Z)}(b,Z);case"$indexOfArray":return function(l,b){if(!Array.isArray(l)||l.length<2)return null;const Z=Xl(l[0],b),d=Xl(l[1],b),c=void 0!==l[2]?Xl(l[2],b):0,i=void 0!==l[3]?Xl(l[3],b):Z.length;if(!Array.isArray(Z))return null;for(let m=c;m<i&&m<Z.length;m++)if(Z[m]===d)return m;return-1}(b,Z);case"$isArray":return function(l,b){const Z=Xl(l,b);return Array.isArray(Z)}(b,Z);case"$map":return function(l,b){const Z=Xl(l.input,b),d=l.as||"this",c=l.in;return Array.isArray(Z)?Z.map(l=>{const Z={...b,[d]:l};return Xl(c,Z)}):null}(b,Z);case"$reduce":return function(l,b){const Z=Xl(l.input,b),d=Xl(l.initialValue,b),c=l.in;if(!Array.isArray(Z))return null;let i=d;for(const m of Z){i=Xl(c,{...b,value:i,this:m})}return i}(b,Z);case"$size":return function(l,b){const Z=Xl(l,b);return Array.isArray(Z)?Z.length:null}(b,Z);case"$slice":return function(l,b){if(!Array.isArray(l)||l.length<2)return null;const Z=Xl(l[0],b);if(!Array.isArray(Z))return null;if(2===l.length){const d=Xl(l[1],b);return d>=0?Z.slice(0,d):Z.slice(d)}{const d=Xl(l[1],b),c=Xl(l[2],b);return Z.slice(d,d+c)}}(b,Z);case"$reverseArray":return function(l,b){const Z=Xl(l,b);return Array.isArray(Z)?Z.slice().reverse():null}(b,Z);case"$zip":return function(l,b){const Z=l.inputs?Xl(l.inputs,b):null,d=l.useLongestLength||!1,c=l.defaults;if(!Array.isArray(Z))return null;const i=Z.map(l=>Xl(l,b));if(!i.every(l=>Array.isArray(l)))return null;const m=Math.max(...i.map(l=>l.length)),G=d?m:Math.min(...i.map(l=>l.length)),X=[];for(let t=0;t<G;t++){const l=[];for(let b=0;b<i.length;b++)t<i[b].length?l.push(i[b][t]):c&&b<c.length?l.push(c[b]):l.push(null);X.push(l)}return X}(b,Z);case"$type":return function(l,b){const Z=Xl(l,b);return null===Z?"null":void 0===Z?"missing":"boolean"==typeof Z?"bool":"number"==typeof Z?Number.isInteger(Z)?"int":"double":"string"==typeof Z?"string":Z instanceof Date?"date":Array.isArray(Z)?"array":"object"==typeof Z?"object":"unknown"}(b,Z);case"$convert":return function(l,b){const Z=Xl(l.input,b),d=l.to,c=l.onError,i=l.onNull;if(null===Z)return void 0!==i?Xl(i,b):null;try{switch(d){case"double":case"decimal":return parseFloat(Z);case"int":case"long":return parseInt(Z);case"bool":return Boolean(Z);case"string":return String(Z);case"date":return new Date(Z);default:return Z}}catch(m){return void 0!==c?Xl(c,b):null}}(b,Z);case"$toBool":return function(l,b){const Z=Xl(l,b);return Boolean(Z)}(b,Z);case"$toDecimal":return function(l,b){const Z=Xl(l,b);return parseFloat(Z)}(b,Z);case"$toDouble":return function(l,b){const Z=Xl(l,b);return parseFloat(Z)}(b,Z);case"$toInt":return function(l,b){const Z=Xl(l,b);return parseInt(Z)}(b,Z);case"$toLong":return function(l,b){const Z=Xl(l,b);return parseInt(Z)}(b,Z);case"$toString":return function(l,b){const Z=Xl(l,b);return null==Z?null:String(Z)}(b,Z);case"$objectToArray":return function(l,b){const Z=Xl(l,b);if("object"!=typeof Z||null===Z||Array.isArray(Z))return null;return Object.keys(Z).map(l=>({k:l,v:Z[l]}))}(b,Z);case"$arrayToObject":return function(l,b){const Z=Xl(l,b);if(!Array.isArray(Z))return null;const d={};for(const c of Z)Array.isArray(c)&&2===c.length?d[c[0]]=c[1]:"object"==typeof c&&void 0!==c.k&&void 0!==c.v&&(d[c.k]=c.v);return d}(b,Z);case"$mergeObjects":return function(l,b){if(!Array.isArray(l))return Xl(l,b);const Z={};for(const d of l){const l=Xl(d,b);"object"!=typeof l||null===l||Array.isArray(l)||Object.assign(Z,l)}return Z}(b,Z);case"$literal":return b;default:throw new Error(`Unsupported aggregation operator: ${l}`)}}(d,l[d],b)}{const d={};for(const c of Z)d[c]=Xl(l[c],b);return d}}return l}function tl(l){return l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const ul={1:"double",2:"string",3:"object",4:"array",5:"binData",6:"undefined",7:"objectId",8:"bool",9:"date",10:"null",11:"regex",13:"javascript",15:"javascriptWithScope",16:"int",17:"timestamp",18:"long",19:"decimal",127:"maxKey","-1":"minKey"},nl=Object.entries(ul).reduce((l,[b,Z])=>(l[Z]=parseInt(b),l),{});function Wl(l,b){if(k(b)){for(let Z=0;Z<b.length;Z++)if(Wl(l,b[Z]))return!0;return!1}const Z="number"==typeof b?b:nl[b],d=ul[Z]||b;return null===l?"null"===d||10===Z:void 0===l?"undefined"===d||6===Z:"number"==typeof l?Number.isInteger(l)?"int"===d||16===Z:"double"===d||1===Z:"string"==typeof l?"string"===d||2===Z:"boolean"==typeof l?"bool"===d||8===Z:l instanceof Date?"date"===d||9===Z:l instanceof L?"objectId"===d||7===Z:l instanceof RegExp?"regex"===d||11===Z:k(l)?"array"===d||4===Z:"object"==typeof l?"object"===d||3===Z:typeof l===b}function el(l){if(k(l)){let b=0;for(let Z=0;Z<l.length;Z++)b|=1<<l[Z];return b}return"number"==typeof l?l:0}function pl(l,b){if("number"!=typeof l)return!1;const Z=el(b);return(l&Z)===Z}function al(l,b){if("number"!=typeof l)return!1;return 0===(l&el(b))}function ol(l,b){if("number"!=typeof l)return!1;return 0!==(l&el(b))}function hl(l,b){if("number"!=typeof l)return!1;const Z=el(b);return(l&Z)!==Z}function sl(l,b){if(b.type){const Z=k(l)?"array":null===l?"null":typeof l;if(b.type!==Z)return!1}if(b.required&&k(b.required))for(let Z=0;Z<b.required.length;Z++)if(!(b.required[Z]in l))return!1;if(b.properties)for(const Z in b.properties){if(!(Z in l))return!1;const d=b.properties[Z];if(!sl(l[Z],d))return!1}if(void 0!==b.minimum&&"number"==typeof l&&l<b.minimum)return!1;if(void 0!==b.maximum&&"number"==typeof l&&l>b.maximum)return!1;if(void 0!==b.minLength&&"string"==typeof l&&l.length<b.minLength)return!1;if(void 0!==b.maxLength&&"string"==typeof l&&l.length>b.maxLength)return!1;if(b.pattern&&"string"==typeof l){if(!new RegExp(b.pattern).test(l))return!1}return!(b.enum&&k(b.enum)&&!b.enum.includes(l))}function Vl(l,b){return l instanceof L&&b instanceof L?l.equals(b):l==b}function yl(l,b,Z){let d=l,c=b;switch(l instanceof L&&(d=l.toString()),b instanceof L&&(c=b.toString()),Z){case">":return d>c;case">=":return d>=c;case"<":return d<c;case"<=":return d<=c;default:return!1}}function Il(l,b){if(void 0===l)return!1;if(null===l)return b(l);if(k(l)){for(var Z=0;Z<l.length;Z++)if(b(l[Z]))return!0;return!1}return b(l)}function Yl(l){if("string"!=typeof l)return[];const b=function(l){return"string"!=typeof l?[]:l.toLowerCase().split(/\W+/).filter(l=>l.length>0).filter(l=>!Gl.has(l))}(l);return b.map(l=>function(l){let b=String(l).toLowerCase();if(b.length<3)return b;let Z,d=!1;return 121===b.codePointAt(0)&&(d=!0,b="Y"+b.slice(1)),Zl.test(b)?b=b.slice(0,-2):bl.test(b)&&(b=b.slice(0,-1)),(Z=ll.exec(b))?j.test(Z[1])&&(b=b.slice(0,-1)):(Z=$.exec(b))&&O.test(Z[1])&&(b=Z[1],q.test(b)?b+="e":dl.test(b)?b=b.slice(0,-1):w.test(b)&&(b+="e")),(Z=A.exec(b))&&O.test(Z[1])&&(b=Z[1]+"i"),(Z=cl.exec(b))&&j.test(Z[1])&&(b=Z[1]+v[Z[2]]),(Z=il.exec(b))&&j.test(Z[1])&&(b=Z[1]+B[Z[2]]),(Z=ml.exec(b))?M.test(Z[1])&&(b=Z[1]):(Z=_.exec(b))&&M.test(Z[1])&&(b=Z[1]),(Z=D.exec(b))&&(M.test(Z[1])||P.test(Z[1])&&!w.test(Z[1]))&&(b=Z[1]),E.test(b)&&M.test(b)&&(b=b.slice(0,-1)),d&&(b="y"+b.slice(1)),b}(l))}function Kl(l,b){if("string"!=typeof l)return!1;const Z=new Set(Yl(l));return Yl(b).some(l=>Z.has(l))}function Rl(l,b){try{if(!Array.isArray(b)||2!==b.length)return!1;const Z=b[0][0],d=b[0][1],c=b[1][0];return rl(l,Z,c,b[1][1],d)}catch(Z){return!1}}function rl(l,b,Z,d,c){if(!l)return!1;if("FeatureCollection"===l.type&&l.features&&l.features.length>0){for(const i of l.features)if(i.geometry&&!rl(i.geometry,b,Z,d,c))return!1;return!0}if("Feature"===l.type&&l.geometry)return rl(l.geometry,b,Z,d,c);if("Point"===l.type&&l.coordinates){const[i,m]=l.coordinates;if("number"==typeof i&&"number"==typeof m)return i>=b&&i<=Z&&m>=d&&m<=c}if("Polygon"===l.type&&l.coordinates&&l.coordinates.length>0){for(const i of l.coordinates)for(const l of i){const i=l[0],m=l[1];if(i<b||i>Z||m<d||m>c)return!1}return!0}return!1}function gl(l){if(!l)return null;if("FeatureCollection"===l.type&&l.features&&l.features.length>0){const b=l.features[0];if(b.geometry)return gl(b.geometry)}if("Feature"===l.type&&l.geometry)return gl(l.geometry);if("Point"===l.type&&l.coordinates){const[b,Z]=l.coordinates;if("number"==typeof b&&"number"==typeof Z)return{lat:Z,lng:b}}if("Polygon"===l.type&&l.coordinates&&l.coordinates.length>0){const b=l.coordinates[0];if(b.length>0){let l=0,Z=0;for(const d of b)Z+=d[0],l+=d[1];return{lat:l/b.length,lng:Z/b.length}}}return null}function Jl(l,b,Z,d){const c=(Z-l)*Math.PI/180,i=(d-b)*Math.PI/180,m=Math.sin(c/2)*Math.sin(c/2)+Math.cos(l*Math.PI/180)*Math.cos(Z*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}function Sl(l,b,Z,d){const c=gl(l);if(!c)return!1;return 1e3*Jl(c.lat,c.lng,Z,b)<=d}function Cl(l,b){if(!l||!b)return!1;const Z=gl(b);if(!Z)return!1;const d=gl(l);if(!d)return!1;if("Polygon"===b.type&&"Point"===l.type)return Nl(d.lng,d.lat,b.coordinates[0]);if("Polygon"===l.type&&"Point"===b.type){const Z=b.coordinates;return Nl(Z[0],Z[1],l.coordinates[0])}if("Point"===l.type&&"Point"===b.type){return Jl(d.lat,d.lng,Z.lat,Z.lng)<.001}return!1}function Nl(l,b,Z){let d=!1;for(let c=0,i=Z.length-1;c<Z.length;i=c++){const m=Z[c][0],G=Z[c][1],X=Z[i][0],t=Z[i][1];G>b!=t>b&&l<(X-m)*(b-G)/(t-G)+m&&(d=!d)}return d}function Ll(l,b){var Z=Object.keys(b)[0],d=b[Z];if("$"!=Z.charAt(0))return Hl(l,Z,d);if("$and"==Z)return xl(l,d);if("$or"==Z)return function(l,b){for(var Z=0;Z<b.length;Z++)if(Ll(l,b[Z]))return!0;return!1}(l,d);if("$not"==Z)return function(l,b){return!Ll(l,b)}(l,d);if("$nor"==Z)return function(l,b){for(var Z=0;Z<b.length;Z++)if(Ll(l,b[Z]))return!1;return!0}(l,d);if("$where"==Z)return function(l,b){if("function"==typeof b)try{return b.call(l)}catch(Z){return!1}else if("string"==typeof b)try{return new Function("return "+b).call(l)}catch(Z){return!1}return!1}(l,d);if("$comment"==Z)return!0;if("$jsonSchema"==Z)return sl(l,d);if("$text"==Z){return function(l,b){return!(!l||"object"!=typeof l)&&function l(Z){if("string"==typeof Z)return Kl(Z,b);if("object"!=typeof Z||null===Z)return!1;if(k(Z)){for(let b=0;b<Z.length;b++)if(l(Z[b]))return!0;return!1}for(const b in Z)if(Z.hasOwnProperty(b)&&l(Z[b]))return!0;return!1}(l)}(l,d.$search||d)}if("$expr"!=Z)throw{$err:"Can't canonicalize query: BadValue unknown top level operator: "+Z,code:17287};try{return Xl(d,l)}catch(c){return!1}}function Hl(l,b,Z){var d=function(l,b){for(var Z=b.split("."),d=[l],c=0;c<Z.length;c++){for(var i=Z[c],m=parseInt(i,10),G=[],X=0;X<d.length;X++){var t=d[X];if(null!=t&&null!=t)if(k(t)&&!isNaN(m)&&m>=0)m<t.length&&G.push(t[m]);else if(k(t))for(var u=0;u<t.length;u++)null!=t[u]&&null!=t[u]&&"object"==typeof t[u]&&G.push(t[u][i]);else"object"==typeof t&&G.push(t[i])}d=G}if(0!==(d=d.filter(function(l){return void 0!==l})).length)return 1===d.length?d[0]:d}(l,b);if("string"==typeof Z)return Il(d,function(l){return Vl(l,Z)});if("number"==typeof Z)return Il(d,function(l){return Vl(l,Z)});if("boolean"==typeof Z)return Il(d,function(l){return Vl(l,Z)});if(Z instanceof L)return Il(d,function(l){return Vl(l,Z)});if("object"==typeof Z){if(Z instanceof RegExp)return null!=d&&Il(d,function(l){return l&&l.match(Z)});if(k(Z))return null!=d&&Il(d,function(l){return l&&T(l,Z)});var c=Object.keys(Z);if("$"==c[0].charAt(0)){for(var i=0;i<c.length;i++){var m=Object.keys(Z)[i],G=Z[m];if("$eq"==m){if(!Il(d,function(l){return Vl(l,G)}))return!1}else if("$gt"==m){if(!Il(d,function(l){return yl(l,G,">")}))return!1}else if("$gte"==m){if(!Il(d,function(l){return yl(l,G,">=")}))return!1}else if("$lt"==m){if(!Il(d,function(l){return yl(l,G,"<")}))return!1}else if("$lte"==m){if(!Il(d,function(l){return yl(l,G,"<=")}))return!1}else if("$ne"==m){if(!Il(d,function(l){return!Vl(l,G)}))return!1}else if("$in"==m){if(!Il(d,function(l){return z(l,G)}))return!1}else if("$nin"==m){if(Il(d,function(l){return z(l,G)}))return!1}else if("$exists"==m){var X=x(l,b);if(G?null==X:null!=X)return!1}else if("$type"==m){if(void 0===d){if(6!==("number"==typeof G?G:nl[G]))return!1}else if(!Wl(d,G))return!1}else if("$mod"==m){if(2!=G.length)throw{$err:"Can't canonicalize query: BadValue malformed mod, not enough elements",code:17287};if(!Il(d,function(l){return null!=l&&l%G[0]==G[1]}))return!1}else if("$regex"==m){var t=G,u=Z.$options||"",n="string"==typeof t?new RegExp(t,u):t;if(!Il(d,function(l){return null!=l&&n.test(l)}))return!1}else{if("$options"==m)continue;if("$text"==m){if(!Il(d,function(l){return null!=l&&Kl(l,G)}))return!1}else if("$expr"==m)try{if(!Xl(G,l))return!1}catch(Y){return!1}else if("$geoWithin"==m){if(!Il(d,function(l){return null!=l&&Rl(l,G)}))return!1}else if("$near"==m||"$nearSphere"==m){let l;if(G.$geometry?l=G.$geometry.coordinates:G.coordinates?l=G.coordinates:Array.isArray(G)&&(l=G),!(l&&l.length>=2))return!1;{const[b,Z]=l,c=G.$maxDistance||1e6;if(!Il(d,function(l){return null!=l&&Sl(l,b,Z,c)}))return!1}}else if("$geoIntersects"==m){const l=G.$geometry||G;if(!Il(d,function(b){return null!=b&&Cl(b,l)}))return!1}else if("$not"==m){if(Hl(l,b,G))return!1}else if("$all"==m){if(null==(e=x(l,b))||!k(e))return!1;for(var W=0;W<G.length;W++)if(!z(G[W],e))return!1}else if("$elemMatch"==m){var e;if(null==(e=x(l,b))||!k(e))return!1;var p=!1;for(W=0;W<e.length;W++){var a=e[W];if("object"!=typeof a||k(a)){for(var o=!0,h=Object.keys(G),s=0;s<h.length;s++){var V=h[s],y=G[V];("$gte"!=V||a>=y)&&("$gt"!=V||a>y)&&("$lte"!=V||a<=y)&&("$lt"!=V||a<y)?"$eq"==V&&a!=y||"$ne"==V&&a==y?o=!1:"$in"!=V||z(a,y)?"$nin"==V&&z(a,y)&&(o=!1):o=!1:o=!1}if(o){p=!0;break}}else if(kl(a,G)){p=!0;break}}if(!p)return!1}else if("$size"==m){var I=x(l,b);if(null==I||!k(I))return!1;if(I.length!=G)return!1}else if("$bitsAllSet"==m){if(!Il(d,function(l){return pl(l,G)}))return!1}else if("$bitsAllClear"==m){if(!Il(d,function(l){return al(l,G)}))return!1}else if("$bitsAnySet"==m){if(!Il(d,function(l){return ol(l,G)}))return!1}else{if("$bitsAnyClear"!=m)throw{$err:"Can't canonicalize query: BadValue unknown operator: "+m,code:17287};if(!Il(d,function(l){return hl(l,G)}))return!1}}}return!0}return x(l,b)&&F(x(l,b),Z)}}function xl(l,b){for(var Z=0;Z<b.length;Z++)if(!Ll(l,b[Z]))return!1;return!0}function kl(l,b){return xl(l,function(l){var b=[];for(var Z in l)if(l.hasOwnProperty(Z)){var d={};d[Z]=l[Z],b.push(d)}return b}(b))}class zl extends Z.EventEmitter{constructor(l,b=[],Z={}){super(),this.target=l,this.pipeline=b,this.options=Z,this.closed=!1,this._listeners=/* @__PURE__ */new Map,this._changeCounter=0,this._startWatching()}_isDB(l){return l&&"string"==typeof l.dbName&&"function"==typeof l.getCollectionNames&&l.collections instanceof Map}_isServer(l){return l&&l.databases instanceof Map&&"function"==typeof l._getDB}_isMongoClient(l){return l&&"function"==typeof l.connect&&"function"==typeof l.db&&"MongoClient"===l.constructor.name}_startWatching(){if(this.closed)return;const l=this._getCollectionsToWatch();for(const b of l)this._watchCollection(b);this._isServer(this.target)&&this._interceptServerDBCreation(),this._isDB(this.target)&&this._interceptDBCollectionCreation(),this._isMongoClient(this.target)&&this._interceptClientDBCreation()}_getCollectionsToWatch(){const l=[];if(this._isServer(this.target)){for(const[b,Z]of this.target.databases){const b=Z.getCollectionNames();for(const d of b){const b=Z[d];b&&b.isCollection&&l.push(b)}}return l}if(this._isMongoClient(this.target))return this._monitorClient(),l;if(this._isDB(this.target)){const b=this.target.getCollectionNames();for(const Z of b){const b=this.target[Z];b&&b.isCollection&&l.push(b)}this._monitorDB()}return this.target.isCollection&&l.push(this.target),l}_watchCollection(l){if(this.closed)return;if(!l)return;if("function"!=typeof l.on)return;if(!l.isCollection)return;if(this._listeners.has(l))return;const b={insert:b=>this._emitChange("insert",l,b),update:(b,Z)=>this._emitChange("update",l,b,Z),replace:b=>this._emitChange("replace",l,b),delete:b=>this._emitChange("delete",l,b)};this._listeners.set(l,b),l.on("insert",b.insert),l.on("update",b.update),l.on("replace",b.replace),l.on("delete",b.delete)}_emitChange(l,b,Z,d=null){if(this.closed)return;const c=this._createChangeEvent(l,b,Z,d);this._matchesPipeline(c)&&this.emit("change",c)}_createChangeEvent(l,b,Z,d){const c={_id:{_data:btoa(String(++this._changeCounter))},operationType:l,clusterTime:/* @__PURE__ */new Date,ns:{db:b.db.dbName,coll:b.name},documentKey:{_id:Z._id}};switch(l){case"insert":case"replace":c.fullDocument=Z;break;case"update":c.updateDescription=d||{updatedFields:{},removedFields:[],truncatedArrays:[]},"updateLookup"===this.options.fullDocument&&(c.fullDocument=Z)}return c}_matchesPipeline(l){if(!this.pipeline||0===this.pipeline.length)return!0;for(const b of this.pipeline)if(b.$match&&!kl(l,b.$match))return!1;return!0}_getNestedValue(l,b){return b.split(".").reduce((l,b)=>l?.[b],l)}_monitorClient(){}_interceptClientDBCreation(){const l=this.target,b=l.db.bind(l),Z=this;this._watchedDBs=/* @__PURE__ */new Map,l.db=function(l,d){const c=b(l,d),i=c.dbName;if(!Z._watchedDBs.has(i)){Z._watchedDBs.set(i,c);const l=c.getCollectionNames();for(const b of l){const l=c[b];l&&l.isCollection&&!Z._listeners.has(l)&&Z._watchCollection(l)}Z._interceptDBCollectionCreationForClient(c)}return c},this._originalClientMethods={db:b}}_interceptServerDBCreation(){const l=this.target,b=l._getDB.bind(l),Z=this;this._watchedDBs=/* @__PURE__ */new Map,l._getDB=function(l){const d=b(l);if(!Z._watchedDBs.has(l)){Z._watchedDBs.set(l,d);const b=d.getCollectionNames();for(const l of b){const b=d[l];b&&b.isCollection&&!Z._listeners.has(b)&&Z._watchCollection(b)}Z._interceptDBCollectionCreationForServer(d)}return d},this._originalServerMethods={_getDB:b}}_interceptDBCollectionCreationForServer(l){const b=l.collection.bind(l),Z=l.createCollection.bind(l),d=this;l.collection=function(l){const Z=b(l);return Z&&Z.isCollection&&!d._listeners.has(Z)&&d._watchCollection(Z),Z},l.createCollection=function(b){Z(b);const c=l[b];c&&c.isCollection&&!d._listeners.has(c)&&d._watchCollection(c)}}_interceptDBCollectionCreationForClient(l){const b=l.collection.bind(l),Z=l.createCollection.bind(l),d=this;l.collection=function(l){const Z=b(l);return Z&&Z.isCollection&&!d._listeners.has(Z)&&d._watchCollection(Z),Z},l.createCollection=function(b){Z(b);const c=l[b];c&&c.isCollection&&!d._listeners.has(c)&&d._watchCollection(c)}}_monitorDB(){}_interceptDBCollectionCreation(){const l=this.target,b=l.getCollection.bind(l),Z=l.createCollection?l.createCollection.bind(l):null,d=this;l.getCollection=function(l){const Z=b(l);return Z&&Z.isCollection&&!d._listeners.has(Z)&&d._watchCollection(Z),Z},Z&&(l.createCollection=function(b){Z(b);const c=l[b];c&&c.isCollection&&!d._listeners.has(c)&&d._watchCollection(c)}),this._originalDBMethods={getCollection:b,createCollection:Z}}close(){if(!this.closed){this.closed=!0;for(const[l,b]of this._listeners)l.off("insert",b.insert),l.off("update",b.update),l.off("replace",b.replace),l.off("delete",b.delete);this._listeners.clear(),this._originalServerMethods&&"Server"===this.target.constructor.name&&(this.target._getDB=this._originalServerMethods._getDB),this._originalDBMethods&&"DB"===this.target.constructor.name&&(this.target.collection=this._originalDBMethods.collection,this.target.createCollection=this._originalDBMethods.createCollection),this._originalClientMethods&&"MongoClient"===this.target.constructor.name&&(this.target.db=this._originalClientMethods.db),this.emit("close"),this.removeAllListeners()}}get isClosed(){return this.closed}async*[Symbol.asyncIterator](){const l=[];let b=null,Z=!1;const d=Z=>{b?(b({value:Z,done:!1}),b=null):l.push(Z)},c=()=>{Z=!0,b&&(b({done:!0}),b=null)},i=l=>{b&&(b(Promise.reject(l)),b=null)};this.on("change",d),this.on("close",c),this.on("error",i);try{for(;!Z;)if(l.length>0)yield l.shift();else{const l=await new Promise(l=>{b=l,Z&&l({done:!0})});if(l.done)break;yield l.value}}finally{this.off("change",d),this.off("close",c),this.off("error",i)}}async next(){return new Promise((l,b)=>{const Z=b=>{i(),l(b)},d=()=>{i(),l(null)},c=l=>{i(),b(l)},i=()=>{this.off("change",Z),this.off("close",d),this.off("error",c)};this.closed?l(null):(this.once("change",Z),this.once("close",d),this.once("error",c))})}}function Tl(l){if(null==l)return l;if("function"==typeof l)return{__function:l.toString()};if(l&&"object"==typeof l&&"function"==typeof l.toString)try{const b=l.toString();if(b&&24===b.length&&/^[0-9a-f]{24}$/i.test(b)&&l.constructor&&"ObjectId"===l.constructor.name)return{__objectId:b}}catch(b){}if(l instanceof L)return{__objectId:l.toString()};if(l instanceof Date)return{__date:l.toISOString()};if(Array.isArray(l))return l.map(Tl);if("object"==typeof l){const b={};for(const[Z,d]of Object.entries(l))b[Z]=Tl(d);return b}return l}function Fl(l){if(null==l)return l;if("object"==typeof l&&l.__function)return"string"==typeof l.__function?`(${l.__function}).call(this)`:void 0;if("object"==typeof l&&l.__objectId)return new L(l.__objectId);if("object"==typeof l&&l.__date)return new Date(l.__date);if(Array.isArray(l))return l.map(Fl);if("object"==typeof l){const b={};for(const[Z,d]of Object.entries(l))b[Z]=Fl(d);return b}return l}class vl extends Z.EventEmitter{constructor(l){super(),this.worker=l,this._nextId=1,this._pending=/* @__PURE__ */new Map,this._terminating=!1,this._handleMessage=this._handleMessage.bind(this),this._handleError=this._handleError.bind(this),this._attach()}static async create(l={}){if("undefined"!=typeof window&&void 0!==globalThis.Worker)return new Bl(l);const{Worker:b}=await import("worker_threads"),{fileURLToPath:Z}=await import("url");let d=l.workerPath;if(!d){d=Z(new URL("data:text/javascript;base64,dmFyIGUsdD17ZXhwb3J0czp7fX07dmFyIG49ZnVuY3Rpb24oKXtpZihlKXJldHVybiB0LmV4cG9ydHM7ZT0xO3ZhciBuLHI9Im9iamVjdCI9PXR5cGVvZiBSZWZsZWN0P1JlZmxlY3Q6bnVsbCxpPXImJiJmdW5jdGlvbiI9PXR5cGVvZiByLmFwcGx5P3IuYXBwbHk6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuY2FsbChlLHQsbil9O249ciYmImZ1bmN0aW9uIj09dHlwZW9mIHIub3duS2V5cz9yLm93bktleXM6T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scz9mdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZSkuY29uY2F0KE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSkpfTpmdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZSl9O3ZhciBzPU51bWJlci5pc05hTnx8ZnVuY3Rpb24oZSl7cmV0dXJuIGUhPWV9O2Z1bmN0aW9uIG8oKXtvLmluaXQuY2FsbCh0aGlzKX10LmV4cG9ydHM9byx0LmV4cG9ydHMub25jZT1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihuLHIpe2Z1bmN0aW9uIGkobil7ZS5yZW1vdmVMaXN0ZW5lcih0LHMpLHIobil9ZnVuY3Rpb24gcygpeyJmdW5jdGlvbiI9PXR5cGVvZiBlLnJlbW92ZUxpc3RlbmVyJiZlLnJlbW92ZUxpc3RlbmVyKCJlcnJvciIsaSksbihbXS5zbGljZS5jYWxsKGFyZ3VtZW50cykpfXkoZSx0LHMse29uY2U6ITB9KSwiZXJyb3IiIT09dCYmZnVuY3Rpb24oZSx0LG4peyJmdW5jdGlvbiI9PXR5cGVvZiBlLm9uJiZ5KGUsImVycm9yIix0LG4pfShlLGkse29uY2U6ITB9KX0pfSxvLkV2ZW50RW1pdHRlcj1vLG8ucHJvdG90eXBlLl9ldmVudHM9dm9pZCAwLG8ucHJvdG90eXBlLl9ldmVudHNDb3VudD0wLG8ucHJvdG90eXBlLl9tYXhMaXN0ZW5lcnM9dm9pZCAwO3ZhciBhPTEwO2Z1bmN0aW9uIGMoZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUpdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJsaXN0ZW5lciIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEZ1bmN0aW9uLiBSZWNlaXZlZCB0eXBlICcrdHlwZW9mIGUpfWZ1bmN0aW9uIGwoZSl7cmV0dXJuIHZvaWQgMD09PWUuX21heExpc3RlbmVycz9vLmRlZmF1bHRNYXhMaXN0ZW5lcnM6ZS5fbWF4TGlzdGVuZXJzfWZ1bmN0aW9uIHUoZSx0LG4scil7dmFyIGkscyxvLGE7aWYoYyhuKSx2b2lkIDA9PT0ocz1lLl9ldmVudHMpPyhzPWUuX2V2ZW50cz0vKiBAX19QVVJFX18gKi9PYmplY3QuY3JlYXRlKG51bGwpLGUuX2V2ZW50c0NvdW50PTApOih2b2lkIDAhPT1zLm5ld0xpc3RlbmVyJiYoZS5lbWl0KCJuZXdMaXN0ZW5lciIsdCxuLmxpc3RlbmVyP24ubGlzdGVuZXI6bikscz1lLl9ldmVudHMpLG89c1t0XSksdm9pZCAwPT09bylvPXNbdF09biwrK2UuX2V2ZW50c0NvdW50O2Vsc2UgaWYoImZ1bmN0aW9uIj09dHlwZW9mIG8/bz1zW3RdPXI/W24sb106W28sbl06cj9vLnVuc2hpZnQobik6by5wdXNoKG4pLChpPWwoZSkpPjAmJm8ubGVuZ3RoPmkmJiFvLndhcm5lZCl7by53YXJuZWQ9ITA7dmFyIHU9bmV3IEVycm9yKCJQb3NzaWJsZSBFdmVudEVtaXR0ZXIgbWVtb3J5IGxlYWsgZGV0ZWN0ZWQuICIrby5sZW5ndGgrIiAiK1N0cmluZyh0KSsiIGxpc3RlbmVycyBhZGRlZC4gVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gaW5jcmVhc2UgbGltaXQiKTt1Lm5hbWU9Ik1heExpc3RlbmVyc0V4Y2VlZGVkV2FybmluZyIsdS5lbWl0dGVyPWUsdS50eXBlPXQsdS5jb3VudD1vLmxlbmd0aCxhPXUsY29uc29sZSYmY29uc29sZS53YXJuJiZjb25zb2xlLndhcm4oYSl9cmV0dXJuIGV9ZnVuY3Rpb24gaCgpe2lmKCF0aGlzLmZpcmVkKXJldHVybiB0aGlzLnRhcmdldC5yZW1vdmVMaXN0ZW5lcih0aGlzLnR5cGUsdGhpcy53cmFwRm4pLHRoaXMuZmlyZWQ9ITAsMD09PWFyZ3VtZW50cy5sZW5ndGg/dGhpcy5saXN0ZW5lci5jYWxsKHRoaXMudGFyZ2V0KTp0aGlzLmxpc3RlbmVyLmFwcGx5KHRoaXMudGFyZ2V0LGFyZ3VtZW50cyl9ZnVuY3Rpb24gZihlLHQsbil7dmFyIHI9e2ZpcmVkOiExLHdyYXBGbjp2b2lkIDAsdGFyZ2V0OmUsdHlwZTp0LGxpc3RlbmVyOm59LGk9aC5iaW5kKHIpO3JldHVybiBpLmxpc3RlbmVyPW4sci53cmFwRm49aSxpfWZ1bmN0aW9uIGQoZSx0LG4pe3ZhciByPWUuX2V2ZW50cztpZih2b2lkIDA9PT1yKXJldHVybltdO3ZhciBpPXJbdF07cmV0dXJuIHZvaWQgMD09PWk/W106ImZ1bmN0aW9uIj09dHlwZW9mIGk/bj9baS5saXN0ZW5lcnx8aV06W2ldOm4/ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PW5ldyBBcnJheShlLmxlbmd0aCksbj0wO248dC5sZW5ndGg7KytuKXRbbl09ZVtuXS5saXN0ZW5lcnx8ZVtuXTtyZXR1cm4gdH0oaSk6ZyhpLGkubGVuZ3RoKX1mdW5jdGlvbiBwKGUpe3ZhciB0PXRoaXMuX2V2ZW50cztpZih2b2lkIDAhPT10KXt2YXIgbj10W2VdO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBuKXJldHVybiAxO2lmKHZvaWQgMCE9PW4pcmV0dXJuIG4ubGVuZ3RofXJldHVybiAwfWZ1bmN0aW9uIGcoZSx0KXtmb3IodmFyIG49bmV3IEFycmF5KHQpLHI9MDtyPHQ7KytyKW5bcl09ZVtyXTtyZXR1cm4gbn1mdW5jdGlvbiB5KGUsdCxuLHIpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBlLm9uKXIub25jZT9lLm9uY2UodCxuKTplLm9uKHQsbik7ZWxzZXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZS5hZGRFdmVudExpc3RlbmVyKXRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSAiZW1pdHRlciIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEV2ZW50RW1pdHRlci4gUmVjZWl2ZWQgdHlwZSAnK3R5cGVvZiBlKTtlLmFkZEV2ZW50TGlzdGVuZXIodCxmdW5jdGlvbiBpKHMpe3Iub25jZSYmZS5yZW1vdmVFdmVudExpc3RlbmVyKHQsaSksbihzKX0pfX1yZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sImRlZmF1bHRNYXhMaXN0ZW5lcnMiLHtlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiBhfSxzZXQ6ZnVuY3Rpb24oZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlfHxlPDB8fHMoZSkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSB2YWx1ZSBvZiAiZGVmYXVsdE1heExpc3RlbmVycyIgaXMgb3V0IG9mIHJhbmdlLiBJdCBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIG51bWJlci4gUmVjZWl2ZWQgJytlKyIuIik7YT1lfX0pLG8uaW5pdD1mdW5jdGlvbigpe3ZvaWQgMCE9PXRoaXMuX2V2ZW50cyYmdGhpcy5fZXZlbnRzIT09T2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLl9ldmVudHN8fCh0aGlzLl9ldmVudHM9LyogQF9fUFVSRV9fICovT2JqZWN0LmNyZWF0ZShudWxsKSx0aGlzLl9ldmVudHNDb3VudD0wKSx0aGlzLl9tYXhMaXN0ZW5lcnM9dGhpcy5fbWF4TGlzdGVuZXJzfHx2b2lkIDB9LG8ucHJvdG90eXBlLnNldE1heExpc3RlbmVycz1mdW5jdGlvbihlKXtpZigibnVtYmVyIiE9dHlwZW9mIGV8fGU8MHx8cyhlKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHZhbHVlIG9mICJuIiBpcyBvdXQgb2YgcmFuZ2UuIEl0IG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyLiBSZWNlaXZlZCAnK2UrIi4iKTtyZXR1cm4gdGhpcy5fbWF4TGlzdGVuZXJzPWUsdGhpc30sby5wcm90b3R5cGUuZ2V0TWF4TGlzdGVuZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIGwodGhpcyl9LG8ucHJvdG90eXBlLmVtaXQ9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PVtdLG49MTtuPGFyZ3VtZW50cy5sZW5ndGg7bisrKXQucHVzaChhcmd1bWVudHNbbl0pO3ZhciByPSJlcnJvciI9PT1lLHM9dGhpcy5fZXZlbnRzO2lmKHZvaWQgMCE9PXMpcj1yJiZ2b2lkIDA9PT1zLmVycm9yO2Vsc2UgaWYoIXIpcmV0dXJuITE7aWYocil7dmFyIG87aWYodC5sZW5ndGg+MCYmKG89dFswXSksbyBpbnN0YW5jZW9mIEVycm9yKXRocm93IG87dmFyIGE9bmV3IEVycm9yKCJVbmhhbmRsZWQgZXJyb3IuIisobz8iICgiK28ubWVzc2FnZSsiKSI6IiIpKTt0aHJvdyBhLmNvbnRleHQ9byxhfXZhciBjPXNbZV07aWYodm9pZCAwPT09YylyZXR1cm4hMTtpZigiZnVuY3Rpb24iPT10eXBlb2YgYylpKGMsdGhpcyx0KTtlbHNle3ZhciBsPWMubGVuZ3RoLHU9ZyhjLGwpO2ZvcihuPTA7bjxsOysrbilpKHVbbl0sdGhpcyx0KX1yZXR1cm4hMH0sby5wcm90b3R5cGUuYWRkTGlzdGVuZXI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdSh0aGlzLGUsdCwhMSl9LG8ucHJvdG90eXBlLm9uPW8ucHJvdG90eXBlLmFkZExpc3RlbmVyLG8ucHJvdG90eXBlLnByZXBlbmRMaXN0ZW5lcj1mdW5jdGlvbihlLHQpe3JldHVybiB1KHRoaXMsZSx0LCEwKX0sby5wcm90b3R5cGUub25jZT1mdW5jdGlvbihlLHQpe3JldHVybiBjKHQpLHRoaXMub24oZSxmKHRoaXMsZSx0KSksdGhpc30sby5wcm90b3R5cGUucHJlcGVuZE9uY2VMaXN0ZW5lcj1mdW5jdGlvbihlLHQpe3JldHVybiBjKHQpLHRoaXMucHJlcGVuZExpc3RlbmVyKGUsZih0aGlzLGUsdCkpLHRoaXN9LG8ucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyPWZ1bmN0aW9uKGUsdCl7dmFyIG4scixpLHMsbztpZihjKHQpLHZvaWQgMD09PShyPXRoaXMuX2V2ZW50cykpcmV0dXJuIHRoaXM7aWYodm9pZCAwPT09KG49cltlXSkpcmV0dXJuIHRoaXM7aWYobj09PXR8fG4ubGlzdGVuZXI9PT10KTA9PT0tLXRoaXMuX2V2ZW50c0NvdW50P3RoaXMuX2V2ZW50cz0vKiBAX19QVVJFX18gKi9PYmplY3QuY3JlYXRlKG51bGwpOihkZWxldGUgcltlXSxyLnJlbW92ZUxpc3RlbmVyJiZ0aGlzLmVtaXQoInJlbW92ZUxpc3RlbmVyIixlLG4ubGlzdGVuZXJ8fHQpKTtlbHNlIGlmKCJmdW5jdGlvbiIhPXR5cGVvZiBuKXtmb3IoaT0tMSxzPW4ubGVuZ3RoLTE7cz49MDtzLS0paWYobltzXT09PXR8fG5bc10ubGlzdGVuZXI9PT10KXtvPW5bc10ubGlzdGVuZXIsaT1zO2JyZWFrfWlmKGk8MClyZXR1cm4gdGhpczswPT09aT9uLnNoaWZ0KCk6ZnVuY3Rpb24oZSx0KXtmb3IoO3QrMTxlLmxlbmd0aDt0KyspZVt0XT1lW3QrMV07ZS5wb3AoKX0obixpKSwxPT09bi5sZW5ndGgmJihyW2VdPW5bMF0pLHZvaWQgMCE9PXIucmVtb3ZlTGlzdGVuZXImJnRoaXMuZW1pdCgicmVtb3ZlTGlzdGVuZXIiLGUsb3x8dCl9cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLm9mZj1vLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lcixvLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnM9ZnVuY3Rpb24oZSl7dmFyIHQsbixyO2lmKHZvaWQgMD09PShuPXRoaXMuX2V2ZW50cykpcmV0dXJuIHRoaXM7aWYodm9pZCAwPT09bi5yZW1vdmVMaXN0ZW5lcilyZXR1cm4gMD09PWFyZ3VtZW50cy5sZW5ndGg/KHRoaXMuX2V2ZW50cz0vKiBAX19QVVJFX18gKi9PYmplY3QuY3JlYXRlKG51bGwpLHRoaXMuX2V2ZW50c0NvdW50PTApOnZvaWQgMCE9PW5bZV0mJigwPT09LS10aGlzLl9ldmVudHNDb3VudD90aGlzLl9ldmVudHM9LyogQF9fUFVSRV9fICovT2JqZWN0LmNyZWF0ZShudWxsKTpkZWxldGUgbltlXSksdGhpcztpZigwPT09YXJndW1lbnRzLmxlbmd0aCl7dmFyIGkscz1PYmplY3Qua2V5cyhuKTtmb3Iocj0wO3I8cy5sZW5ndGg7KytyKSJyZW1vdmVMaXN0ZW5lciIhPT0oaT1zW3JdKSYmdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoaSk7cmV0dXJuIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCJyZW1vdmVMaXN0ZW5lciIpLHRoaXMuX2V2ZW50cz0vKiBAX19QVVJFX18gKi9PYmplY3QuY3JlYXRlKG51bGwpLHRoaXMuX2V2ZW50c0NvdW50PTAsdGhpc31pZigiZnVuY3Rpb24iPT10eXBlb2YodD1uW2VdKSl0aGlzLnJlbW92ZUxpc3RlbmVyKGUsdCk7ZWxzZSBpZih2b2lkIDAhPT10KWZvcihyPXQubGVuZ3RoLTE7cj49MDtyLS0pdGhpcy5yZW1vdmVMaXN0ZW5lcihlLHRbcl0pO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5saXN0ZW5lcnM9ZnVuY3Rpb24oZSl7cmV0dXJuIGQodGhpcyxlLCEwKX0sby5wcm90b3R5cGUucmF3TGlzdGVuZXJzPWZ1bmN0aW9uKGUpe3JldHVybiBkKHRoaXMsZSwhMSl9LG8ubGlzdGVuZXJDb3VudD1mdW5jdGlvbihlLHQpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBlLmxpc3RlbmVyQ291bnQ/ZS5saXN0ZW5lckNvdW50KHQpOnAuY2FsbChlLHQpfSxvLnByb3RvdHlwZS5saXN0ZW5lckNvdW50PXAsby5wcm90b3R5cGUuZXZlbnROYW1lcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9ldmVudHNDb3VudD4wP24odGhpcy5fZXZlbnRzKTpbXX0sdC5leHBvcnRzfSgpO2NvbnN0IHI9MCxpPTEscz0yLG89MyxhPTQsYz01LGw9Nix1PTcsaD04LGY9OSxkPTE2LHA9MTc7Y2xhc3MgZ3tjb25zdHJ1Y3RvcihlKXtpZihudWxsPT1lKXRoaXMuaWQ9Zy5nZW5lcmF0ZSgpO2Vsc2UgaWYoInN0cmluZyI9PXR5cGVvZiBlKXtpZighZy5pc1ZhbGlkKGUpKXRocm93IG5ldyBFcnJvcihgQXJndW1lbnQgcGFzc2VkIGluIG11c3QgYmUgYSBzdHJpbmcgb2YgMjQgaGV4IGNoYXJhY3RlcnMsIGdvdDogJHtlfWApO3RoaXMuaWQ9ZS50b0xvd2VyQ2FzZSgpfWVsc2UgaWYoZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJjEyPT09ZS5sZW5ndGgpdGhpcy5pZD1BcnJheS5mcm9tKGUpLm1hcChlPT5lLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCIwIikpLmpvaW4oIiIpO2Vsc2V7aWYoIShlIGluc3RhbmNlb2YgZykpdGhyb3cgbmV3IEVycm9yKCJBcmd1bWVudCBwYXNzZWQgaW4gbXVzdCBiZSBhIHN0cmluZyBvZiAyNCBoZXggY2hhcmFjdGVycyBvciBhbiBPYmplY3RJZCIpO3RoaXMuaWQ9ZS5pZH19dG9TdHJpbmcoKXtyZXR1cm4gdGhpcy5pZH10b0hleFN0cmluZygpe3JldHVybiB0aGlzLmlkfWdldFRpbWVzdGFtcCgpe2NvbnN0IGU9cGFyc2VJbnQodGhpcy5pZC5zdWJzdHJpbmcoMCw4KSwxNik7cmV0dXJuIG5ldyBEYXRlKDFlMyplKX1lcXVhbHMoZSl7aWYoIShlIGluc3RhbmNlb2YgZykpdGhyb3cgbmV3IEVycm9yKCJDYW4gb25seSBjb21wYXJlIHdpdGggYW5vdGhlciBPYmplY3RJZCIpO3JldHVybiB0aGlzLmlkPT09ZS5pZH1jb21wYXJlKGUpe2lmKCEoZSBpbnN0YW5jZW9mIGcpKXRocm93IG5ldyBFcnJvcigiQ2FuIG9ubHkgY29tcGFyZSB3aXRoIGFub3RoZXIgT2JqZWN0SWQiKTtyZXR1cm4gdGhpcy5pZC5sb2NhbGVDb21wYXJlKGUuaWQpfXRvSlNPTigpe3JldHVybiB0aGlzLmlkfWluc3BlY3QoKXtyZXR1cm5gT2JqZWN0SWQoIiR7dGhpcy5pZH0iKWB9dG9CeXRlcygpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoMTIpO2ZvcihsZXQgdD0wO3Q8MTI7dCsrKWVbdF09cGFyc2VJbnQodGhpcy5pZC5zdWJzdHJpbmcoMip0LDIqdCsyKSwxNik7cmV0dXJuIGV9c3RhdGljIGlzVmFsaWQoZSl7cmV0dXJuISFlJiYoInN0cmluZyI9PXR5cGVvZiBlJiYoMjQ9PT1lLmxlbmd0aCYmL15bMC05YS1mQS1GXXsyNH0kLy50ZXN0KGUpKSl9c3RhdGljIGNyZWF0ZUZyb21UaW1lKGUpe2NvbnN0IHQ9KCIwMDAwMDAwMCIrTWF0aC5mbG9vcihlLzFlMykudG9TdHJpbmcoMTYpKS5zbGljZSgtOCk7cmV0dXJuIG5ldyBnKHQrIjAwMDAwMDAwMDAwMDAwMDAiKX1zdGF0aWMgZ2VuZXJhdGUoKXtjb25zdCBlPU1hdGguZmxvb3IoRGF0ZS5ub3coKS8xZTMpLHQ9InVuZGVmaW5lZCIhPXR5cGVvZiBjcnlwdG8mJmNyeXB0by5nZXRSYW5kb21WYWx1ZXM/bmV3IFVpbnQ4QXJyYXkoOCk6bnVsbDtsZXQgbj0iIjtpZih0KXtjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKHQpO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKW4rPSgiMCIrdFtlXS50b1N0cmluZygxNikpLnNsaWNlKC0yKX1lbHNlIG49TWF0aC5yYW5kb20oKS50b1N0cmluZygxNikuc2xpY2UoMikucGFkRW5kKDgsIjAiKS5zbGljZSgwLDgpK01hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIpLnBhZEVuZCg4LCIwIikuc2xpY2UoMCw4KTtyZXR1cm4oKCIwMDAwMDAwMCIrZS50b1N0cmluZygxNikpLnNsaWNlKC04KStuKS5zbGljZSgwLDI0KX19Y2xhc3MgeXtjb25zdHJ1Y3RvcihlKXtpZihudWxsPT1lKXRocm93IG5ldyBFcnJvcigiUG9pbnRlciBvZmZzZXQgbXVzdCBiZSBhIG51bWJlciIpO2lmKCJudW1iZXIiIT10eXBlb2YgZSl0aHJvdyBuZXcgRXJyb3IoIlBvaW50ZXIgb2Zmc2V0IG11c3QgYmUgYSBudW1iZXIiKTtpZighTnVtYmVyLmlzSW50ZWdlcihlKSl0aHJvdyBuZXcgRXJyb3IoIlBvaW50ZXIgb2Zmc2V0IG11c3QgYmUgYW4gaW50ZWdlciIpO2lmKGU8MCl0aHJvdyBuZXcgRXJyb3IoIlBvaW50ZXIgb2Zmc2V0IG11c3QgYmUgbm9uLW5lZ2F0aXZlIik7aWYoZT5OdW1iZXIuTUFYX1NBRkVfSU5URUdFUil0aHJvdyBuZXcgRXJyb3IoIlBvaW50ZXIgb2Zmc2V0IGV4Y2VlZHMgbWF4aW11bSBzYWZlIGludGVnZXIiKTt0aGlzLm9mZnNldD1lfXZhbHVlT2YoKXtyZXR1cm4gdGhpcy5vZmZzZXR9dG9TdHJpbmcoKXtyZXR1cm4gdGhpcy5vZmZzZXQudG9TdHJpbmcoKX10b0pTT04oKXtyZXR1cm4gdGhpcy5vZmZzZXR9aW5zcGVjdCgpe3JldHVybmBQb2ludGVyKCR7dGhpcy5vZmZzZXR9KWB9ZXF1YWxzKGUpe3JldHVybiBlIGluc3RhbmNlb2YgeSYmdGhpcy5vZmZzZXQ9PT1lLm9mZnNldH19ZnVuY3Rpb24gbShlKXtjb25zdCB0PVtdOyFmdW5jdGlvbiBlKG4pe2lmKG51bGw9PT1uKXQucHVzaChuZXcgVWludDhBcnJheShbcl0pKTtlbHNlIGlmKCExPT09bil0LnB1c2gobmV3IFVpbnQ4QXJyYXkoW2ldKSk7ZWxzZSBpZighMD09PW4pdC5wdXNoKG5ldyBVaW50OEFycmF5KFtzXSkpO2Vsc2UgaWYobiBpbnN0YW5jZW9mIGcpdC5wdXNoKG5ldyBVaW50OEFycmF5KFtsXSkpLHQucHVzaChuLnRvQnl0ZXMoKSk7ZWxzZSBpZihuIGluc3RhbmNlb2YgRGF0ZSl7dC5wdXNoKG5ldyBVaW50OEFycmF5KFt1XSkpO2NvbnN0IGU9bmV3IEFycmF5QnVmZmVyKDgpO25ldyBEYXRhVmlldyhlKS5zZXRCaWdJbnQ2NCgwLEJpZ0ludChuLmdldFRpbWUoKSksITApLHQucHVzaChuZXcgVWludDhBcnJheShlKSl9ZWxzZSBpZihuIGluc3RhbmNlb2YgeSl7dC5wdXNoKG5ldyBVaW50OEFycmF5KFtoXSkpO2NvbnN0IGU9bmV3IEFycmF5QnVmZmVyKDgpO25ldyBEYXRhVmlldyhlKS5zZXRCaWdVaW50NjQoMCxCaWdJbnQobi5vZmZzZXQpLCEwKSx0LnB1c2gobmV3IFVpbnQ4QXJyYXkoZSkpfWVsc2UgaWYobiBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpe3QucHVzaChuZXcgVWludDhBcnJheShbZl0pKTtjb25zdCBlPW5ldyBBcnJheUJ1ZmZlcig0KTtuZXcgRGF0YVZpZXcoZSkuc2V0VWludDMyKDAsbi5sZW5ndGgsITApLHQucHVzaChuZXcgVWludDhBcnJheShlKSksdC5wdXNoKG4pfWVsc2UgaWYoIm51bWJlciI9PXR5cGVvZiBuKWlmKE51bWJlci5pc0ludGVnZXIobikmJk51bWJlci5pc1NhZmVJbnRlZ2VyKG4pKXt0LnB1c2gobmV3IFVpbnQ4QXJyYXkoW29dKSk7Y29uc3QgZT1uZXcgQXJyYXlCdWZmZXIoOCk7bmV3IERhdGFWaWV3KGUpLnNldEJpZ0ludDY0KDAsQmlnSW50KG4pLCEwKSx0LnB1c2gobmV3IFVpbnQ4QXJyYXkoZSkpfWVsc2V7dC5wdXNoKG5ldyBVaW50OEFycmF5KFthXSkpO2NvbnN0IGU9bmV3IEFycmF5QnVmZmVyKDgpO25ldyBEYXRhVmlldyhlKS5zZXRGbG9hdDY0KDAsbiwhMCksdC5wdXNoKG5ldyBVaW50OEFycmF5KGUpKX1lbHNlIGlmKCJzdHJpbmciPT10eXBlb2Ygbil7dC5wdXNoKG5ldyBVaW50OEFycmF5KFtjXSkpO2NvbnN0IGU9KG5ldyBUZXh0RW5jb2RlcikuZW5jb2RlKG4pLHI9bmV3IEFycmF5QnVmZmVyKDQpO25ldyBEYXRhVmlldyhyKS5zZXRVaW50MzIoMCxlLmxlbmd0aCwhMCksdC5wdXNoKG5ldyBVaW50OEFycmF5KHIpKSx0LnB1c2goZSl9ZWxzZSBpZihBcnJheS5pc0FycmF5KG4pKXtjb25zdCByPVtdLGk9bmV3IEFycmF5QnVmZmVyKDQpO25ldyBEYXRhVmlldyhpKS5zZXRVaW50MzIoMCxuLmxlbmd0aCwhMCksci5wdXNoKG5ldyBVaW50OEFycmF5KGkpKTtjb25zdCBzPXQubGVuZ3RoO2Zvcihjb25zdCB0IG9mIG4pZSh0KTtjb25zdCBvPXQuc3BsaWNlKHMpO3IucHVzaCguLi5vKTtjb25zdCBhPXIucmVkdWNlKChlLHQpPT5lK3QubGVuZ3RoLDApO3QucHVzaChuZXcgVWludDhBcnJheShbZF0pKTtjb25zdCBjPW5ldyBBcnJheUJ1ZmZlcig0KTtuZXcgRGF0YVZpZXcoYykuc2V0VWludDMyKDAsYSwhMCksdC5wdXNoKG5ldyBVaW50OEFycmF5KGMpKSx0LnB1c2goLi4ucil9ZWxzZXtpZigib2JqZWN0IiE9dHlwZW9mIG4pdGhyb3cgbmV3IEVycm9yKCJVbnN1cHBvcnRlZCB0eXBlOiAiK3R5cGVvZiBuKTt7Y29uc3Qgcj1bXSxpPU9iamVjdC5rZXlzKG4pLHM9bmV3IEFycmF5QnVmZmVyKDQpO25ldyBEYXRhVmlldyhzKS5zZXRVaW50MzIoMCxpLmxlbmd0aCwhMCksci5wdXNoKG5ldyBVaW50OEFycmF5KHMpKTtjb25zdCBvPXQubGVuZ3RoO2Zvcihjb25zdCB1IG9mIGkpe2NvbnN0IHI9KG5ldyBUZXh0RW5jb2RlcikuZW5jb2RlKHUpLGk9bmV3IEFycmF5QnVmZmVyKDQpO25ldyBEYXRhVmlldyhpKS5zZXRVaW50MzIoMCxyLmxlbmd0aCwhMCksdC5wdXNoKG5ldyBVaW50OEFycmF5KGkpKSx0LnB1c2gociksZShuW3VdKX1jb25zdCBhPXQuc3BsaWNlKG8pO3IucHVzaCguLi5hKTtjb25zdCBjPXIucmVkdWNlKChlLHQpPT5lK3QubGVuZ3RoLDApO3QucHVzaChuZXcgVWludDhBcnJheShbcF0pKTtjb25zdCBsPW5ldyBBcnJheUJ1ZmZlcig0KTtuZXcgRGF0YVZpZXcobCkuc2V0VWludDMyKDAsYywhMCksdC5wdXNoKG5ldyBVaW50OEFycmF5KGwpKSx0LnB1c2goLi4ucil9fX0oZSk7Y29uc3Qgbj10LnJlZHVjZSgoZSx0KT0+ZSt0Lmxlbmd0aCwwKSxtPW5ldyBVaW50OEFycmF5KG4pO2xldCB3PTA7Zm9yKGNvbnN0IHIgb2YgdCltLnNldChyLHcpLHcrPXIubGVuZ3RoO3JldHVybiBtfWZ1bmN0aW9uIHcoZSl7bGV0IHQ9MDtyZXR1cm4gZnVuY3Rpb24gbigpe2lmKHQ+PWUubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBlbmQgb2YgZGF0YSIpO2NvbnN0IG09ZVt0KytdO3N3aXRjaChtKXtjYXNlIHI6cmV0dXJuIG51bGw7Y2FzZSBpOnJldHVybiExO2Nhc2UgczpyZXR1cm4hMDtjYXNlIG86e2lmKHQrND5lLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgZW5kIG9mIGRhdGEgZm9yIElOVCIpO2NvbnN0IG49bmV3IERhdGFWaWV3KGUuYnVmZmVyLGUuYnl0ZU9mZnNldCt0LDgpLmdldEJpZ0ludDY0KDAsITApO2lmKHQrPTgsbjxCaWdJbnQoTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVIpfHxuPkJpZ0ludChOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikpdGhyb3cgbmV3IEVycm9yKCJEZWNvZGVkIGludGVnZXIgZXhjZWVkcyBzYWZlIHJhbmdlIik7cmV0dXJuIE51bWJlcihuKX1jYXNlIGE6e2lmKHQrOD5lLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgZW5kIG9mIGRhdGEgZm9yIEZMT0FUIik7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5idWZmZXIsZS5ieXRlT2Zmc2V0K3QsOCkuZ2V0RmxvYXQ2NCgwLCEwKTtyZXR1cm4gdCs9OCxufWNhc2UgYzp7aWYodCs0PmUubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBlbmQgb2YgZGF0YSBmb3IgU1RSSU5HIGxlbmd0aCIpO2NvbnN0IG49bmV3IERhdGFWaWV3KGUuYnVmZmVyLGUuYnl0ZU9mZnNldCt0LDQpLmdldFVpbnQzMigwLCEwKTtpZih0Kz00LHQrbj5lLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgZW5kIG9mIGRhdGEgZm9yIFNUUklORyBjb250ZW50Iik7Y29uc3Qgcj1lLnNsaWNlKHQsdCtuKTtyZXR1cm4gdCs9biwobmV3IFRleHREZWNvZGVyKS5kZWNvZGUocil9Y2FzZSBsOntpZih0KzEyPmUubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBlbmQgb2YgZGF0YSBmb3IgT0lEIik7Y29uc3Qgbj1lLnNsaWNlKHQsdCsxMik7cmV0dXJuIHQrPTEyLG5ldyBnKG4pfWNhc2UgdTp7aWYodCs4PmUubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBlbmQgb2YgZGF0YSBmb3IgREFURSIpO2NvbnN0IG49bmV3IERhdGFWaWV3KGUuYnVmZmVyLGUuYnl0ZU9mZnNldCt0LDgpLmdldEJpZ0ludDY0KDAsITApO3JldHVybiB0Kz04LG5ldyBEYXRlKE51bWJlcihuKSl9Y2FzZSBoOntpZih0Kzg+ZS5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIGVuZCBvZiBkYXRhIGZvciBQT0lOVEVSIik7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5idWZmZXIsZS5ieXRlT2Zmc2V0K3QsOCkuZ2V0QmlnVWludDY0KDAsITApO2lmKHQrPTgsbj5CaWdJbnQoTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpKXRocm93IG5ldyBFcnJvcigiUG9pbnRlciBvZmZzZXQgb3V0IG9mIHZhbGlkIHJhbmdlIik7cmV0dXJuIG5ldyB5KE51bWJlcihuKSl9Y2FzZSBmOntpZih0KzQ+ZS5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIGVuZCBvZiBkYXRhIGZvciBCSU5BUlkgbGVuZ3RoIik7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5idWZmZXIsZS5ieXRlT2Zmc2V0K3QsNCkuZ2V0VWludDMyKDAsITApO2lmKHQrPTQsdCtuPmUubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBlbmQgb2YgZGF0YSBmb3IgQklOQVJZIGNvbnRlbnQiKTtjb25zdCByPWUuc2xpY2UodCx0K24pO3JldHVybiB0Kz1uLHJ9Y2FzZSBkOntpZih0KzQ+ZS5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIGVuZCBvZiBkYXRhIGZvciBBUlJBWSBzaXplIik7Y29uc3Qgcj1uZXcgRGF0YVZpZXcoZS5idWZmZXIsZS5ieXRlT2Zmc2V0K3QsNCkuZ2V0VWludDMyKDAsITApO2lmKHQrPTQsdCtyPmUubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBlbmQgb2YgZGF0YSBmb3IgQVJSQVkgY29udGVudCIpO2NvbnN0IGk9bmV3IERhdGFWaWV3KGUuYnVmZmVyLGUuYnl0ZU9mZnNldCt0LDQpLmdldFVpbnQzMigwLCEwKTt0Kz00O2NvbnN0IHM9W107Zm9yKGxldCBlPTA7ZTxpO2UrKylzLnB1c2gobigpKTtyZXR1cm4gc31jYXNlIHA6e2lmKHQrND5lLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgZW5kIG9mIGRhdGEgZm9yIE9CSkVDVCBzaXplIik7Y29uc3Qgcj1uZXcgRGF0YVZpZXcoZS5idWZmZXIsZS5ieXRlT2Zmc2V0K3QsNCkuZ2V0VWludDMyKDAsITApO2lmKHQrPTQsdCtyPmUubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBlbmQgb2YgZGF0YSBmb3IgT0JKRUNUIGNvbnRlbnQiKTtjb25zdCBpPW5ldyBEYXRhVmlldyhlLmJ1ZmZlcixlLmJ5dGVPZmZzZXQrdCw0KS5nZXRVaW50MzIoMCwhMCk7dCs9NDtjb25zdCBzPXt9O2ZvcihsZXQgbz0wO288aTtvKyspe2lmKHQrND5lLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgZW5kIG9mIGRhdGEgZm9yIE9CSkVDVCBrZXkgbGVuZ3RoIik7Y29uc3Qgcj1uZXcgRGF0YVZpZXcoZS5idWZmZXIsZS5ieXRlT2Zmc2V0K3QsNCkuZ2V0VWludDMyKDAsITApO2lmKHQrPTQsdCtyPmUubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBlbmQgb2YgZGF0YSBmb3IgT0JKRUNUIGtleSIpO2NvbnN0IGk9ZS5zbGljZSh0LHQrcik7dCs9cjtzWyhuZXcgVGV4dERlY29kZXIpLmRlY29kZShpKV09bigpfXJldHVybiBzfWRlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHR5cGUgYnl0ZTogMHgke20udG9TdHJpbmcoMTYpfWApfX0oKX1jbGFzcyBie2NvbnN0cnVjdG9yKGUpe2lmKCFlKXRocm93IG5ldyBFcnJvcigiRmlsZVN5c3RlbVN5bmNBY2Nlc3NIYW5kbGUgaXMgcmVxdWlyZWQiKTt0aGlzLnN5bmNBY2Nlc3NIYW5kbGU9ZX0jZShlLHQpe2NvbnN0IG49bmV3IFVpbnQ4QXJyYXkodCkscj10aGlzLnN5bmNBY2Nlc3NIYW5kbGUucmVhZChuLHthdDplfSk7cmV0dXJuIHI8dD9uLnNsaWNlKDAscik6bn1nZXRGaWxlU2l6ZSgpe3JldHVybiB0aGlzLnN5bmNBY2Nlc3NIYW5kbGUuZ2V0U2l6ZSgpfXdyaXRlKGUpe2NvbnN0IHQ9bShlKTt0aGlzLnN5bmNBY2Nlc3NIYW5kbGUudHJ1bmNhdGUoMCksdGhpcy5zeW5jQWNjZXNzSGFuZGxlLndyaXRlKHQse2F0OjB9KX1yZWFkKGU9bmV3IHkoMCkpe2NvbnN0IHQ9dGhpcy5nZXRGaWxlU2l6ZSgpO2lmKDA9PT10KXRocm93IG5ldyBFcnJvcigiRmlsZSBpcyBlbXB0eSIpO2NvbnN0IG49ZS52YWx1ZU9mKCk7aWYobjwwfHxuPj10KXRocm93IG5ldyBFcnJvcihgUG9pbnRlciBvZmZzZXQgJHtlfSBvdXQgb2YgZmlsZSBib3VuZHMgWzAsICR7dH0pYCk7cmV0dXJuIHcodGhpcy4jZShuLHQtbikpfWFwcGVuZChlKXtjb25zdCB0PW0oZSksbj10aGlzLmdldEZpbGVTaXplKCk7dGhpcy5zeW5jQWNjZXNzSGFuZGxlLndyaXRlKHQse2F0Om59KX1mbHVzaCgpe3RoaXMuc3luY0FjY2Vzc0hhbmRsZS5mbHVzaCgpfSpzY2FuKCl7Y29uc3QgZT10aGlzLmdldEZpbGVTaXplKCk7aWYoMD09PWUpcmV0dXJuO2xldCB0PTA7Zm9yKDt0PGU7KXtjb25zdCBlPShlPT57bGV0IHQ9dGhpcy4jZShlLDEpO2NvbnN0IG49dFswXTtzd2l0Y2gobil7Y2FzZSByOmNhc2UgaTpjYXNlIHM6cmV0dXJuIDE7Y2FzZSBvOmNhc2UgYTpjYXNlIHU6Y2FzZSBoOnJldHVybiA5O2Nhc2UgbDpyZXR1cm4gMTM7Y2FzZSBjOnQ9dGhpcy4jZShlKzEsNCk7cmV0dXJuIDUrbmV3IERhdGFWaWV3KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCw0KS5nZXRVaW50MzIoMCwhMCk7Y2FzZSBmOnQ9dGhpcy4jZShlKzEsNCk7cmV0dXJuIDUrbmV3IERhdGFWaWV3KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCw0KS5nZXRVaW50MzIoMCwhMCk7Y2FzZSBkOnQ9dGhpcy4jZShlKzEsNCk7cmV0dXJuIDUrbmV3IERhdGFWaWV3KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCw0KS5nZXRVaW50MzIoMCwhMCk7Y2FzZSBwOnQ9dGhpcy4jZShlKzEsNCk7cmV0dXJuIDUrbmV3IERhdGFWaWV3KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCw0KS5nZXRVaW50MzIoMCwhMCk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gdHlwZSBieXRlOiAweCR7bi50b1N0cmluZygxNil9YCl9fSkodCksbj10aGlzLiNlKHQsZSk7dCs9ZSx5aWVsZCB3KG4pfX19ZnVuY3Rpb24geChlLHQpe3JldHVybiBlIGluc3RhbmNlb2YgZ3x8dCBpbnN0YW5jZW9mIGc/ZSBpbnN0YW5jZW9mIGcmJnQgaW5zdGFuY2VvZiBnfHxlIGluc3RhbmNlb2YgZyYmInN0cmluZyI9PXR5cGVvZiB0P2UuZXF1YWxzKHQpOnQgaW5zdGFuY2VvZiBnJiYic3RyaW5nIj09dHlwZW9mIGUmJnQuZXF1YWxzKGUpOmU9PXR9ZnVuY3Rpb24gXyhlKXtpZihlIGluc3RhbmNlb2YgZylyZXR1cm4gbmV3IGcoZS5pZCk7dmFyIHQsbixyO2ZvcihyIGluIHQ9QXJyYXkuaXNBcnJheShlKT9bXTp7fSxlKW49ZVtyXSx0W3JdPSJvYmplY3QiPT10eXBlb2YgbiYmbnVsbCE9PW4/XyhuKTpuO3JldHVybiB0fWZ1bmN0aW9uIHYoZSx0KXtmb3IodmFyIG49dC5zcGxpdCgiLiIpLHI9ZVtuWzBdXSxpPTE7aTxuLmxlbmd0aDtpKyspe2lmKG51bGw9PXJ8fG51bGw9PXIpcmV0dXJuIHI7dmFyIHM9bltpXSxvPXBhcnNlSW50KHMsMTApO3I9SShyKSYmIWlzTmFOKG8pJiZvPj0wJiZvPHIubGVuZ3RoP3Jbb106cltzXX1yZXR1cm4gcn1mdW5jdGlvbiAkKGUsdCl7Zm9yKHZhciBuPXQuc3BsaXQoIi4iKSxyPVtlXSxpPTA7aTxuLmxlbmd0aDtpKyspe2Zvcih2YXIgcz1uW2ldLG89cGFyc2VJbnQocywxMCksYT1bXSxjPTA7YzxyLmxlbmd0aDtjKyspe3ZhciBsPXJbY107aWYobnVsbCE9bCYmbnVsbCE9bClpZihJKGwpJiYhaXNOYU4obykmJm8+PTApbzxsLmxlbmd0aCYmYS5wdXNoKGxbb10pO2Vsc2UgaWYoSShsKSlmb3IodmFyIHU9MDt1PGwubGVuZ3RoO3UrKyludWxsIT1sW3VdJiZudWxsIT1sW3VdJiYib2JqZWN0Ij09dHlwZW9mIGxbdV0mJmEucHVzaChsW3VdW3NdKTtlbHNlIm9iamVjdCI9PXR5cGVvZiBsJiZhLnB1c2gobFtzXSl9cj1hfWlmKDAhPT0ocj1yLmZpbHRlcihmdW5jdGlvbihlKXtyZXR1cm4gdm9pZCAwIT09ZX0pKS5sZW5ndGgpcmV0dXJuIDE9PT1yLmxlbmd0aD9yWzBdOnJ9ZnVuY3Rpb24gTihlLHQsbil7aWYoLTEhPT10LmluZGV4T2YoIiRbXSIpKXJldHVybiBmdW5jdGlvbihlLHQsbil7Zm9yKHZhciByPXQuc3BsaXQoIi4iKSxpPWUscz0wO3M8ci5sZW5ndGg7cysrKXt2YXIgbz1yW3NdO2lmKCIkW10iPT09byl7aWYoIUFycmF5LmlzQXJyYXkoaSkpdGhyb3cgbmV3IEVycm9yKCJUaGUgcG9zaXRpb25hbCBvcGVyYXRvciBkaWQgbm90IGZpbmQgdGhlIG1hdGNoIG5lZWRlZCBmcm9tIHRoZSBxdWVyeS4iKTtmb3IodmFyIGE9ci5zbGljZShzKzEpLmpvaW4oIi4iKSxjPTA7YzxpLmxlbmd0aDtjKyspYT9OKGlbY10sYSxuKTppW2NdPW47cmV0dXJufXZhciBsPXBhcnNlSW50KG8sMTApO2lmKEkoaSkmJiFpc05hTihsKSYmbD49MClpPWlbbF07ZWxzZXtpZihudWxsPT1pW29dfHxudWxsPT1pW29dKXt2YXIgdT1zKzE8ci5sZW5ndGg/cltzKzFdOm51bGw7aWYoIiRbXSI9PT11KWlbb109W107ZWxzZXt2YXIgaD1wYXJzZUludCh1LDEwKTshaXNOYU4oaCkmJmg+PTA/aVtvXT1bXTppW29dPXt9fX1pPWlbb119fX0oZSx0LG4pO2Zvcih2YXIgcj10LnNwbGl0KCIuIiksaT1lLHM9MDtzPHIubGVuZ3RoLTE7cysrKXt2YXIgbz1yW3NdLGE9cGFyc2VJbnQobywxMCk7aWYoSShpKSYmIWlzTmFOKGEpJiZhPj0wKXtmb3IoO2kubGVuZ3RoPD1hOylpLnB1c2godm9pZCAwKTtpZihudWxsPT1pW2FdfHxudWxsPT1pW2FdKXt2YXIgYz1yW3MrMV0sbD1wYXJzZUludChjLDEwKTshaXNOYU4obCkmJmw+PTA/aVthXT1bXTppW2FdPXt9fWk9aVthXX1lbHNle2lmKG51bGw9PWlbb118fG51bGw9PWlbb10pe2M9cltzKzFdLGw9cGFyc2VJbnQoYywxMCk7IWlzTmFOKGwpJiZsPj0wP2lbb109W106aVtvXT17fX1pPWlbb119fXZhciB1PXJbci5sZW5ndGgtMV0saD1wYXJzZUludCh1LDEwKTtpZihJKGkpJiYhaXNOYU4oaCkmJmg+PTApe2Zvcig7aS5sZW5ndGg8PWg7KWkucHVzaCh2b2lkIDApO2lbaF09bn1lbHNlIGlbdV09bn1mdW5jdGlvbiBJKGUpe3JldHVybiBBcnJheT09ZS5jb25zdHJ1Y3Rvcn1mdW5jdGlvbiBTKGUpe3ZhciB0PVtdO2Zvcih2YXIgbiBpbiBlKWlmKGUuaGFzT3duUHJvcGVydHkobikpe3ZhciByPXt9O3Jbbl09ZVtuXSx0LnB1c2gocil9cmV0dXJuIHR9ZnVuY3Rpb24gQShlLHQpe2Zvcih2YXIgbj0wO248dC5sZW5ndGg7bisrKWlmKHgodFtuXSxlKSlyZXR1cm4hMDtyZXR1cm4hMX1mdW5jdGlvbiBPKGUsdCl7aWYoZS5sZW5ndGghPXQubGVuZ3RoKXJldHVybiExO2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKWlmKCF4KGVbbl0sdFtuXSkpe2lmKHR5cGVvZiBlW25dIT10eXBlb2YgdFtuXSlyZXR1cm4hMTtpZigib2JqZWN0Ij09dHlwZW9mIGVbbl0mJm51bGwhPT1lW25dKXtpZihJKGVbbl0pKXtpZighTyhlW25dLHRbbl0pKXJldHVybiExfWVsc2UgaWYoIUMoZVtuXSx0W25dKSlyZXR1cm4hMX1lbHNlIGlmKCF4KGVbbl0sdFtuXSkpcmV0dXJuITF9cmV0dXJuITB9ZnVuY3Rpb24gQyhlLHQpe2Zvcih2YXIgbiBpbiBlKWlmKGUuaGFzT3duUHJvcGVydHkobikpe2lmKCF0Lmhhc093blByb3BlcnR5KG4pKXJldHVybiExO2lmKCF4KGVbbl0sdFtuXSkpe2lmKHR5cGVvZiBlW25dIT10eXBlb2YgdFtuXSlyZXR1cm4hMTtpZigib2JqZWN0Ij09dHlwZW9mIGVbbl0mJm51bGwhPT1lW25dKXtpZihJKGVbbl0pKXtpZighTyhlW25dLHRbbl0pKXJldHVybiExfWVsc2UgaWYoIUMoZVtuXSx0W25dKSlyZXR1cm4hMX1lbHNlIGlmKCF4KGVbbl0sdFtuXSkpcmV0dXJuITF9fWZvcih2YXIgbiBpbiB0KWlmKHQuaGFzT3duUHJvcGVydHkobikmJiFlLmhhc093blByb3BlcnR5KG4pKXJldHVybiExO3JldHVybiEwfWZ1bmN0aW9uIEUoZSx0KXt2YXIgbj17fSxyPU9iamVjdC5rZXlzKGUpO2lmKDA9PXIubGVuZ3RoKXJldHVybiB0O2Zvcih2YXIgaT0hMSxzPSExLG89MDtvPHIubGVuZ3RoO28rKykiX2lkIiE9PXJbb10mJihlW3Jbb11dP2k9ITA6cz0hMCk7aWYoaSYmcyl0aHJvd3skZXJyOiJDYW4ndCBjYW5vbmljYWxpemUgcXVlcnk6IEJhZFZhbHVlIFByb2plY3Rpb24gY2Fubm90IGhhdmUgYSBtaXggb2YgaW5jbHVzaW9uIGFuZCBleGNsdXNpb24uIixjb2RlOjE3Mjg3fTtpZihlW3JbMF1dfHxpKXswIT09ZS5faWQmJihuLl9pZD10Ll9pZCk7Zm9yKG89MDtvPHIubGVuZ3RoO28rKylpZigiX2lkIiE9PXJbb10mJmVbcltvXV0pe3ZhciBhPXYodCx1PXJbb10pO3ZvaWQgMCE9PWEmJk4obix1LGEpfX1lbHNle2Zvcih2YXIgYyBpbiB0KWlmKHQuaGFzT3duUHJvcGVydHkoYykpe3ZhciBsPXRbY107Im9iamVjdCIhPXR5cGVvZiBsfHxudWxsPT09bHx8SShsKT9JKGwpP25bY109bC5zbGljZSgpOm5bY109bDpuW2NdPV8obCl9Zm9yKG89MDtvPHIubGVuZ3RoO28rKylpZighZVtyW29dXSl7dmFyIHUsaD0odT1yW29dKS5zcGxpdCgiLiIpO2lmKDE9PT1oLmxlbmd0aClkZWxldGUgblt1XTtlbHNle2Zvcih2YXIgZj1uLGQ9MDtkPGgubGVuZ3RoLTEmJihudWxsIT1mJiZudWxsIT1mKTtkKyspZj1mW2hbZF1dO251bGwhPWYmJm51bGwhPWYmJmRlbGV0ZSBmW2hbaC5sZW5ndGgtMV1dfX19cmV0dXJuIG59Y29uc3Qgaj0yLEQ9OCxrPTE3Mjg3LFA9MjYsTT0yNyxMPTg1LEI9MTFlMyxGPTIsVD0zMTI1NCx6PTk5OTtjbGFzcyBVIGV4dGVuZHMgRXJyb3J7Y29uc3RydWN0b3IoZSx0PXt9KXtzdXBlcihlKSx0aGlzLm5hbWU9Ik1vbmdvRXJyb3IiLHRoaXMuY29kZT10LmNvZGV8fEQsdGhpcy5jb2RlTmFtZT10aGlzLl9nZXRDb2RlTmFtZSh0aGlzLmNvZGUpLHRoaXMuJGVycj1lLHQuY29sbGVjdGlvbiYmKHRoaXMuY29sbGVjdGlvbj10LmNvbGxlY3Rpb24pLHQuZGF0YWJhc2UmJih0aGlzLmRhdGFiYXNlPXQuZGF0YWJhc2UpLHQub3BlcmF0aW9uJiYodGhpcy5vcGVyYXRpb249dC5vcGVyYXRpb24pLHQucXVlcnkmJih0aGlzLnF1ZXJ5PXQucXVlcnkpLHQuZG9jdW1lbnQmJih0aGlzLmRvY3VtZW50PXQuZG9jdW1lbnQpLHQuZmllbGQmJih0aGlzLmZpZWxkPXQuZmllbGQpLHQuaW5kZXgmJih0aGlzLmluZGV4PXQuaW5kZXgpLEVycm9yLmNhcHR1cmVTdGFja1RyYWNlJiZFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLHRoaXMuY29uc3RydWN0b3IpfV9nZXRDb2RlTmFtZShlKXtyZXR1cm57MDoiT0siLDE6IkludGVybmFsRXJyb3IiLDI6IkJhZFZhbHVlIiw0OiJOb1N1Y2hLZXkiLDU6IkdyYXBoQ29udGFpbnNDeWNsZSIsNjoiSG9zdFVucmVhY2hhYmxlIiw3OiJIb3N0Tm90Rm91bmQiLDg6IlVua25vd25FcnJvciIsMTA6IkNhbm5vdE11dGF0ZU9iamVjdCIsMTE6IlVzZXJOb3RGb3VuZCIsMTI6IlVuc3VwcG9ydGVkRm9ybWF0IiwxMzoiVW5hdXRob3JpemVkIiwxNDoiVHlwZU1pc21hdGNoIiwxNToiT3ZlcmZsb3ciLDE2OiJJbnZhbGlkTGVuZ3RoIiwxNzoiUHJvdG9jb2xFcnJvciIsMTg6IkF1dGhlbnRpY2F0aW9uRmFpbGVkIiwyMDoiSWxsZWdhbE9wZXJhdGlvbiIsMjY6Ik5hbWVzcGFjZU5vdEZvdW5kIiwyNzoiSW5kZXhOb3RGb3VuZCIsMjg6IlBhdGhOb3RWaWFibGUiLDQzOiJDdXJzb3JOb3RGb3VuZCIsNDg6Ik5hbWVzcGFjZUV4aXN0cyIsNTk6IkNvbW1hbmROb3RGb3VuZCIsNjc6IkNhbm5vdENyZWF0ZUluZGV4Iiw2ODoiSW5kZXhFeGlzdHMiLDczOiJJbnZhbGlkTmFtZXNwYWNlIiw4NToiSW5kZXhPcHRpb25zQ29uZmxpY3QiLDExMjoiV3JpdGVDb25mbGljdCIsMTIxOiJEb2N1bWVudFZhbGlkYXRpb25GYWlsdXJlIiwxNzE6IkNhbm5vdEluZGV4UGFyYWxsZWxBcnJheXMiLDE5NzoiSW52YWxpZEluZGV4U3BlY2lmaWNhdGlvbk9wdGlvbiIsOTk4OiJPcGVyYXRpb25Ob3RTdXBwb3J0ZWQiLDk5OToiTm90SW1wbGVtZW50ZWQiLDExZTM6IkR1cGxpY2F0ZUtleSIsMTEwMDE6IkR1cGxpY2F0ZUtleVVwZGF0ZSIsMTcyODc6IkZhaWxlZFRvUGFyc2UifVtlXXx8IlVua25vd25FcnJvciJ9dG9KU09OKCl7Y29uc3QgZT17bmFtZTp0aGlzLm5hbWUsbWVzc2FnZTp0aGlzLm1lc3NhZ2UsY29kZTp0aGlzLmNvZGUsY29kZU5hbWU6dGhpcy5jb2RlTmFtZX07cmV0dXJuIHRoaXMuY29sbGVjdGlvbiYmKGUuY29sbGVjdGlvbj10aGlzLmNvbGxlY3Rpb24pLHRoaXMuZGF0YWJhc2UmJihlLmRhdGFiYXNlPXRoaXMuZGF0YWJhc2UpLHRoaXMub3BlcmF0aW9uJiYoZS5vcGVyYXRpb249dGhpcy5vcGVyYXRpb24pLHRoaXMuaW5kZXgmJihlLmluZGV4PXRoaXMuaW5kZXgpLHRoaXMuaW5kZXhOYW1lJiYoZS5pbmRleE5hbWU9dGhpcy5pbmRleE5hbWUpLHRoaXMuZmllbGQmJihlLmZpZWxkPXRoaXMuZmllbGQpLHRoaXMucXVlcnkmJihlLnF1ZXJ5PXRoaXMucXVlcnkpLHRoaXMuZG9jdW1lbnQmJihlLmRvY3VtZW50PXRoaXMuZG9jdW1lbnQpLHRoaXMubmFtZXNwYWNlJiYoZS5uYW1lc3BhY2U9dGhpcy5uYW1lc3BhY2UpLHRoaXMuY3Vyc29ySWQmJihlLmN1cnNvcklkPXRoaXMuY3Vyc29ySWQpLHRoaXMuZmVhdHVyZSYmKGUuZmVhdHVyZT10aGlzLmZlYXR1cmUpLHRoaXMua2V5UGF0dGVybiYmKGUua2V5UGF0dGVybj10aGlzLmtleVBhdHRlcm4pLHRoaXMua2V5VmFsdWUmJihlLmtleVZhbHVlPXRoaXMua2V5VmFsdWUpLHRoaXMud3JpdGVFcnJvcnMmJihlLndyaXRlRXJyb3JzPXRoaXMud3JpdGVFcnJvcnMpLGV9fWNsYXNzIHEgZXh0ZW5kcyBVe2NvbnN0cnVjdG9yKGUsdD17fSl7c3VwZXIoZSx0KSx0aGlzLm5hbWU9IkluZGV4RXJyb3IifX1jbGFzcyBSIGV4dGVuZHMgcXtjb25zdHJ1Y3RvcihlLHQ9e30pe3N1cGVyKGBJbmRleCAnJHtlfScgbm90IGZvdW5kYCx7Li4udCxjb2RlOk0saW5kZXg6ZX0pLHRoaXMubmFtZT0iSW5kZXhOb3RGb3VuZEVycm9yIix0aGlzLmluZGV4TmFtZT1lfX1jbGFzcyBWIGV4dGVuZHMgVXtjb25zdHJ1Y3RvcihlLHQ9e30pe3N1cGVyKGUsdCksdGhpcy5uYW1lPSJRdWVyeUVycm9yIix0aGlzLmNvZGU9dC5jb2RlfHxGfX1jbGFzcyBIIGV4dGVuZHMgVXtjb25zdHJ1Y3RvcihlLHQ9e30pe3N1cGVyKGAke2V9IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiBtaWNyby1tb25nb2Asey4uLnQsY29kZTp6fSksdGhpcy5uYW1lPSJOb3RJbXBsZW1lbnRlZEVycm9yIix0aGlzLmZlYXR1cmU9ZX19Y2xhc3MgVyBleHRlbmRzIFV7Y29uc3RydWN0b3IoZSx0LG4scj17fSl7c3VwZXIoYEJhZCB2YWx1ZSBmb3IgZmllbGQgJyR7ZX0nOiAke259YCx7Li4ucixjb2RlOmosZmllbGQ6ZX0pLHRoaXMubmFtZT0iQmFkVmFsdWVFcnJvciIsdGhpcy52YWx1ZT10fX1jbGFzcyBRe2NvbnN0cnVjdG9yKGUsdCxuLHIsaSl7aWYodGhpcy5jb2xsZWN0aW9uPWUsdGhpcy5xdWVyeT10LHRoaXMucHJvamVjdGlvbj1uLHRoaXMuX2RvY3VtZW50c1Byb21pc2U9ciBpbnN0YW5jZW9mIFByb21pc2U/cjpQcm9taXNlLnJlc29sdmUociksdGhpcy5kb2N1bWVudHM9bnVsbCx0aGlzLl9pbml0aWFsaXplZD0hMSx0aGlzLlNvcnRlZEN1cnNvcj1pLG4mJk9iamVjdC5rZXlzKG4pLmxlbmd0aD4wKXtjb25zdCB0PU9iamVjdC5rZXlzKG4pO2xldCByPSExLGk9ITE7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspIl9pZCIhPT10W2VdJiYoblt0W2VdXT9yPSEwOmk9ITApO2lmKHImJmkpdGhyb3cgbmV3IFYoIkNhbid0IGNhbm9uaWNhbGl6ZSBxdWVyeTogQmFkVmFsdWUgUHJvamVjdGlvbiBjYW5ub3QgaGF2ZSBhIG1peCBvZiBpbmNsdXNpb24gYW5kIGV4Y2x1c2lvbi4iLHtjb2RlOmssY29sbGVjdGlvbjplLm5hbWV9KX10aGlzLnBvcz0wLHRoaXMuX2xpbWl0PTAsdGhpcy5fc2tpcD0wLHRoaXMuX2Nsb3NlZD0hMX1hc3luYyBfZW5zdXJlSW5pdGlhbGl6ZWQoKXt0aGlzLl9pbml0aWFsaXplZHx8KHRoaXMuZG9jdW1lbnRzPWF3YWl0IHRoaXMuX2RvY3VtZW50c1Byb21pc2UsdGhpcy5faW5pdGlhbGl6ZWQ9ITApfWJhdGNoU2l6ZShlKXtyZXR1cm4gdGhpcy5fYmF0Y2hTaXplPWUsdGhpc31jbG9zZSgpe3RoaXMuX2Nsb3NlZD0hMCx0aGlzLmRvY3VtZW50cyYmKHRoaXMucG9zPXRoaXMuZG9jdW1lbnRzLmxlbmd0aCl9Y29tbWVudChlKXtyZXR1cm4gdGhpcy5fY29tbWVudD1lLHRoaXN9YXN5bmMgY291bnQoKXtyZXR1cm4gYXdhaXQgdGhpcy5fZW5zdXJlSW5pdGlhbGl6ZWQoKSx0aGlzLmRvY3VtZW50cy5sZW5ndGh9ZXhwbGFpbihlPSJxdWVyeVBsYW5uZXIiKXtyZXR1cm57cXVlcnlQbGFubmVyOntwbGFubmVyVmVyc2lvbjoxLG5hbWVzcGFjZTpgJHt0aGlzLmNvbGxlY3Rpb24uZGI/Lm5hbWV8fCJkYiJ9LiR7dGhpcy5jb2xsZWN0aW9uLm5hbWV9YCxpbmRleEZpbHRlclNldDohMSxwYXJzZWRRdWVyeTp0aGlzLnF1ZXJ5LHdpbm5pbmdQbGFuOntzdGFnZToiQ09MTFNDQU4iLGZpbHRlcjp0aGlzLnF1ZXJ5LGRpcmVjdGlvbjoiZm9yd2FyZCJ9fSxleGVjdXRpb25TdGF0czoiZXhlY3V0aW9uU3RhdHMiPT09ZXx8ImFsbFBsYW5zRXhlY3V0aW9uIj09PWU/e2V4ZWN1dGlvblN1Y2Nlc3M6ITAsblJldHVybmVkOnRoaXMuZG9jdW1lbnRzP3RoaXMuZG9jdW1lbnRzLmxlbmd0aDowLGV4ZWN1dGlvblRpbWVNaWxsaXM6MCx0b3RhbEtleXNFeGFtaW5lZDowLHRvdGFsRG9jc0V4YW1pbmVkOnRoaXMuZG9jdW1lbnRzP3RoaXMuZG9jdW1lbnRzLmxlbmd0aDowfTp2b2lkIDAsb2s6MX19YXN5bmMgZm9yRWFjaChlKXtmb3IoYXdhaXQgdGhpcy5fZW5zdXJlSW5pdGlhbGl6ZWQoKTthd2FpdCB0aGlzLmhhc05leHQoKTspYXdhaXQgZShhd2FpdCB0aGlzLm5leHQoKSl9YXN5bmMgaGFzTmV4dCgpe2lmKHRoaXMuX2Nsb3NlZClyZXR1cm4hMTtsZXQgZTtyZXR1cm4gYXdhaXQgdGhpcy5fZW5zdXJlSW5pdGlhbGl6ZWQoKSwwPT09dGhpcy5wb3MmJnRoaXMuX3NraXA+MCYmKHRoaXMucG9zPU1hdGgubWluKHRoaXMuX3NraXAsdGhpcy5kb2N1bWVudHMubGVuZ3RoKSksZT10aGlzLl9saW1pdD4wP01hdGgubWluKHRoaXMuX3NraXArdGhpcy5fbGltaXQsdGhpcy5kb2N1bWVudHMubGVuZ3RoKTp0aGlzLmRvY3VtZW50cy5sZW5ndGgsdGhpcy5wb3M8ZX1oaW50KGUpe3JldHVybiB0aGlzLl9oaW50PWUsdGhpc31hc3luYyBpdGNvdW50KCl7YXdhaXQgdGhpcy5fZW5zdXJlSW5pdGlhbGl6ZWQoKTtsZXQgZT0wO2Zvcig7YXdhaXQgdGhpcy5oYXNOZXh0KCk7KWF3YWl0IHRoaXMubmV4dCgpLGUrKztyZXR1cm4gZX1saW1pdChlKXtyZXR1cm4gdGhpcy5fbGltaXQ9ZSx0aGlzfWFzeW5jIG1hcChlKXthd2FpdCB0aGlzLl9lbnN1cmVJbml0aWFsaXplZCgpO2NvbnN0IHQ9W107Zm9yKDthd2FpdCB0aGlzLmhhc05leHQoKTspdC5wdXNoKGF3YWl0IGUoYXdhaXQgdGhpcy5uZXh0KCkpKTtyZXR1cm4gdH1tYXhTY2FuKGUpe3JldHVybiB0aGlzLl9tYXhTY2FuPWUsdGhpc31tYXhUaW1lTVMoZSl7cmV0dXJuIHRoaXMuX21heFRpbWVNUz1lLHRoaXN9bWF4KGUpe3JldHVybiB0aGlzLl9tYXhJbmRleEJvdW5kcz1lLHRoaXN9bWluKGUpe3JldHVybiB0aGlzLl9taW5JbmRleEJvdW5kcz1lLHRoaXN9YXN5bmMgbmV4dCgpe2lmKCEoYXdhaXQgdGhpcy5oYXNOZXh0KCkpKXRocm93IG5ldyBWKCJFcnJvcjogZXJyb3IgaGFzTmV4dDogZmFsc2UiLHtjb2xsZWN0aW9uOnRoaXMuY29sbGVjdGlvbi5uYW1lfSk7Y29uc3QgZT10aGlzLmRvY3VtZW50c1t0aGlzLnBvcysrXTtyZXR1cm4gdGhpcy5wcm9qZWN0aW9uP0UodGhpcy5wcm9qZWN0aW9uLGUpOmV9bm9DdXJzb3JUaW1lb3V0KCl7cmV0dXJuIHRoaXMuX25vQ3Vyc29yVGltZW91dD0hMCx0aGlzfW9ianNMZWZ0SW5CYXRjaCgpe3JldHVybiB0aGlzLmRvY3VtZW50cz90aGlzLnNpemUoKTowfXByZXR0eSgpe3JldHVybiB0aGlzLl9wcmV0dHk9ITAsdGhpc31yZWFkQ29uY2VybihlKXtyZXR1cm4gdGhpcy5fcmVhZENvbmNlcm49ZSx0aGlzfXJlYWRQcmVmKGUsdCl7cmV0dXJuIHRoaXMuX3JlYWRQcmVmPXttb2RlOmUsdGFnU2V0OnR9LHRoaXN9cmV0dXJuS2V5KGU9ITApe3JldHVybiB0aGlzLl9yZXR1cm5LZXk9ZSx0aGlzfXNob3dSZWNvcmRJZChlPSEwKXtyZXR1cm4gdGhpcy5fc2hvd1JlY29yZElkPWUsdGhpc31zaXplKCl7aWYoIXRoaXMuZG9jdW1lbnRzKXJldHVybiAwO2NvbnN0IGU9dGhpcy5kb2N1bWVudHMubGVuZ3RoLXRoaXMucG9zO2lmKHRoaXMuX2xpbWl0PjApe2NvbnN0IHQ9dGhpcy5fc2tpcCt0aGlzLl9saW1pdDtyZXR1cm4gTWF0aC5taW4odC10aGlzLnBvcyxlKX1yZXR1cm4gZX1za2lwKGUpe3JldHVybiB0aGlzLl9za2lwPWUsMD09PXRoaXMucG9zJiZ0aGlzLmRvY3VtZW50cyYmKHRoaXMucG9zPU1hdGgubWluKGUsdGhpcy5kb2N1bWVudHMubGVuZ3RoKSksdGhpc31pc0Nsb3NlZCgpe3JldHVybiEwPT09dGhpcy5fY2xvc2VkfXNuYXBzaG90KCl7dGhyb3cgbmV3IEgoInNuYXBzaG90Iil9c29ydChlKXtyZXR1cm4gbmV3IHRoaXMuU29ydGVkQ3Vyc29yKHRoaXMuY29sbGVjdGlvbix0aGlzLnF1ZXJ5LHRoaXMsZSl9YWxsb3dEaXNrVXNlKGU9ITApe3JldHVybiB0aGlzLl9hbGxvd0Rpc2tVc2U9ZSx0aGlzfWNvbGxhdGlvbihlKXtyZXR1cm4gdGhpcy5fY29sbGF0aW9uPWUsdGhpc310YWlsYWJsZSgpe3Rocm93IG5ldyBIKCJ0YWlsYWJsZSIpfWFzeW5jIHRvQXJyYXkoKXthd2FpdCB0aGlzLl9lbnN1cmVJbml0aWFsaXplZCgpO2NvbnN0IGU9W107Zm9yKDthd2FpdCB0aGlzLmhhc05leHQoKTspZS5wdXNoKGF3YWl0IHRoaXMubmV4dCgpKTtyZXR1cm4gZX1hc3luYypbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCl7Zm9yKGF3YWl0IHRoaXMuX2Vuc3VyZUluaXRpYWxpemVkKCk7YXdhaXQgdGhpcy5oYXNOZXh0KCk7KXlpZWxkIGF3YWl0IHRoaXMubmV4dCgpfX1jbGFzcyBKe2NvbnN0cnVjdG9yKGUsdCxuLHIpe3RoaXMuY29sbGVjdGlvbj1lLHRoaXMucXVlcnk9dCx0aGlzLnNvcnRTcGVjPXIsdGhpcy5wb3M9MCx0aGlzLl9jdXJzb3I9bix0aGlzLl9zb3J0PXIsdGhpcy5faW5pdGlhbGl6ZWQ9ITEsdGhpcy5pdGVtcz1udWxsfWFzeW5jIF9lbnN1cmVJbml0aWFsaXplZCgpe2lmKHRoaXMuX2luaXRpYWxpemVkKXJldHVybjtmb3IoYXdhaXQgdGhpcy5fY3Vyc29yLl9lbnN1cmVJbml0aWFsaXplZCgpLHRoaXMuaXRlbXM9W107YXdhaXQgdGhpcy5fY3Vyc29yLmhhc05leHQoKTspdGhpcy5pdGVtcy5wdXNoKGF3YWl0IHRoaXMuX2N1cnNvci5uZXh0KCkpO2NvbnN0IGU9T2JqZWN0LmtleXModGhpcy5fc29ydCk7dGhpcy5pdGVtcy5zb3J0KGZ1bmN0aW9uKHQsbil7Zm9yKGxldCByPTA7cjxlLmxlbmd0aDtyKyspe2lmKG51bGw9PXRbZVtyXV0mJm51bGwhPW5bZVtyXV0pcmV0dXJuLTEqdGhpcy5fc29ydFtlW3JdXTtpZihudWxsIT10W2Vbcl1dJiZudWxsPT1uW2Vbcl1dKXJldHVybiAxKnRoaXMuX3NvcnRbZVtyXV07aWYodFtlW3JdXTxuW2Vbcl1dKXJldHVybi0xKnRoaXMuX3NvcnRbZVtyXV07aWYodFtlW3JdXT5uW2Vbcl1dKXJldHVybiAxKnRoaXMuX3NvcnRbZVtyXV19cmV0dXJuIDB9LmJpbmQodGhpcykpLHRoaXMuX2luaXRpYWxpemVkPSEwfWJhdGNoU2l6ZSgpe3Rocm93Ik5vdCBJbXBsZW1lbnRlZCJ9Y2xvc2UoKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifWNvbW1lbnQoKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifWFzeW5jIGNvdW50KCl7cmV0dXJuIGF3YWl0IHRoaXMuX2Vuc3VyZUluaXRpYWxpemVkKCksdGhpcy5pdGVtcy5sZW5ndGh9ZXhwbGFpbigpe3Rocm93Ik5vdCBJbXBsZW1lbnRlZCJ9YXN5bmMgZm9yRWFjaChlKXtmb3IoYXdhaXQgdGhpcy5fZW5zdXJlSW5pdGlhbGl6ZWQoKTthd2FpdCB0aGlzLmhhc05leHQoKTspYXdhaXQgZShhd2FpdCB0aGlzLm5leHQoKSl9YXN5bmMgaGFzTmV4dCgpe3JldHVybiBhd2FpdCB0aGlzLl9lbnN1cmVJbml0aWFsaXplZCgpLHRoaXMucG9zPHRoaXMuaXRlbXMubGVuZ3RofWhpbnQoKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifWl0Y291bnQoKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifWFzeW5jIGxpbWl0KGUpe3JldHVybiBhd2FpdCB0aGlzLl9lbnN1cmVJbml0aWFsaXplZCgpLHRoaXMuaXRlbXM9dGhpcy5pdGVtcy5zbGljZSgwLGUpLHRoaXN9YXN5bmMgbWFwKGUpe2F3YWl0IHRoaXMuX2Vuc3VyZUluaXRpYWxpemVkKCk7Y29uc3QgdD1bXTtmb3IoO2F3YWl0IHRoaXMuaGFzTmV4dCgpOyl0LnB1c2goYXdhaXQgZShhd2FpdCB0aGlzLm5leHQoKSkpO3JldHVybiB0fW1heFNjYW4oKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifW1heFRpbWVNUygpe3Rocm93Ik5vdCBJbXBsZW1lbnRlZCJ9bWF4KCl7dGhyb3ciTm90IEltcGxlbWVudGVkIn1taW4oKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifWFzeW5jIG5leHQoKXtyZXR1cm4gYXdhaXQgdGhpcy5fZW5zdXJlSW5pdGlhbGl6ZWQoKSx0aGlzLml0ZW1zW3RoaXMucG9zKytdfW5vQ3Vyc29yVGltZW91dCgpe3Rocm93Ik5vdCBJbXBsZW1lbnRlZCJ9b2Jqc0xlZnRJbkJhdGNoKCl7dGhyb3ciTm90IEltcGxlbWVudGVkIn1wcmV0dHkoKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifXJlYWRDb25jZXJuKCl7dGhyb3ciTm90IEltcGxlbWVudGVkIn1yZWFkUHJlZigpe3Rocm93Ik5vdCBJbXBsZW1lbnRlZCJ9cmV0dXJuS2V5KCl7dGhyb3ciTm90IEltcGxlbWVudGVkIn1zaG93UmVjb3JkSWQoKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifXNpemUoKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifWFzeW5jIHNraXAoZSl7Zm9yKGF3YWl0IHRoaXMuX2Vuc3VyZUluaXRpYWxpemVkKCk7ZT4wOylhd2FpdCB0aGlzLm5leHQoKSxlLS07cmV0dXJuIHRoaXN9c25hcHNob3QoKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifXNvcnQoZSl7cmV0dXJuIG5ldyBKKHRoaXMuY29sbGVjdGlvbix0aGlzLnF1ZXJ5LHRoaXMsZSl9dGFpbGFibGUoKXt0aHJvdyJOb3QgSW1wbGVtZW50ZWQifWFzeW5jIHRvQXJyYXkoKXthd2FpdCB0aGlzLl9lbnN1cmVJbml0aWFsaXplZCgpO2NvbnN0IGU9W107Zm9yKDthd2FpdCB0aGlzLmhhc05leHQoKTspZS5wdXNoKHRoaXMubmV4dCgpKTtyZXR1cm4gZX1hc3luYypbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCl7Zm9yKGF3YWl0IHRoaXMuX2Vuc3VyZUluaXRpYWxpemVkKCk7YXdhaXQgdGhpcy5oYXNOZXh0KCk7KXlpZWxkIGF3YWl0IHRoaXMubmV4dCgpfX1jb25zdCBLPXthdGlvbmFsOiJhdGUiLHRpb25hbDoidGlvbiIsZW5jaToiZW5jZSIsYW5jaToiYW5jZSIsaXplcjoiaXplIixibGk6ImJsZSIsYWxsaToiYWwiLGVudGxpOiJlbnQiLGVsaToiZSIsb3VzbGk6Im91cyIsaXphdGlvbjoiaXplIixhdGlvbjoiYXRlIixhdG9yOiJhdGUiLGFsaXNtOiJhbCIsaXZlbmVzczoiaXZlIixmdWxuZXNzOiJmdWwiLG91c25lc3M6Im91cyIsYWxpdGk6ImFsIixpdml0aToiaXZlIixiaWxpdGk6ImJsZSIsbG9naToibG9nIn0sRz17aWNhdGU6ImljIixhdGl2ZToiIixhbGl6ZToiYWwiLGljaXRpOiJpYyIsaWNhbDoiaWMiLGZ1bDoiIixuZXNzOiIifSxZPSJbYWVpb3V5XSIsWD0iKFteYWVpb3VdW15hZWlvdXldKikiLFo9IigiK1krIlthZWlvdV0qKSIsZWU9bmV3IFJlZ0V4cCgiXiIrWCsiPyIrWitYKSx0ZT1uZXcgUmVnRXhwKCJeIitYKyI/IitaK1grWisiPyQiKSxuZT1uZXcgUmVnRXhwKCJeIitYKyI/KCIrWitYKyIpezIsfSIpLHJlPW5ldyBSZWdFeHAoIl4iK1grIj8iK1kpLGllPW5ldyBSZWdFeHAoIl4iK1grWSsiW15hZWlvdXd4eV0kIiksc2U9L2xsJC8sb2U9L14oLis/KWUkLyxhZT0vXiguKz8peSQvLGNlPS9eKC4rPyhzfHQpKShpb24pJC8sbGU9L14oLis/KShlZHxpbmcpJC8sdWU9LyhhdHxibHxpeikkLyxoZT0vXiguKz8pZWVkJC8sZmU9L14uKz9bXnNdcyQvLGRlPS9eLis/KHNzfGkpZXMkLyxwZT0vKFteYWVpb3V5bHN6XSlcMSQvLGdlPS9eKC4rPykoYXRpb25hbHx0aW9uYWx8ZW5jaXxhbmNpfGl6ZXJ8YmxpfGFsbGl8ZW50bGl8ZWxpfG91c2xpfGl6YXRpb258YXRpb258YXRvcnxhbGlzbXxpdmVuZXNzfGZ1bG5lc3N8b3VzbmVzc3xhbGl0aXxpdml0aXxiaWxpdGl8bG9naSkkLyx5ZT0vXiguKz8pKGljYXRlfGF0aXZlfGFsaXplfGljaXRpfGljYWx8ZnVsfG5lc3MpJC8sbWU9L14oLis/KShhbHxhbmNlfGVuY2V8ZXJ8aWN8YWJsZXxpYmxlfGFudHxlbWVudHxtZW50fGVudHxvdXxpc218YXRlfGl0aXxvdXN8aXZlfGl6ZSkkLztmdW5jdGlvbiB3ZShlKXtsZXQgdD1TdHJpbmcoZSkudG9Mb3dlckNhc2UoKTtpZih0Lmxlbmd0aDwzKXJldHVybiB0O2xldCBuLHI9ITE7cmV0dXJuIDEyMT09PXQuY29kZVBvaW50QXQoMCkmJihyPSEwLHQ9IlkiK3Quc2xpY2UoMSkpLGRlLnRlc3QodCk/dD10LnNsaWNlKDAsLTIpOmZlLnRlc3QodCkmJih0PXQuc2xpY2UoMCwtMSkpLChuPWhlLmV4ZWModCkpP2VlLnRlc3QoblsxXSkmJih0PXQuc2xpY2UoMCwtMSkpOihuPWxlLmV4ZWModCkpJiZyZS50ZXN0KG5bMV0pJiYodD1uWzFdLHVlLnRlc3QodCk/dCs9ImUiOnBlLnRlc3QodCk/dD10LnNsaWNlKDAsLTEpOmllLnRlc3QodCkmJih0Kz0iZSIpKSwobj1hZS5leGVjKHQpKSYmcmUudGVzdChuWzFdKSYmKHQ9blsxXSsiaSIpLChuPWdlLmV4ZWModCkpJiZlZS50ZXN0KG5bMV0pJiYodD1uWzFdK0tbblsyXV0pLChuPXllLmV4ZWModCkpJiZlZS50ZXN0KG5bMV0pJiYodD1uWzFdK0dbblsyXV0pLChuPW1lLmV4ZWModCkpP25lLnRlc3QoblsxXSkmJih0PW5bMV0pOihuPWNlLmV4ZWModCkpJiZuZS50ZXN0KG5bMV0pJiYodD1uWzFdKSwobj1vZS5leGVjKHQpKSYmKG5lLnRlc3QoblsxXSl8fHRlLnRlc3QoblsxXSkmJiFpZS50ZXN0KG5bMV0pKSYmKHQ9blsxXSksc2UudGVzdCh0KSYmbmUudGVzdCh0KSYmKHQ9dC5zbGljZSgwLC0xKSksciYmKHQ9InkiK3Quc2xpY2UoMSkpLHR9Y2xhc3MgYmV7Y29uc3RydWN0b3IoZSx0LG4scixpLHMpe3RoaXMuaWQ9ZSx0aGlzLmlzTGVhZj10LHRoaXMua2V5cz1uLHRoaXMudmFsdWVzPXIsdGhpcy5jaGlsZHJlbj1pO2ZvcihsZXQgbyBvZiBpKWlmKCEobyBpbnN0YW5jZW9mIHkpKXRocm93IG5ldyBFcnJvcigiQ2hpbGRyZW4gbXVzdCBiZSBQb2ludGVyIG9iamVjdHMiKTt0aGlzLm5leHQ9c319Y2xhc3MgeGV7Y29uc3RydWN0b3IoZSx0PTMpe2lmKHQ8Myl0aHJvdyBuZXcgRXJyb3IoIkIrIHRyZWUgb3JkZXIgbXVzdCBiZSBhdCBsZWFzdCAzIik7dGhpcy5maWxlPW5ldyBiKGUpLHRoaXMub3JkZXI9dCx0aGlzLm1pbktleXM9TWF0aC5jZWlsKHQvMiktMSx0aGlzLmlzT3Blbj0hMSx0aGlzLnJvb3RQb2ludGVyPW51bGwsdGhpcy5uZXh0Tm9kZUlkPTAsdGhpcy5fc2l6ZT0wfWFzeW5jIG9wZW4oKXtpZih0aGlzLmlzT3Blbil0aHJvdyBuZXcgRXJyb3IoIlRyZWUgaXMgYWxyZWFkeSBvcGVuIik7dGhpcy5maWxlLmdldEZpbGVTaXplKCk+MD90aGlzLl9sb2FkTWV0YWRhdGEoKTp0aGlzLl9pbml0aWFsaXplTmV3VHJlZSgpLHRoaXMuaXNPcGVuPSEwfWFzeW5jIGNsb3NlKCl7dGhpcy5pc09wZW4mJih0aGlzLmZpbGUmJnRoaXMuZmlsZS5zeW5jQWNjZXNzSGFuZGxlJiYodGhpcy5maWxlLmZsdXNoKCksYXdhaXQgdGhpcy5maWxlLnN5bmNBY2Nlc3NIYW5kbGUuY2xvc2UoKSksdGhpcy5pc09wZW49ITEpfV9pbml0aWFsaXplTmV3VHJlZSgpe2NvbnN0IGU9bmV3IGJlKDAsITAsW10sW10sW10sbnVsbCk7dGhpcy5uZXh0Tm9kZUlkPTEsdGhpcy5fc2l6ZT0wO2NvbnN0IHQ9dGhpcy5fc2F2ZU5vZGUoZSk7dGhpcy5yb290UG9pbnRlcj10LHRoaXMuX3NhdmVNZXRhZGF0YSgpfV9zYXZlTWV0YWRhdGEoKXtjb25zdCBlPXt2ZXJzaW9uOjEsbWF4RW50cmllczp0aGlzLm9yZGVyLG1pbkVudHJpZXM6dGhpcy5taW5LZXlzLHNpemU6dGhpcy5fc2l6ZSxyb290UG9pbnRlcjp0aGlzLnJvb3RQb2ludGVyLG5leHRJZDp0aGlzLm5leHROb2RlSWR9O3RoaXMuZmlsZS5hcHBlbmQoZSl9X2xvYWRNZXRhZGF0YSgpe2NvbnN0IGU9dGhpcy5maWxlLmdldEZpbGVTaXplKCk7aWYoZTwxMzUpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHRyZWUgZmlsZSIpO2NvbnN0IHQ9ZS0xMzUsbj10aGlzLmZpbGUucmVhZCh0KTtpZighbnx8dm9pZCAwPT09bi5tYXhFbnRyaWVzKXRocm93IG5ldyBFcnJvcigiRmFpbGVkIHRvIHJlYWQgbWV0YWRhdGE6IG1pc3NpbmcgcmVxdWlyZWQgZmllbGRzIik7dGhpcy5vcmRlcj1uLm1heEVudHJpZXMsdGhpcy5taW5LZXlzPW4ubWluRW50cmllcyx0aGlzLl9zaXplPW4uc2l6ZSx0aGlzLm5leHROb2RlSWQ9bi5uZXh0SWQsdGhpcy5yb290UG9pbnRlcj1uLnJvb3RQb2ludGVyfV9zYXZlTm9kZShlKXtjb25zdCB0PXRoaXMuZmlsZS5nZXRGaWxlU2l6ZSgpO3JldHVybiB0aGlzLmZpbGUuYXBwZW5kKGUpLG5ldyB5KHQpfV9sb2FkTm9kZShlKXtpZighKGUgaW5zdGFuY2VvZiB5KSl0aHJvdyBuZXcgRXJyb3IoIkV4cGVjdGVkIFBvaW50ZXIgb2JqZWN0Iik7Y29uc3QgdD10aGlzLmZpbGUucmVhZChlKTtyZXR1cm4gbmV3IGJlKHQuaWQsdC5pc0xlYWYsdC5rZXlzLHQudmFsdWVzLHQuY2hpbGRyZW4sdC5uZXh0KX1fbG9hZFJvb3QoKXtyZXR1cm4gdGhpcy5fbG9hZE5vZGUodGhpcy5yb290UG9pbnRlcil9c2VhcmNoKGUpe2NvbnN0IHQ9dGhpcy5fbG9hZFJvb3QoKTtyZXR1cm4gdGhpcy5fc2VhcmNoTm9kZSh0LGUpfV9zZWFyY2hOb2RlKGUsdCl7aWYoIWUuaXNMZWFmKXtsZXQgbj0wO2Zvcig7bjxlLmtleXMubGVuZ3RoJiZ0Pj1lLmtleXNbbl07KW4rKztjb25zdCByPXRoaXMuX2xvYWROb2RlKGUuY2hpbGRyZW5bbl0pO3JldHVybiB0aGlzLl9zZWFyY2hOb2RlKHIsdCl9Zm9yKGxldCBuPTA7bjxlLmtleXMubGVuZ3RoO24rKylpZih0PT09ZS5rZXlzW25dKXJldHVybiBlLnZhbHVlc1tuXX1hZGQoZSx0KXtjb25zdCBuPXRoaXMuX2xvYWRSb290KCkscj10aGlzLl9hZGRUb05vZGUobixlLHQpO2xldCBpO2lmKHIubmV3Tm9kZSlpPXIubmV3Tm9kZTtlbHNle2NvbnN0IGU9dGhpcy5fc2F2ZU5vZGUoci5sZWZ0KSx0PXRoaXMuX3NhdmVOb2RlKHIucmlnaHQpO2k9bmV3IGJlKHRoaXMubmV4dE5vZGVJZCsrLCExLFtyLnNwbGl0S2V5XSxbXSxbZSx0XSxudWxsKX1jb25zdCBzPXRoaXMuX3NhdmVOb2RlKGkpO3RoaXMucm9vdFBvaW50ZXI9cyx0aGlzLl9zaXplKyssdGhpcy5fc2F2ZU1ldGFkYXRhKCl9X2FkZFRvTm9kZShlLHQsbil7aWYoZS5pc0xlYWYpe2NvbnN0IHI9Wy4uLmUua2V5c10saT1bLi4uZS52YWx1ZXNdLHM9ci5pbmRleE9mKHQpO2lmKC0xIT09cylyZXR1cm4gaVtzXT1uLHtuZXdOb2RlOm5ldyBiZShlLmlkLCEwLHIsaSxbXSxudWxsKX07bGV0IG89MDtmb3IoO288ci5sZW5ndGgmJnQ+cltvXTspbysrO2lmKHIuc3BsaWNlKG8sMCx0KSxpLnNwbGljZShvLDAsbiksci5sZW5ndGg8dGhpcy5vcmRlcilyZXR1cm57bmV3Tm9kZTpuZXcgYmUoZS5pZCwhMCxyLGksW10sbnVsbCl9O3tjb25zdCB0PU1hdGguY2VpbChyLmxlbmd0aC8yKSxuPXIuc2xpY2UoMCx0KSxzPWkuc2xpY2UoMCx0KSxvPXIuc2xpY2UodCksYT1pLnNsaWNlKHQpLGM9bmV3IGJlKHRoaXMubmV4dE5vZGVJZCsrLCEwLG8sYSxbXSxudWxsKTtyZXR1cm57bGVmdDpuZXcgYmUoZS5pZCwhMCxuLHMsW10sbnVsbCkscmlnaHQ6YyxzcGxpdEtleTpvWzBdfX19e2NvbnN0IHI9Wy4uLmUua2V5c10saT1bLi4uZS5jaGlsZHJlbl07bGV0IHM9MDtmb3IoO3M8ci5sZW5ndGgmJnQ+PXJbc107KXMrKztjb25zdCBvPXRoaXMuX2xvYWROb2RlKGlbc10pLGE9dGhpcy5fYWRkVG9Ob2RlKG8sdCxuKTtpZihhLm5ld05vZGUpe2NvbnN0IHQ9dGhpcy5fc2F2ZU5vZGUoYS5uZXdOb2RlKTtyZXR1cm4gaVtzXT10LHtuZXdOb2RlOm5ldyBiZShlLmlkLCExLHIsW10saSxudWxsKX19e2NvbnN0IHQ9dGhpcy5fc2F2ZU5vZGUoYS5sZWZ0KSxuPXRoaXMuX3NhdmVOb2RlKGEucmlnaHQpO2lmKHIuc3BsaWNlKHMsMCxhLnNwbGl0S2V5KSxpLnNwbGljZShzLDEsdCxuKSxyLmxlbmd0aDx0aGlzLm9yZGVyKXJldHVybntuZXdOb2RlOm5ldyBiZShlLmlkLCExLHIsW10saSxudWxsKX07e2NvbnN0IHQ9TWF0aC5jZWlsKHIubGVuZ3RoLzIpLTEsbj1yW3RdLHM9ci5zbGljZSgwLHQpLG89ci5zbGljZSh0KzEpLGE9aS5zbGljZSgwLHQrMSksYz1pLnNsaWNlKHQrMSk7cmV0dXJue2xlZnQ6bmV3IGJlKGUuaWQsITEscyxbXSxhLG51bGwpLHJpZ2h0Om5ldyBiZSh0aGlzLm5leHROb2RlSWQrKywhMSxvLFtdLGMsbnVsbCksc3BsaXRLZXk6bn19fX19ZGVsZXRlKGUpe2NvbnN0IHQ9dGhpcy5fbG9hZFJvb3QoKSxuPXRoaXMuX2RlbGV0ZUZyb21Ob2RlKHQsZSk7aWYoIW4pcmV0dXJuO2xldCByPW47MD09PXIua2V5cy5sZW5ndGgmJiFyLmlzTGVhZiYmci5jaGlsZHJlbi5sZW5ndGg+MCYmKHI9dGhpcy5fbG9hZE5vZGUoci5jaGlsZHJlblswXSkpO2NvbnN0IGk9dGhpcy5fc2F2ZU5vZGUocik7dGhpcy5yb290UG9pbnRlcj1pLHRoaXMuX3NpemUtLSx0aGlzLl9zYXZlTWV0YWRhdGEoKX1fZGVsZXRlRnJvbU5vZGUoZSx0KXtpZihlLmlzTGVhZil7Y29uc3Qgbj1lLmtleXMuaW5kZXhPZih0KTtpZigtMT09PW4pcmV0dXJuIG51bGw7Y29uc3Qgcj1bLi4uZS5rZXlzXSxpPVsuLi5lLnZhbHVlc107cmV0dXJuIHIuc3BsaWNlKG4sMSksaS5zcGxpY2UobiwxKSxuZXcgYmUoZS5pZCwhMCxyLGksW10sZS5uZXh0KX17bGV0IG49MDtmb3IoO248ZS5rZXlzLmxlbmd0aCYmdD49ZS5rZXlzW25dOyluKys7Y29uc3Qgcj10aGlzLl9sb2FkTm9kZShlLmNoaWxkcmVuW25dKSxpPXRoaXMuX2RlbGV0ZUZyb21Ob2RlKHIsdCk7aWYoIWkpcmV0dXJuIG51bGw7Y29uc3Qgcz1bLi4uZS5jaGlsZHJlbl0sbz10aGlzLl9zYXZlTm9kZShpKTtyZXR1cm4gc1tuXT1vLG5ldyBiZShlLmlkLCExLFsuLi5lLmtleXNdLFtdLHMsbnVsbCl9fXRvQXJyYXkoKXtjb25zdCBlPVtdO3JldHVybiB0aGlzLl9jb2xsZWN0QWxsRW50cmllcyh0aGlzLl9sb2FkUm9vdCgpLGUpLGV9YXN5bmMqW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpe2lmKCF0aGlzLmlzT3Blbil0aHJvdyBuZXcgRXJyb3IoIlRyZWUgbXVzdCBiZSBvcGVuIGJlZm9yZSBpdGVyYXRpb24iKTswIT09dGhpcy5fc2l6ZSYmKHlpZWxkKnRoaXMuX2l0ZXJhdGVOb2RlKHRoaXMuX2xvYWRSb290KCkpKX0qX2l0ZXJhdGVOb2RlKGUpe2lmKGUuaXNMZWFmKWZvcihsZXQgdD0wO3Q8ZS5rZXlzLmxlbmd0aDt0KyspeWllbGR7a2V5OmUua2V5c1t0XSx2YWx1ZTplLnZhbHVlc1t0XX07ZWxzZSBmb3IoY29uc3QgdCBvZiBlLmNoaWxkcmVuKXtjb25zdCBlPXRoaXMuX2xvYWROb2RlKHQpO3lpZWxkKnRoaXMuX2l0ZXJhdGVOb2RlKGUpfX1fY29sbGVjdEFsbEVudHJpZXMoZSx0KXtpZihlLmlzTGVhZilmb3IobGV0IG49MDtuPGUua2V5cy5sZW5ndGg7bisrKXQucHVzaCh7a2V5OmUua2V5c1tuXSx2YWx1ZTplLnZhbHVlc1tuXX0pO2Vsc2UgZm9yKGNvbnN0IG4gb2YgZS5jaGlsZHJlbil7Y29uc3QgZT10aGlzLl9sb2FkTm9kZShuKTt0aGlzLl9jb2xsZWN0QWxsRW50cmllcyhlLHQpfX1zaXplKCl7cmV0dXJuIHRoaXMuX3NpemV9aXNFbXB0eSgpe3JldHVybiAwPT09dGhpcy5fc2l6ZX1yYW5nZVNlYXJjaChlLHQpe2NvbnN0IG49W107cmV0dXJuIHRoaXMuX3JhbmdlU2VhcmNoTm9kZSh0aGlzLl9sb2FkUm9vdCgpLGUsdCxuKSxufV9yYW5nZVNlYXJjaE5vZGUoZSx0LG4scil7aWYoZS5pc0xlYWYpZm9yKGxldCBpPTA7aTxlLmtleXMubGVuZ3RoO2krKyllLmtleXNbaV0+PXQmJmUua2V5c1tpXTw9biYmci5wdXNoKHtrZXk6ZS5rZXlzW2ldLHZhbHVlOmUudmFsdWVzW2ldfSk7ZWxzZSBmb3IoY29uc3QgaSBvZiBlLmNoaWxkcmVuKXtjb25zdCBlPXRoaXMuX2xvYWROb2RlKGkpO3RoaXMuX3JhbmdlU2VhcmNoTm9kZShlLHQsbixyKX19Z2V0SGVpZ2h0KCl7bGV0IGU9MCx0PXRoaXMuX2xvYWRSb290KCk7Zm9yKDshdC5pc0xlYWY7KWUrKyx0PXRoaXMuX2xvYWROb2RlKHQuY2hpbGRyZW5bMF0pO3JldHVybiBlfWFzeW5jIGNvbXBhY3QoZSl7aWYoIXRoaXMuaXNPcGVuKXRocm93IG5ldyBFcnJvcigiVHJlZSBmaWxlIGlzIG5vdCBvcGVuIik7aWYoIWUpdGhyb3cgbmV3IEVycm9yKCJEZXN0aW5hdGlvbiBzeW5jIGhhbmRsZSBpcyByZXF1aXJlZCBmb3IgY29tcGFjdGlvbiIpO2NvbnN0IHQ9dGhpcy5maWxlLmdldEZpbGVTaXplKCksbj10aGlzLnRvQXJyYXkoKSxyPW5ldyB4ZShlLHRoaXMub3JkZXIpO2F3YWl0IHIub3BlbigpO2Zvcihjb25zdCBzIG9mIG4pYXdhaXQgci5hZGQocy5rZXkscy52YWx1ZSk7Y29uc3QgaT1yLmZpbGUuZ2V0RmlsZVNpemUoKTtyZXR1cm4gYXdhaXQgci5jbG9zZSgpLHtvbGRTaXplOnQsbmV3U2l6ZTppLGJ5dGVzU2F2ZWQ6TWF0aC5tYXgoMCx0LWkpfX19Y29uc3QgX2U9LyogQF9fUFVSRV9fICovbmV3IFNldChbImEiLCJhYm91dCIsImFmdGVyIiwiYWxsIiwiYWxzbyIsImFtIiwiYW4iLCJhbmQiLCJhbm90aGVyIiwiYW55IiwiYXJlIiwiYXJvdW5kIiwiYXMiLCJhdCIsImJlIiwiYmVjYXVzZSIsImJlZW4iLCJiZWZvcmUiLCJiZWluZyIsImJldHdlZW4iLCJib3RoIiwiYnV0IiwiYnkiLCJjYW1lIiwiY2FuIiwiY29tZSIsImNvdWxkIiwiZGlkIiwiZG8iLCJlYWNoIiwiZm9yIiwiZnJvbSIsImdldCIsImdvdCIsImhhcyIsImhhZCIsImhlIiwiaGF2ZSIsImhlciIsImhlcmUiLCJoaW0iLCJoaW1zZWxmIiwiaGlzIiwiaG93IiwiaSIsImlmIiwiaW4iLCJpbnRvIiwiaXMiLCJpdCIsImxpa2UiLCJtYWtlIiwibWFueSIsIm1lIiwibWlnaHQiLCJtb3JlIiwibW9zdCIsIm11Y2giLCJtdXN0IiwibXkiLCJuZXZlciIsIm5vdyIsIm9mIiwib24iLCJvbmx5Iiwib3IiLCJvdGhlciIsIm91ciIsIm91dCIsIm92ZXIiLCJzYWlkIiwic2FtZSIsInNlZSIsInNob3VsZCIsInNpbmNlIiwic29tZSIsInN0aWxsIiwic3VjaCIsInRha2UiLCJ0aGFuIiwidGhhdCIsInRoZSIsInRoZWlyIiwidGhlbSIsInRoZW4iLCJ0aGVyZSIsInRoZXNlIiwidGhleSIsInRoaXMiLCJ0aG9zZSIsInRocm91Z2giLCJ0byIsInRvbyIsInVuZGVyIiwidXAiLCJ2ZXJ5Iiwid2FzIiwid2F5Iiwid2UiLCJ3ZWxsIiwid2VyZSIsIndoYXQiLCJ3aGVyZSIsIndoaWNoIiwid2hpbGUiLCJ3aG8iLCJ3aXRoIiwid291bGQiLCJ5b3UiLCJ5b3VyIl0pO2Z1bmN0aW9uIHZlKGUpe2lmKCJzdHJpbmciIT10eXBlb2YgZSlyZXR1cm5bXTtyZXR1cm4gZS50b0xvd2VyQ2FzZSgpLnNwbGl0KC9cVysvKS5maWx0ZXIoZT0+ZS5sZW5ndGg+MCkuZmlsdGVyKGU9PiFfZS5oYXMoZSkpfWNsYXNzICRle2NvbnN0cnVjdG9yKGU9e30pe2NvbnN0e29yZGVyOnQ9MTYsdHJlZXM6bn09ZTt0aGlzLm9yZGVyPXQsdGhpcy5pbmRleD1uPy5pbmRleHx8bnVsbCx0aGlzLmRvY3VtZW50VGVybXM9bj8uZG9jdW1lbnRUZXJtc3x8bnVsbCx0aGlzLmRvY3VtZW50TGVuZ3Rocz1uPy5kb2N1bWVudExlbmd0aHN8fG51bGwsdGhpcy5pc09wZW49ITF9YXN5bmMgb3Blbigpe2lmKHRoaXMuaXNPcGVuKXRocm93IG5ldyBFcnJvcigiVGV4dEluZGV4IGlzIGFscmVhZHkgb3BlbiIpO2lmKCF0aGlzLmluZGV4fHwhdGhpcy5kb2N1bWVudFRlcm1zfHwhdGhpcy5kb2N1bWVudExlbmd0aHMpdGhyb3cgbmV3IEVycm9yKCJUcmVlcyBtdXN0IGJlIGluaXRpYWxpemVkIGJlZm9yZSBvcGVuaW5nIik7YXdhaXQgUHJvbWlzZS5hbGwoW3RoaXMuaW5kZXgub3BlbigpLHRoaXMuZG9jdW1lbnRUZXJtcy5vcGVuKCksdGhpcy5kb2N1bWVudExlbmd0aHMub3BlbigpXSksdGhpcy5pc09wZW49ITB9YXN5bmMgY2xvc2UoKXt0aGlzLmlzT3BlbiYmKGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLmluZGV4LmNsb3NlKCksdGhpcy5kb2N1bWVudFRlcm1zLmNsb3NlKCksdGhpcy5kb2N1bWVudExlbmd0aHMuY2xvc2UoKV0pLHRoaXMuaXNPcGVuPSExKX1fZW5zdXJlT3Blbigpe2lmKCF0aGlzLmlzT3Blbil0aHJvdyBuZXcgRXJyb3IoIlRleHRJbmRleCBpcyBub3Qgb3BlbiIpfWFzeW5jIGFkZChlLHQpe2lmKHRoaXMuX2Vuc3VyZU9wZW4oKSwhZSl0aHJvdyBuZXcgRXJyb3IoIkRvY3VtZW50IElEIGlzIHJlcXVpcmVkIik7Y29uc3Qgbj12ZSh0KSxyPS8qIEBfX1BVUkVfXyAqL25ldyBNYXA7bi5mb3JFYWNoKGU9Pntjb25zdCB0PXdlKGUpO3Iuc2V0KHQsKHIuZ2V0KHQpfHwwKSsxKX0pO2Zvcihjb25zdFtvLGFdb2Ygci5lbnRyaWVzKCkpe2NvbnN0IHQ9YXdhaXQgdGhpcy5pbmRleC5zZWFyY2gobyl8fHt9O3RbZV09YSxhd2FpdCB0aGlzLmluZGV4LmFkZChvLHQpfWNvbnN0IGk9ey4uLmF3YWl0IHRoaXMuZG9jdW1lbnRUZXJtcy5zZWFyY2goZSl8fHt9fTtyLmZvckVhY2goKGUsdCk9PntpW3RdPWV9KTtjb25zdCBzPU9iamVjdC52YWx1ZXMoaSkucmVkdWNlKChlLHQpPT5lK3QsMCk7YXdhaXQgdGhpcy5kb2N1bWVudFRlcm1zLmFkZChlLGkpLGF3YWl0IHRoaXMuZG9jdW1lbnRMZW5ndGhzLmFkZChlLHMpfWFzeW5jIHJlbW92ZShlKXt0aGlzLl9lbnN1cmVPcGVuKCk7Y29uc3QgdD1hd2FpdCB0aGlzLmRvY3VtZW50VGVybXMuc2VhcmNoKGUpO2lmKCF0KXJldHVybiExO2Zvcihjb25zdFtuXW9mIE9iamVjdC5lbnRyaWVzKHQpKXtjb25zdCB0PWF3YWl0IHRoaXMuaW5kZXguc2VhcmNoKG4pfHx7fTtkZWxldGUgdFtlXSwwPT09T2JqZWN0LmtleXModCkubGVuZ3RoP2F3YWl0IHRoaXMuaW5kZXguZGVsZXRlKG4pOmF3YWl0IHRoaXMuaW5kZXguYWRkKG4sdCl9cmV0dXJuIGF3YWl0IHRoaXMuZG9jdW1lbnRUZXJtcy5kZWxldGUoZSksYXdhaXQgdGhpcy5kb2N1bWVudExlbmd0aHMuZGVsZXRlKGUpLCEwfWFzeW5jIHF1ZXJ5KGUsdD17c2NvcmVkOiEwLHJlcXVpcmVBbGw6ITF9KXt0aGlzLl9lbnN1cmVPcGVuKCk7Y29uc3Qgbj12ZShlKTtpZigwPT09bi5sZW5ndGgpcmV0dXJuW107Y29uc3Qgcj1uLm1hcChlPT53ZShlKSksaT1bLi4ubmV3IFNldChyKV07aWYodC5yZXF1aXJlQWxsKXtjb25zdCBlPVtdO2Zvcihjb25zdCBuIG9mIGkpe2NvbnN0IHQ9YXdhaXQgdGhpcy5pbmRleC5zZWFyY2gobik7ZS5wdXNoKG5ldyBTZXQoT2JqZWN0LmtleXModHx8e30pKSl9aWYoMD09PWUubGVuZ3RoKXJldHVybltdO2NvbnN0IHQ9bmV3IFNldChlWzBdKTtmb3IobGV0IG49MTtuPGUubGVuZ3RoO24rKylmb3IoY29uc3QgciBvZlsuLi50XSllW25dLmhhcyhyKXx8dC5kZWxldGUocik7cmV0dXJuIEFycmF5LmZyb20odCl9Y29uc3Qgcz1hd2FpdCB0aGlzLmRvY3VtZW50TGVuZ3Rocy50b0FycmF5KCksbz1uZXcgTWFwKHMubWFwKCh7a2V5OmUsdmFsdWU6dH0pPT5bU3RyaW5nKGUpLHR8fDFdKSksYT1zLmxlbmd0aCxjPS8qIEBfX1BVUkVfXyAqL25ldyBNYXA7Zm9yKGNvbnN0IGggb2YgaSl7Y29uc3QgZT1hd2FpdCB0aGlzLmluZGV4LnNlYXJjaChoKSx0PWU/T2JqZWN0LmtleXMoZSkubGVuZ3RoOjA7dD4wJiZjLnNldChoLE1hdGgubG9nKGEvdCkpfWNvbnN0IGw9LyogQF9fUFVSRV9fICovbmV3IE1hcDtmb3IoY29uc3QgaCBvZiBpKXtjb25zdCBlPWF3YWl0IHRoaXMuaW5kZXguc2VhcmNoKGgpO2lmKGUpZm9yKGNvbnN0W3Qsbl1vZiBPYmplY3QuZW50cmllcyhlKSl7Y29uc3QgZT1uLyhvLmdldCh0KXx8MSkscj1jLmdldChoKXx8MCxpPWwuZ2V0KHQpfHwwO2wuc2V0KHQsaStlKnIpfX1mb3IoY29uc3RbaCxmXW9mIGwuZW50cmllcygpKXtjb25zdCBlPWF3YWl0IHRoaXMuZG9jdW1lbnRUZXJtcy5zZWFyY2goaCl8fHt9LHQ9aS5maWx0ZXIodD0+ISFlW3RdKS5sZW5ndGgvaS5sZW5ndGg7bC5zZXQoaCxmKigxK3QpKX1jb25zdCB1PUFycmF5LmZyb20obC5lbnRyaWVzKCkpLm1hcCgoW2UsdF0pPT4oe2lkOmUsc2NvcmU6dH0pKS5zb3J0KChlLHQpPT50LnNjb3JlLWUuc2NvcmUpO3JldHVybiExPT09dC5zY29yZWQ/dS5tYXAoZT0+ZS5pZCk6dX1hc3luYyBnZXRUZXJtQ291bnQoKXt0aGlzLl9lbnN1cmVPcGVuKCk7cmV0dXJuKGF3YWl0IHRoaXMuaW5kZXgudG9BcnJheSgpKS5sZW5ndGh9YXN5bmMgZ2V0RG9jdW1lbnRDb3VudCgpe3RoaXMuX2Vuc3VyZU9wZW4oKTtyZXR1cm4oYXdhaXQgdGhpcy5kb2N1bWVudFRlcm1zLnRvQXJyYXkoKSkubGVuZ3RofWFzeW5jIGNsZWFyKCl7dGhpcy5fZW5zdXJlT3BlbigpO2NvbnN0W2UsdCxuXT1hd2FpdCBQcm9taXNlLmFsbChbdGhpcy5pbmRleC50b0FycmF5KCksdGhpcy5kb2N1bWVudFRlcm1zLnRvQXJyYXkoKSx0aGlzLmRvY3VtZW50TGVuZ3Rocy50b0FycmF5KCldKTtmb3IoY29uc3QgciBvZiBlKWF3YWl0IHRoaXMuaW5kZXguZGVsZXRlKHIua2V5KTtmb3IoY29uc3QgciBvZiB0KWF3YWl0IHRoaXMuZG9jdW1lbnRUZXJtcy5kZWxldGUoci5rZXkpO2Zvcihjb25zdCByIG9mIG4pYXdhaXQgdGhpcy5kb2N1bWVudExlbmd0aHMuZGVsZXRlKHIua2V5KX1hc3luYyBjb21wYWN0KHtpbmRleDplLGRvY3VtZW50VGVybXM6dCxkb2N1bWVudExlbmd0aHM6bn0pe2lmKHRoaXMuX2Vuc3VyZU9wZW4oKSwhZXx8IXR8fCFuKXRocm93IG5ldyBFcnJvcigiRGVzdGluYXRpb24gdHJlZXMgbXVzdCBiZSBwcm92aWRlZCBmb3IgY29tcGFjdGlvbiIpO2NvbnN0IHI9YXdhaXQgdGhpcy5pbmRleC5jb21wYWN0KGUuZmlsZS5zeW5jQWNjZXNzSGFuZGxlKSxpPWF3YWl0IHRoaXMuZG9jdW1lbnRUZXJtcy5jb21wYWN0KHQuZmlsZS5zeW5jQWNjZXNzSGFuZGxlKSxzPWF3YWl0IHRoaXMuZG9jdW1lbnRMZW5ndGhzLmNvbXBhY3Qobi5maWxlLnN5bmNBY2Nlc3NIYW5kbGUpO3JldHVybiBhd2FpdCB0aGlzLmNsb3NlKCksdGhpcy5pc09wZW49ITEse3Rlcm1zOnIsZG9jdW1lbnRzOmksbGVuZ3RoczpzfX19ZnVuY3Rpb24gTmUoZSx0KXtpZihudWxsPT1lKXJldHVybiBlO2lmKCJib29sZWFuIj09dHlwZW9mIGV8fCJudW1iZXIiPT10eXBlb2YgZSlyZXR1cm4gZTtpZigic3RyaW5nIj09dHlwZW9mIGUpcmV0dXJuIGUuc3RhcnRzV2l0aCgiJCQiKT8iJCRLRUVQIj09PWV8fCIkJFBSVU5FIj09PWV8fCIkJERFU0NFTkQiPT09ZT9lOnYodCxlLnN1YnN0cmluZygyKSk6IiQiPT09ZS5jaGFyQXQoMCk/dih0LGUuc3Vic3RyaW5nKDEpKTplO2lmKCJvYmplY3QiPT10eXBlb2YgZSl7aWYoQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gZS5tYXAoZT0+TmUoZSx0KSk7Y29uc3Qgbj1PYmplY3Qua2V5cyhlKTtpZigwPT09bi5sZW5ndGgpcmV0dXJuIGU7Y29uc3Qgcj1uWzBdO2lmKCIkIj09PXIuY2hhckF0KDApKXtyZXR1cm4gZnVuY3Rpb24oZSx0LG4pe3N3aXRjaChlKXtjYXNlIiRhZGQiOnJldHVybiBmdW5jdGlvbihlLHQpe2lmKCFBcnJheS5pc0FycmF5KGUpKXJldHVybiBudWxsO2xldCBuPTA7Zm9yKGNvbnN0IHIgb2YgZSl7Y29uc3QgZT1OZShyLHQpO2UgaW5zdGFuY2VvZiBEYXRlP24rPWUuZ2V0VGltZSgpOiJudW1iZXIiPT10eXBlb2YgZSYmKG4rPWUpfXJldHVybiBufSh0LG4pO2Nhc2UiJHN1YnRyYWN0IjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8MiE9PWUubGVuZ3RoKXJldHVybiBudWxsO2NvbnN0IG49TmUoZVswXSx0KSxyPU5lKGVbMV0sdCk7aWYobiBpbnN0YW5jZW9mIERhdGUmJnIgaW5zdGFuY2VvZiBEYXRlKXJldHVybiBuLmdldFRpbWUoKS1yLmdldFRpbWUoKTtpZihuIGluc3RhbmNlb2YgRGF0ZSYmIm51bWJlciI9PXR5cGVvZiByKXJldHVybiBuZXcgRGF0ZShuLmdldFRpbWUoKS1yKTtpZigibnVtYmVyIj09dHlwZW9mIG4mJiJudW1iZXIiPT10eXBlb2YgcilyZXR1cm4gbi1yO3JldHVybiBudWxsfSh0LG4pO2Nhc2UiJG11bHRpcGx5IjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gbnVsbDtsZXQgbj0xO2Zvcihjb25zdCByIG9mIGUpe2NvbnN0IGU9TmUocix0KTsibnVtYmVyIj09dHlwZW9mIGUmJihuKj1lKX1yZXR1cm4gbn0odCxuKTtjYXNlIiRkaXZpZGUiOnJldHVybiBmdW5jdGlvbihlLHQpe2lmKCFBcnJheS5pc0FycmF5KGUpfHwyIT09ZS5sZW5ndGgpcmV0dXJuIG51bGw7Y29uc3Qgbj1OZShlWzBdLHQpLHI9TmUoZVsxXSx0KTtpZigibnVtYmVyIj09dHlwZW9mIG4mJiJudW1iZXIiPT10eXBlb2YgciYmMCE9PXIpcmV0dXJuIG4vcjtyZXR1cm4gbnVsbH0odCxuKTtjYXNlIiRtb2QiOnJldHVybiBmdW5jdGlvbihlLHQpe2lmKCFBcnJheS5pc0FycmF5KGUpfHwyIT09ZS5sZW5ndGgpcmV0dXJuIG51bGw7Y29uc3Qgbj1OZShlWzBdLHQpLHI9TmUoZVsxXSx0KTtpZigibnVtYmVyIj09dHlwZW9mIG4mJiJudW1iZXIiPT10eXBlb2YgciYmMCE9PXIpcmV0dXJuIG4lcjtyZXR1cm4gbnVsbH0odCxuKTtjYXNlIiRwb3ciOnJldHVybiBmdW5jdGlvbihlLHQpe2lmKCFBcnJheS5pc0FycmF5KGUpfHwyIT09ZS5sZW5ndGgpcmV0dXJuIG51bGw7Y29uc3Qgbj1OZShlWzBdLHQpLHI9TmUoZVsxXSx0KTtpZigibnVtYmVyIj09dHlwZW9mIG4mJiJudW1iZXIiPT10eXBlb2YgcilyZXR1cm4gTWF0aC5wb3cobixyKTtyZXR1cm4gbnVsbH0odCxuKTtjYXNlIiRzcXJ0IjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPU5lKGUsdCk7aWYoIm51bWJlciI9PXR5cGVvZiBuJiZuPj0wKXJldHVybiBNYXRoLnNxcnQobik7cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkYWJzIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPU5lKGUsdCk7aWYoIm51bWJlciI9PXR5cGVvZiBuKXJldHVybiBNYXRoLmFicyhuKTtyZXR1cm4gbnVsbH0odCxuKTtjYXNlIiRjZWlsIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPU5lKGUsdCk7aWYoIm51bWJlciI9PXR5cGVvZiBuKXJldHVybiBNYXRoLmNlaWwobik7cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkZmxvb3IiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtpZigibnVtYmVyIj09dHlwZW9mIG4pcmV0dXJuIE1hdGguZmxvb3Iobik7cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkdHJ1bmMiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtpZigibnVtYmVyIj09dHlwZW9mIG4pcmV0dXJuIE1hdGgudHJ1bmMobik7cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkcm91bmQiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoQXJyYXkuaXNBcnJheShlKT9lWzBdOmUsdCkscj1BcnJheS5pc0FycmF5KGUpJiZ2b2lkIDAhPT1lWzFdP05lKGVbMV0sdCk6MDtpZigibnVtYmVyIj09dHlwZW9mIG4mJiJudW1iZXIiPT10eXBlb2Ygcil7Y29uc3QgZT1NYXRoLnBvdygxMCxyKTtyZXR1cm4gTWF0aC5yb3VuZChuKmUpL2V9cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkY29uY2F0IjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gbnVsbDtsZXQgbj0iIjtmb3IoY29uc3QgciBvZiBlKXtjb25zdCBlPU5lKHIsdCk7bnVsbCE9ZSYmKG4rPVN0cmluZyhlKSl9cmV0dXJuIG59KHQsbik7Y2FzZSIkc3Vic3RyIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8ZS5sZW5ndGg8MylyZXR1cm4gbnVsbDtjb25zdCBuPVN0cmluZyhOZShlWzBdLHQpfHwiIikscj1OZShlWzFdLHQpLGk9TmUoZVsyXSx0KTtpZigibnVtYmVyIj09dHlwZW9mIHImJiJudW1iZXIiPT10eXBlb2YgaSlyZXR1cm4gbi5zdWJzdHIocixpKTtyZXR1cm4gbnVsbH0odCxuKTtjYXNlIiR0b0xvd2VyIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPU5lKGUsdCk7cmV0dXJuIG51bGwhPW4/U3RyaW5nKG4pLnRvTG93ZXJDYXNlKCk6IiJ9KHQsbik7Y2FzZSIkdG9VcHBlciI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO3JldHVybiBudWxsIT1uP1N0cmluZyhuKS50b1VwcGVyQ2FzZSgpOiIifSh0LG4pO2Nhc2UiJHRyaW0iOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoIm9iamVjdCI9PXR5cGVvZiBlJiZlLmlucHV0P2UuaW5wdXQ6ZSx0KSxyPWUuY2hhcnM/TmUoZS5jaGFycyx0KTpudWxsO2xldCBpPW51bGwhPW4/U3RyaW5nKG4pOiIiO2lmKHIpe2NvbnN0IGU9bmV3IFJlZ0V4cChgXlske0llKHIpfV0rfFske0llKHIpfV0rJGAsImciKTtyZXR1cm4gaS5yZXBsYWNlKGUsIiIpfXJldHVybiBpLnRyaW0oKX0odCxuKTtjYXNlIiRsdHJpbSI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZSgib2JqZWN0Ij09dHlwZW9mIGUmJmUuaW5wdXQ/ZS5pbnB1dDplLHQpLHI9ZS5jaGFycz9OZShlLmNoYXJzLHQpOm51bGw7bGV0IGk9bnVsbCE9bj9TdHJpbmcobik6IiI7aWYocil7Y29uc3QgZT1uZXcgUmVnRXhwKGBeWyR7SWUocil9XStgLCJnIik7cmV0dXJuIGkucmVwbGFjZShlLCIiKX1yZXR1cm4gaS5yZXBsYWNlKC9eXHMrLywiIil9KHQsbik7Y2FzZSIkcnRyaW0iOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoIm9iamVjdCI9PXR5cGVvZiBlJiZlLmlucHV0P2UuaW5wdXQ6ZSx0KSxyPWUuY2hhcnM/TmUoZS5jaGFycyx0KTpudWxsO2xldCBpPW51bGwhPW4/U3RyaW5nKG4pOiIiO2lmKHIpe2NvbnN0IGU9bmV3IFJlZ0V4cChgWyR7SWUocil9XSskYCwiZyIpO3JldHVybiBpLnJlcGxhY2UoZSwiIil9cmV0dXJuIGkucmVwbGFjZSgvXHMrJC8sIiIpfSh0LG4pO2Nhc2UiJHNwbGl0IjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8MiE9PWUubGVuZ3RoKXJldHVybiBudWxsO2NvbnN0IG49U3RyaW5nKE5lKGVbMF0sdCl8fCIiKSxyPVN0cmluZyhOZShlWzFdLHQpfHwiIik7cmV0dXJuIG4uc3BsaXQocil9KHQsbik7Y2FzZSIkc3RyTGVuQ1AiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtyZXR1cm4gbnVsbCE9bj9TdHJpbmcobikubGVuZ3RoOjB9KHQsbik7Y2FzZSIkc3RyY2FzZWNtcCI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7aWYoIUFycmF5LmlzQXJyYXkoZSl8fDIhPT1lLmxlbmd0aClyZXR1cm4gbnVsbDtjb25zdCBuPVN0cmluZyhOZShlWzBdLHQpfHwiIikudG9Mb3dlckNhc2UoKSxyPVN0cmluZyhOZShlWzFdLHQpfHwiIikudG9Mb3dlckNhc2UoKTtyZXR1cm4gbjxyPy0xOm4+cj8xOjB9KHQsbik7Y2FzZSIkaW5kZXhPZkNQIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8ZS5sZW5ndGg8MilyZXR1cm4gbnVsbDtjb25zdCBuPVN0cmluZyhOZShlWzBdLHQpfHwiIikscj1TdHJpbmcoTmUoZVsxXSx0KXx8IiIpLGk9dm9pZCAwIT09ZVsyXT9OZShlWzJdLHQpOjAscz12b2lkIDAhPT1lWzNdP05lKGVbM10sdCk6bi5sZW5ndGgsbz1uLnN1YnN0cmluZyhpLHMpLmluZGV4T2Yocik7cmV0dXJuLTE9PT1vPy0xOm8raX0odCxuKTtjYXNlIiRyZXBsYWNlT25lIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPVN0cmluZyhOZShlLmlucHV0LHQpfHwiIikscj1TdHJpbmcoTmUoZS5maW5kLHQpfHwiIiksaT1TdHJpbmcoTmUoZS5yZXBsYWNlbWVudCx0KXx8IiIpO3JldHVybiBuLnJlcGxhY2UocixpKX0odCxuKTtjYXNlIiRyZXBsYWNlQWxsIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPVN0cmluZyhOZShlLmlucHV0LHQpfHwiIikscj1TdHJpbmcoTmUoZS5maW5kLHQpfHwiIiksaT1TdHJpbmcoTmUoZS5yZXBsYWNlbWVudCx0KXx8IiIpO3JldHVybiBuLnNwbGl0KHIpLmpvaW4oaSl9KHQsbik7Y2FzZSIkY21wIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8MiE9PWUubGVuZ3RoKXJldHVybiBudWxsO2NvbnN0IG49TmUoZVswXSx0KSxyPU5lKGVbMV0sdCk7cmV0dXJuIG48cj8tMTpuPnI/MTowfSh0LG4pO2Nhc2UiJGVxIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8MiE9PWUubGVuZ3RoKXJldHVybiBudWxsO2NvbnN0IG49TmUoZVswXSx0KSxyPU5lKGVbMV0sdCk7cmV0dXJuIG49PT1yfSh0LG4pO2Nhc2UiJG5lIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8MiE9PWUubGVuZ3RoKXJldHVybiBudWxsO2NvbnN0IG49TmUoZVswXSx0KSxyPU5lKGVbMV0sdCk7cmV0dXJuIG4hPT1yfSh0LG4pO2Nhc2UiJGd0IjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8MiE9PWUubGVuZ3RoKXJldHVybiBudWxsO2NvbnN0IG49TmUoZVswXSx0KSxyPU5lKGVbMV0sdCk7cmV0dXJuIG4+cn0odCxuKTtjYXNlIiRndGUiOnJldHVybiBmdW5jdGlvbihlLHQpe2lmKCFBcnJheS5pc0FycmF5KGUpfHwyIT09ZS5sZW5ndGgpcmV0dXJuIG51bGw7Y29uc3Qgbj1OZShlWzBdLHQpLHI9TmUoZVsxXSx0KTtyZXR1cm4gbj49cn0odCxuKTtjYXNlIiRsdCI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7aWYoIUFycmF5LmlzQXJyYXkoZSl8fDIhPT1lLmxlbmd0aClyZXR1cm4gbnVsbDtjb25zdCBuPU5lKGVbMF0sdCkscj1OZShlWzFdLHQpO3JldHVybiBuPHJ9KHQsbik7Y2FzZSIkbHRlIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8MiE9PWUubGVuZ3RoKXJldHVybiBudWxsO2NvbnN0IG49TmUoZVswXSx0KSxyPU5lKGVbMV0sdCk7cmV0dXJuIG48PXJ9KHQsbik7Y2FzZSIkYW5kIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gbnVsbDtmb3IoY29uc3QgbiBvZiBlKXtpZighTmUobix0KSlyZXR1cm4hMX1yZXR1cm4hMH0odCxuKTtjYXNlIiRvciI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7aWYoIUFycmF5LmlzQXJyYXkoZSkpcmV0dXJuIG51bGw7Zm9yKGNvbnN0IG4gb2YgZSl7aWYoTmUobix0KSlyZXR1cm4hMH1yZXR1cm4hMX0odCxuKTtjYXNlIiRub3QiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoQXJyYXkuaXNBcnJheShlKT9lWzBdOmUsdCk7cmV0dXJuIW59KHQsbik7Y2FzZSIkY29uZCI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7bGV0IG4scixpO2lmKEFycmF5LmlzQXJyYXkoZSkpe2lmKDMhPT1lLmxlbmd0aClyZXR1cm4gbnVsbDtbbixyLGldPWV9ZWxzZXtpZigib2JqZWN0IiE9dHlwZW9mIGUpcmV0dXJuIG51bGw7bj1lLmlmLHI9ZS50aGVuLGk9ZS5lbHNlfWNvbnN0IHM9TmUobix0KTtyZXR1cm4gTmUocz9yOmksdCl9KHQsbik7Y2FzZSIkaWZOdWxsIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8ZS5sZW5ndGg8MilyZXR1cm4gbnVsbDtmb3IobGV0IG49MDtuPGUubGVuZ3RoO24rKyl7Y29uc3Qgcj1OZShlW25dLHQpO2lmKG51bGwhPXIpcmV0dXJuIHJ9cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkc3dpdGNoIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fCFBcnJheS5pc0FycmF5KGUuYnJhbmNoZXMpKXJldHVybiBudWxsO2Zvcihjb25zdCBuIG9mIGUuYnJhbmNoZXMpe2lmKE5lKG4uY2FzZSx0KSlyZXR1cm4gTmUobi50aGVuLHQpfXJldHVybiB2b2lkIDAhPT1lLmRlZmF1bHQ/TmUoZS5kZWZhdWx0LHQpOm51bGx9KHQsbik7Y2FzZSIkeWVhciI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO2lmKG4gaW5zdGFuY2VvZiBEYXRlKXJldHVybiBuLmdldFVUQ0Z1bGxZZWFyKCk7cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkbW9udGgiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtpZihuIGluc3RhbmNlb2YgRGF0ZSlyZXR1cm4gbi5nZXRVVENNb250aCgpKzE7cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkZGF5T2ZNb250aCI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO2lmKG4gaW5zdGFuY2VvZiBEYXRlKXJldHVybiBuLmdldFVUQ0RhdGUoKTtyZXR1cm4gbnVsbH0odCxuKTtjYXNlIiRkYXlPZldlZWsiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtpZihuIGluc3RhbmNlb2YgRGF0ZSlyZXR1cm4gbi5nZXRVVENEYXkoKSsxO3JldHVybiBudWxsfSh0LG4pO2Nhc2UiJGRheU9mWWVhciI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO2lmKG4gaW5zdGFuY2VvZiBEYXRlKXtjb25zdCBlPW5ldyBEYXRlKERhdGUuVVRDKG4uZ2V0VVRDRnVsbFllYXIoKSwwLDApKSx0PW4tZSxyPTg2NGU1O3JldHVybiBNYXRoLmZsb29yKHQvcil9cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkaG91ciI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO2lmKG4gaW5zdGFuY2VvZiBEYXRlKXJldHVybiBuLmdldFVUQ0hvdXJzKCk7cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkbWludXRlIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPU5lKGUsdCk7aWYobiBpbnN0YW5jZW9mIERhdGUpcmV0dXJuIG4uZ2V0VVRDTWludXRlcygpO3JldHVybiBudWxsfSh0LG4pO2Nhc2UiJHNlY29uZCI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO2lmKG4gaW5zdGFuY2VvZiBEYXRlKXJldHVybiBuLmdldFVUQ1NlY29uZHMoKTtyZXR1cm4gbnVsbH0odCxuKTtjYXNlIiRtaWxsaXNlY29uZCI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO2lmKG4gaW5zdGFuY2VvZiBEYXRlKXJldHVybiBuLmdldFVUQ01pbGxpc2Vjb25kcygpO3JldHVybiBudWxsfSh0LG4pO2Nhc2UiJHdlZWsiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtpZihuIGluc3RhbmNlb2YgRGF0ZSl7Y29uc3QgZT1uZXcgRGF0ZShEYXRlLlVUQyhuLmdldFVUQ0Z1bGxZZWFyKCksMCwxKSk7cmV0dXJuIE1hdGguY2VpbCgoKG4tZSkvODY0ZTUrZS5nZXRVVENEYXkoKSsxKS83KS0xfXJldHVybiBudWxsfSh0LG4pO2Nhc2UiJGlzb1dlZWsiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtpZihuIGluc3RhbmNlb2YgRGF0ZSl7Y29uc3QgZT1uZXcgRGF0ZShuLnZhbHVlT2YoKSksdD0obi5nZXRVVENEYXkoKSs2KSU3O2Uuc2V0VVRDRGF0ZShlLmdldFVUQ0RhdGUoKS10KzMpO2NvbnN0IHI9ZS52YWx1ZU9mKCk7cmV0dXJuIGUuc2V0VVRDTW9udGgoMCwxKSw0IT09ZS5nZXRVVENEYXkoKSYmZS5zZXRVVENNb250aCgwLDErKDQtZS5nZXRVVENEYXkoKSs3KSU3KSwxK01hdGguY2VpbCgoci1lKS82MDQ4ZTUpfXJldHVybiBudWxsfSh0LG4pO2Nhc2UiJGlzb1dlZWtZZWFyIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPU5lKGUsdCk7aWYobiBpbnN0YW5jZW9mIERhdGUpe2NvbnN0IGU9bmV3IERhdGUobi52YWx1ZU9mKCkpO3JldHVybiBlLnNldFVUQ0RhdGUoZS5nZXRVVENEYXRlKCktKG4uZ2V0VVRDRGF5KCkrNiklNyszKSxlLmdldFVUQ0Z1bGxZZWFyKCl9cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkZGF0ZVRvU3RyaW5nIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPWUuZm9ybWF0P05lKGUuZm9ybWF0LHQpOiIlWS0lbS0lZFQlSDolTTolUy4lTFoiLHI9TmUoZS5kYXRlLHQpO3JldHVybiByIGluc3RhbmNlb2YgRGF0ZT9uLnJlcGxhY2UoIiVZIixyLmdldFVUQ0Z1bGxZZWFyKCkpLnJlcGxhY2UoIiVtIixTdHJpbmcoci5nZXRVVENNb250aCgpKzEpLnBhZFN0YXJ0KDIsIjAiKSkucmVwbGFjZSgiJWQiLFN0cmluZyhyLmdldFVUQ0RhdGUoKSkucGFkU3RhcnQoMiwiMCIpKS5yZXBsYWNlKCIlSCIsU3RyaW5nKHIuZ2V0VVRDSG91cnMoKSkucGFkU3RhcnQoMiwiMCIpKS5yZXBsYWNlKCIlTSIsU3RyaW5nKHIuZ2V0VVRDTWludXRlcygpKS5wYWRTdGFydCgyLCIwIikpLnJlcGxhY2UoIiVTIixTdHJpbmcoci5nZXRVVENTZWNvbmRzKCkpLnBhZFN0YXJ0KDIsIjAiKSkucmVwbGFjZSgiJUwiLFN0cmluZyhyLmdldFVUQ01pbGxpc2Vjb25kcygpKS5wYWRTdGFydCgzLCIwIikpOm51bGx9KHQsbik7Y2FzZSIkdG9EYXRlIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPU5lKGUsdCk7aWYobiBpbnN0YW5jZW9mIERhdGUpcmV0dXJuIG47aWYoInN0cmluZyI9PXR5cGVvZiBufHwibnVtYmVyIj09dHlwZW9mIG4pe2NvbnN0IGU9bmV3IERhdGUobik7cmV0dXJuIGlzTmFOKGUuZ2V0VGltZSgpKT9udWxsOmV9cmV0dXJuIG51bGx9KHQsbik7Y2FzZSIkYXJyYXlFbGVtQXQiOnJldHVybiBmdW5jdGlvbihlLHQpe2lmKCFBcnJheS5pc0FycmF5KGUpfHwyIT09ZS5sZW5ndGgpcmV0dXJuIG51bGw7Y29uc3Qgbj1OZShlWzBdLHQpLHI9TmUoZVsxXSx0KTtpZighQXJyYXkuaXNBcnJheShuKXx8Im51bWJlciIhPXR5cGVvZiByKXJldHVybiBudWxsO2NvbnN0IGk9cjwwP24ubGVuZ3RoK3I6cjtyZXR1cm4gbltpXX0odCxuKTtjYXNlIiRjb25jYXRBcnJheXMiOnJldHVybiBmdW5jdGlvbihlLHQpe2lmKCFBcnJheS5pc0FycmF5KGUpKXJldHVybiBudWxsO2NvbnN0IG49W107Zm9yKGNvbnN0IHIgb2YgZSl7Y29uc3QgZT1OZShyLHQpO0FycmF5LmlzQXJyYXkoZSkmJm4ucHVzaCguLi5lKX1yZXR1cm4gbn0odCxuKTtjYXNlIiRmaWx0ZXIiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZS5pbnB1dCx0KSxyPWUuYXN8fCJ0aGlzIixpPWUuY29uZDtyZXR1cm4gQXJyYXkuaXNBcnJheShuKT9uLmZpbHRlcihlPT57Y29uc3Qgbj17Li4udCxbcl06ZX07cmV0dXJuIE5lKGksbil9KTpudWxsfSh0LG4pO2Nhc2UiJGluIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKXx8MiE9PWUubGVuZ3RoKXJldHVybiBudWxsO2NvbnN0IG49TmUoZVswXSx0KSxyPU5lKGVbMV0sdCk7cmV0dXJuISFBcnJheS5pc0FycmF5KHIpJiZyLmluY2x1ZGVzKG4pfSh0LG4pO2Nhc2UiJGluZGV4T2ZBcnJheSI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7aWYoIUFycmF5LmlzQXJyYXkoZSl8fGUubGVuZ3RoPDIpcmV0dXJuIG51bGw7Y29uc3Qgbj1OZShlWzBdLHQpLHI9TmUoZVsxXSx0KSxpPXZvaWQgMCE9PWVbMl0/TmUoZVsyXSx0KTowLHM9dm9pZCAwIT09ZVszXT9OZShlWzNdLHQpOm4ubGVuZ3RoO2lmKCFBcnJheS5pc0FycmF5KG4pKXJldHVybiBudWxsO2ZvcihsZXQgbz1pO288cyYmbzxuLmxlbmd0aDtvKyspaWYobltvXT09PXIpcmV0dXJuIG87cmV0dXJuLTF9KHQsbik7Y2FzZSIkaXNBcnJheSI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO3JldHVybiBBcnJheS5pc0FycmF5KG4pfSh0LG4pO2Nhc2UiJG1hcCI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLmlucHV0LHQpLHI9ZS5hc3x8InRoaXMiLGk9ZS5pbjtyZXR1cm4gQXJyYXkuaXNBcnJheShuKT9uLm1hcChlPT57Y29uc3Qgbj17Li4udCxbcl06ZX07cmV0dXJuIE5lKGksbil9KTpudWxsfSh0LG4pO2Nhc2UiJHJlZHVjZSI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLmlucHV0LHQpLHI9TmUoZS5pbml0aWFsVmFsdWUsdCksaT1lLmluO2lmKCFBcnJheS5pc0FycmF5KG4pKXJldHVybiBudWxsO2xldCBzPXI7Zm9yKGNvbnN0IG8gb2Ygbil7cz1OZShpLHsuLi50LHZhbHVlOnMsdGhpczpvfSl9cmV0dXJuIHN9KHQsbik7Y2FzZSIkc2l6ZSI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO3JldHVybiBBcnJheS5pc0FycmF5KG4pP24ubGVuZ3RoOm51bGx9KHQsbik7Y2FzZSIkc2xpY2UiOnJldHVybiBmdW5jdGlvbihlLHQpe2lmKCFBcnJheS5pc0FycmF5KGUpfHxlLmxlbmd0aDwyKXJldHVybiBudWxsO2NvbnN0IG49TmUoZVswXSx0KTtpZighQXJyYXkuaXNBcnJheShuKSlyZXR1cm4gbnVsbDtpZigyPT09ZS5sZW5ndGgpe2NvbnN0IHI9TmUoZVsxXSx0KTtyZXR1cm4gcj49MD9uLnNsaWNlKDAscik6bi5zbGljZShyKX17Y29uc3Qgcj1OZShlWzFdLHQpLGk9TmUoZVsyXSx0KTtyZXR1cm4gbi5zbGljZShyLHIraSl9fSh0LG4pO2Nhc2UiJHJldmVyc2VBcnJheSI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO3JldHVybiBBcnJheS5pc0FycmF5KG4pP24uc2xpY2UoKS5yZXZlcnNlKCk6bnVsbH0odCxuKTtjYXNlIiR6aXAiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49ZS5pbnB1dHM/TmUoZS5pbnB1dHMsdCk6bnVsbCxyPWUudXNlTG9uZ2VzdExlbmd0aHx8ITEsaT1lLmRlZmF1bHRzO2lmKCFBcnJheS5pc0FycmF5KG4pKXJldHVybiBudWxsO2NvbnN0IHM9bi5tYXAoZT0+TmUoZSx0KSk7aWYoIXMuZXZlcnkoZT0+QXJyYXkuaXNBcnJheShlKSkpcmV0dXJuIG51bGw7Y29uc3Qgbz1NYXRoLm1heCguLi5zLm1hcChlPT5lLmxlbmd0aCkpLGE9cj9vOk1hdGgubWluKC4uLnMubWFwKGU9PmUubGVuZ3RoKSksYz1bXTtmb3IobGV0IGw9MDtsPGE7bCsrKXtjb25zdCBlPVtdO2ZvcihsZXQgdD0wO3Q8cy5sZW5ndGg7dCsrKWw8c1t0XS5sZW5ndGg/ZS5wdXNoKHNbdF1bbF0pOmkmJnQ8aS5sZW5ndGg/ZS5wdXNoKGlbdF0pOmUucHVzaChudWxsKTtjLnB1c2goZSl9cmV0dXJuIGN9KHQsbik7Y2FzZSIkdHlwZSI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO3JldHVybiBudWxsPT09bj8ibnVsbCI6dm9pZCAwPT09bj8ibWlzc2luZyI6ImJvb2xlYW4iPT10eXBlb2Ygbj8iYm9vbCI6Im51bWJlciI9PXR5cGVvZiBuP051bWJlci5pc0ludGVnZXIobik/ImludCI6ImRvdWJsZSI6InN0cmluZyI9PXR5cGVvZiBuPyJzdHJpbmciOm4gaW5zdGFuY2VvZiBEYXRlPyJkYXRlIjpBcnJheS5pc0FycmF5KG4pPyJhcnJheSI6Im9iamVjdCI9PXR5cGVvZiBuPyJvYmplY3QiOiJ1bmtub3duIn0odCxuKTtjYXNlIiRjb252ZXJ0IjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPU5lKGUuaW5wdXQsdCkscj1lLnRvLGk9ZS5vbkVycm9yLHM9ZS5vbk51bGw7aWYobnVsbD09PW4pcmV0dXJuIHZvaWQgMCE9PXM/TmUocyx0KTpudWxsO3RyeXtzd2l0Y2gocil7Y2FzZSJkb3VibGUiOmNhc2UiZGVjaW1hbCI6cmV0dXJuIHBhcnNlRmxvYXQobik7Y2FzZSJpbnQiOmNhc2UibG9uZyI6cmV0dXJuIHBhcnNlSW50KG4pO2Nhc2UiYm9vbCI6cmV0dXJuIEJvb2xlYW4obik7Y2FzZSJzdHJpbmciOnJldHVybiBTdHJpbmcobik7Y2FzZSJkYXRlIjpyZXR1cm4gbmV3IERhdGUobik7ZGVmYXVsdDpyZXR1cm4gbn19Y2F0Y2gobyl7cmV0dXJuIHZvaWQgMCE9PWk/TmUoaSx0KTpudWxsfX0odCxuKTtjYXNlIiR0b0Jvb2wiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtyZXR1cm4gQm9vbGVhbihuKX0odCxuKTtjYXNlIiR0b0RlY2ltYWwiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtyZXR1cm4gcGFyc2VGbG9hdChuKX0odCxuKTtjYXNlIiR0b0RvdWJsZSI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO3JldHVybiBwYXJzZUZsb2F0KG4pfSh0LG4pO2Nhc2UiJHRvSW50IjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtjb25zdCBuPU5lKGUsdCk7cmV0dXJuIHBhcnNlSW50KG4pfSh0LG4pO2Nhc2UiJHRvTG9uZyI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO3JldHVybiBwYXJzZUludChuKX0odCxuKTtjYXNlIiR0b1N0cmluZyI6cmV0dXJuIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1OZShlLHQpO3JldHVybiBudWxsPT1uP251bGw6U3RyaW5nKG4pfSh0LG4pO2Nhc2UiJG9iamVjdFRvQXJyYXkiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtpZigib2JqZWN0IiE9dHlwZW9mIG58fG51bGw9PT1ufHxBcnJheS5pc0FycmF5KG4pKXJldHVybiBudWxsO3JldHVybiBPYmplY3Qua2V5cyhuKS5tYXAoZT0+KHtrOmUsdjpuW2VdfSkpfSh0LG4pO2Nhc2UiJGFycmF5VG9PYmplY3QiOnJldHVybiBmdW5jdGlvbihlLHQpe2NvbnN0IG49TmUoZSx0KTtpZighQXJyYXkuaXNBcnJheShuKSlyZXR1cm4gbnVsbDtjb25zdCByPXt9O2Zvcihjb25zdCBpIG9mIG4pQXJyYXkuaXNBcnJheShpKSYmMj09PWkubGVuZ3RoP3JbaVswXV09aVsxXToib2JqZWN0Ij09dHlwZW9mIGkmJnZvaWQgMCE9PWkuayYmdm9pZCAwIT09aS52JiYocltpLmtdPWkudik7cmV0dXJuIHJ9KHQsbik7Y2FzZSIkbWVyZ2VPYmplY3RzIjpyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gTmUoZSx0KTtjb25zdCBuPXt9O2Zvcihjb25zdCByIG9mIGUpe2NvbnN0IGU9TmUocix0KTsib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lfHxBcnJheS5pc0FycmF5KGUpfHxPYmplY3QuYXNzaWduKG4sZSl9cmV0dXJuIG59KHQsbik7Y2FzZSIkbGl0ZXJhbCI6cmV0dXJuIHQ7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIGFnZ3JlZ2F0aW9uIG9wZXJhdG9yOiAke2V9YCl9fShyLGVbcl0sdCl9e2NvbnN0IHI9e307Zm9yKGNvbnN0IGkgb2YgbilyW2ldPU5lKGVbaV0sdCk7cmV0dXJuIHJ9fXJldHVybiBlfWZ1bmN0aW9uIEllKGUpe3JldHVybiBlLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXVxcXS9nLCJcXCQmIil9Y29uc3QgU2U9ezE6ImRvdWJsZSIsMjoic3RyaW5nIiwzOiJvYmplY3QiLDQ6ImFycmF5Iiw1OiJiaW5EYXRhIiw2OiJ1bmRlZmluZWQiLDc6Im9iamVjdElkIiw4OiJib29sIiw5OiJkYXRlIiwxMDoibnVsbCIsMTE6InJlZ2V4IiwxMzoiamF2YXNjcmlwdCIsMTU6ImphdmFzY3JpcHRXaXRoU2NvcGUiLDE2OiJpbnQiLDE3OiJ0aW1lc3RhbXAiLDE4OiJsb25nIiwxOToiZGVjaW1hbCIsMTI3OiJtYXhLZXkiLCItMSI6Im1pbktleSJ9LEFlPU9iamVjdC5lbnRyaWVzKFNlKS5yZWR1Y2UoKGUsW3Qsbl0pPT4oZVtuXT1wYXJzZUludCh0KSxlKSx7fSk7ZnVuY3Rpb24gT2UoZSx0KXtpZihJKHQpKXtmb3IobGV0IG49MDtuPHQubGVuZ3RoO24rKylpZihPZShlLHRbbl0pKXJldHVybiEwO3JldHVybiExfWNvbnN0IG49Im51bWJlciI9PXR5cGVvZiB0P3Q6QWVbdF0scj1TZVtuXXx8dDtyZXR1cm4gbnVsbD09PWU/Im51bGwiPT09cnx8MTA9PT1uOnZvaWQgMD09PWU/InVuZGVmaW5lZCI9PT1yfHw2PT09bjoibnVtYmVyIj09dHlwZW9mIGU/TnVtYmVyLmlzSW50ZWdlcihlKT8iaW50Ij09PXJ8fDE2PT09bjoiZG91YmxlIj09PXJ8fDE9PT1uOiJzdHJpbmciPT10eXBlb2YgZT8ic3RyaW5nIj09PXJ8fDI9PT1uOiJib29sZWFuIj09dHlwZW9mIGU/ImJvb2wiPT09cnx8OD09PW46ZSBpbnN0YW5jZW9mIERhdGU/ImRhdGUiPT09cnx8OT09PW46ZSBpbnN0YW5jZW9mIGc/Im9iamVjdElkIj09PXJ8fDc9PT1uOmUgaW5zdGFuY2VvZiBSZWdFeHA/InJlZ2V4Ij09PXJ8fDExPT09bjpJKGUpPyJhcnJheSI9PT1yfHw0PT09bjoib2JqZWN0Ij09dHlwZW9mIGU/Im9iamVjdCI9PT1yfHwzPT09bjp0eXBlb2YgZT09PXR9ZnVuY3Rpb24gQ2UoZSl7aWYoSShlKSl7bGV0IHQ9MDtmb3IobGV0IG49MDtuPGUubGVuZ3RoO24rKyl0fD0xPDxlW25dO3JldHVybiB0fXJldHVybiJudW1iZXIiPT10eXBlb2YgZT9lOjB9ZnVuY3Rpb24gRWUoZSx0KXtpZigibnVtYmVyIiE9dHlwZW9mIGUpcmV0dXJuITE7Y29uc3Qgbj1DZSh0KTtyZXR1cm4oZSZuKT09PW59ZnVuY3Rpb24gamUoZSx0KXtpZigibnVtYmVyIiE9dHlwZW9mIGUpcmV0dXJuITE7cmV0dXJuIDA9PT0oZSZDZSh0KSl9ZnVuY3Rpb24gRGUoZSx0KXtpZigibnVtYmVyIiE9dHlwZW9mIGUpcmV0dXJuITE7cmV0dXJuIDAhPT0oZSZDZSh0KSl9ZnVuY3Rpb24ga2UoZSx0KXtpZigibnVtYmVyIiE9dHlwZW9mIGUpcmV0dXJuITE7Y29uc3Qgbj1DZSh0KTtyZXR1cm4oZSZuKSE9PW59ZnVuY3Rpb24gUGUoZSx0KXtpZih0LnR5cGUpe2NvbnN0IG49SShlKT8iYXJyYXkiOm51bGw9PT1lPyJudWxsIjp0eXBlb2YgZTtpZih0LnR5cGUhPT1uKXJldHVybiExfWlmKHQucmVxdWlyZWQmJkkodC5yZXF1aXJlZCkpZm9yKGxldCBuPTA7bjx0LnJlcXVpcmVkLmxlbmd0aDtuKyspaWYoISh0LnJlcXVpcmVkW25daW4gZSkpcmV0dXJuITE7aWYodC5wcm9wZXJ0aWVzKWZvcihjb25zdCBuIGluIHQucHJvcGVydGllcyl7aWYoIShuIGluIGUpKXJldHVybiExO2NvbnN0IHI9dC5wcm9wZXJ0aWVzW25dO2lmKCFQZShlW25dLHIpKXJldHVybiExfWlmKHZvaWQgMCE9PXQubWluaW11bSYmIm51bWJlciI9PXR5cGVvZiBlJiZlPHQubWluaW11bSlyZXR1cm4hMTtpZih2b2lkIDAhPT10Lm1heGltdW0mJiJudW1iZXIiPT10eXBlb2YgZSYmZT50Lm1heGltdW0pcmV0dXJuITE7aWYodm9pZCAwIT09dC5taW5MZW5ndGgmJiJzdHJpbmciPT10eXBlb2YgZSYmZS5sZW5ndGg8dC5taW5MZW5ndGgpcmV0dXJuITE7aWYodm9pZCAwIT09dC5tYXhMZW5ndGgmJiJzdHJpbmciPT10eXBlb2YgZSYmZS5sZW5ndGg+dC5tYXhMZW5ndGgpcmV0dXJuITE7aWYodC5wYXR0ZXJuJiYic3RyaW5nIj09dHlwZW9mIGUpe2lmKCFuZXcgUmVnRXhwKHQucGF0dGVybikudGVzdChlKSlyZXR1cm4hMX1yZXR1cm4hKHQuZW51bSYmSSh0LmVudW0pJiYhdC5lbnVtLmluY2x1ZGVzKGUpKX1mdW5jdGlvbiBNZShlLHQpe3JldHVybiBlIGluc3RhbmNlb2YgZyYmdCBpbnN0YW5jZW9mIGc/ZS5lcXVhbHModCk6ZT09dH1mdW5jdGlvbiBMZShlLHQsbil7bGV0IHI9ZSxpPXQ7c3dpdGNoKGUgaW5zdGFuY2VvZiBnJiYocj1lLnRvU3RyaW5nKCkpLHQgaW5zdGFuY2VvZiBnJiYoaT10LnRvU3RyaW5nKCkpLG4pe2Nhc2UiPiI6cmV0dXJuIHI+aTtjYXNlIj49IjpyZXR1cm4gcj49aTtjYXNlIjwiOnJldHVybiByPGk7Y2FzZSI8PSI6cmV0dXJuIHI8PWk7ZGVmYXVsdDpyZXR1cm4hMX19ZnVuY3Rpb24gQmUoZSx0KXtpZih2b2lkIDA9PT1lKXJldHVybiExO2lmKG51bGw9PT1lKXJldHVybiB0KGUpO2lmKEkoZSkpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKWlmKHQoZVtuXSkpcmV0dXJuITA7cmV0dXJuITF9cmV0dXJuIHQoZSl9ZnVuY3Rpb24gRmUoZSl7aWYoInN0cmluZyIhPXR5cGVvZiBlKXJldHVybltdO3JldHVybiB2ZShlKS5tYXAoZT0+d2UoZSkpfWZ1bmN0aW9uIFRlKGUsdCl7aWYoInN0cmluZyIhPXR5cGVvZiBlKXJldHVybiExO2NvbnN0IG49bmV3IFNldChGZShlKSk7cmV0dXJuIEZlKHQpLnNvbWUoZT0+bi5oYXMoZSkpfWZ1bmN0aW9uIHplKGUsdCl7dHJ5e2lmKCFBcnJheS5pc0FycmF5KHQpfHwyIT09dC5sZW5ndGgpcmV0dXJuITE7Y29uc3Qgbj10WzBdWzBdLHI9dFswXVsxXSxpPXRbMV1bMF07cmV0dXJuIFVlKGUsbixpLHRbMV1bMV0scil9Y2F0Y2gobil7cmV0dXJuITF9fWZ1bmN0aW9uIFVlKGUsdCxuLHIsaSl7aWYoIWUpcmV0dXJuITE7aWYoIkZlYXR1cmVDb2xsZWN0aW9uIj09PWUudHlwZSYmZS5mZWF0dXJlcyYmZS5mZWF0dXJlcy5sZW5ndGg+MCl7Zm9yKGNvbnN0IHMgb2YgZS5mZWF0dXJlcylpZihzLmdlb21ldHJ5JiYhVWUocy5nZW9tZXRyeSx0LG4scixpKSlyZXR1cm4hMTtyZXR1cm4hMH1pZigiRmVhdHVyZSI9PT1lLnR5cGUmJmUuZ2VvbWV0cnkpcmV0dXJuIFVlKGUuZ2VvbWV0cnksdCxuLHIsaSk7aWYoIlBvaW50Ij09PWUudHlwZSYmZS5jb29yZGluYXRlcyl7Y29uc3RbcyxvXT1lLmNvb3JkaW5hdGVzO2lmKCJudW1iZXIiPT10eXBlb2YgcyYmIm51bWJlciI9PXR5cGVvZiBvKXJldHVybiBzPj10JiZzPD1uJiZvPj1yJiZvPD1pfWlmKCJQb2x5Z29uIj09PWUudHlwZSYmZS5jb29yZGluYXRlcyYmZS5jb29yZGluYXRlcy5sZW5ndGg+MCl7Zm9yKGNvbnN0IHMgb2YgZS5jb29yZGluYXRlcylmb3IoY29uc3QgZSBvZiBzKXtjb25zdCBzPWVbMF0sbz1lWzFdO2lmKHM8dHx8cz5ufHxvPHJ8fG8+aSlyZXR1cm4hMX1yZXR1cm4hMH1yZXR1cm4hMX1mdW5jdGlvbiBxZShlKXtpZighZSlyZXR1cm4gbnVsbDtpZigiRmVhdHVyZUNvbGxlY3Rpb24iPT09ZS50eXBlJiZlLmZlYXR1cmVzJiZlLmZlYXR1cmVzLmxlbmd0aD4wKXtjb25zdCB0PWUuZmVhdHVyZXNbMF07aWYodC5nZW9tZXRyeSlyZXR1cm4gcWUodC5nZW9tZXRyeSl9aWYoIkZlYXR1cmUiPT09ZS50eXBlJiZlLmdlb21ldHJ5KXJldHVybiBxZShlLmdlb21ldHJ5KTtpZigiUG9pbnQiPT09ZS50eXBlJiZlLmNvb3JkaW5hdGVzKXtjb25zdFt0LG5dPWUuY29vcmRpbmF0ZXM7aWYoIm51bWJlciI9PXR5cGVvZiB0JiYibnVtYmVyIj09dHlwZW9mIG4pcmV0dXJue2xhdDpuLGxuZzp0fX1pZigiUG9seWdvbiI9PT1lLnR5cGUmJmUuY29vcmRpbmF0ZXMmJmUuY29vcmRpbmF0ZXMubGVuZ3RoPjApe2NvbnN0IHQ9ZS5jb29yZGluYXRlc1swXTtpZih0Lmxlbmd0aD4wKXtsZXQgZT0wLG49MDtmb3IoY29uc3QgciBvZiB0KW4rPXJbMF0sZSs9clsxXTtyZXR1cm57bGF0OmUvdC5sZW5ndGgsbG5nOm4vdC5sZW5ndGh9fX1yZXR1cm4gbnVsbH1mdW5jdGlvbiBSZShlLHQsbixyKXtjb25zdCBpPShuLWUpKk1hdGguUEkvMTgwLHM9KHItdCkqTWF0aC5QSS8xODAsbz1NYXRoLnNpbihpLzIpKk1hdGguc2luKGkvMikrTWF0aC5jb3MoZSpNYXRoLlBJLzE4MCkqTWF0aC5jb3MobipNYXRoLlBJLzE4MCkqTWF0aC5zaW4ocy8yKSpNYXRoLnNpbihzLzIpO3JldHVybiA2MzcxKigyKk1hdGguYXRhbjIoTWF0aC5zcXJ0KG8pLE1hdGguc3FydCgxLW8pKSl9ZnVuY3Rpb24gVmUoZSx0LG4scil7Y29uc3QgaT1xZShlKTtpZighaSlyZXR1cm4hMTtyZXR1cm4gMWUzKlJlKGkubGF0LGkubG5nLG4sdCk8PXJ9ZnVuY3Rpb24gSGUoZSx0KXtpZighZXx8IXQpcmV0dXJuITE7Y29uc3Qgbj1xZSh0KTtpZighbilyZXR1cm4hMTtjb25zdCByPXFlKGUpO2lmKCFyKXJldHVybiExO2lmKCJQb2x5Z29uIj09PXQudHlwZSYmIlBvaW50Ij09PWUudHlwZSlyZXR1cm4gV2Uoci5sbmcsci5sYXQsdC5jb29yZGluYXRlc1swXSk7aWYoIlBvbHlnb24iPT09ZS50eXBlJiYiUG9pbnQiPT09dC50eXBlKXtjb25zdCBuPXQuY29vcmRpbmF0ZXM7cmV0dXJuIFdlKG5bMF0sblsxXSxlLmNvb3JkaW5hdGVzWzBdKX1pZigiUG9pbnQiPT09ZS50eXBlJiYiUG9pbnQiPT09dC50eXBlKXtyZXR1cm4gUmUoci5sYXQsci5sbmcsbi5sYXQsbi5sbmcpPC4wMDF9cmV0dXJuITF9ZnVuY3Rpb24gV2UoZSx0LG4pe2xldCByPSExO2ZvcihsZXQgaT0wLHM9bi5sZW5ndGgtMTtpPG4ubGVuZ3RoO3M9aSsrKXtjb25zdCBvPW5baV1bMF0sYT1uW2ldWzFdLGM9bltzXVswXSxsPW5bc11bMV07YT50IT1sPnQmJmU8KGMtbykqKHQtYSkvKGwtYSkrbyYmKHI9IXIpfXJldHVybiByfWZ1bmN0aW9uIFFlKGUsdCl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIHQpdHJ5e3JldHVybiB0LmNhbGwoZSl9Y2F0Y2gobil7cmV0dXJuITF9ZWxzZSBpZigic3RyaW5nIj09dHlwZW9mIHQpdHJ5e3JldHVybiBuZXcgRnVuY3Rpb24oInJldHVybiAiK3QpLmNhbGwoZSl9Y2F0Y2gobil7cmV0dXJuITF9cmV0dXJuITF9ZnVuY3Rpb24gSmUoZSx0KXt2YXIgbj1PYmplY3Qua2V5cyh0KVswXSxyPXRbbl07aWYoIiQiIT1uLmNoYXJBdCgwKSlyZXR1cm4gS2UoZSxuLHIpO2lmKCIkYW5kIj09bilyZXR1cm4gR2UoZSxyKTtpZigiJG9yIj09bilyZXR1cm4gZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49MDtuPHQubGVuZ3RoO24rKylpZihKZShlLHRbbl0pKXJldHVybiEwO3JldHVybiExfShlLHIpO2lmKCIkbm90Ij09bilyZXR1cm4gZnVuY3Rpb24oZSx0KXtyZXR1cm4hSmUoZSx0KX0oZSxyKTtpZigiJG5vciI9PW4pcmV0dXJuIGZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBuPTA7bjx0Lmxlbmd0aDtuKyspaWYoSmUoZSx0W25dKSlyZXR1cm4hMTtyZXR1cm4hMH0oZSxyKTtpZigiJHdoZXJlIj09bilyZXR1cm4gUWUoZSxyKTtpZigiJGNvbW1lbnQiPT1uKXJldHVybiEwO2lmKCIkanNvblNjaGVtYSI9PW4pcmV0dXJuIFBlKGUscik7aWYoIiR0ZXh0Ij09bil7cmV0dXJuIGZ1bmN0aW9uKGUsdCl7cmV0dXJuISghZXx8Im9iamVjdCIhPXR5cGVvZiBlKSYmZnVuY3Rpb24gZShuKXtpZigic3RyaW5nIj09dHlwZW9mIG4pcmV0dXJuIFRlKG4sdCk7aWYoIm9iamVjdCIhPXR5cGVvZiBufHxudWxsPT09bilyZXR1cm4hMTtpZihJKG4pKXtmb3IobGV0IHQ9MDt0PG4ubGVuZ3RoO3QrKylpZihlKG5bdF0pKXJldHVybiEwO3JldHVybiExfWZvcihjb25zdCB0IGluIG4paWYobi5oYXNPd25Qcm9wZXJ0eSh0KSYmZShuW3RdKSlyZXR1cm4hMDtyZXR1cm4hMX0oZSl9KGUsci4kc2VhcmNofHxyKX1pZigiJGV4cHIiIT1uKXRocm93eyRlcnI6IkNhbid0IGNhbm9uaWNhbGl6ZSBxdWVyeTogQmFkVmFsdWUgdW5rbm93biB0b3AgbGV2ZWwgb3BlcmF0b3I6ICIrbixjb2RlOjE3Mjg3fTt0cnl7cmV0dXJuIE5lKHIsZSl9Y2F0Y2goaSl7cmV0dXJuITF9fWZ1bmN0aW9uIEtlKGUsdCxuKXt2YXIgcj0kKGUsdCk7aWYoInN0cmluZyI9PXR5cGVvZiBuKXJldHVybiBCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBNZShlLG4pfSk7aWYoIm51bWJlciI9PXR5cGVvZiBuKXJldHVybiBCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBNZShlLG4pfSk7aWYoImJvb2xlYW4iPT10eXBlb2YgbilyZXR1cm4gQmUocixmdW5jdGlvbihlKXtyZXR1cm4gTWUoZSxuKX0pO2lmKG4gaW5zdGFuY2VvZiBnKXJldHVybiBCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBNZShlLG4pfSk7aWYoIm9iamVjdCI9PXR5cGVvZiBuKXtpZihuIGluc3RhbmNlb2YgUmVnRXhwKXJldHVybiBudWxsIT1yJiZCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBlJiZlLm1hdGNoKG4pfSk7aWYoSShuKSlyZXR1cm4gbnVsbCE9ciYmQmUocixmdW5jdGlvbihlKXtyZXR1cm4gZSYmTyhlLG4pfSk7dmFyIGk9T2JqZWN0LmtleXMobik7aWYoIiQiPT1pWzBdLmNoYXJBdCgwKSl7Zm9yKHZhciBzPTA7czxpLmxlbmd0aDtzKyspe3ZhciBvPU9iamVjdC5rZXlzKG4pW3NdLGE9bltvXTtpZigiJGVxIj09byl7aWYoIUJlKHIsZnVuY3Rpb24oZSl7cmV0dXJuIE1lKGUsYSl9KSlyZXR1cm4hMX1lbHNlIGlmKCIkZ3QiPT1vKXtpZighQmUocixmdW5jdGlvbihlKXtyZXR1cm4gTGUoZSxhLCI+Iil9KSlyZXR1cm4hMX1lbHNlIGlmKCIkZ3RlIj09byl7aWYoIUJlKHIsZnVuY3Rpb24oZSl7cmV0dXJuIExlKGUsYSwiPj0iKX0pKXJldHVybiExfWVsc2UgaWYoIiRsdCI9PW8pe2lmKCFCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBMZShlLGEsIjwiKX0pKXJldHVybiExfWVsc2UgaWYoIiRsdGUiPT1vKXtpZighQmUocixmdW5jdGlvbihlKXtyZXR1cm4gTGUoZSxhLCI8PSIpfSkpcmV0dXJuITF9ZWxzZSBpZigiJG5lIj09byl7aWYoIUJlKHIsZnVuY3Rpb24oZSl7cmV0dXJuIU1lKGUsYSl9KSlyZXR1cm4hMX1lbHNlIGlmKCIkaW4iPT1vKXtpZighQmUocixmdW5jdGlvbihlKXtyZXR1cm4gQShlLGEpfSkpcmV0dXJuITF9ZWxzZSBpZigiJG5pbiI9PW8pe2lmKEJlKHIsZnVuY3Rpb24oZSl7cmV0dXJuIEEoZSxhKX0pKXJldHVybiExfWVsc2UgaWYoIiRleGlzdHMiPT1vKXt2YXIgYz12KGUsdCk7aWYoYT9udWxsPT1jOm51bGwhPWMpcmV0dXJuITF9ZWxzZSBpZigiJHR5cGUiPT1vKXtpZih2b2lkIDA9PT1yKXtpZig2IT09KCJudW1iZXIiPT10eXBlb2YgYT9hOkFlW2FdKSlyZXR1cm4hMX1lbHNlIGlmKCFPZShyLGEpKXJldHVybiExfWVsc2UgaWYoIiRtb2QiPT1vKXtpZigyIT1hLmxlbmd0aCl0aHJvd3skZXJyOiJDYW4ndCBjYW5vbmljYWxpemUgcXVlcnk6IEJhZFZhbHVlIG1hbGZvcm1lZCBtb2QsIG5vdCBlbm91Z2ggZWxlbWVudHMiLGNvZGU6MTcyODd9O2lmKCFCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBudWxsIT1lJiZlJWFbMF09PWFbMV19KSlyZXR1cm4hMX1lbHNlIGlmKCIkcmVnZXgiPT1vKXt2YXIgbD1hLHU9bi4kb3B0aW9uc3x8IiIsaD0ic3RyaW5nIj09dHlwZW9mIGw/bmV3IFJlZ0V4cChsLHUpOmw7aWYoIUJlKHIsZnVuY3Rpb24oZSl7cmV0dXJuIG51bGwhPWUmJmgudGVzdChlKX0pKXJldHVybiExfWVsc2V7aWYoIiRvcHRpb25zIj09byljb250aW51ZTtpZigiJHRleHQiPT1vKXtpZighQmUocixmdW5jdGlvbihlKXtyZXR1cm4gbnVsbCE9ZSYmVGUoZSxhKX0pKXJldHVybiExfWVsc2UgaWYoIiRleHByIj09byl0cnl7aWYoIU5lKGEsZSkpcmV0dXJuITF9Y2F0Y2goUyl7cmV0dXJuITF9ZWxzZSBpZigiJGdlb1dpdGhpbiI9PW8pe2lmKCFCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBudWxsIT1lJiZ6ZShlLGEpfSkpcmV0dXJuITF9ZWxzZSBpZigiJG5lYXIiPT1vfHwiJG5lYXJTcGhlcmUiPT1vKXtsZXQgZTtpZihhLiRnZW9tZXRyeT9lPWEuJGdlb21ldHJ5LmNvb3JkaW5hdGVzOmEuY29vcmRpbmF0ZXM/ZT1hLmNvb3JkaW5hdGVzOkFycmF5LmlzQXJyYXkoYSkmJihlPWEpLCEoZSYmZS5sZW5ndGg+PTIpKXJldHVybiExO3tjb25zdFt0LG5dPWUsaT1hLiRtYXhEaXN0YW5jZXx8MWU2O2lmKCFCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBudWxsIT1lJiZWZShlLHQsbixpKX0pKXJldHVybiExfX1lbHNlIGlmKCIkZ2VvSW50ZXJzZWN0cyI9PW8pe2NvbnN0IGU9YS4kZ2VvbWV0cnl8fGE7aWYoIUJlKHIsZnVuY3Rpb24odCl7cmV0dXJuIG51bGwhPXQmJkhlKHQsZSl9KSlyZXR1cm4hMX1lbHNlIGlmKCIkbm90Ij09byl7aWYoS2UoZSx0LGEpKXJldHVybiExfWVsc2UgaWYoIiRhbGwiPT1vKXtpZihudWxsPT0oZD12KGUsdCkpfHwhSShkKSlyZXR1cm4hMTtmb3IodmFyIGY9MDtmPGEubGVuZ3RoO2YrKylpZighQShhW2ZdLGQpKXJldHVybiExfWVsc2UgaWYoIiRlbGVtTWF0Y2giPT1vKXt2YXIgZDtpZihudWxsPT0oZD12KGUsdCkpfHwhSShkKSlyZXR1cm4hMTt2YXIgcD0hMTtmb3IoZj0wO2Y8ZC5sZW5ndGg7ZisrKXt2YXIgeT1kW2ZdO2lmKCJvYmplY3QiIT10eXBlb2YgeXx8SSh5KSl7Zm9yKHZhciBtPSEwLHc9T2JqZWN0LmtleXMoYSksYj0wO2I8dy5sZW5ndGg7YisrKXt2YXIgeD13W2JdLF89YVt4XTsoIiRndGUiIT14fHx5Pj1fKSYmKCIkZ3QiIT14fHx5Pl8pJiYoIiRsdGUiIT14fHx5PD1fKSYmKCIkbHQiIT14fHx5PF8pPyIkZXEiPT14JiZ5IT1ffHwiJG5lIj09eCYmeT09Xz9tPSExOiIkaW4iIT14fHxBKHksXyk/IiRuaW4iPT14JiZBKHksXykmJihtPSExKTptPSExOm09ITF9aWYobSl7cD0hMDticmVha319ZWxzZSBpZihZZSh5LGEpKXtwPSEwO2JyZWFrfX1pZighcClyZXR1cm4hMX1lbHNlIGlmKCIkc2l6ZSI9PW8pe3ZhciBOPXYoZSx0KTtpZihudWxsPT1OfHwhSShOKSlyZXR1cm4hMTtpZihOLmxlbmd0aCE9YSlyZXR1cm4hMX1lbHNlIGlmKCIkYml0c0FsbFNldCI9PW8pe2lmKCFCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBFZShlLGEpfSkpcmV0dXJuITF9ZWxzZSBpZigiJGJpdHNBbGxDbGVhciI9PW8pe2lmKCFCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBqZShlLGEpfSkpcmV0dXJuITF9ZWxzZSBpZigiJGJpdHNBbnlTZXQiPT1vKXtpZighQmUocixmdW5jdGlvbihlKXtyZXR1cm4gRGUoZSxhKX0pKXJldHVybiExfWVsc2V7aWYoIiRiaXRzQW55Q2xlYXIiIT1vKXRocm93eyRlcnI6IkNhbid0IGNhbm9uaWNhbGl6ZSBxdWVyeTogQmFkVmFsdWUgdW5rbm93biBvcGVyYXRvcjogIitvLGNvZGU6MTcyODd9O2lmKCFCZShyLGZ1bmN0aW9uKGUpe3JldHVybiBrZShlLGEpfSkpcmV0dXJuITF9fX1yZXR1cm4hMH1yZXR1cm4gdihlLHQpJiZDKHYoZSx0KSxuKX19ZnVuY3Rpb24gR2UoZSx0KXtmb3IodmFyIG49MDtuPHQubGVuZ3RoO24rKylpZighSmUoZSx0W25dKSlyZXR1cm4hMTtyZXR1cm4hMH1mdW5jdGlvbiBZZShlLHQpe3JldHVybiBHZShlLFModCkpfWZ1bmN0aW9uIFhlKGUsdCl7Y29uc3Qgbj17fTtyZXR1cm57bWF0Y2hlZDpaZShlLFModCksbiksYXJyYXlGaWx0ZXJzOm59fWZ1bmN0aW9uIFplKGUsdCxuKXtmb3IodmFyIHI9MDtyPHQubGVuZ3RoO3IrKylpZighZXQoZSx0W3JdLG4pKXJldHVybiExO3JldHVybiEwfWZ1bmN0aW9uIGV0KGUsdCxuKXt2YXIgcj1PYmplY3Qua2V5cyh0KVswXSxpPXRbcl07aWYoIiQiIT1yLmNoYXJBdCgwKSlyZXR1cm4gZnVuY3Rpb24oZSx0LG4scil7Y29uc3QgaT10LnNwbGl0KCIuIilbMF0scz0kKGUsdCksbz0obixzKT0+e2lmKHZvaWQgMD09PW4pcmV0dXJuITE7aWYobnVsbD09PW4pcmV0dXJuIHMobik7aWYoSShuKSl7aWYoSSh2KGUsaSkpKXtmb3IodmFyIG89MDtvPG4ubGVuZ3RoO28rKylpZihzKG5bb10pKXJldHVybiByW3RdPW8sITA7cmV0dXJuITF9fXJldHVybiBCZShuLHMpfTtpZigic3RyaW5nIj09dHlwZW9mIG4pcmV0dXJuIG8ocyxmdW5jdGlvbihlKXtyZXR1cm4gTWUoZSxuKX0pO2lmKCJudW1iZXIiPT10eXBlb2YgbilyZXR1cm4gbyhzLGZ1bmN0aW9uKGUpe3JldHVybiBNZShlLG4pfSk7aWYoImJvb2xlYW4iPT10eXBlb2YgbilyZXR1cm4gbyhzLGZ1bmN0aW9uKGUpe3JldHVybiBNZShlLG4pfSk7aWYobiBpbnN0YW5jZW9mIGcpcmV0dXJuIG8ocyxmdW5jdGlvbihlKXtyZXR1cm4gTWUoZSxuKX0pO2lmKCJvYmplY3QiPT10eXBlb2Ygbil7aWYobiBpbnN0YW5jZW9mIFJlZ0V4cClyZXR1cm4gbnVsbCE9cyYmbyhzLGZ1bmN0aW9uKGUpe3JldHVybiBlJiZlLm1hdGNoKG4pfSk7aWYoSShuKSlyZXR1cm4gbnVsbCE9cyYmbyhzLGZ1bmN0aW9uKGUpe3JldHVybiBlJiZPKGUsbil9KTt2YXIgYT1PYmplY3Qua2V5cyhuKTtpZigiJCI9PWFbMF0uY2hhckF0KDApKXtmb3IodmFyIGM9MDtjPGEubGVuZ3RoO2MrKyl7dmFyIGw9YVtjXSx1PW5bbF07aWYoIiRlcSI9PWwpe2lmKCFvKHMsZnVuY3Rpb24oZSl7cmV0dXJuIE1lKGUsdSl9KSlyZXR1cm4hMX1lbHNlIGlmKCIkZ3QiPT1sKXtpZighbyhzLGZ1bmN0aW9uKGUpe3JldHVybiBMZShlLHUsIj4iKX0pKXJldHVybiExfWVsc2UgaWYoIiRndGUiPT1sKXtpZighbyhzLGZ1bmN0aW9uKGUpe3JldHVybiBMZShlLHUsIj49Iil9KSlyZXR1cm4hMX1lbHNlIGlmKCIkbHQiPT1sKXtpZighbyhzLGZ1bmN0aW9uKGUpe3JldHVybiBMZShlLHUsIjwiKX0pKXJldHVybiExfWVsc2UgaWYoIiRsdGUiPT1sKXtpZighbyhzLGZ1bmN0aW9uKGUpe3JldHVybiBMZShlLHUsIjw9Iil9KSlyZXR1cm4hMX1lbHNlIGlmKCIkbmUiPT1sKXtpZighbyhzLGZ1bmN0aW9uKGUpe3JldHVybiFNZShlLHUpfSkpcmV0dXJuITF9ZWxzZSBpZigiJGluIj09bCl7aWYoIW8ocyxmdW5jdGlvbihlKXtyZXR1cm4gQShlLHUpfSkpcmV0dXJuITF9ZWxzZSBpZigiJG5pbiI9PWwpe2lmKG8ocyxmdW5jdGlvbihlKXtyZXR1cm4gQShlLHUpfSkpcmV0dXJuITF9ZWxzZXtpZigiJGVsZW1NYXRjaCI9PWwpe3ZhciBoPXYoZSx0KTtpZihudWxsPT1ofHwhSShoKSlyZXR1cm4hMTtmb3IodmFyIGY9MDtmPGgubGVuZ3RoO2YrKyl7dmFyIGQ9aFtmXTtpZigib2JqZWN0IiE9dHlwZW9mIGR8fEkoZCkpe2Zvcih2YXIgcD0hMCx5PU9iamVjdC5rZXlzKHUpLG09MDttPHkubGVuZ3RoO20rKyl7dmFyIHc9eVttXSxiPXVbd107KCIkZ3RlIiE9d3x8ZD49YikmJigiJGd0IiE9d3x8ZD5iKSYmKCIkbHRlIiE9d3x8ZDw9YikmJigiJGx0IiE9d3x8ZDxiKT8oIiRlcSI9PXcmJmQhPWJ8fCIkbmUiPT13JiZkPT1iKSYmKHA9ITEpOnA9ITF9aWYocClyZXR1cm4gclt0XT1mLCEwfWVsc2UgaWYoWWUoZCx1KSlyZXR1cm4gclt0XT1mLCEwfXJldHVybiExfWlmKCFLZShlLHQsbikpcmV0dXJuITF9fXJldHVybiEwfXJldHVybiBudWxsIT1zJiZvKHMsZnVuY3Rpb24oZSl7cmV0dXJuIEMoZSxuKX0pfXJldHVybiExfShlLHIsaSxuKTtpZigiJGFuZCI9PXIpcmV0dXJuIFplKGUsaSxuKTtpZigiJG9yIj09cilyZXR1cm4gZnVuY3Rpb24oZSx0LG4pe2Zvcih2YXIgcj0wO3I8dC5sZW5ndGg7cisrKWlmKGV0KGUsdFtyXSxuKSlyZXR1cm4hMDtyZXR1cm4hMX0oZSxpLG4pO2lmKCIkbm90Ij09cilyZXR1cm4hSmUoZSxpKTtpZigiJG5vciI9PXIpcmV0dXJuIGZ1bmN0aW9uKGUsdCxuKXtmb3IodmFyIHI9MDtyPHQubGVuZ3RoO3IrKylpZihldChlLHRbcl0sbikpcmV0dXJuITE7cmV0dXJuITB9KGUsaSxuKTtpZigiJHdoZXJlIj09cilyZXR1cm4gUWUoZSxpKTtpZigiJGNvbW1lbnQiPT1yKXJldHVybiEwO2lmKCIkanNvblNjaGVtYSI9PXIpcmV0dXJuIFBlKGUsaSk7aWYoIiRleHByIiE9cil0aHJvd3skZXJyOiJDYW4ndCBjYW5vbmljYWxpemUgcXVlcnk6IEJhZFZhbHVlIHVua25vd24gdG9wIGxldmVsIG9wZXJhdG9yOiAiK3IsY29kZToxNzI4N307dHJ5e3JldHVybiBOZShpLGUpfWNhdGNoKHMpe3JldHVybiExfX1mdW5jdGlvbiB0dChlKXtyZXR1cm4gZS5zcGxpdCgiLiIpLm1hcChlPT57Y29uc3QgdD1mdW5jdGlvbihlKXtjb25zdCB0PWUubWF0Y2goL15cJFxbKFteXF1dKylcXSQvKTtyZXR1cm4gdD90WzFdOm51bGx9KGUpO3JldHVybntzZWdtZW50OmUsaXNGaWx0ZXJlZFBvc2l0aW9uYWw6bnVsbCE9PXQsaWRlbnRpZmllcjp0fX0pfWZ1bmN0aW9uIG50KGUsdCxuLHIsaSl7IWZ1bmN0aW9uIGUocyxvLGEpe2lmKG8+PXQubGVuZ3RoKXJldHVybjtjb25zdCBjPXRbb10sbD1vPT09dC5sZW5ndGgtMTtpZihjLmlzRmlsdGVyZWRQb3NpdGlvbmFsKXtjb25zdCBhPWMuaWRlbnRpZmllcix1PWk/aS5maW5kKGU9Pk9iamVjdC5rZXlzKGUpLnNvbWUoZT0+ZS5zdGFydHNXaXRoKGErIi4iKXx8ZT09PWEpKTpudWxsO2lmKCFpKXtpZighc1tjLnNlZ21lbnRdKXtjb25zdCBlPXRbbysxXTtlJiZlLmlzRmlsdGVyZWRQb3NpdGlvbmFsP3NbYy5zZWdtZW50XT1bXTpzW2Muc2VnbWVudF09e319cmV0dXJuIHZvaWQobD9ydChzLGMuc2VnbWVudCxuLHIpOmUoc1tjLnNlZ21lbnRdLG8rMSkpfWlmKCFJKHMpKXJldHVybiBzW2Muc2VnbWVudF18fChzW2Muc2VnbWVudF09e30pLHZvaWQobD9ydChzLGMuc2VnbWVudCxuLHIpOmUoc1tjLnNlZ21lbnRdLG8rMSkpO2ZvcihsZXQgdD0wO3Q8cy5sZW5ndGg7dCsrKXtjb25zdCBpPXNbdF07bGV0IGM9ITA7aWYodSl7bGV0IGU9e30sdD0hMTtpZihPYmplY3Qua2V5cyh1KS5mb3JFYWNoKG49PntpZihuLnN0YXJ0c1dpdGgoYSsiLiIpKXtjb25zdCB0PW4uc3Vic3RyaW5nKGEubGVuZ3RoKzEpO2VbdF09dVtuXX1lbHNlIG49PT1hJiYoZT11W25dLHQ9ITApfSksdCl7Yz1ZZSh7dmFsdWU6aX0se3ZhbHVlOmV9KX1lbHNlIGM9WWUoaSxlKX1jJiYobD9ydChzLHQsbixyKTpudWxsIT1pJiZlKHNbdF0sbysxKSl9fWVsc2V7aWYoKHZvaWQgMD09PXNbYy5zZWdtZW50XXx8bnVsbD09PXNbYy5zZWdtZW50XSkmJiFsKXtjb25zdCBlPXRbbysxXTtlJiZlLmlzRmlsdGVyZWRQb3NpdGlvbmFsP3NbYy5zZWdtZW50XT1bXTpzW2Muc2VnbWVudF09e319bD9ydChzLGMuc2VnbWVudCxuLHIpOnZvaWQgMCE9PXNbYy5zZWdtZW50XSYmbnVsbCE9PXNbYy5zZWdtZW50XSYmZShzW2Muc2VnbWVudF0sbysxKX19KGUsMCl9ZnVuY3Rpb24gcnQoZSx0LG4scil7c3dpdGNoKHIpe2Nhc2UiJHNldCI6ZGVmYXVsdDplW3RdPW47YnJlYWs7Y2FzZSIkaW5jIjp2b2lkIDA9PT1lW3RdJiYoZVt0XT0wKSxlW3RdKz1uO2JyZWFrO2Nhc2UiJG11bCI6ZVt0XT1lW3RdKm47YnJlYWs7Y2FzZSIkbWluIjplW3RdPU1hdGgubWluKGVbdF0sbik7YnJlYWs7Y2FzZSIkbWF4IjplW3RdPU1hdGgubWF4KGVbdF0sbik7YnJlYWs7Y2FzZSIkdW5zZXQiOmRlbGV0ZSBlW3RdfX1mdW5jdGlvbiBpdChlKXtyZXR1cm4vXCRcW1teXF1dK1xdLy50ZXN0KGUpfWZ1bmN0aW9uIHN0KGUpe3JldHVybi0xIT09ZS5pbmRleE9mKCIkW10iKX1mdW5jdGlvbiBvdChlLHQsbil7Zm9yKHZhciByPXQuc3BsaXQoIi4iKSxpPWUscz0wO3M8ci5sZW5ndGg7cysrKXt2YXIgbz1yW3NdO2lmKCIkW10iPT09byl7aWYoIUFycmF5LmlzQXJyYXkoaSkpcmV0dXJuO2Zvcih2YXIgYT1yLnNsaWNlKHMrMSkuam9pbigiLiIpLGM9MDtjPGkubGVuZ3RoO2MrKylpZihhKWlmKC0xIT09YS5pbmRleE9mKCIkW10iKSlvdChpW2NdLGEsbik7ZWxzZXt2YXIgbD1uKHYoaVtjXSxhKSk7TihpW2NdLGEsbCl9ZWxzZSBpW2NdPW4oaVtjXSk7cmV0dXJufWlmKG51bGw9PWl8fG51bGw9PWkpcmV0dXJuO2k9aVtvXX19ZnVuY3Rpb24gYXQoZSx0KXtpZighdHx8IWUuaW5jbHVkZXMoIiQiKSlyZXR1cm4gZTtjb25zdCBuPWUuc3BsaXQoIi4iKSxyPW4uaW5kZXhPZigiJCIpO2lmKC0xPT09cilyZXR1cm4gZTtjb25zdCBpPW4uc2xpY2UoMCxyKS5qb2luKCIuIik7bGV0IHM9bnVsbDtmb3IoY29uc3QgbyBpbiB0KWlmKG89PT1pfHxvLnN0YXJ0c1dpdGgoaSsiLiIpKXtzPXRbb107YnJlYWt9cmV0dXJuIG51bGwhPXM/KG5bcl09cy50b1N0cmluZygpLG4uam9pbigiLiIpKTplfWZ1bmN0aW9uIGN0KGUsdCxuLHIsaSl7Zm9yKHZhciBzPU9iamVjdC5rZXlzKGUpLG89MDtvPHMubGVuZ3RoO28rKyl7dmFyIGE9c1tvXSxjPWVbYV07aWYoIiRpbmMiPT1hKWZvcih2YXIgbD1PYmplY3Qua2V5cyhjKSx1PTA7dTxsLmxlbmd0aDt1Kyspe3ZhciBoPWF0KGxbdV0sciksZj1jW2xbdV1dO2lmKGl0KGgpKXtpZighaSl0aHJvdyBuZXcgRXJyb3IoImFycmF5RmlsdGVycyBvcHRpb24gaXMgcmVxdWlyZWQgd2hlbiB1c2luZyBmaWx0ZXJlZCBwb3NpdGlvbmFsIG9wZXJhdG9yICRbPGlkZW50aWZpZXI+XSIpO250KHQsdHQoaCksZiwiJGluYyIsaSl9ZWxzZSBpZihzdChoKSlvdCh0LGgsZnVuY3Rpb24oZSl7cmV0dXJuKHZvaWQgMD09PWU/MDplKStmfSk7ZWxzZXtudWxsPT0oZD12KHQsaCkpJiYoZD0wKSxOKHQsaCxkK2YpfX1lbHNlIGlmKCIkbXVsIj09YSlmb3IobD1PYmplY3Qua2V5cyhjKSx1PTA7dTxsLmxlbmd0aDt1Kyspe2g9YXQobFt1XSxyKSxmPWNbbFt1XV07aWYoaXQoaCkpe2lmKCFpKXRocm93IG5ldyBFcnJvcigiYXJyYXlGaWx0ZXJzIG9wdGlvbiBpcyByZXF1aXJlZCB3aGVuIHVzaW5nIGZpbHRlcmVkIHBvc2l0aW9uYWwgb3BlcmF0b3IgJFs8aWRlbnRpZmllcj5dIik7bnQodCx0dChoKSxmLCIkbXVsIixpKX1lbHNlIGlmKHN0KGgpKW90KHQsaCxmdW5jdGlvbihlKXtyZXR1cm4gZSpmfSk7ZWxzZXtudWxsPT0oZD12KHQsaCkpJiYoZD0wKSxOKHQsaCxkKmYpfX1lbHNlIGlmKCIkcmVuYW1lIj09YSlmb3IobD1PYmplY3Qua2V5cyhjKSx1PTA7dTxsLmxlbmd0aDt1Kyspe2g9YXQobFt1XSxyKTt0W2F0KGNbbFt1XV0scildPXRbaF0sZGVsZXRlIHRbaF19ZWxzZSBpZigiJHNldE9uSW5zZXJ0Ij09YSYmbilmb3IobD1PYmplY3Qua2V5cyhjKSx1PTA7dTxsLmxlbmd0aDt1Kyspe3RbaD1hdChsW3VdLHIpXT1jW2xbdV1dfWVsc2UgaWYoIiRzZXQiPT1hKWZvcihsPU9iamVjdC5rZXlzKGMpLHU9MDt1PGwubGVuZ3RoO3UrKyl7aWYoaXQoaD1hdChsW3VdLHIpKSl7aWYoIWkpdGhyb3cgbmV3IEVycm9yKCJhcnJheUZpbHRlcnMgb3B0aW9uIGlzIHJlcXVpcmVkIHdoZW4gdXNpbmcgZmlsdGVyZWQgcG9zaXRpb25hbCBvcGVyYXRvciAkWzxpZGVudGlmaWVyPl0iKTtudCh0LHR0KGgpLGNbbFt1XV0sIiRzZXQiLGkpfWVsc2UgTih0LGgsY1tsW3VdXSl9ZWxzZSBpZigiJHVuc2V0Ij09YSlmb3IobD1PYmplY3Qua2V5cyhjKSx1PTA7dTxsLmxlbmd0aDt1Kyspe2RlbGV0ZSB0W2g9YXQobFt1XSxyKV19ZWxzZSBpZigiJG1pbiI9PWEpZm9yKGw9T2JqZWN0LmtleXMoYyksdT0wO3U8bC5sZW5ndGg7dSsrKXtoPWF0KGxbdV0sciksZj1jW2xbdV1dO2lmKGl0KGgpKXtpZighaSl0aHJvdyBuZXcgRXJyb3IoImFycmF5RmlsdGVycyBvcHRpb24gaXMgcmVxdWlyZWQgd2hlbiB1c2luZyBmaWx0ZXJlZCBwb3NpdGlvbmFsIG9wZXJhdG9yICRbPGlkZW50aWZpZXI+XSIpO250KHQsdHQoaCksZiwiJG1pbiIsaSl9ZWxzZSBpZihzdChoKSlvdCh0LGgsZnVuY3Rpb24oZSl7cmV0dXJuIE1hdGgubWluKGUsZil9KTtlbHNle3ZhciBkPXYodCxoKTtOKHQsaCxNYXRoLm1pbihkLGYpKX19ZWxzZSBpZigiJG1heCI9PWEpZm9yKGw9T2JqZWN0LmtleXMoYyksdT0wO3U8bC5sZW5ndGg7dSsrKXtoPWF0KGxbdV0sciksZj1jW2xbdV1dO2lmKGl0KGgpKXtpZighaSl0aHJvdyBuZXcgRXJyb3IoImFycmF5RmlsdGVycyBvcHRpb24gaXMgcmVxdWlyZWQgd2hlbiB1c2luZyBmaWx0ZXJlZCBwb3NpdGlvbmFsIG9wZXJhdG9yICRbPGlkZW50aWZpZXI+XSIpO250KHQsdHQoaCksZiwiJG1heCIsaSl9ZWxzZSBpZihzdChoKSlvdCh0LGgsZnVuY3Rpb24oZSl7cmV0dXJuIE1hdGgubWF4KGUsZil9KTtlbHNle2Q9dih0LGgpO04odCxoLE1hdGgubWF4KGQsZikpfX1lbHNlIGlmKCIkY3VycmVudERhdGUiPT1hKWZvcihsPU9iamVjdC5rZXlzKGMpLHU9MDt1PGwubGVuZ3RoO3UrKyl7aD1hdChsW3VdLHIpO3ZhciBwPWNbbFt1XV07ITA9PT1wfHwib2JqZWN0Ij09dHlwZW9mIHAmJnAuJHR5cGUsTih0LGgsLyogQF9fUFVSRV9fICovbmV3IERhdGUpfWVsc2UgaWYoIiRhZGRUb1NldCI9PWEpZm9yKGw9T2JqZWN0LmtleXMoYyksdT0wO3U8bC5sZW5ndGg7dSsrKXtoPWF0KGxbdV0scik7dmFyIGc9Y1tsW3VdXTsoUD12KHQsaCkpJiZBcnJheS5pc0FycmF5KFApJiZQLnB1c2goZyl9ZWxzZSBpZigiJHBvcCI9PWEpZm9yKGw9T2JqZWN0LmtleXMoYyksdT0wO3U8bC5sZW5ndGg7dSsrKXtoPWF0KGxbdV0scik7dmFyIHk9Y1tsW3VdXTsoUD12KHQsaCkpJiZBcnJheS5pc0FycmF5KFApJiYoMT09eT9QLnBvcCgpOi0xPT15JiZQLnNoaWZ0KCkpfWVsc2UgaWYoIiRwdWxsIj09YSlmb3IobD1PYmplY3Qua2V5cyhjKSx1PTA7dTxsLmxlbmd0aDt1Kyspe2g9YXQobFt1XSxyKTt2YXIgbT1jW2xbdV1dO2lmKG51bGwhPSgkPXYodCxoKSkmJkFycmF5LmlzQXJyYXkoJCkpe2Zvcih2YXIgdz1bXSxiPTA7YjwkLmxlbmd0aDtiKyspe3ZhciB4PSRbYl0sXz0hMTtpZigib2JqZWN0IiE9dHlwZW9mIG18fG51bGw9PT1tfHxBcnJheS5pc0FycmF5KG0pKV89eD09bTtlbHNlIGlmKCJvYmplY3QiIT10eXBlb2YgeHx8bnVsbD09PXh8fEFycmF5LmlzQXJyYXkoeCkpXz1LZSh7X190ZW1wOnh9LCJfX3RlbXAiLG0pO2Vsc2UgXz1ZZSh4LG0pO198fHcucHVzaCh4KX1OKHQsaCx3KX19ZWxzZSBpZigiJHB1bGxBbGwiPT1hKWZvcihsPU9iamVjdC5rZXlzKGMpLHU9MDt1PGwubGVuZ3RoO3UrKyl7dmFyICQ9dih0LGg9YXQobFt1XSxyKSksST1jW2xbdV1dO2Zvcih3PVtdLGI9MDtiPCQubGVuZ3RoO2IrKyl7Zm9yKHZhciBTPSExLEE9MDtBPEkubGVuZ3RoO0ErKylpZigkW2JdPT1JW0FdKXtTPSEwO2JyZWFrfVN8fHcucHVzaCgkW2JdKX1OKHQsaCx3KX1lbHNlIGlmKCIkcHVzaEFsbCI9PWEpZm9yKGw9T2JqZWN0LmtleXMoYyksdT0wO3U8bC5sZW5ndGg7dSsrKXtoPWF0KGxbdV0scik7dmFyIE89Y1tsW3VdXTtpZigoUD12KHQsaCkpJiZBcnJheS5pc0FycmF5KFApKWZvcihiPTA7YjxPLmxlbmd0aDtiKyspUC5wdXNoKE9bYl0pfWVsc2UgaWYoIiRwdXNoIj09YSlmb3IobD1PYmplY3Qua2V5cyhjKSx1PTA7dTxsLmxlbmd0aDt1Kyspe2g9YXQobFt1XSxyKTt2YXIgQz1jW2xbdV1dO2lmKG51bGwhPT1DJiYib2JqZWN0Ij09dHlwZW9mIEMmJih2b2lkIDAhPT1DLiRlYWNofHx2b2lkIDAhPT1DLiRwb3NpdGlvbnx8dm9pZCAwIT09Qy4kc2xpY2V8fHZvaWQgMCE9PUMuJHNvcnQpKXsoUD12KHQsaCkpfHxOKHQsaCxQPVtdKTt2YXIgRT12b2lkIDAhPT1DLiRlYWNoP0MuJGVhY2g6W0NdLGo9dm9pZCAwIT09Qy4kcG9zaXRpb24/Qy4kcG9zaXRpb246UC5sZW5ndGg7aWYoajwwJiYoaj1NYXRoLm1heCgwLFAubGVuZ3RoK2opKSxQLnNwbGljZShqLDAsLi4uRSksdm9pZCAwIT09Qy4kc29ydCl7dmFyIEQ9Qy4kc29ydDsibnVtYmVyIj09dHlwZW9mIEQ/UC5zb3J0KGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGU8dD9EPjA/LTE6MTplPnQ/RD4wPzE6LTE6MH0pOiJvYmplY3QiPT10eXBlb2YgRCYmUC5zb3J0KGZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBuPU9iamVjdC5rZXlzKEQpLHI9MDtyPG4ubGVuZ3RoO3IrKyl7dmFyIGk9bltyXSxzPURbaV0sbz12KGUsaSksYT12KHQsaSk7aWYobzxhKXJldHVybiBzPjA/LTE6MTtpZihvPmEpcmV0dXJuIHM+MD8xOi0xfXJldHVybiAwfSl9aWYodm9pZCAwIT09Qy4kc2xpY2Upe3ZhciBrPUMuJHNsaWNlO2lmKGs8MClOKHQsaCxQLnNsaWNlKGspKTtlbHNlIGlmKDA9PT1rKU4odCxoLFtdKTtlbHNle04odCxoLFAuc2xpY2UoMCxrKSl9fX1lbHNle3ZhciBQOyhQPXYodCxoKSkmJkFycmF5LmlzQXJyYXkoUCkmJlAucHVzaChDKX19ZWxzZXtpZigiJGJpdCIhPWEpdGhyb3cidW5rbm93biB1cGRhdGUgb3BlcmF0b3I6ICIrYTtoPWF0KChsPU9iamVjdC5rZXlzKGMpKVswXSxyKTt2YXIgTT1jW2xbMF1dLEw9T2JqZWN0LmtleXMoTSlbMF0sQj1NW0xdO2Q9dih0LGgpO2lmKCJhbmQiPT1MKU4odCxoLGQmQik7ZWxzZSBpZigib3IiPT1MKU4odCxoLGR8Qik7ZWxzZXtpZigieG9yIiE9TCl0aHJvdyJ1bmtub3duICRiaXQgb3BlcmF0b3I6ICIrTDtOKHQsaCxkXkIpfX19fWZ1bmN0aW9uIGx0KGUsdCxuKXtmb3IodmFyIHI9e19pZDpufSxpPSEwLHM9T2JqZWN0LmtleXModCksbz0wO288cy5sZW5ndGg7bysrKWlmKCIkIj09c1tvXS5jaGFyQXQoMCkpe2k9ITE7YnJlYWt9aWYoaSlmb3Iobz0wO288cy5sZW5ndGg7bysrKXJbc1tvXV09dFtzW29dXTtlbHNle3ZhciBhPU9iamVjdC5rZXlzKGUpO2ZvcihvPTA7bzxhLmxlbmd0aDtvKyspclthW29dXT1lW2Fbb11dO2N0KHQsciwhMCl9cmV0dXJuIHJ9Y2xhc3MgdXR7Y29uc3RydWN0b3IoZSx0LG4scj17fSl7dGhpcy5uYW1lPWUsdGhpcy5rZXlzPXQsdGhpcy5zdG9yYWdlPW4sdGhpcy5vcHRpb25zPXJ9YWRkKGUpe3Rocm93IG5ldyBFcnJvcigiYWRkKCkgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBzdWJjbGFzcyIpfXJlbW92ZShlKXt0aHJvdyBuZXcgRXJyb3IoInJlbW92ZSgpIG11c3QgYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2xhc3MiKX11cGRhdGUoZSx0KXt0aGlzLnJlbW92ZShlKSx0aGlzLmFkZCh0KX1xdWVyeShlKXt0aHJvdyBuZXcgRXJyb3IoInF1ZXJ5KCkgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBzdWJjbGFzcyIpfWNsZWFyKCl7dGhyb3cgbmV3IEVycm9yKCJjbGVhcigpIG11c3QgYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2xhc3MiKX1nZXRTcGVjKCl7cmV0dXJue25hbWU6dGhpcy5uYW1lLGtleTp0aGlzLmtleXN9fX1jb25zdCBodD0iLnZlcnNpb24uanNvbiIsZnQ9MTYzODQ7ZnVuY3Rpb24gZHQoZSx0KXtjb25zdCBuPU51bWJlcih0KTtpZighTnVtYmVyLmlzRmluaXRlKG4pKXRocm93IG5ldyBFcnJvcihgSW52YWxpZCB2ZXJzaW9uIHZhbHVlOiAke3R9YCk7aWYobjwwKXRocm93IG5ldyBFcnJvcihgVmVyc2lvbiBtdXN0IGJlIG5vbi1uZWdhdGl2ZTogJHtufWApO3JldHVybiAwPT09bj9lOmAke2V9LnYke259YH1mdW5jdGlvbiBwdChlKXtjb25zdCB0PXtjdXJyZW50VmVyc2lvbjowLHJlZkNvdW50czp7fX07aWYoIWV8fCJvYmplY3QiIT10eXBlb2YgZSlyZXR1cm4gdDtjb25zdCBuPU51bWJlcihlLmN1cnJlbnRWZXJzaW9uKTtpZih0LmN1cnJlbnRWZXJzaW9uPU51bWJlci5pc0Zpbml0ZShuKT9uOjAsZS5yZWZDb3VudHMmJiJvYmplY3QiPT10eXBlb2YgZS5yZWZDb3VudHMpZm9yKGNvbnN0W3IsaV1vZiBPYmplY3QuZW50cmllcyhlLnJlZkNvdW50cykpe2NvbnN0IGU9TnVtYmVyKGkpO051bWJlci5pc0Zpbml0ZShlKSYmZT4wP3QucmVmQ291bnRzW1N0cmluZyhyKV09ZTooIU51bWJlci5pc0Zpbml0ZShlKXx8ZTwwKSYmY29uc29sZS53YXJuKGBJZ25vcmluZyBpbnZhbGlkIHJlZiBjb3VudCBmb3IgdmVyc2lvbiAke3J9OiAke2l9YCl9cmV0dXJuIHR9ZnVuY3Rpb24gZ3QoZSl7Y29uc3QgdD1lLnNwbGl0KCIvIikuZmlsdGVyKEJvb2xlYW4pLG49dC5wb3AoKTtpZighbil0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc3RvcmFnZSBwYXRoOiAke2V9YCk7cmV0dXJue3BhcnRzOnQsZmlsZW5hbWU6bn19YXN5bmMgZnVuY3Rpb24geXQoZSx0KXtsZXQgbj1hd2FpdCBnbG9iYWxUaGlzLm5hdmlnYXRvci5zdG9yYWdlLmdldERpcmVjdG9yeSgpO2Zvcihjb25zdCByIG9mIGUpbj1hd2FpdCBuLmdldERpcmVjdG9yeUhhbmRsZShyLHtjcmVhdGU6dH0pO3JldHVybiBufWFzeW5jIGZ1bmN0aW9uIG10KGUpe2NvbnN0e3BhcnRzOnR9PWd0KGUpOzAhPT10Lmxlbmd0aCYmYXdhaXQgeXQodCwhMCl9YXN5bmMgZnVuY3Rpb24gd3QoZSx7Y3JlYXRlOnR9PXt9KXtjb25zdHtwYXJ0czpuLGZpbGVuYW1lOnJ9PWd0KGUpO3JldHVybihhd2FpdCB5dChuLCEhdCkpLmdldEZpbGVIYW5kbGUocix7Y3JlYXRlOnR9KX1hc3luYyBmdW5jdGlvbiBidChlKXtjb25zdCB0PWAke2V9JHtodH1gO3RyeXtjb25zdCBlPWF3YWl0IHd0KHQse2NyZWF0ZTohMX0pLG49YXdhaXQgZS5nZXRGaWxlKCkscj1hd2FpdCBuLnRleHQoKTtyZXR1cm4gciYmIiIhPT1yLnRyaW0oKT9wdChKU09OLnBhcnNlKHIpKTpwdCgpfWNhdGNoKG4pe2lmKCJOb3RGb3VuZEVycm9yIj09PW4/Lm5hbWV8fCJFTk9FTlQiPT09bj8uY29kZSlyZXR1cm4gcHQoKTt0aHJvdyBufX1hc3luYyBmdW5jdGlvbiB4dChlLHQpe2NvbnN0IG49YCR7ZX0ke2h0fWA7YXdhaXQgbXQobik7Y29uc3Qgcj1hd2FpdCB3dChuLHtjcmVhdGU6ITB9KSxpPWF3YWl0IHIuY3JlYXRlV3JpdGFibGUoKTthd2FpdCBpLndyaXRlKEpTT04uc3RyaW5naWZ5KHQpKSxhd2FpdCBpLmNsb3NlKCl9YXN5bmMgZnVuY3Rpb24gX3QoZSx0LG4scil7aWYodD09PW4uY3VycmVudFZlcnNpb24pcmV0dXJuO2NvbnN0IGk9U3RyaW5nKHQpO24ucmVmQ291bnRzW2ldfHxhd2FpdCBhc3luYyBmdW5jdGlvbihlLHQsbil7Y29uc3Qgcj1kdChlLHQpO2Zvcihjb25zdCBpIG9mIG4pe2NvbnN0IGU9aT9gJHtyfSR7aX1gOnI7YXdhaXQgU3QoZSl9fShlLHQscil9YXN5bmMgZnVuY3Rpb24gdnQoZSl7Y29uc3QgdD1hd2FpdCBidChlKSxuPXQuY3VycmVudFZlcnNpb24scj1TdHJpbmcobik7cmV0dXJuIHQucmVmQ291bnRzW3JdPSh0LnJlZkNvdW50c1tyXXx8MCkrMSxhd2FpdCB4dChlLHQpLHt2ZXJzaW9uOm4scGF0aDpkdChlLG4pfX1hc3luYyBmdW5jdGlvbiAkdChlLHQse3N1ZmZpeGVzOm49WyIiXX09e30pe2NvbnN0IHI9YXdhaXQgYnQoZSksaT1TdHJpbmcodCk7ci5yZWZDb3VudHNbaV0mJihyLnJlZkNvdW50c1tpXS09MSxyLnJlZkNvdW50c1tpXTw9MCYmZGVsZXRlIHIucmVmQ291bnRzW2ldKSxhd2FpdCBfdChlLHQscixuKSxhd2FpdCB4dChlLHIpfWFzeW5jIGZ1bmN0aW9uIE50KGUsdCxuLHtzdWZmaXhlczpyPVsiIl19PXt9KXtjb25zdCBpPWF3YWl0IGJ0KGUpLHM9TnVtYmVyKHQpO2kuY3VycmVudFZlcnNpb249TnVtYmVyLmlzRmluaXRlKHMpP3M6aS5jdXJyZW50VmVyc2lvbjtjb25zdCBvPVN0cmluZyhpLmN1cnJlbnRWZXJzaW9uKTtpLnJlZkNvdW50c1tvXXx8KGkucmVmQ291bnRzW29dPTApLGF3YWl0IF90KGUsbixpLHIpLGF3YWl0IHh0KGUsaSl9YXN5bmMgZnVuY3Rpb24gSXQoZSl7cmV0dXJuKGF3YWl0IGJ0KGUpKS5jdXJyZW50VmVyc2lvbn1hc3luYyBmdW5jdGlvbiBTdChlKXt0cnl7Y29uc3R7cGFydHM6dCxmaWxlbmFtZTpufT1ndChlKSxyPWF3YWl0IHl0KHQsITEpO2F3YWl0IHIucmVtb3ZlRW50cnkobil9Y2F0Y2godCl7aWYoIk5vdEZvdW5kRXJyb3IiPT09dD8ubmFtZXx8IkVOT0VOVCI9PT10Py5jb2RlKXJldHVybjt0aHJvdyB0fX1hc3luYyBmdW5jdGlvbiBBdChlLHtyZXNldDp0PSExfT17fSl7dCYmYXdhaXQgU3QoZSksYXdhaXQgbXQoZSk7cmV0dXJuKGF3YWl0IHd0KGUse2NyZWF0ZTohMH0pKS5jcmVhdGVTeW5jQWNjZXNzSGFuZGxlKCl9Y2xhc3MgT3QgZXh0ZW5kcyB1dHtjb25zdHJ1Y3RvcihlLHQsbixyPXt9KXtzdXBlcihlLHQsbixyKSx0aGlzLnN0b3JhZ2VGaWxlUGF0aD1uLHRoaXMuc3RvcmFnZVZlcnNpb25lZFBhdGg9bnVsbCx0aGlzLnN0b3JhZ2VWZXJzaW9uPTAsdGhpcy5fcmVsZWFzZVN0b3JhZ2U9bnVsbCx0aGlzLmRhdGE9bnVsbCx0aGlzLnN5bmNIYW5kbGU9bnVsbCx0aGlzLmlzT3Blbj0hMX1hc3luYyBvcGVuKCl7aWYoIXRoaXMuaXNPcGVuKXRyeXtjb25zdHt2ZXJzaW9uOmUscGF0aDp0fT1hd2FpdCB2dCh0aGlzLnN0b3JhZ2VGaWxlUGF0aCk7dGhpcy5zdG9yYWdlVmVyc2lvbj1lLHRoaXMuc3RvcmFnZVZlcnNpb25lZFBhdGg9dCx0aGlzLl9yZWxlYXNlU3RvcmFnZT0oKT0+JHQodGhpcy5zdG9yYWdlRmlsZVBhdGgsZSk7Y29uc3Qgbj10aGlzLnN0b3JhZ2VWZXJzaW9uZWRQYXRoLnNwbGl0KCIvIikuZmlsdGVyKEJvb2xlYW4pLHI9bi5wb3AoKTtpZighcil0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc3RvcmFnZSBwYXRoOiAke3RoaXMuc3RvcmFnZVZlcnNpb25lZFBhdGh9YCk7bGV0IGk9YXdhaXQgZ2xvYmFsVGhpcy5uYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkoKTtmb3IoY29uc3QgbyBvZiBuKWk9YXdhaXQgaS5nZXREaXJlY3RvcnlIYW5kbGUobyx7Y3JlYXRlOiEwfSk7Y29uc3Qgcz1hd2FpdCBpLmdldEZpbGVIYW5kbGUocix7Y3JlYXRlOiEwfSk7dGhpcy5zeW5jSGFuZGxlPWF3YWl0IHMuY3JlYXRlU3luY0FjY2Vzc0hhbmRsZSgpLHRoaXMuZGF0YT1uZXcgeGUodGhpcy5zeW5jSGFuZGxlLDUwKSxhd2FpdCB0aGlzLmRhdGEub3BlbigpLHRoaXMuaXNPcGVuPSEwfWNhdGNoKGUpe2lmKCFlLm1lc3NhZ2V8fCEoZS5tZXNzYWdlLmluY2x1ZGVzKCJVbmtub3duIHR5cGUgYnl0ZSIpfHxlLm1lc3NhZ2UuaW5jbHVkZXMoIkZhaWxlZCB0byByZWFkIG1ldGFkYXRhIil8fGUubWVzc2FnZS5pbmNsdWRlcygiSW52YWxpZCB0cmVlIGZpbGUiKSkpdGhyb3cgZTt7aWYodGhpcy5zeW5jSGFuZGxlKXt0cnl7YXdhaXQgdGhpcy5zeW5jSGFuZGxlLmNsb3NlKCl9Y2F0Y2godCl7fXRoaXMuc3luY0hhbmRsZT1udWxsfWNvbnN0IGU9dGhpcy5zdG9yYWdlVmVyc2lvbmVkUGF0aC5zcGxpdCgiLyIpLmZpbHRlcihCb29sZWFuKSxuPWUucG9wKCk7aWYoIW4pdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHN0b3JhZ2UgcGF0aDogJHt0aGlzLnN0b3JhZ2VWZXJzaW9uZWRQYXRofWApO2xldCByPWF3YWl0IGdsb2JhbFRoaXMubmF2aWdhdG9yLnN0b3JhZ2UuZ2V0RGlyZWN0b3J5KCk7Zm9yKGNvbnN0IHQgb2YgZSlyPWF3YWl0IHIuZ2V0RGlyZWN0b3J5SGFuZGxlKHQse2NyZWF0ZTohMH0pO3RyeXthd2FpdCByLnJlbW92ZUVudHJ5KG4pfWNhdGNoKHQpe31jb25zdCBpPWF3YWl0IHIuZ2V0RmlsZUhhbmRsZShuLHtjcmVhdGU6ITB9KTt0aGlzLnN5bmNIYW5kbGU9YXdhaXQgaS5jcmVhdGVTeW5jQWNjZXNzSGFuZGxlKCksdGhpcy5kYXRhPW5ldyB4ZSh0aGlzLnN5bmNIYW5kbGUsNTApLGF3YWl0IHRoaXMuZGF0YS5vcGVuKCksdGhpcy5pc09wZW49ITB9fX1hc3luYyBjbG9zZSgpe2lmKHRoaXMuaXNPcGVuKXt0cnl7YXdhaXQgdGhpcy5fbWF5YmVDb21wYWN0KCksYXdhaXQgdGhpcy5kYXRhLmNsb3NlKCl9Y2F0Y2goZSl7aWYoIWUubWVzc2FnZXx8IWUubWVzc2FnZS5pbmNsdWRlcygiRmlsZSBpcyBub3Qgb3BlbiIpKXRocm93IGV9dGhpcy5pc09wZW49ITEsdGhpcy5fcmVsZWFzZVN0b3JhZ2UmJihhd2FpdCB0aGlzLl9yZWxlYXNlU3RvcmFnZSgpLHRoaXMuX3JlbGVhc2VTdG9yYWdlPW51bGwpfWVsc2UgdGhpcy5fcmVsZWFzZVN0b3JhZ2UmJihhd2FpdCB0aGlzLl9yZWxlYXNlU3RvcmFnZSgpLHRoaXMuX3JlbGVhc2VTdG9yYWdlPW51bGwpfWFzeW5jIF9tYXliZUNvbXBhY3QoKXtpZighdGhpcy5kYXRhfHwhdGhpcy5kYXRhLmZpbGUpcmV0dXJuO2NvbnN0IGU9YXdhaXQgSXQodGhpcy5zdG9yYWdlRmlsZVBhdGgpO2lmKGUhPT10aGlzLnN0b3JhZ2VWZXJzaW9uKXJldHVybjtjb25zdCB0PXRoaXMuZGF0YS5maWxlLmdldEZpbGVTaXplKCk7aWYoIXR8fHQ8ZnQpcmV0dXJuO2NvbnN0IG49ZSsxLHI9ZHQodGhpcy5zdG9yYWdlRmlsZVBhdGgsbiksaT1hd2FpdCBBdChyLHtyZXNldDohMH0pO2F3YWl0IHRoaXMuZGF0YS5jb21wYWN0KGkpLGF3YWl0IE50KHRoaXMuc3RvcmFnZUZpbGVQYXRoLG4sZSl9ZXh0cmFjdEluZGV4S2V5KGUpe2NvbnN0IHQ9T2JqZWN0LmtleXModGhpcy5rZXlzKTtpZigwPT09dC5sZW5ndGgpcmV0dXJuIG51bGw7aWYoMT09PXQubGVuZ3RoKXtjb25zdCBuPXYoZSx0WzBdKTtyZXR1cm4gdm9pZCAwPT09bj9udWxsOm59Y29uc3Qgbj1bXTtmb3IobGV0IHI9MDtyPHQubGVuZ3RoO3IrKyl7Y29uc3QgaT12KGUsdFtyXSk7aWYodm9pZCAwPT09aSlyZXR1cm4gbnVsbDtuLnB1c2goaSl9cmV0dXJuIG4uam9pbigiXDAiKX1hc3luYyBhZGQoZSl7dGhpcy5pc09wZW58fGF3YWl0IHRoaXMub3BlbigpO2NvbnN0IHQ9dGhpcy5leHRyYWN0SW5kZXhLZXkoZSk7aWYobnVsbCE9PXQpe2NvbnN0IG49ZS5faWQudG9TdHJpbmcoKSxyPWF3YWl0IHRoaXMuZGF0YS5zZWFyY2godCk7bGV0IGk7aWYoQXJyYXkuaXNBcnJheShyKSl7aWYoci5pbmNsdWRlcyhuKSlyZXR1cm47aT1bLi4ucixuXX1lbHNlIGk9cj9yPT09bj9bcl06W3Isbl06W25dO2F3YWl0IHRoaXMuZGF0YS5hZGQodCxpKX19YXN5bmMgcmVtb3ZlKGUpe3RoaXMuaXNPcGVufHxhd2FpdCB0aGlzLm9wZW4oKTtjb25zdCB0PXRoaXMuZXh0cmFjdEluZGV4S2V5KGUpO2lmKG51bGwhPT10KXtjb25zdCBuPWUuX2lkLnRvU3RyaW5nKCkscj1hd2FpdCB0aGlzLmRhdGEuc2VhcmNoKHQpO2lmKEFycmF5LmlzQXJyYXkocikpe2NvbnN0IGU9ci5maWx0ZXIoZT0+ZSE9PW4pO2UubGVuZ3RoPjA/YXdhaXQgdGhpcy5kYXRhLmFkZCh0LGUpOmF3YWl0IHRoaXMuZGF0YS5kZWxldGUodCl9ZWxzZSByPT09biYmYXdhaXQgdGhpcy5kYXRhLmRlbGV0ZSh0KX19YXN5bmMgcXVlcnkoZSl7Y29uc3QgdD1PYmplY3Qua2V5cyhlKSxuPU9iamVjdC5rZXlzKHRoaXMua2V5cyk7aWYoMSE9PW4ubGVuZ3RoKXJldHVybiBudWxsO2NvbnN0IHI9blswXTtpZigtMT09PXQuaW5kZXhPZihyKSlyZXR1cm4gbnVsbDtjb25zdCBpPWVbcl07aWYoIm9iamVjdCIhPXR5cGVvZiBpfHxudWxsPT09aSl7Y29uc3QgZT1pO3JldHVybiBhd2FpdCB0aGlzLmRhdGEuc2VhcmNoKGUpfHxbXX1yZXR1cm4ib2JqZWN0IiE9dHlwZW9mIGl8fEFycmF5LmlzQXJyYXkoaSk/bnVsbDphd2FpdCB0aGlzLl9xdWVyeVdpdGhPcGVyYXRvcnMocixpKX1hc3luYyBfcXVlcnlXaXRoT3BlcmF0b3JzKGUsdCl7Y29uc3Qgbj1PYmplY3Qua2V5cyh0KSxyPS8qIEBfX1BVUkVfXyAqL25ldyBTZXQ7aWYobi5zb21lKGU9PlsiJGd0IiwiJGd0ZSIsIiRsdCIsIiRsdGUiXS5pbmNsdWRlcyhlKSkpe2NvbnN0IGU9bi5pbmNsdWRlcygiJGd0Iil8fG4uaW5jbHVkZXMoIiRndGUiKSxpPW4uaW5jbHVkZXMoIiRsdCIpfHxuLmluY2x1ZGVzKCIkbHRlIik7aWYoZSYmaSl7Y29uc3QgZT1uLmluY2x1ZGVzKCIkZ3RlIik/dC4kZ3RlOm4uaW5jbHVkZXMoIiRndCIpP3QuJGd0Oi0xLzAsaT1uLmluY2x1ZGVzKCIkbHRlIik/dC4kbHRlOm4uaW5jbHVkZXMoIiRsdCIpP3QuJGx0OjEvMCxzPWF3YWl0IHRoaXMuZGF0YS5yYW5nZVNlYXJjaChlLGkpO2Zvcihjb25zdCBvIG9mIHMpe2NvbnN0IGU9by5rZXksaT1vLnZhbHVlO2xldCBzPSEwOyFuLmluY2x1ZGVzKCIkZ3QiKXx8ZT50LiRndHx8KHM9ITEpLCFuLmluY2x1ZGVzKCIkZ3RlIil8fGU+PXQuJGd0ZXx8KHM9ITEpLCFuLmluY2x1ZGVzKCIkbHQiKXx8ZTx0LiRsdHx8KHM9ITEpLCFuLmluY2x1ZGVzKCIkbHRlIil8fGU8PXQuJGx0ZXx8KHM9ITEpLHMmJmkmJihBcnJheS5pc0FycmF5KGkpP2kuZm9yRWFjaChlPT5yLmFkZChlKSk6ci5hZGQoaSkpfXJldHVybiBBcnJheS5mcm9tKHIpfXtjb25zdCBlPWF3YWl0IHRoaXMuZGF0YS50b0FycmF5KCk7Zm9yKGNvbnN0IGkgb2YgZSl7Y29uc3QgZT1pLmtleSxzPWkudmFsdWU7bGV0IG89ITA7Zm9yKGNvbnN0IHIgb2Ygbil7Y29uc3Qgbj10W3JdOygiJGd0IiE9PXJ8fGU+bikmJigiJGd0ZSIhPT1yfHxlPj1uKSYmKCIkbHQiIT09cnx8ZTxuKSYmKCIkbHRlIiE9PXJ8fGU8PW4pPygiJGVxIj09PXImJmUhPT1ufHwiJG5lIj09PXImJmU9PT1uKSYmKG89ITEpOm89ITF9byYmcyYmKEFycmF5LmlzQXJyYXkocyk/cy5mb3JFYWNoKGU9PnIuYWRkKGUpKTpyLmFkZChzKSl9cmV0dXJuIEFycmF5LmZyb20ocil9fWlmKG4uaW5jbHVkZXMoIiRpbiIpKXtjb25zdCBlPXQuJGluO2lmKEFycmF5LmlzQXJyYXkoZSkpe2Zvcihjb25zdCB0IG9mIGUpe2NvbnN0IGU9YXdhaXQgdGhpcy5kYXRhLnNlYXJjaCh0KTtlJiYoQXJyYXkuaXNBcnJheShlKT9lLmZvckVhY2goZT0+ci5hZGQoZSkpOnIuYWRkKGUpKX1yZXR1cm4gQXJyYXkuZnJvbShyKX19aWYobi5pbmNsdWRlcygiJGVxIikpe2NvbnN0IGU9dC4kZXEsbj1hd2FpdCB0aGlzLmRhdGEuc2VhcmNoKGUpO3JldHVybiBuP0FycmF5LmlzQXJyYXkobik/bjpbbl06W119aWYobi5pbmNsdWRlcygiJG5lIikpe2NvbnN0IGU9dC4kbmUsbj1hd2FpdCB0aGlzLmRhdGEudG9BcnJheSgpO2Zvcihjb25zdCB0IG9mIG4pdC5rZXkhPT1lJiZ0LnZhbHVlJiYoQXJyYXkuaXNBcnJheSh0LnZhbHVlKT90LnZhbHVlLmZvckVhY2goZT0+ci5hZGQoZSkpOnIuYWRkKHQudmFsdWUpKTtyZXR1cm4gQXJyYXkuZnJvbShyKX1yZXR1cm4gbnVsbH1hc3luYyBjbGVhcigpe3RoaXMuaXNPcGVuJiZhd2FpdCB0aGlzLmNsb3NlKCk7Y29uc3QgZT1hd2FpdCBJdCh0aGlzLnN0b3JhZ2VGaWxlUGF0aCksdD1kdCh0aGlzLnN0b3JhZ2VGaWxlUGF0aCxlKS5zcGxpdCgiLyIpLmZpbHRlcihCb29sZWFuKSxuPXQucG9wKCk7bGV0IHI9YXdhaXQgZ2xvYmFsVGhpcy5uYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkoKTtmb3IoY29uc3QgcyBvZiB0KXI9YXdhaXQgci5nZXREaXJlY3RvcnlIYW5kbGUocyx7Y3JlYXRlOiEwfSk7dHJ5e2F3YWl0IHIucmVtb3ZlRW50cnkobil9Y2F0Y2goaSl7fWF3YWl0IHRoaXMub3BlbigpfX1jb25zdCBDdD1bIi10ZXJtcy5ianNvbiIsIi1kb2N1bWVudHMuYmpzb24iLCItbGVuZ3Rocy5ianNvbiJdO2NsYXNzIEV0IGV4dGVuZHMgdXR7Y29uc3RydWN0b3IoZSx0LG4scj17fSl7c3VwZXIoZSx0LG4pLHRoaXMuc3RvcmFnZUJhc2VQYXRoPW4sdGhpcy5zdG9yYWdlVmVyc2lvbj0wLHRoaXMudmVyc2lvbmVkQmFzZVBhdGg9bnVsbCx0aGlzLl9yZWxlYXNlU3RvcmFnZT1udWxsLHRoaXMudGV4dEluZGV4PW51bGwsdGhpcy5zeW5jSGFuZGxlcz1bXSx0aGlzLmlzT3Blbj0hMSx0aGlzLmluZGV4ZWRGaWVsZHM9W107Zm9yKGNvbnN0IGkgaW4gdCkidGV4dCI9PT10W2ldJiZ0aGlzLmluZGV4ZWRGaWVsZHMucHVzaChpKTtpZigwPT09dGhpcy5pbmRleGVkRmllbGRzLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoJ1RleHQgaW5kZXggbXVzdCBoYXZlIGF0IGxlYXN0IG9uZSBmaWVsZCB3aXRoIHR5cGUgInRleHQiJyl9YXN5bmMgb3Blbigpe2lmKCF0aGlzLmlzT3Blbil0cnl7Y29uc3R7dmVyc2lvbjplLHBhdGg6dH09YXdhaXQgdnQodGhpcy5zdG9yYWdlQmFzZVBhdGgpO3RoaXMuc3RvcmFnZVZlcnNpb249ZSx0aGlzLnZlcnNpb25lZEJhc2VQYXRoPXQsdGhpcy5fcmVsZWFzZVN0b3JhZ2U9KCk9PiR0KHRoaXMuc3RvcmFnZUJhc2VQYXRoLGUse3N1ZmZpeGVzOkN0fSk7Y29uc3Qgbj1hd2FpdCB0aGlzLl9jcmVhdGVCUGx1c1RyZWUodGhpcy5fZ2V0QWN0aXZlQmFzZVBhdGgoKSsiLXRlcm1zLmJqc29uIikscj1hd2FpdCB0aGlzLl9jcmVhdGVCUGx1c1RyZWUodGhpcy5fZ2V0QWN0aXZlQmFzZVBhdGgoKSsiLWRvY3VtZW50cy5ianNvbiIpLGk9YXdhaXQgdGhpcy5fY3JlYXRlQlBsdXNUcmVlKHRoaXMuX2dldEFjdGl2ZUJhc2VQYXRoKCkrIi1sZW5ndGhzLmJqc29uIik7dGhpcy50ZXh0SW5kZXg9bmV3ICRlKHtvcmRlcjoxNix0cmVlczp7aW5kZXg6bixkb2N1bWVudFRlcm1zOnIsZG9jdW1lbnRMZW5ndGhzOml9fSksYXdhaXQgdGhpcy50ZXh0SW5kZXgub3BlbigpLHRoaXMuaXNPcGVuPSEwfWNhdGNoKGUpe2lmKCEoIkVOT0VOVCI9PT1lLmNvZGV8fGUubWVzc2FnZSYmKGUubWVzc2FnZS5pbmNsdWRlcygiRmFpbGVkIHRvIHJlYWQgbWV0YWRhdGEiKXx8ZS5tZXNzYWdlLmluY2x1ZGVzKCJtaXNzaW5nIHJlcXVpcmVkIGZpZWxkcyIpfHxlLm1lc3NhZ2UuaW5jbHVkZXMoIlVua25vd24gdHlwZSBieXRlIil8fGUubWVzc2FnZS5pbmNsdWRlcygiSW52YWxpZCIpfHxlLm1lc3NhZ2UuaW5jbHVkZXMoImZpbGUgdG9vIHNtYWxsIikpKSl0aHJvdyBlO3thd2FpdCB0aGlzLl9jbG9zZVN5bmNIYW5kbGVzKCksYXdhaXQgdGhpcy5fZGVsZXRlSW5kZXhGaWxlcygpLGF3YWl0IHRoaXMuX2Vuc3VyZURpcmVjdG9yeUZvckZpbGUodGhpcy5fZ2V0QWN0aXZlQmFzZVBhdGgoKSsiLXRlcm1zLmJqc29uIik7Y29uc3QgZT1hd2FpdCB0aGlzLl9jcmVhdGVCUGx1c1RyZWUodGhpcy5fZ2V0QWN0aXZlQmFzZVBhdGgoKSsiLXRlcm1zLmJqc29uIiksdD1hd2FpdCB0aGlzLl9jcmVhdGVCUGx1c1RyZWUodGhpcy5fZ2V0QWN0aXZlQmFzZVBhdGgoKSsiLWRvY3VtZW50cy5ianNvbiIpLG49YXdhaXQgdGhpcy5fY3JlYXRlQlBsdXNUcmVlKHRoaXMuX2dldEFjdGl2ZUJhc2VQYXRoKCkrIi1sZW5ndGhzLmJqc29uIik7dGhpcy50ZXh0SW5kZXg9bmV3ICRlKHtvcmRlcjoxNix0cmVlczp7aW5kZXg6ZSxkb2N1bWVudFRlcm1zOnQsZG9jdW1lbnRMZW5ndGhzOm59fSksYXdhaXQgdGhpcy50ZXh0SW5kZXgub3BlbigpLHRoaXMuaXNPcGVuPSEwfX19YXN5bmMgX2NyZWF0ZUJQbHVzVHJlZShlKXtjb25zdCB0PWUuc3BsaXQoIi8iKS5maWx0ZXIoQm9vbGVhbiksbj10LnBvcCgpO2lmKCFuKXRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzdG9yYWdlIHBhdGg6ICR7ZX1gKTtsZXQgcj1hd2FpdCBnbG9iYWxUaGlzLm5hdmlnYXRvci5zdG9yYWdlLmdldERpcmVjdG9yeSgpO2Zvcihjb25zdCBvIG9mIHQpcj1hd2FpdCByLmdldERpcmVjdG9yeUhhbmRsZShvLHtjcmVhdGU6ITB9KTtjb25zdCBpPWF3YWl0IHIuZ2V0RmlsZUhhbmRsZShuLHtjcmVhdGU6ITB9KSxzPWF3YWl0IGkuY3JlYXRlU3luY0FjY2Vzc0hhbmRsZSgpO3JldHVybiB0aGlzLnN5bmNIYW5kbGVzLnB1c2gocyksbmV3IHhlKHMsMTYpfWFzeW5jIF9jbG9zZVN5bmNIYW5kbGVzKCl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5zeW5jSGFuZGxlcyl0cnl7YXdhaXQgdC5jbG9zZSgpfWNhdGNoKGUpe310aGlzLnN5bmNIYW5kbGVzPVtdfV9nZXRBY3RpdmVCYXNlUGF0aCgpe3JldHVybiB0aGlzLnZlcnNpb25lZEJhc2VQYXRofHx0aGlzLnN0b3JhZ2VCYXNlUGF0aH1hc3luYyBfZGVsZXRlSW5kZXhGaWxlcyhlPXRoaXMuX2dldEFjdGl2ZUJhc2VQYXRoKCkpe2Zvcihjb25zdCB0IG9mIEN0KWF3YWl0IHRoaXMuX2RlbGV0ZUZpbGUoZSt0KX1hc3luYyBfZGVsZXRlRmlsZShlKXtpZihlKXRyeXtjb25zdCB0PWUuc3BsaXQoIi8iKS5maWx0ZXIoQm9vbGVhbiksbj10LnBvcCgpO2lmKCFuKXRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzdG9yYWdlIHBhdGg6ICR7ZX1gKTtsZXQgcj1hd2FpdCBnbG9iYWxUaGlzLm5hdmlnYXRvci5zdG9yYWdlLmdldERpcmVjdG9yeSgpO2Zvcihjb25zdCBlIG9mIHQpcj1hd2FpdCByLmdldERpcmVjdG9yeUhhbmRsZShlLHtjcmVhdGU6ITF9KTthd2FpdCByLnJlbW92ZUVudHJ5KG4pfWNhdGNoKHQpe319YXN5bmMgX2Vuc3VyZURpcmVjdG9yeUZvckZpbGUoZSl7aWYoIWUpcmV0dXJuO2NvbnN0IHQ9ZS5zcGxpdCgiLyIpLmZpbHRlcihCb29sZWFuKTtpZih0LnBvcCgpLDAhPT10Lmxlbmd0aCl0cnl7bGV0IGU9YXdhaXQgZ2xvYmFsVGhpcy5uYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkoKTtmb3IoY29uc3QgbiBvZiB0KWU9YXdhaXQgZS5nZXREaXJlY3RvcnlIYW5kbGUobix7Y3JlYXRlOiEwfSl9Y2F0Y2gobil7aWYoIkVFWElTVCIhPT1uLmNvZGUpdGhyb3cgbn19YXN5bmMgY2xvc2UoKXtpZih0aGlzLmlzT3Blbil7aWYoYXdhaXQgdGhpcy5fbWF5YmVDb21wYWN0KCksdGhpcy50ZXh0SW5kZXg/LmlzT3Blbil0cnl7YXdhaXQgdGhpcy50ZXh0SW5kZXguY2xvc2UoKX1jYXRjaChlKXtpZighZS5tZXNzYWdlfHwhZS5tZXNzYWdlLmluY2x1ZGVzKCJGaWxlIGlzIG5vdCBvcGVuIikpdGhyb3cgZX10aGlzLmlzT3Blbj0hMX10aGlzLl9yZWxlYXNlU3RvcmFnZSYmKGF3YWl0IHRoaXMuX3JlbGVhc2VTdG9yYWdlKCksdGhpcy5fcmVsZWFzZVN0b3JhZ2U9bnVsbCl9YXN5bmMgX21heWJlQ29tcGFjdCgpe2lmKCF0aGlzLnRleHRJbmRleD8uaW5kZXg/LmZpbGV8fCF0aGlzLnRleHRJbmRleD8uZG9jdW1lbnRUZXJtcz8uZmlsZXx8IXRoaXMudGV4dEluZGV4Py5kb2N1bWVudExlbmd0aHM/LmZpbGUpcmV0dXJuITE7Y29uc3QgZT1hd2FpdCBJdCh0aGlzLnN0b3JhZ2VCYXNlUGF0aCk7aWYoZSE9PXRoaXMuc3RvcmFnZVZlcnNpb24pcmV0dXJuITE7Y29uc3QgdD10aGlzLnRleHRJbmRleC5pbmRleC5maWxlLmdldEZpbGVTaXplKCkrdGhpcy50ZXh0SW5kZXguZG9jdW1lbnRUZXJtcy5maWxlLmdldEZpbGVTaXplKCkrdGhpcy50ZXh0SW5kZXguZG9jdW1lbnRMZW5ndGhzLmZpbGUuZ2V0RmlsZVNpemUoKTtpZighdHx8dDxmdClyZXR1cm4hMTtjb25zdCBuPWUrMSxyPWR0KHRoaXMuc3RvcmFnZUJhc2VQYXRoLG4pLGk9YXdhaXQgQXQoYCR7cn0tdGVybXMuYmpzb25gLHtyZXNldDohMH0pLHM9YXdhaXQgQXQoYCR7cn0tZG9jdW1lbnRzLmJqc29uYCx7cmVzZXQ6ITB9KSxvPWF3YWl0IEF0KGAke3J9LWxlbmd0aHMuYmpzb25gLHtyZXNldDohMH0pLGE9bmV3IHhlKGksMTYpLGM9bmV3IHhlKHMsMTYpLGw9bmV3IHhlKG8sMTYpO3JldHVybiBhd2FpdCB0aGlzLnRleHRJbmRleC5jb21wYWN0KHtpbmRleDphLGRvY3VtZW50VGVybXM6Yyxkb2N1bWVudExlbmd0aHM6bH0pLGF3YWl0IE50KHRoaXMuc3RvcmFnZUJhc2VQYXRoLG4sZSx7c3VmZml4ZXM6Q3R9KSxhd2FpdCB0aGlzLl9jbG9zZVN5bmNIYW5kbGVzKCksITB9X2V4dHJhY3RUZXh0KGUpe2NvbnN0IHQ9W107Zm9yKGNvbnN0IG4gb2YgdGhpcy5pbmRleGVkRmllbGRzKXtjb25zdCByPXYoZSxuKTtudWxsIT1yJiZ0LnB1c2goU3RyaW5nKHIpKX1yZXR1cm4gdC5qb2luKCIgIil9YXN5bmMgYWRkKGUpe2lmKCFlLl9pZCl0aHJvdyBuZXcgRXJyb3IoIkRvY3VtZW50IG11c3QgaGF2ZSBhbiBfaWQgZmllbGQiKTtjb25zdCB0PXRoaXMuX2V4dHJhY3RUZXh0KGUpO3QmJmF3YWl0IHRoaXMudGV4dEluZGV4LmFkZChTdHJpbmcoZS5faWQpLHQpfWFzeW5jIHJlbW92ZShlKXtlLl9pZCYmYXdhaXQgdGhpcy50ZXh0SW5kZXgucmVtb3ZlKFN0cmluZyhlLl9pZCkpfXF1ZXJ5KGUpe3JldHVybiBudWxsfWFzeW5jIHNlYXJjaChlLHQ9e30pe3JldHVybiBhd2FpdCB0aGlzLnRleHRJbmRleC5xdWVyeShlLHtzY29yZWQ6ITEsLi4udH0pfWFzeW5jIGNsZWFyKCl7dGhpcy5pc09wZW4mJmF3YWl0IHRoaXMuY2xvc2UoKTtjb25zdCBlPWF3YWl0IEl0KHRoaXMuc3RvcmFnZUJhc2VQYXRoKSx0PWR0KHRoaXMuc3RvcmFnZUJhc2VQYXRoLGUpO2F3YWl0IHRoaXMuX2RlbGV0ZUluZGV4RmlsZXModCksYXdhaXQgdGhpcy5vcGVuKCl9Z2V0U3BlYygpe3JldHVybntuYW1lOnRoaXMubmFtZSxrZXk6dGhpcy5rZXlzLHRleHRJbmRleFZlcnNpb246Myx3ZWlnaHRzOnRoaXMuX2dldFdlaWdodHMoKX19X2dldFdlaWdodHMoKXtjb25zdCBlPXt9O2Zvcihjb25zdCB0IG9mIHRoaXMuaW5kZXhlZEZpZWxkcyllW3RdPTE7cmV0dXJuIGV9fWZ1bmN0aW9uIGp0KGUsdCxuLHIpe2NvbnN0IGk9KG4tZSkqTWF0aC5QSS8xODAscz0oci10KSpNYXRoLlBJLzE4MCxvPU1hdGguc2luKGkvMikqTWF0aC5zaW4oaS8yKStNYXRoLmNvcyhlKk1hdGguUEkvMTgwKSpNYXRoLmNvcyhuKk1hdGguUEkvMTgwKSpNYXRoLnNpbihzLzIpKk1hdGguc2luKHMvMik7cmV0dXJuIDYzNzEqKDIqTWF0aC5hdGFuMihNYXRoLnNxcnQobyksTWF0aC5zcXJ0KDEtbykpKX1mdW5jdGlvbiBEdChlLHQpe3JldHVybiEoZS5tYXhMYXQ8dC5taW5MYXR8fGUubWluTGF0PnQubWF4TGF0fHxlLm1heExuZzx0Lm1pbkxuZ3x8ZS5taW5Mbmc+dC5tYXhMbmcpfWZ1bmN0aW9uIGt0KGUpe3JldHVybihlLm1heExhdC1lLm1pbkxhdCkqKGUubWF4TG5nLWUubWluTG5nKX1mdW5jdGlvbiBQdChlLHQpe3JldHVybnttaW5MYXQ6TWF0aC5taW4oZS5taW5MYXQsdC5taW5MYXQpLG1heExhdDpNYXRoLm1heChlLm1heExhdCx0Lm1heExhdCksbWluTG5nOk1hdGgubWluKGUubWluTG5nLHQubWluTG5nKSxtYXhMbmc6TWF0aC5tYXgoZS5tYXhMbmcsdC5tYXhMbmcpfX1mdW5jdGlvbiBNdChlLHQpe3JldHVybiBrdChQdChlLHQpKS1rdChlKX1jbGFzcyBMdHtjb25zdHJ1Y3RvcihlLHQpe3RoaXMucnRyZWU9ZSx0aGlzLmlkPXQuaWQsdGhpcy5pc0xlYWY9dC5pc0xlYWYsdGhpcy5jaGlsZHJlbj10LmNoaWxkcmVufHxbXSx0aGlzLmJib3g9dC5iYm94fXVwZGF0ZUJCb3goKXtpZigwPT09dGhpcy5jaGlsZHJlbi5sZW5ndGgpcmV0dXJuIHZvaWQodGhpcy5iYm94PW51bGwpO2xldCBlPTEvMCx0PS0xLzAsbj0xLzAscj0tMS8wO2Zvcihjb25zdCBpIG9mIHRoaXMuY2hpbGRyZW4pe2xldCBzO2lmKHRoaXMuaXNMZWFmKXM9aS5iYm94O2Vsc2V7cz10aGlzLnJ0cmVlLl9sb2FkTm9kZShpKS5iYm94fXMmJihlPU1hdGgubWluKGUscy5taW5MYXQpLHQ9TWF0aC5tYXgodCxzLm1heExhdCksbj1NYXRoLm1pbihuLHMubWluTG5nKSxyPU1hdGgubWF4KHIscy5tYXhMbmcpKX10aGlzLmJib3g9e21pbkxhdDplLG1heExhdDp0LG1pbkxuZzpuLG1heExuZzpyfSx0aGlzLnJ0cmVlLl9zYXZlTm9kZSh0aGlzKX10b0pTT04oKXtyZXR1cm57aWQ6dGhpcy5pZCxpc0xlYWY6dGhpcy5pc0xlYWYsY2hpbGRyZW46dGhpcy5jaGlsZHJlbixiYm94OnRoaXMuYmJveH19fWNsYXNzIEJ0e2NvbnN0cnVjdG9yKGUsdD05KXt0aGlzLmZpbGU9bmV3IGIoZSksdGhpcy5tYXhFbnRyaWVzPXQsdGhpcy5taW5FbnRyaWVzPU1hdGgubWF4KDIsTWF0aC5jZWlsKHQvMikpLHRoaXMucm9vdFBvaW50ZXI9bnVsbCx0aGlzLm5leHRJZD0xLHRoaXMuX3NpemU9MCx0aGlzLmlzT3Blbj0hMX1hc3luYyBvcGVuKCl7aWYodGhpcy5pc09wZW4pdGhyb3cgbmV3IEVycm9yKCJSLXRyZWUgaXMgYWxyZWFkeSBvcGVuIik7dGhpcy5maWxlLmdldEZpbGVTaXplKCk+MD90aGlzLl9sb2FkRnJvbUZpbGUoKTp0aGlzLl9pbml0aWFsaXplTmV3VHJlZSgpLHRoaXMuaXNPcGVuPSEwfWFzeW5jIGNsb3NlKCl7dGhpcy5pc09wZW4mJih0aGlzLl93cml0ZU1ldGFkYXRhKCksdGhpcy5maWxlJiZ0aGlzLmZpbGUuc3luY0FjY2Vzc0hhbmRsZSYmKHRoaXMuZmlsZS5mbHVzaCgpLGF3YWl0IHRoaXMuZmlsZS5zeW5jQWNjZXNzSGFuZGxlLmNsb3NlKCkpLHRoaXMuaXNPcGVuPSExKX1faW5pdGlhbGl6ZU5ld1RyZWUoKXtjb25zdCBlPW5ldyBMdCh0aGlzLHtpZDowLGlzTGVhZjohMCxjaGlsZHJlbjpbXSxiYm94Om51bGx9KTt0aGlzLm5leHRJZD0xLHRoaXMuX3NpemU9MCx0aGlzLnJvb3RQb2ludGVyPXRoaXMuX3NhdmVOb2RlKGUpLHRoaXMuX3dyaXRlTWV0YWRhdGEoKX1fd3JpdGVNZXRhZGF0YSgpe2NvbnN0IGU9e3ZlcnNpb246MSxtYXhFbnRyaWVzOnRoaXMubWF4RW50cmllcyxtaW5FbnRyaWVzOnRoaXMubWluRW50cmllcyxzaXplOnRoaXMuX3NpemUscm9vdFBvaW50ZXI6dGhpcy5yb290UG9pbnRlcixuZXh0SWQ6dGhpcy5uZXh0SWR9O3RoaXMuZmlsZS5hcHBlbmQoZSl9X2xvYWRGcm9tRmlsZSgpe2NvbnN0IGU9dGhpcy5maWxlLmdldEZpbGVTaXplKCk7aWYoZTwxMzUpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIFItdHJlZSBmaWxlIGZvcm1hdDogZmlsZSB0b28gc21hbGwgZm9yIG1ldGFkYXRhIik7Y29uc3QgdD1lLTEzNSxuPXRoaXMuZmlsZS5yZWFkKHQpO3RoaXMubWF4RW50cmllcz1uLm1heEVudHJpZXMsdGhpcy5taW5FbnRyaWVzPW4ubWluRW50cmllcyx0aGlzLl9zaXplPW4uc2l6ZSx0aGlzLnJvb3RQb2ludGVyPW4ucm9vdFBvaW50ZXIsdGhpcy5uZXh0SWQ9bi5uZXh0SWR9X3NhdmVOb2RlKGUpe2NvbnN0IHQ9ZS50b0pTT04oKSxuPXRoaXMuZmlsZS5nZXRGaWxlU2l6ZSgpO3JldHVybiB0aGlzLmZpbGUuYXBwZW5kKHQpLG5ldyB5KG4pfV9sb2FkTm9kZShlKXtpZighKGUgaW5zdGFuY2VvZiB5KSl0aHJvdyBuZXcgRXJyb3IoIkV4cGVjdGVkIFBvaW50ZXIgb2JqZWN0Iik7Y29uc3QgdD1lLnZhbHVlT2YoKSxuPXRoaXMuZmlsZS5yZWFkKHQpO3JldHVybiBuZXcgTHQodGhpcyxuKX1fbG9hZFJvb3QoKXtyZXR1cm4gdGhpcy5fbG9hZE5vZGUodGhpcy5yb290UG9pbnRlcil9aW5zZXJ0KGUsdCxuKXtpZighdGhpcy5pc09wZW4pdGhyb3cgbmV3IEVycm9yKCJSLXRyZWUgZmlsZSBtdXN0IGJlIG9wZW5lZCBiZWZvcmUgdXNlIik7aWYoIShuIGluc3RhbmNlb2YgZykpdGhyb3cgbmV3IEVycm9yKCJvYmplY3RJZCBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIE9iamVjdElkIHRvIGluc2VydCBpbnRvIHJ0cmVlIik7Y29uc3Qgcj17YmJveDp7bWluTGF0OmUsbWF4TGF0OmUsbWluTG5nOnQsbWF4TG5nOnR9LGxhdDplLGxuZzp0LG9iamVjdElkOm59LGk9dGhpcy5fbG9hZFJvb3QoKSxzPXRoaXMuX2luc2VydChyLGksMSk7aWYocy5zcGxpdCl7Y29uc3QgZT1uZXcgTHQodGhpcyx7aWQ6dGhpcy5uZXh0SWQrKyxpc0xlYWY6ITEsY2hpbGRyZW46cy5wb2ludGVycyxiYm94Om51bGx9KTtlLnVwZGF0ZUJCb3goKSx0aGlzLnJvb3RQb2ludGVyPXRoaXMuX3NhdmVOb2RlKGUpfWVsc2UgdGhpcy5yb290UG9pbnRlcj1zLnBvaW50ZXI7dGhpcy5fc2l6ZSsrLHRoaXMuX3dyaXRlTWV0YWRhdGEoKX1faW5zZXJ0KGUsdCxuKXtpZih0LmlzTGVhZil7aWYodC5jaGlsZHJlbi5wdXNoKGUpLHQudXBkYXRlQkJveCgpLHQuY2hpbGRyZW4ubGVuZ3RoPnRoaXMubWF4RW50cmllcyl7Y29uc3RbZSxuXT10aGlzLl9zcGxpdCh0KTtyZXR1cm57c3BsaXQ6ITAscG9pbnRlcnM6W2Usbl19fXJldHVybntzcGxpdDohMSxwb2ludGVyOnRoaXMuX3NhdmVOb2RlKHQpfX17Y29uc3Qgcj10aGlzLl9jaG9vc2VTdWJ0cmVlKGUuYmJveCx0KSxpPXRoaXMuX2xvYWROb2RlKHIpLHM9dGhpcy5faW5zZXJ0KGUsaSxuKzEpO2lmKHMuc3BsaXQpe2xldCBlPS0xO2ZvcihsZXQgbj0wO248dC5jaGlsZHJlbi5sZW5ndGg7bisrKWlmKHQuY2hpbGRyZW5bbl0udmFsdWVPZigpPT09ci52YWx1ZU9mKCkpe2U9bjticmVha31pZigtMSE9PWU/KHQuY2hpbGRyZW5bZV09cy5wb2ludGVyc1swXSx0LmNoaWxkcmVuLnB1c2gocy5wb2ludGVyc1sxXSkpOih0LmNoaWxkcmVuLnB1c2gocy5wb2ludGVyc1swXSksdC5jaGlsZHJlbi5wdXNoKHMucG9pbnRlcnNbMV0pKSx0LnVwZGF0ZUJCb3goKSx0LmNoaWxkcmVuLmxlbmd0aD50aGlzLm1heEVudHJpZXMpe2NvbnN0W2Usbl09dGhpcy5fc3BsaXQodCk7cmV0dXJue3NwbGl0OiEwLHBvaW50ZXJzOltlLG5dfX19ZWxzZXtsZXQgZT0tMTtmb3IobGV0IG49MDtuPHQuY2hpbGRyZW4ubGVuZ3RoO24rKylpZih0LmNoaWxkcmVuW25dLnZhbHVlT2YoKT09PXIudmFsdWVPZigpKXtlPW47YnJlYWt9LTEhPT1lJiYodC5jaGlsZHJlbltlXT1zLnBvaW50ZXIpLHQudXBkYXRlQkJveCgpfXJldHVybntzcGxpdDohMSxwb2ludGVyOnRoaXMuX3NhdmVOb2RlKHQpfX19X2Nob29zZVN1YnRyZWUoZSx0KXtsZXQgbj0xLzAscj0xLzAsaT1udWxsO2Zvcihjb25zdCBzIG9mIHQuY2hpbGRyZW4pe2lmKCEocyBpbnN0YW5jZW9mIHkpKXRocm93IG5ldyBFcnJvcigiRXhwZWN0ZWQgUG9pbnRlciBpbiBfY2hvb3NlU3VidHJlZSwgZ290OiAiK3R5cGVvZiBzKTtjb25zdCB0PXRoaXMuX2xvYWROb2RlKHMpLG89TXQodC5iYm94LGUpLGE9a3QodC5iYm94KTsobzxufHxvPT09biYmYTxyKSYmKG49byxyPWEsaT1zKX1yZXR1cm4gaX1fc3BsaXQoZSl7Y29uc3QgdD1lLmNoaWxkcmVuLG49ZS5pc0xlYWY7bGV0IHI9LTEvMCxpPTAscz0xO2ZvcihsZXQgYz0wO2M8dC5sZW5ndGg7YysrKWZvcihsZXQgZT1jKzE7ZTx0Lmxlbmd0aDtlKyspe2xldCBvLGE7aWYobilvPXRbY10uYmJveCxhPXRbZV0uYmJveDtlbHNle2NvbnN0IG49dGhpcy5fbG9hZE5vZGUodFtjXSkscj10aGlzLl9sb2FkTm9kZSh0W2VdKTtvPW4uYmJveCxhPXIuYmJveH1jb25zdCBsPWt0KFB0KG8sYSkpO2w+ciYmKHI9bCxpPWMscz1lKX1jb25zdCBvPW5ldyBMdCh0aGlzLHtpZDp0aGlzLm5leHRJZCsrLGlzTGVhZjpuLGNoaWxkcmVuOlt0W2ldXSxiYm94Om51bGx9KSxhPW5ldyBMdCh0aGlzLHtpZDp0aGlzLm5leHRJZCsrLGlzTGVhZjpuLGNoaWxkcmVuOlt0W3NdXSxiYm94Om51bGx9KTtmb3IobGV0IGM9MDtjPHQubGVuZ3RoO2MrKyl7aWYoYz09PWl8fGM9PT1zKWNvbnRpbnVlO2NvbnN0IGU9dFtjXTtsZXQgcjtpZihuKXI9ZS5iYm94O2Vsc2V7cj10aGlzLl9sb2FkTm9kZShlKS5iYm94fW8udXBkYXRlQkJveCgpLGEudXBkYXRlQkJveCgpO2NvbnN0IGw9by5iYm94P010KG8uYmJveCxyKTowLHU9YS5iYm94P010KGEuYmJveCxyKTowO2w8dT9vLmNoaWxkcmVuLnB1c2goZSk6dTxsP2EuY2hpbGRyZW4ucHVzaChlKTpvLmNoaWxkcmVuLmxlbmd0aDw9YS5jaGlsZHJlbi5sZW5ndGg/by5jaGlsZHJlbi5wdXNoKGUpOmEuY2hpbGRyZW4ucHVzaChlKX1vLnVwZGF0ZUJCb3goKSxhLnVwZGF0ZUJCb3goKTtyZXR1cm5bdGhpcy5fc2F2ZU5vZGUobyksdGhpcy5fc2F2ZU5vZGUoYSldfXNlYXJjaEJCb3goZSl7aWYoIXRoaXMuaXNPcGVuKXRocm93IG5ldyBFcnJvcigiUi10cmVlIGZpbGUgbXVzdCBiZSBvcGVuZWQgYmVmb3JlIHVzZSIpO2NvbnN0IHQ9W10sbj10aGlzLl9sb2FkUm9vdCgpO3JldHVybiB0aGlzLl9zZWFyY2hCQm94KGUsbix0KSx0fV9zZWFyY2hCQm94KGUsdCxuKXtpZih0LmJib3gmJkR0KGUsdC5iYm94KSlpZih0LmlzTGVhZilmb3IoY29uc3QgciBvZiB0LmNoaWxkcmVuKUR0KGUsci5iYm94KSYmbi5wdXNoKHtvYmplY3RJZDpyLm9iamVjdElkLGxhdDpyLmxhdCxsbmc6ci5sbmd9KTtlbHNlIGZvcihjb25zdCByIG9mIHQuY2hpbGRyZW4pe2NvbnN0IHQ9dGhpcy5fbG9hZE5vZGUocik7dGhpcy5fc2VhcmNoQkJveChlLHQsbil9fXNlYXJjaFJhZGl1cyhlLHQsbil7Y29uc3Qgcj1mdW5jdGlvbihlLHQsbil7Y29uc3Qgcj1uLzExMSxpPW4vKDExMSpNYXRoLmNvcyhlKk1hdGguUEkvMTgwKSk7cmV0dXJue21pbkxhdDplLXIsbWF4TGF0OmUrcixtaW5Mbmc6dC1pLG1heExuZzp0K2l9fShlLHQsbiksaT10aGlzLl9sb2FkUm9vdCgpLHM9W107dGhpcy5fc2VhcmNoQkJveEVudHJpZXMocixpLHMpO2NvbnN0IG89W107Zm9yKGNvbnN0IGEgb2Ygcyl7Y29uc3Qgcj1qdChlLHQsYS5sYXQsYS5sbmcpO3I8PW4mJm8ucHVzaCh7b2JqZWN0SWQ6YS5vYmplY3RJZCxsYXQ6YS5sYXQsbG5nOmEubG5nLGRpc3RhbmNlOnJ9KX1yZXR1cm4gb31fc2VhcmNoQkJveEVudHJpZXMoZSx0LG4pe2lmKHQuYmJveCYmRHQoZSx0LmJib3gpKWlmKHQuaXNMZWFmKWZvcihjb25zdCByIG9mIHQuY2hpbGRyZW4pRHQoZSxyLmJib3gpJiZuLnB1c2gocik7ZWxzZSBmb3IoY29uc3QgciBvZiB0LmNoaWxkcmVuKXtjb25zdCB0PXRoaXMuX2xvYWROb2RlKHIpO3RoaXMuX3NlYXJjaEJCb3hFbnRyaWVzKGUsdCxuKX19cmVtb3ZlKGUpe2lmKCF0aGlzLmlzT3Blbil0aHJvdyBuZXcgRXJyb3IoIlItdHJlZSBmaWxlIG11c3QgYmUgb3BlbmVkIGJlZm9yZSB1c2UiKTtpZighKGUgaW5zdGFuY2VvZiBnKSl0aHJvdyBuZXcgRXJyb3IoIm9iamVjdElkIG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgT2JqZWN0SWQgdG8gcmVtb3ZlIGZyb20gcnRyZWUiKTtjb25zdCB0PXRoaXMuX2xvYWRSb290KCksbj10aGlzLl9yZW1vdmUoZSx0KTtpZighbi5mb3VuZClyZXR1cm4hMTtpZihuLnVuZGVyZmxvdyYmbi5jaGlsZHJlbilpZigwPT09bi5jaGlsZHJlbi5sZW5ndGgpe2NvbnN0IGU9bmV3IEx0KHRoaXMse2lkOnRoaXMubmV4dElkKyssaXNMZWFmOiEwLGNoaWxkcmVuOltdLGJib3g6bnVsbH0pO3RoaXMucm9vdFBvaW50ZXI9dGhpcy5fc2F2ZU5vZGUoZSl9ZWxzZSBpZigxIT09bi5jaGlsZHJlbi5sZW5ndGh8fG4uaXNMZWFmKXtjb25zdCBlPW5ldyBMdCh0aGlzLHtpZDp0LmlkLGlzTGVhZjpuLmlzTGVhZixjaGlsZHJlbjpuLmNoaWxkcmVuLGJib3g6bnVsbH0pO2UudXBkYXRlQkJveCgpLHRoaXMucm9vdFBvaW50ZXI9dGhpcy5fc2F2ZU5vZGUoZSl9ZWxzZSB0aGlzLnJvb3RQb2ludGVyPW4uY2hpbGRyZW5bMF07ZWxzZSBuLnBvaW50ZXImJih0aGlzLnJvb3RQb2ludGVyPW4ucG9pbnRlcik7cmV0dXJuIHRoaXMuX3NpemUtLSx0aGlzLl93cml0ZU1ldGFkYXRhKCksITB9X3JlbW92ZShlLHQpe2lmKHQuaXNMZWFmKXtjb25zdCBuPXQuY2hpbGRyZW4ubGVuZ3RoO2lmKHQuY2hpbGRyZW49dC5jaGlsZHJlbi5maWx0ZXIodD0+IXQub2JqZWN0SWQuZXF1YWxzKGUpKSx0LmNoaWxkcmVuLmxlbmd0aD09PW4pcmV0dXJue2ZvdW5kOiExfTt0LnVwZGF0ZUJCb3goKTtjb25zdCByPXRoaXMuX3NhdmVOb2RlKHQpO3JldHVybntmb3VuZDohMCx1bmRlcmZsb3c6dC5jaGlsZHJlbi5sZW5ndGg8dGhpcy5taW5FbnRyaWVzJiZ0LmNoaWxkcmVuLmxlbmd0aD4wLHBvaW50ZXI6cixjaGlsZHJlbjp0LmNoaWxkcmVuLGlzTGVhZjohMH19e2xldCBuPVsuLi50LmNoaWxkcmVuXTtmb3IobGV0IHI9MDtyPG4ubGVuZ3RoO3IrKyl7Y29uc3QgaT1uW3JdLHM9dGhpcy5fbG9hZE5vZGUoaSksbz10aGlzLl9yZW1vdmUoZSxzKTtpZihvLmZvdW5kKXtpZihvLnVuZGVyZmxvdyl7Y29uc3QgZT10aGlzLl9oYW5kbGVVbmRlcmZsb3codCxyLHMsbyk7ZS5tZXJnZWQ/bj1lLmNoaWxkcmVuOm5bcl09by5wb2ludGVyfWVsc2UgbltyXT1vLnBvaW50ZXI7Y29uc3QgZT1uZXcgTHQodGhpcyx7aWQ6dC5pZCxpc0xlYWY6ITEsY2hpbGRyZW46bixiYm94Om51bGx9KTtlLnVwZGF0ZUJCb3goKTtjb25zdCBpPXRoaXMuX3NhdmVOb2RlKGUpO3JldHVybntmb3VuZDohMCx1bmRlcmZsb3c6bi5sZW5ndGg8dGhpcy5taW5FbnRyaWVzJiZuLmxlbmd0aD4wLHBvaW50ZXI6aSxjaGlsZHJlbjpuLGlzTGVhZjohMX19fXJldHVybntmb3VuZDohMX19fV9oYW5kbGVVbmRlcmZsb3coZSx0LG4scil7Y29uc3QgaT1bXTtpZih0PjApe2NvbnN0IG49ZS5jaGlsZHJlblt0LTFdLHI9dGhpcy5fbG9hZE5vZGUobik7aS5wdXNoKHtpbmRleDp0LTEsbm9kZTpyLHBvaW50ZXI6bn0pfWlmKHQ8ZS5jaGlsZHJlbi5sZW5ndGgtMSl7Y29uc3Qgbj1lLmNoaWxkcmVuW3QrMV0scj10aGlzLl9sb2FkTm9kZShuKTtpLnB1c2goe2luZGV4OnQrMSxub2RlOnIscG9pbnRlcjpufSl9Zm9yKGNvbnN0IHMgb2YgaSlpZihzLm5vZGUuY2hpbGRyZW4ubGVuZ3RoPnRoaXMubWluRW50cmllcyl7Y29uc3QgaT1bLi4uci5jaGlsZHJlbiwuLi5zLm5vZGUuY2hpbGRyZW5dLG89TWF0aC5jZWlsKGkubGVuZ3RoLzIpLGE9aS5zbGljZSgwLG8pLGM9aS5zbGljZShvKSxsPW5ldyBMdCh0aGlzLHtpZDpuLmlkLGlzTGVhZjpyLmlzTGVhZixjaGlsZHJlbjphLGJib3g6bnVsbH0pO2wudXBkYXRlQkJveCgpO2NvbnN0IHU9bmV3IEx0KHRoaXMse2lkOnMubm9kZS5pZCxpc0xlYWY6cy5ub2RlLmlzTGVhZixjaGlsZHJlbjpjLGJib3g6bnVsbH0pO3UudXBkYXRlQkJveCgpO2NvbnN0IGg9dGhpcy5fc2F2ZU5vZGUobCksZj10aGlzLl9zYXZlTm9kZSh1KSxkPVsuLi5lLmNoaWxkcmVuXSxwPU1hdGgubWluKHQscy5pbmRleCksZz1NYXRoLm1heCh0LHMuaW5kZXgpO3JldHVybiBkW3BdPWgsZFtnXT1mLHttZXJnZWQ6ITAsY2hpbGRyZW46ZH19aWYoaS5sZW5ndGg+MCl7Y29uc3Qgbj1pWzBdLHM9Wy4uLnIuY2hpbGRyZW4sLi4ubi5ub2RlLmNoaWxkcmVuXSxvPW5ldyBMdCh0aGlzLHtpZDp0aGlzLm5leHRJZCsrLGlzTGVhZjpyLmlzTGVhZixjaGlsZHJlbjpzLGJib3g6bnVsbH0pO28udXBkYXRlQkJveCgpO2NvbnN0IGE9dGhpcy5fc2F2ZU5vZGUobyksYz1lLmNoaWxkcmVuLmZpbHRlcigoZSxyKT0+ciE9PXQmJnIhPT1uLmluZGV4KTtyZXR1cm4gYy5wdXNoKGEpLHttZXJnZWQ6ITAsY2hpbGRyZW46Y319cmV0dXJue21lcmdlZDohMX19c2l6ZSgpe3JldHVybiB0aGlzLl9zaXplfWFzeW5jIGNsZWFyKCl7Y29uc3QgZT1uZXcgTHQodGhpcyx7aWQ6dGhpcy5uZXh0SWQrKyxpc0xlYWY6ITAsY2hpbGRyZW46W10sYmJveDpudWxsfSk7dGhpcy5yb290UG9pbnRlcj10aGlzLl9zYXZlTm9kZShlKSx0aGlzLl9zaXplPTAsdGhpcy5fd3JpdGVNZXRhZGF0YSgpfWFzeW5jIGNvbXBhY3QoZSl7aWYoIXRoaXMuaXNPcGVuKXRocm93IG5ldyBFcnJvcigiUi10cmVlIGZpbGUgbXVzdCBiZSBvcGVuZWQgYmVmb3JlIHVzZSIpO2lmKCFlKXRocm93IG5ldyBFcnJvcigiRGVzdGluYXRpb24gc3luYyBoYW5kbGUgaXMgcmVxdWlyZWQgZm9yIGNvbXBhY3Rpb24iKTt0aGlzLl93cml0ZU1ldGFkYXRhKCk7Y29uc3QgdD10aGlzLmZpbGUuZ2V0RmlsZVNpemUoKSxuPW5ldyBCdChlLHRoaXMubWF4RW50cmllcyk7YXdhaXQgbi5vcGVuKCksbi5taW5FbnRyaWVzPXRoaXMubWluRW50cmllcyxuLm5leHRJZD10aGlzLm5leHRJZCxuLl9zaXplPXRoaXMuX3NpemU7Y29uc3Qgcj0vKiBAX19QVVJFX18gKi9uZXcgTWFwLGk9ZT0+e2NvbnN0IHQ9ZS52YWx1ZU9mKCk7aWYoci5oYXModCkpcmV0dXJuIHIuZ2V0KHQpO2NvbnN0IHM9dGhpcy5fbG9hZE5vZGUoZSksbz1bXTtpZihzLmlzTGVhZilmb3IoY29uc3QgbiBvZiBzLmNoaWxkcmVuKW8ucHVzaChuKTtlbHNlIGZvcihjb25zdCBuIG9mIHMuY2hpbGRyZW4pe2NvbnN0IGU9aShuKTtvLnB1c2goZSl9Y29uc3QgYT1uZXcgTHQobix7aWQ6cy5pZCxpc0xlYWY6cy5pc0xlYWYsY2hpbGRyZW46byxiYm94OnMuYmJveH0pLGM9bi5fc2F2ZU5vZGUoYSk7cmV0dXJuIHIuc2V0KHQsYyksY30scz1pKHRoaXMucm9vdFBvaW50ZXIpO24ucm9vdFBvaW50ZXI9cyxuLl93cml0ZU1ldGFkYXRhKCk7Y29uc3Qgbz1uLmZpbGUuZ2V0RmlsZVNpemUoKTtyZXR1cm4gYXdhaXQgbi5jbG9zZSgpLHtvbGRTaXplOnQsbmV3U2l6ZTpvLGJ5dGVzU2F2ZWQ6TWF0aC5tYXgoMCx0LW8pfX19Y2xhc3MgRnQgZXh0ZW5kcyB1dHtjb25zdHJ1Y3RvcihlLHQsbixyPXt9KXtzdXBlcihlLHQsbixyKSx0aGlzLmdlb0ZpZWxkPU9iamVjdC5rZXlzKHQpWzBdLHRoaXMuc3RvcmFnZUZpbGVQYXRoPW4sdGhpcy5ydHJlZT1udWxsLHRoaXMuc3luY0hhbmRsZT1udWxsLHRoaXMuaXNPcGVuPSExfWFzeW5jIG9wZW4oKXtpZighdGhpcy5pc09wZW4pdHJ5e2NvbnN0IGU9dGhpcy5zdG9yYWdlRmlsZVBhdGguc3BsaXQoIi8iKS5maWx0ZXIoQm9vbGVhbiksdD1lLnBvcCgpO2lmKCF0KXRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzdG9yYWdlIHBhdGg6ICR7dGhpcy5zdG9yYWdlRmlsZVBhdGh9YCk7bGV0IG49YXdhaXQgZ2xvYmFsVGhpcy5uYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkoKTtmb3IoY29uc3QgaSBvZiBlKW49YXdhaXQgbi5nZXREaXJlY3RvcnlIYW5kbGUoaSx7Y3JlYXRlOiEwfSk7Y29uc3Qgcj1hd2FpdCBuLmdldEZpbGVIYW5kbGUodCx7Y3JlYXRlOiEwfSk7dGhpcy5zeW5jSGFuZGxlPWF3YWl0IHIuY3JlYXRlU3luY0FjY2Vzc0hhbmRsZSgpLHRoaXMucnRyZWU9bmV3IEJ0KHRoaXMuc3luY0hhbmRsZSw5KSxhd2FpdCB0aGlzLnJ0cmVlLm9wZW4oKSx0aGlzLmlzT3Blbj0hMH1jYXRjaChlKXtpZighKCJFTk9FTlQiPT09ZS5jb2RlfHxlLm1lc3NhZ2UmJihlLm1lc3NhZ2UuaW5jbHVkZXMoIkludmFsaWQgUi10cmVlIil8fGUubWVzc2FnZS5pbmNsdWRlcygiZmlsZSB0b28gc21hbGwiKXx8ZS5tZXNzYWdlLmluY2x1ZGVzKCJGYWlsZWQgdG8gcmVhZCBtZXRhZGF0YSIpfHxlLm1lc3NhZ2UuaW5jbHVkZXMoIlVua25vd24gdHlwZSBieXRlIikpKSl0aHJvdyBlO3tpZih0aGlzLnN5bmNIYW5kbGUpe3RyeXthd2FpdCB0aGlzLnN5bmNIYW5kbGUuY2xvc2UoKX1jYXRjaCh0KXt9dGhpcy5zeW5jSGFuZGxlPW51bGx9Y29uc3QgZT10aGlzLnN0b3JhZ2VGaWxlUGF0aC5zcGxpdCgiLyIpLmZpbHRlcihCb29sZWFuKSxuPWUucG9wKCk7aWYoIW4pdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHN0b3JhZ2UgcGF0aDogJHt0aGlzLnN0b3JhZ2VGaWxlUGF0aH1gKTtsZXQgcj1hd2FpdCBnbG9iYWxUaGlzLm5hdmlnYXRvci5zdG9yYWdlLmdldERpcmVjdG9yeSgpO2Zvcihjb25zdCB0IG9mIGUpcj1hd2FpdCByLmdldERpcmVjdG9yeUhhbmRsZSh0LHtjcmVhdGU6ITB9KTt0cnl7YXdhaXQgci5yZW1vdmVFbnRyeShuKX1jYXRjaCh0KXt9Y29uc3QgaT1hd2FpdCByLmdldEZpbGVIYW5kbGUobix7Y3JlYXRlOiEwfSk7dGhpcy5zeW5jSGFuZGxlPWF3YWl0IGkuY3JlYXRlU3luY0FjY2Vzc0hhbmRsZSgpLHRoaXMucnRyZWU9bmV3IEJ0KHRoaXMuc3luY0hhbmRsZSw5KSxhd2FpdCB0aGlzLnJ0cmVlLm9wZW4oKSx0aGlzLmlzT3Blbj0hMH19fWFzeW5jIGNsb3NlKCl7aWYodGhpcy5pc09wZW4pe3RyeXthd2FpdCB0aGlzLnJ0cmVlLmNsb3NlKCl9Y2F0Y2goZSl7aWYoIWUubWVzc2FnZXx8IWUubWVzc2FnZS5pbmNsdWRlcygiRmlsZSBpcyBub3Qgb3BlbiIpKXRocm93IGV9dGhpcy5pc09wZW49ITF9fV9leHRyYWN0Q29vcmRpbmF0ZXMoZSl7aWYoIWUpcmV0dXJuIG51bGw7aWYoIkZlYXR1cmVDb2xsZWN0aW9uIj09PWUudHlwZSYmZS5mZWF0dXJlcyYmZS5mZWF0dXJlcy5sZW5ndGg+MCl7Y29uc3QgdD1lLmZlYXR1cmVzWzBdO2lmKHQuZ2VvbWV0cnkpcmV0dXJuIHRoaXMuX2V4dHJhY3RDb29yZGluYXRlcyh0Lmdlb21ldHJ5KX1pZigiRmVhdHVyZSI9PT1lLnR5cGUmJmUuZ2VvbWV0cnkpcmV0dXJuIHRoaXMuX2V4dHJhY3RDb29yZGluYXRlcyhlLmdlb21ldHJ5KTtpZigiUG9pbnQiPT09ZS50eXBlJiZlLmNvb3JkaW5hdGVzKXtjb25zdFt0LG5dPWUuY29vcmRpbmF0ZXM7aWYoIm51bWJlciI9PXR5cGVvZiB0JiYibnVtYmVyIj09dHlwZW9mIG4pcmV0dXJue2xhdDpuLGxuZzp0fX1pZigiUG9seWdvbiI9PT1lLnR5cGUmJmUuY29vcmRpbmF0ZXMmJmUuY29vcmRpbmF0ZXMubGVuZ3RoPjApe2NvbnN0IHQ9ZS5jb29yZGluYXRlc1swXTtpZih0Lmxlbmd0aD4wKXtsZXQgZT0wLG49MDtmb3IoY29uc3QgciBvZiB0KW4rPXJbMF0sZSs9clsxXTtyZXR1cm57bGF0OmUvdC5sZW5ndGgsbG5nOm4vdC5sZW5ndGh9fX1yZXR1cm4gbnVsbH1hc3luYyBhZGQoZSl7aWYoIWUuX2lkKXRocm93IG5ldyBFcnJvcigiRG9jdW1lbnQgbXVzdCBoYXZlIGFuIF9pZCBmaWVsZCIpO2NvbnN0IHQ9dihlLHRoaXMuZ2VvRmllbGQpLG49dGhpcy5fZXh0cmFjdENvb3JkaW5hdGVzKHQpO24mJmF3YWl0IHRoaXMucnRyZWUuaW5zZXJ0KG4ubGF0LG4ubG5nLGUuX2lkKX1hc3luYyByZW1vdmUoZSl7aWYoZS5faWQpe2lmKCEoZS5faWQgaW5zdGFuY2VvZiBnKSl0aHJvdyBjb25zb2xlLmVycm9yKGUpLG5ldyBFcnJvcigiRG9jdW1lbnQgX2lkIG11c3QgYmUgYW4gT2JqZWN0SWQgdG8gcmVtb3ZlIGZyb20gZ2Vvc3BhdGlhbCBpbmRleCIpO2F3YWl0IHRoaXMucnRyZWUucmVtb3ZlKGUuX2lkKX19YXN5bmMgcXVlcnkoZSl7aWYodGhpcy5pc09wZW58fGF3YWl0IHRoaXMub3BlbigpLCFlW3RoaXMuZ2VvRmllbGRdKXJldHVybiBudWxsO2NvbnN0IHQ9ZVt0aGlzLmdlb0ZpZWxkXTtpZih0LiRnZW9XaXRoaW4pe2NvbnN0IGU9dC4kZ2VvV2l0aGluO2lmKEFycmF5LmlzQXJyYXkoZSkmJjI9PT1lLmxlbmd0aCl7Y29uc3QgdD1lWzBdWzBdLG49ZVswXVsxXSxyPWVbMV1bMF0saT1lWzFdWzFdO3JldHVybihhd2FpdCB0aGlzLnJ0cmVlLnNlYXJjaEJCb3goe21pbkxhdDppLG1heExhdDpuLG1pbkxuZzp0LG1heExuZzpyfSkpLm1hcChlPT5lLm9iamVjdElkLnRvU3RyaW5nKCkpfX1pZih0LiRuZWFyKXtjb25zdCBlPXQuJG5lYXI7bGV0IG47aWYoZS4kZ2VvbWV0cnkpbj1lLiRnZW9tZXRyeS5jb29yZGluYXRlcztlbHNlIGlmKGUuY29vcmRpbmF0ZXMpbj1lLmNvb3JkaW5hdGVzO2Vsc2V7aWYoIUFycmF5LmlzQXJyYXkoZSkpcmV0dXJuIG51bGw7bj1lfWlmKCFufHxuLmxlbmd0aDwyKXJldHVybiBudWxsO2NvbnN0W3IsaV09bixzPShlLiRtYXhEaXN0YW5jZXx8MWU2KS8xZTMsbz1hd2FpdCB0aGlzLnJ0cmVlLnNlYXJjaFJhZGl1cyhpLHIscyk7cmV0dXJuIG8uc29ydCgoZSx0KT0+ZS5kaXN0YW5jZS10LmRpc3RhbmNlKSxvLm1hcChlPT5lLm9iamVjdElkLnRvU3RyaW5nKCkpfWlmKHQuJG5lYXJTcGhlcmUpe2NvbnN0IGU9dC4kbmVhclNwaGVyZTtsZXQgbjtpZihlLiRnZW9tZXRyeSluPWUuJGdlb21ldHJ5LmNvb3JkaW5hdGVzO2Vsc2UgaWYoZS5jb29yZGluYXRlcyluPWUuY29vcmRpbmF0ZXM7ZWxzZXtpZighQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gbnVsbDtuPWV9aWYoIW58fG4ubGVuZ3RoPDIpcmV0dXJuIG51bGw7Y29uc3RbcixpXT1uLHM9KGUuJG1heERpc3RhbmNlfHwxZTYpLzFlMyxvPWF3YWl0IHRoaXMucnRyZWUuc2VhcmNoUmFkaXVzKGkscixzKTtyZXR1cm4gby5zb3J0KChlLHQpPT5lLmRpc3RhbmNlLXQuZGlzdGFuY2UpLG8ubWFwKGU9PmUub2JqZWN0SWQudG9TdHJpbmcoKSl9aWYodC4kZ2VvSW50ZXJzZWN0cyl7Y29uc3QgZT10LiRnZW9JbnRlcnNlY3RzO2xldCBuO2lmKCFlLiRnZW9tZXRyeSlyZXR1cm4gbnVsbDtpZihuPWUuJGdlb21ldHJ5LCFufHwhbi50eXBlKXJldHVybiBudWxsO2lmKCJQb2ludCI9PT1uLnR5cGUpe2NvbnN0W2UsdF09bi5jb29yZGluYXRlcyxyPTFlLTQ7cmV0dXJuKGF3YWl0IHRoaXMucnRyZWUuc2VhcmNoQkJveCh7bWluTGF0OnQtcixtYXhMYXQ6dCtyLG1pbkxuZzplLXIsbWF4TG5nOmUrcn0pKS5tYXAoZT0+ZS5vYmplY3RJZC50b1N0cmluZygpKX1pZigiUG9seWdvbiI9PT1uLnR5cGUpe2NvbnN0IGU9bi5jb29yZGluYXRlcztpZighZXx8MD09PWUubGVuZ3RoKXJldHVybiBudWxsO2NvbnN0IHQ9ZVswXTtpZighdHx8dC5sZW5ndGg8MylyZXR1cm4gbnVsbDtsZXQgcj0xLzAsaT0tMS8wLHM9MS8wLG89LTEvMDtmb3IoY29uc3QgbiBvZiB0KXtjb25zdFtlLHRdPW47cj1NYXRoLm1pbihyLHQpLGk9TWF0aC5tYXgoaSx0KSxzPU1hdGgubWluKHMsZSksbz1NYXRoLm1heChvLGUpfXJldHVybihhd2FpdCB0aGlzLnJ0cmVlLnNlYXJjaEJCb3goe21pbkxhdDpyLG1heExhdDppLG1pbkxuZzpzLG1heExuZzpvfSkpLmZpbHRlcihlPT50aGlzLl9wb2ludEluUG9seWdvbihlLmxhdCxlLmxuZyx0KSkubWFwKGU9PmUub2JqZWN0SWQudG9TdHJpbmcoKSl9cmV0dXJuIG51bGx9cmV0dXJuIG51bGx9X3BvaW50SW5Qb2x5Z29uKGUsdCxuKXtsZXQgcj0hMTtmb3IobGV0IGk9MCxzPW4ubGVuZ3RoLTE7aTxuLmxlbmd0aDtzPWkrKyl7Y29uc3RbbyxhXT1uW2ldLFtjLGxdPW5bc107YT5lIT1sPmUmJnQ8KGMtbykqKGUtYSkvKGwtYSkrbyYmKHI9IXIpfXJldHVybiByfWFzeW5jIGNsZWFyKCl7YXdhaXQgdGhpcy5jbG9zZSgpO3RyeXtjb25zdCBlPXRoaXMuc3RvcmFnZUZpbGVQYXRoLnNwbGl0KCIvIikuZmlsdGVyKEJvb2xlYW4pLHQ9ZS5wb3AoKTtsZXQgbj1hd2FpdCBnbG9iYWxUaGlzLm5hdmlnYXRvci5zdG9yYWdlLmdldERpcmVjdG9yeSgpO2Zvcihjb25zdCByIG9mIGUpbj1hd2FpdCBuLmdldERpcmVjdG9yeUhhbmRsZShyLHtjcmVhdGU6ITF9KTthd2FpdCBuLnJlbW92ZUVudHJ5KHQpfWNhdGNoKGUpe2lmKCFlfHwiTm90Rm91bmRFcnJvciIhPT1lLm5hbWUpdGhyb3cgZX1hd2FpdCB0aGlzLm9wZW4oKX1nZXRTcGVjKCl7cmV0dXJue25hbWU6dGhpcy5uYW1lLGtleTp0aGlzLmtleXMsIjJkc3BoZXJlSW5kZXhWZXJzaW9uIjozfX19Y2xhc3MgVHR7Y29uc3RydWN0b3IoKXt0aGlzLnR5cGU9ImZ1bGxfc2NhbiIsdGhpcy5pbmRleGVzPVtdLHRoaXMuaW5kZXhTY2Fucz1bXSx0aGlzLmVzdGltYXRlZENvc3Q9MS8wLHRoaXMuaW5kZXhPbmx5PSExfX1jbGFzcyB6dHtjb25zdHJ1Y3RvcihlKXt0aGlzLmluZGV4ZXM9ZX1wbGFuKGUpe2NvbnN0IHQ9bmV3IFR0O2lmKCFlfHwwPT09T2JqZWN0LmtleXMoZSkubGVuZ3RoKXJldHVybiB0O2NvbnN0IG49dGhpcy5fYW5hbHl6ZVF1ZXJ5KGUpO2lmKG4uaGFzVGV4dFNlYXJjaCl7Y29uc3QgdD10aGlzLl9wbGFuVGV4dFNlYXJjaChlLG4pO2lmKHQpcmV0dXJuIHR9aWYobi5oYXNHZW9RdWVyeSl7Y29uc3QgdD10aGlzLl9wbGFuR2VvUXVlcnkoZSxuKTtpZih0KXJldHVybiB0fWlmKCJhbmQiPT09bi50eXBlKXtjb25zdCB0PXRoaXMuX3BsYW5BbmRRdWVyeShlLG4pO2lmKCJmdWxsX3NjYW4iIT09dC50eXBlKXJldHVybiB0fWlmKCJvciI9PT1uLnR5cGUpe2NvbnN0IHQ9dGhpcy5fcGxhbk9yUXVlcnkoZSxuKTtpZigiZnVsbF9zY2FuIiE9PXQudHlwZSlyZXR1cm4gdH1jb25zdCByPXRoaXMuX3BsYW5TaW1wbGVRdWVyeShlKTtyZXR1cm4iZnVsbF9zY2FuIiE9PXIudHlwZT9yOnR9X2FuYWx5emVRdWVyeShlKXtjb25zdCB0PXt0eXBlOiJzaW1wbGUiLGZpZWxkczpbXSxvcGVyYXRvcnM6e30saGFzVGV4dFNlYXJjaDohMSxoYXNHZW9RdWVyeTohMSxjb25kaXRpb25zOltdfSxuPU9iamVjdC5rZXlzKGUpO2lmKDE9PT1uLmxlbmd0aCl7Y29uc3Qgcj1uWzBdO2lmKCIkYW5kIj09PXIpe3QudHlwZT0iYW5kIix0LmNvbmRpdGlvbnM9ZS4kYW5kO2Zvcihjb25zdCBlIG9mIHQuY29uZGl0aW9ucyl7Y29uc3Qgbj10aGlzLl9hbmFseXplUXVlcnkoZSk7dC5maWVsZHMucHVzaCguLi5uLmZpZWxkcyksbi5oYXNUZXh0U2VhcmNoJiYodC5oYXNUZXh0U2VhcmNoPSEwKSxuLmhhc0dlb1F1ZXJ5JiYodC5oYXNHZW9RdWVyeT0hMCl9cmV0dXJuIHR9aWYoIiRvciI9PT1yKXt0LnR5cGU9Im9yIix0LmNvbmRpdGlvbnM9ZS4kb3I7Zm9yKGNvbnN0IGUgb2YgdC5jb25kaXRpb25zKXtjb25zdCBuPXRoaXMuX2FuYWx5emVRdWVyeShlKTt0LmZpZWxkcy5wdXNoKC4uLm4uZmllbGRzKSxuLmhhc1RleHRTZWFyY2gmJih0Lmhhc1RleHRTZWFyY2g9ITApLG4uaGFzR2VvUXVlcnkmJih0Lmhhc0dlb1F1ZXJ5PSEwKX1yZXR1cm4gdH19Zm9yKGNvbnN0IHIgb2Ygbil7aWYoci5zdGFydHNXaXRoKCIkIikpY29udGludWU7dC5maWVsZHMucHVzaChyKTtjb25zdCBuPWVbcl07aWYoIm9iamVjdCI9PXR5cGVvZiBuJiZudWxsIT09biYmIUFycmF5LmlzQXJyYXkobikpe2NvbnN0IGU9T2JqZWN0LmtleXMobik7dC5vcGVyYXRvcnNbcl09ZSxlLmluY2x1ZGVzKCIkdGV4dCIpJiYodC5oYXNUZXh0U2VhcmNoPSEwKSxlLnNvbWUoZT0+WyIkZ2VvV2l0aGluIiwiJGdlb0ludGVyc2VjdHMiLCIkbmVhciIsIiRuZWFyU3BoZXJlIl0uaW5jbHVkZXMoZSkpJiYodC5oYXNHZW9RdWVyeT0hMCl9fXJldHVybiBuLmxlbmd0aD4xJiYodC50eXBlPSJhbmQiKSx0fV9wbGFuVGV4dFNlYXJjaChlLHQpe2Zvcihjb25zdFtuLHJdb2YgdGhpcy5pbmRleGVzKWlmKHIgaW5zdGFuY2VvZiBFdCl7Y29uc3QgdD10aGlzLl9leHRyYWN0VGV4dFF1ZXJ5KGUpO2lmKHQpe2NvbnN0IGU9bmV3IFR0O3JldHVybiBlLnR5cGU9ImluZGV4X3NjYW4iLGUuaW5kZXhlcz1bbl0sZS5pbmRleFNjYW5zPVt7aW5kZXhOYW1lOm4saW5kZXg6cix0ZXh0UXVlcnk6dH1dLGUuZXN0aW1hdGVkQ29zdD0xMDAsZS5pbmRleE9ubHk9ITAsZX19cmV0dXJuIG51bGx9X2V4dHJhY3RUZXh0UXVlcnkoZSl7Zm9yKGNvbnN0IHQgaW4gZSl7Y29uc3Qgbj1lW3RdO2lmKCJvYmplY3QiPT10eXBlb2YgbiYmbnVsbCE9PW4mJm4uJHRleHQpcmV0dXJuInN0cmluZyI9PXR5cGVvZiBuLiR0ZXh0P24uJHRleHQ6bi4kdGV4dC4kc2VhcmNofXJldHVybiBudWxsfV9wbGFuR2VvUXVlcnkoZSx0KXtmb3IoY29uc3RbbixyXW9mIHRoaXMuaW5kZXhlcylpZihyIGluc3RhbmNlb2YgRnQpe2NvbnN0IHQ9bmV3IFR0O3JldHVybiB0LnR5cGU9ImluZGV4X3NjYW4iLHQuaW5kZXhlcz1bbl0sdC5pbmRleFNjYW5zPVt7aW5kZXhOYW1lOm4saW5kZXg6cixxdWVyeTplfV0sdC5lc3RpbWF0ZWRDb3N0PTEwMCx0LmluZGV4T25seT0hMCx0fXJldHVybiBudWxsfV9wbGFuQW5kUXVlcnkoZSx0KXtjb25zdCBuPW5ldyBUdDtsZXQgcjtyPWUuJGFuZD9lLiRhbmQ6T2JqZWN0LmtleXMoZSkubWFwKHQ9Pih7W3RdOmVbdF19KSk7Y29uc3QgaT1bXTtmb3IoY29uc3QgcyBvZiByKXtjb25zdCBlPXRoaXMuX3BsYW5TaW1wbGVRdWVyeShzKTsiaW5kZXhfc2NhbiI9PT1lLnR5cGUmJmkucHVzaChlLmluZGV4U2NhbnNbMF0pfXJldHVybiBpLmxlbmd0aD4xPyhuLnR5cGU9ImluZGV4X2ludGVyc2VjdGlvbiIsbi5pbmRleFNjYW5zPWksbi5pbmRleGVzPWkubWFwKGU9PmUuaW5kZXhOYW1lKSxuLmVzdGltYXRlZENvc3Q9NTAsbik6MT09PWkubGVuZ3RoPyhuLnR5cGU9ImluZGV4X3NjYW4iLG4uaW5kZXhTY2Fucz1baVswXV0sbi5pbmRleGVzPVtpWzBdLmluZGV4TmFtZV0sbi5lc3RpbWF0ZWRDb3N0PTUwLG4pOm59X3BsYW5PclF1ZXJ5KGUsdCl7Y29uc3Qgbj1uZXcgVHQ7aWYoIWUuJG9yKXJldHVybiBuO2NvbnN0IHI9ZS4kb3IsaT1bXTtmb3IoY29uc3QgcyBvZiByKXtjb25zdCBlPXRoaXMuX3BsYW5TaW1wbGVRdWVyeShzKTsiaW5kZXhfc2NhbiI9PT1lLnR5cGUmJmkucHVzaChlLmluZGV4U2NhbnNbMF0pfXJldHVybiBpLmxlbmd0aD4wPyhuLnR5cGU9ImluZGV4X3VuaW9uIixuLmluZGV4U2NhbnM9aSxuLmluZGV4ZXM9aS5tYXAoZT0+ZS5pbmRleE5hbWUpLG4uZXN0aW1hdGVkQ29zdD0xMDAqaS5sZW5ndGgsbik6bn1fcGxhblNpbXBsZVF1ZXJ5KGUpe2NvbnN0IHQ9bmV3IFR0O2lmKDA9PT1PYmplY3Qua2V5cyhlKS5sZW5ndGgpcmV0dXJuIHQ7Zm9yKGNvbnN0W24scl1vZiB0aGlzLmluZGV4ZXMpaWYoIShyIGluc3RhbmNlb2YgRXR8fHIgaW5zdGFuY2VvZiBGdCkmJnRoaXMuX2NhbkluZGV4SGFuZGxlUXVlcnkocixlKSlyZXR1cm4gdC50eXBlPSJpbmRleF9zY2FuIix0LmluZGV4ZXM9W25dLHQuaW5kZXhTY2Fucz1be2luZGV4TmFtZTpuLGluZGV4OnIscXVlcnk6ZX1dLHQuZXN0aW1hdGVkQ29zdD01MCx0O3JldHVybiB0fWFzeW5jIF9leGVjdXRlSW5kZXhTY2FuKGUpe2NvbnN0e2luZGV4OnQscXVlcnk6bix0ZXh0UXVlcnk6cn09ZTtpZigiZnVuY3Rpb24iIT10eXBlb2YgdC5vcGVufHx2b2lkIDA9PT10LmlzT3Blbnx8dC5pc09wZW58fGF3YWl0IHQub3BlbigpLHZvaWQgMCE9PXIpcmV0dXJuIGF3YWl0IHQuc2VhcmNoKHIpO2lmKHZvaWQgMCE9PW4pe2NvbnN0IGU9YXdhaXQgdC5xdWVyeShuKTtyZXR1cm4gbnVsbCE9PWU/ZTpbXX1yZXR1cm4gdm9pZCAwIT09ZS5kb2NJZHM/ZS5kb2NJZHM6W119X2NhbkluZGV4SGFuZGxlUXVlcnkoZSx0KXtjb25zdCBuPU9iamVjdC5rZXlzKHQpLHI9T2JqZWN0LmtleXMoZS5rZXlzKTtpZigxIT09ci5sZW5ndGgpcmV0dXJuITE7Y29uc3QgaT1yWzBdO3JldHVybi0xIT09bi5pbmRleE9mKGkpfWFzeW5jIGV4ZWN1dGUoZSl7aWYoImZ1bGxfc2NhbiI9PT1lLnR5cGUpcmV0dXJuIG51bGw7aWYoImluZGV4X3NjYW4iPT09ZS50eXBlKXtjb25zdCB0PWUuaW5kZXhTY2Fuc1swXTtyZXR1cm4gYXdhaXQgdGhpcy5fZXhlY3V0ZUluZGV4U2Nhbih0KX1pZigiaW5kZXhfaW50ZXJzZWN0aW9uIj09PWUudHlwZSl7aWYoMD09PWUuaW5kZXhTY2Fucy5sZW5ndGgpcmV0dXJuIG51bGw7Y29uc3QgdD1bXTtmb3IoY29uc3QgaSBvZiBlLmluZGV4U2NhbnMpdC5wdXNoKHtkb2NJZHM6YXdhaXQgdGhpcy5fZXhlY3V0ZUluZGV4U2NhbihpKSxpbmRleE5hbWU6aS5pbmRleE5hbWV9KTtjb25zdCBuPXQuc2xpY2UoKS5zb3J0KChlLHQpPT5lLmRvY0lkcy5sZW5ndGgtdC5kb2NJZHMubGVuZ3RoKTtsZXQgcj1uZXcgU2V0KG5bMF0uZG9jSWRzKTtmb3IobGV0IGU9MTtlPG4ubGVuZ3RoO2UrKyl7Y29uc3QgdD1uZXcgU2V0KG5bZV0uZG9jSWRzKTtpZihyPW5ldyBTZXQoWy4uLnJdLmZpbHRlcihlPT50LmhhcyhlKSkpLDA9PT1yLnNpemUpYnJlYWt9cmV0dXJuIEFycmF5LmZyb20ocil9aWYoImluZGV4X3VuaW9uIj09PWUudHlwZSl7Y29uc3QgdD0vKiBAX19QVVJFX18gKi9uZXcgU2V0O2Zvcihjb25zdCBuIG9mIGUuaW5kZXhTY2Fucyl7KGF3YWl0IHRoaXMuX2V4ZWN1dGVJbmRleFNjYW4obikpLmZvckVhY2goZT0+dC5hZGQoZSkpfXJldHVybiBBcnJheS5mcm9tKHQpfXJldHVybiBudWxsfX1jbGFzcyBVdCBleHRlbmRzIG4uRXZlbnRFbWl0dGVye2NvbnN0cnVjdG9yKGUsdD1bXSxuPXt9KXtzdXBlcigpLHRoaXMudGFyZ2V0PWUsdGhpcy5waXBlbGluZT10LHRoaXMub3B0aW9ucz1uLHRoaXMuY2xvc2VkPSExLHRoaXMuX2xpc3RlbmVycz0vKiBAX19QVVJFX18gKi9uZXcgTWFwLHRoaXMuX2NoYW5nZUNvdW50ZXI9MCx0aGlzLl9zdGFydFdhdGNoaW5nKCl9X2lzREIoZSl7cmV0dXJuIGUmJiJzdHJpbmciPT10eXBlb2YgZS5kYk5hbWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBlLmdldENvbGxlY3Rpb25OYW1lcyYmZS5jb2xsZWN0aW9ucyBpbnN0YW5jZW9mIE1hcH1faXNTZXJ2ZXIoZSl7cmV0dXJuIGUmJmUuZGF0YWJhc2VzIGluc3RhbmNlb2YgTWFwJiYiZnVuY3Rpb24iPT10eXBlb2YgZS5fZ2V0REJ9X2lzTW9uZ29DbGllbnQoZSl7cmV0dXJuIGUmJiJmdW5jdGlvbiI9PXR5cGVvZiBlLmNvbm5lY3QmJiJmdW5jdGlvbiI9PXR5cGVvZiBlLmRiJiYiTW9uZ29DbGllbnQiPT09ZS5jb25zdHJ1Y3Rvci5uYW1lfV9zdGFydFdhdGNoaW5nKCl7aWYodGhpcy5jbG9zZWQpcmV0dXJuO2NvbnN0IGU9dGhpcy5fZ2V0Q29sbGVjdGlvbnNUb1dhdGNoKCk7Zm9yKGNvbnN0IHQgb2YgZSl0aGlzLl93YXRjaENvbGxlY3Rpb24odCk7dGhpcy5faXNTZXJ2ZXIodGhpcy50YXJnZXQpJiZ0aGlzLl9pbnRlcmNlcHRTZXJ2ZXJEQkNyZWF0aW9uKCksdGhpcy5faXNEQih0aGlzLnRhcmdldCkmJnRoaXMuX2ludGVyY2VwdERCQ29sbGVjdGlvbkNyZWF0aW9uKCksdGhpcy5faXNNb25nb0NsaWVudCh0aGlzLnRhcmdldCkmJnRoaXMuX2ludGVyY2VwdENsaWVudERCQ3JlYXRpb24oKX1fZ2V0Q29sbGVjdGlvbnNUb1dhdGNoKCl7Y29uc3QgZT1bXTtpZih0aGlzLl9pc1NlcnZlcih0aGlzLnRhcmdldCkpe2Zvcihjb25zdFt0LG5db2YgdGhpcy50YXJnZXQuZGF0YWJhc2VzKXtjb25zdCB0PW4uZ2V0Q29sbGVjdGlvbk5hbWVzKCk7Zm9yKGNvbnN0IHIgb2YgdCl7Y29uc3QgdD1uW3JdO3QmJnQuaXNDb2xsZWN0aW9uJiZlLnB1c2godCl9fXJldHVybiBlfWlmKHRoaXMuX2lzTW9uZ29DbGllbnQodGhpcy50YXJnZXQpKXJldHVybiB0aGlzLl9tb25pdG9yQ2xpZW50KCksZTtpZih0aGlzLl9pc0RCKHRoaXMudGFyZ2V0KSl7Y29uc3QgdD10aGlzLnRhcmdldC5nZXRDb2xsZWN0aW9uTmFtZXMoKTtmb3IoY29uc3QgbiBvZiB0KXtjb25zdCB0PXRoaXMudGFyZ2V0W25dO3QmJnQuaXNDb2xsZWN0aW9uJiZlLnB1c2godCl9dGhpcy5fbW9uaXRvckRCKCl9cmV0dXJuIHRoaXMudGFyZ2V0LmlzQ29sbGVjdGlvbiYmZS5wdXNoKHRoaXMudGFyZ2V0KSxlfV93YXRjaENvbGxlY3Rpb24oZSl7aWYodGhpcy5jbG9zZWQpcmV0dXJuO2lmKCFlKXJldHVybjtpZigiZnVuY3Rpb24iIT10eXBlb2YgZS5vbilyZXR1cm47aWYoIWUuaXNDb2xsZWN0aW9uKXJldHVybjtpZih0aGlzLl9saXN0ZW5lcnMuaGFzKGUpKXJldHVybjtjb25zdCB0PXtpbnNlcnQ6dD0+dGhpcy5fZW1pdENoYW5nZSgiaW5zZXJ0IixlLHQpLHVwZGF0ZToodCxuKT0+dGhpcy5fZW1pdENoYW5nZSgidXBkYXRlIixlLHQsbikscmVwbGFjZTp0PT50aGlzLl9lbWl0Q2hhbmdlKCJyZXBsYWNlIixlLHQpLGRlbGV0ZTp0PT50aGlzLl9lbWl0Q2hhbmdlKCJkZWxldGUiLGUsdCl9O3RoaXMuX2xpc3RlbmVycy5zZXQoZSx0KSxlLm9uKCJpbnNlcnQiLHQuaW5zZXJ0KSxlLm9uKCJ1cGRhdGUiLHQudXBkYXRlKSxlLm9uKCJyZXBsYWNlIix0LnJlcGxhY2UpLGUub24oImRlbGV0ZSIsdC5kZWxldGUpfV9lbWl0Q2hhbmdlKGUsdCxuLHI9bnVsbCl7aWYodGhpcy5jbG9zZWQpcmV0dXJuO2NvbnN0IGk9dGhpcy5fY3JlYXRlQ2hhbmdlRXZlbnQoZSx0LG4scik7dGhpcy5fbWF0Y2hlc1BpcGVsaW5lKGkpJiZ0aGlzLmVtaXQoImNoYW5nZSIsaSl9X2NyZWF0ZUNoYW5nZUV2ZW50KGUsdCxuLHIpe2NvbnN0IGk9e19pZDp7X2RhdGE6YnRvYShTdHJpbmcoKyt0aGlzLl9jaGFuZ2VDb3VudGVyKSl9LG9wZXJhdGlvblR5cGU6ZSxjbHVzdGVyVGltZTovKiBAX19QVVJFX18gKi9uZXcgRGF0ZSxuczp7ZGI6dC5kYi5kYk5hbWUsY29sbDp0Lm5hbWV9LGRvY3VtZW50S2V5OntfaWQ6bi5faWR9fTtzd2l0Y2goZSl7Y2FzZSJpbnNlcnQiOmNhc2UicmVwbGFjZSI6aS5mdWxsRG9jdW1lbnQ9bjticmVhaztjYXNlInVwZGF0ZSI6aS51cGRhdGVEZXNjcmlwdGlvbj1yfHx7dXBkYXRlZEZpZWxkczp7fSxyZW1vdmVkRmllbGRzOltdLHRydW5jYXRlZEFycmF5czpbXX0sInVwZGF0ZUxvb2t1cCI9PT10aGlzLm9wdGlvbnMuZnVsbERvY3VtZW50JiYoaS5mdWxsRG9jdW1lbnQ9bil9cmV0dXJuIGl9X21hdGNoZXNQaXBlbGluZShlKXtpZighdGhpcy5waXBlbGluZXx8MD09PXRoaXMucGlwZWxpbmUubGVuZ3RoKXJldHVybiEwO2Zvcihjb25zdCB0IG9mIHRoaXMucGlwZWxpbmUpaWYodC4kbWF0Y2gmJiFZZShlLHQuJG1hdGNoKSlyZXR1cm4hMTtyZXR1cm4hMH1fZ2V0TmVzdGVkVmFsdWUoZSx0KXtyZXR1cm4gdC5zcGxpdCgiLiIpLnJlZHVjZSgoZSx0KT0+ZT8uW3RdLGUpfV9tb25pdG9yQ2xpZW50KCl7fV9pbnRlcmNlcHRDbGllbnREQkNyZWF0aW9uKCl7Y29uc3QgZT10aGlzLnRhcmdldCx0PWUuZGIuYmluZChlKSxuPXRoaXM7dGhpcy5fd2F0Y2hlZERCcz0vKiBAX19QVVJFX18gKi9uZXcgTWFwLGUuZGI9ZnVuY3Rpb24oZSxyKXtjb25zdCBpPXQoZSxyKSxzPWkuZGJOYW1lO2lmKCFuLl93YXRjaGVkREJzLmhhcyhzKSl7bi5fd2F0Y2hlZERCcy5zZXQocyxpKTtjb25zdCBlPWkuZ2V0Q29sbGVjdGlvbk5hbWVzKCk7Zm9yKGNvbnN0IHQgb2YgZSl7Y29uc3QgZT1pW3RdO2UmJmUuaXNDb2xsZWN0aW9uJiYhbi5fbGlzdGVuZXJzLmhhcyhlKSYmbi5fd2F0Y2hDb2xsZWN0aW9uKGUpfW4uX2ludGVyY2VwdERCQ29sbGVjdGlvbkNyZWF0aW9uRm9yQ2xpZW50KGkpfXJldHVybiBpfSx0aGlzLl9vcmlnaW5hbENsaWVudE1ldGhvZHM9e2RiOnR9fV9pbnRlcmNlcHRTZXJ2ZXJEQkNyZWF0aW9uKCl7Y29uc3QgZT10aGlzLnRhcmdldCx0PWUuX2dldERCLmJpbmQoZSksbj10aGlzO3RoaXMuX3dhdGNoZWREQnM9LyogQF9fUFVSRV9fICovbmV3IE1hcCxlLl9nZXREQj1mdW5jdGlvbihlKXtjb25zdCByPXQoZSk7aWYoIW4uX3dhdGNoZWREQnMuaGFzKGUpKXtuLl93YXRjaGVkREJzLnNldChlLHIpO2NvbnN0IHQ9ci5nZXRDb2xsZWN0aW9uTmFtZXMoKTtmb3IoY29uc3QgZSBvZiB0KXtjb25zdCB0PXJbZV07dCYmdC5pc0NvbGxlY3Rpb24mJiFuLl9saXN0ZW5lcnMuaGFzKHQpJiZuLl93YXRjaENvbGxlY3Rpb24odCl9bi5faW50ZXJjZXB0REJDb2xsZWN0aW9uQ3JlYXRpb25Gb3JTZXJ2ZXIocil9cmV0dXJuIHJ9LHRoaXMuX29yaWdpbmFsU2VydmVyTWV0aG9kcz17X2dldERCOnR9fV9pbnRlcmNlcHREQkNvbGxlY3Rpb25DcmVhdGlvbkZvclNlcnZlcihlKXtjb25zdCB0PWUuY29sbGVjdGlvbi5iaW5kKGUpLG49ZS5jcmVhdGVDb2xsZWN0aW9uLmJpbmQoZSkscj10aGlzO2UuY29sbGVjdGlvbj1mdW5jdGlvbihlKXtjb25zdCBuPXQoZSk7cmV0dXJuIG4mJm4uaXNDb2xsZWN0aW9uJiYhci5fbGlzdGVuZXJzLmhhcyhuKSYmci5fd2F0Y2hDb2xsZWN0aW9uKG4pLG59LGUuY3JlYXRlQ29sbGVjdGlvbj1mdW5jdGlvbih0KXtuKHQpO2NvbnN0IGk9ZVt0XTtpJiZpLmlzQ29sbGVjdGlvbiYmIXIuX2xpc3RlbmVycy5oYXMoaSkmJnIuX3dhdGNoQ29sbGVjdGlvbihpKX19X2ludGVyY2VwdERCQ29sbGVjdGlvbkNyZWF0aW9uRm9yQ2xpZW50KGUpe2NvbnN0IHQ9ZS5jb2xsZWN0aW9uLmJpbmQoZSksbj1lLmNyZWF0ZUNvbGxlY3Rpb24uYmluZChlKSxyPXRoaXM7ZS5jb2xsZWN0aW9uPWZ1bmN0aW9uKGUpe2NvbnN0IG49dChlKTtyZXR1cm4gbiYmbi5pc0NvbGxlY3Rpb24mJiFyLl9saXN0ZW5lcnMuaGFzKG4pJiZyLl93YXRjaENvbGxlY3Rpb24obiksbn0sZS5jcmVhdGVDb2xsZWN0aW9uPWZ1bmN0aW9uKHQpe24odCk7Y29uc3QgaT1lW3RdO2kmJmkuaXNDb2xsZWN0aW9uJiYhci5fbGlzdGVuZXJzLmhhcyhpKSYmci5fd2F0Y2hDb2xsZWN0aW9uKGkpfX1fbW9uaXRvckRCKCl7fV9pbnRlcmNlcHREQkNvbGxlY3Rpb25DcmVhdGlvbigpe2NvbnN0IGU9dGhpcy50YXJnZXQsdD1lLmdldENvbGxlY3Rpb24uYmluZChlKSxuPWUuY3JlYXRlQ29sbGVjdGlvbj9lLmNyZWF0ZUNvbGxlY3Rpb24uYmluZChlKTpudWxsLHI9dGhpcztlLmdldENvbGxlY3Rpb249ZnVuY3Rpb24oZSl7Y29uc3Qgbj10KGUpO3JldHVybiBuJiZuLmlzQ29sbGVjdGlvbiYmIXIuX2xpc3RlbmVycy5oYXMobikmJnIuX3dhdGNoQ29sbGVjdGlvbihuKSxufSxuJiYoZS5jcmVhdGVDb2xsZWN0aW9uPWZ1bmN0aW9uKHQpe24odCk7Y29uc3QgaT1lW3RdO2kmJmkuaXNDb2xsZWN0aW9uJiYhci5fbGlzdGVuZXJzLmhhcyhpKSYmci5fd2F0Y2hDb2xsZWN0aW9uKGkpfSksdGhpcy5fb3JpZ2luYWxEQk1ldGhvZHM9e2dldENvbGxlY3Rpb246dCxjcmVhdGVDb2xsZWN0aW9uOm59fWNsb3NlKCl7aWYoIXRoaXMuY2xvc2VkKXt0aGlzLmNsb3NlZD0hMDtmb3IoY29uc3RbZSx0XW9mIHRoaXMuX2xpc3RlbmVycyllLm9mZigiaW5zZXJ0Iix0Lmluc2VydCksZS5vZmYoInVwZGF0ZSIsdC51cGRhdGUpLGUub2ZmKCJyZXBsYWNlIix0LnJlcGxhY2UpLGUub2ZmKCJkZWxldGUiLHQuZGVsZXRlKTt0aGlzLl9saXN0ZW5lcnMuY2xlYXIoKSx0aGlzLl9vcmlnaW5hbFNlcnZlck1ldGhvZHMmJiJTZXJ2ZXIiPT09dGhpcy50YXJnZXQuY29uc3RydWN0b3IubmFtZSYmKHRoaXMudGFyZ2V0Ll9nZXREQj10aGlzLl9vcmlnaW5hbFNlcnZlck1ldGhvZHMuX2dldERCKSx0aGlzLl9vcmlnaW5hbERCTWV0aG9kcyYmIkRCIj09PXRoaXMudGFyZ2V0LmNvbnN0cnVjdG9yLm5hbWUmJih0aGlzLnRhcmdldC5jb2xsZWN0aW9uPXRoaXMuX29yaWdpbmFsREJNZXRob2RzLmNvbGxlY3Rpb24sdGhpcy50YXJnZXQuY3JlYXRlQ29sbGVjdGlvbj10aGlzLl9vcmlnaW5hbERCTWV0aG9kcy5jcmVhdGVDb2xsZWN0aW9uKSx0aGlzLl9vcmlnaW5hbENsaWVudE1ldGhvZHMmJiJNb25nb0NsaWVudCI9PT10aGlzLnRhcmdldC5jb25zdHJ1Y3Rvci5uYW1lJiYodGhpcy50YXJnZXQuZGI9dGhpcy5fb3JpZ2luYWxDbGllbnRNZXRob2RzLmRiKSx0aGlzLmVtaXQoImNsb3NlIiksdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoKX19Z2V0IGlzQ2xvc2VkKCl7cmV0dXJuIHRoaXMuY2xvc2VkfWFzeW5jKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKXtjb25zdCBlPVtdO2xldCB0PW51bGwsbj0hMTtjb25zdCByPW49Pnt0Pyh0KHt2YWx1ZTpuLGRvbmU6ITF9KSx0PW51bGwpOmUucHVzaChuKX0saT0oKT0+e249ITAsdCYmKHQoe2RvbmU6ITB9KSx0PW51bGwpfSxzPWU9Pnt0JiYodChQcm9taXNlLnJlamVjdChlKSksdD1udWxsKX07dGhpcy5vbigiY2hhbmdlIixyKSx0aGlzLm9uKCJjbG9zZSIsaSksdGhpcy5vbigiZXJyb3IiLHMpO3RyeXtmb3IoOyFuOylpZihlLmxlbmd0aD4wKXlpZWxkIGUuc2hpZnQoKTtlbHNle2NvbnN0IGU9YXdhaXQgbmV3IFByb21pc2UoZT0+e3Q9ZSxuJiZlKHtkb25lOiEwfSl9KTtpZihlLmRvbmUpYnJlYWs7eWllbGQgZS52YWx1ZX19ZmluYWxseXt0aGlzLm9mZigiY2hhbmdlIixyKSx0aGlzLm9mZigiY2xvc2UiLGkpLHRoaXMub2ZmKCJlcnJvciIscyl9fWFzeW5jIG5leHQoKXtyZXR1cm4gbmV3IFByb21pc2UoKGUsdCk9Pntjb25zdCBuPXQ9PntzKCksZSh0KX0scj0oKT0+e3MoKSxlKG51bGwpfSxpPWU9PntzKCksdChlKX0scz0oKT0+e3RoaXMub2ZmKCJjaGFuZ2UiLG4pLHRoaXMub2ZmKCJjbG9zZSIsciksdGhpcy5vZmYoImVycm9yIixpKX07dGhpcy5jbG9zZWQ/ZShudWxsKToodGhpcy5vbmNlKCJjaGFuZ2UiLG4pLHRoaXMub25jZSgiY2xvc2UiLHIpLHRoaXMub25jZSgiZXJyb3IiLGkpKX0pfX1jbGFzcyBxdCBleHRlbmRzIG4uRXZlbnRFbWl0dGVye2NvbnN0cnVjdG9yKGUsdCxuPXt9KXtzdXBlcigpLHRoaXMuZGI9ZSx0aGlzLm5hbWU9dCx0aGlzLnBhdGg9YCR7dGhpcy5kYi5iYXNlRm9sZGVyfS8ke3RoaXMuZGIuZGJOYW1lfS8ke3RoaXMubmFtZX1gLHRoaXMuZG9jdW1lbnRzUGF0aD1gJHt0aGlzLnBhdGh9L2RvY3VtZW50cy5ianNvbmAsdGhpcy5kb2N1bWVudHNWZXJzaW9uZWRQYXRoPW51bGwsdGhpcy5kb2N1bWVudHNWZXJzaW9uPTAsdGhpcy5fcmVsZWFzZURvY3VtZW50cz1udWxsLHRoaXMub3JkZXI9bi5iUGx1c1RyZWVPcmRlcnx8NTAsdGhpcy5kb2N1bWVudHM9bnVsbCx0aGlzLmluZGV4ZXM9LyogQF9fUFVSRV9fICovbmV3IE1hcCx0aGlzLl9pbml0aWFsaXplZD0hMSx0aGlzLmlzQ29sbGVjdGlvbj0hMCx0aGlzLnF1ZXJ5UGxhbm5lcj1uZXcgenQodGhpcy5pbmRleGVzKX1hc3luYyBfaW5pdGlhbGl6ZSgpe2lmKHRoaXMuX2luaXRpYWxpemVkKXJldHVybjtpZighZ2xvYmFsVGhpcy5uYXZpZ2F0b3J8fCFnbG9iYWxUaGlzLm5hdmlnYXRvci5zdG9yYWdlfHwiZnVuY3Rpb24iIT10eXBlb2YgZ2xvYmFsVGhpcy5uYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkpdGhyb3cgbmV3IEVycm9yKCJPUEZTIG5vdCBhdmFpbGFibGU6IG5hdmlnYXRvci5zdG9yYWdlLmdldERpcmVjdG9yeSBpcyBtaXNzaW5nIik7Y29uc3R7dmVyc2lvbjplLHBhdGg6dH09YXdhaXQgdnQodGhpcy5kb2N1bWVudHNQYXRoKTt0aGlzLmRvY3VtZW50c1ZlcnNpb249ZSx0aGlzLmRvY3VtZW50c1ZlcnNpb25lZFBhdGg9dCx0aGlzLl9yZWxlYXNlRG9jdW1lbnRzPSgpPT4kdCh0aGlzLmRvY3VtZW50c1BhdGgsZSk7bGV0IG49YXdhaXQgdGhpcy5fZW5zdXJlRGlyZWN0b3J5Rm9yRmlsZSh0aGlzLmRvY3VtZW50c1ZlcnNpb25lZFBhdGgpO258fChuPWF3YWl0IGdsb2JhbFRoaXMubmF2aWdhdG9yLnN0b3JhZ2UuZ2V0RGlyZWN0b3J5KCkpO2NvbnN0IHI9dGhpcy5kb2N1bWVudHNWZXJzaW9uZWRQYXRoLnNwbGl0KCIvIikuZmlsdGVyKEJvb2xlYW4pLGk9cltyLmxlbmd0aC0xXTtpZighaSl0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZG9jdW1lbnRzIHBhdGg6ICR7dGhpcy5kb2N1bWVudHNWZXJzaW9uZWRQYXRofWApO2NvbnN0IHM9YXdhaXQgbi5nZXRGaWxlSGFuZGxlKGkse2NyZWF0ZTohMH0pLG89YXdhaXQgcy5jcmVhdGVTeW5jQWNjZXNzSGFuZGxlKCk7dGhpcy5kb2N1bWVudHM9bmV3IHhlKG8sdGhpcy5vcmRlciksYXdhaXQgdGhpcy5kb2N1bWVudHMub3BlbigpLGF3YWl0IHRoaXMuX2xvYWRJbmRleGVzKCksdGhpcy5faW5pdGlhbGl6ZWQ9ITB9YXN5bmMgX2Vuc3VyZURpcmVjdG9yeUZvckZpbGUoZSl7aWYoIWUpcmV0dXJuO2NvbnN0IHQ9ZS5zcGxpdCgiLyIpLmZpbHRlcihCb29sZWFuKTtpZih0LnBvcCgpLDAhPT10Lmxlbmd0aCl0cnl7bGV0IGU9YXdhaXQgZ2xvYmFsVGhpcy5uYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkoKTtmb3IoY29uc3QgbiBvZiB0KWU9YXdhaXQgZS5nZXREaXJlY3RvcnlIYW5kbGUobix7Y3JlYXRlOiEwfSk7cmV0dXJuIGV9Y2F0Y2gobil7aWYoIkVFWElTVCIhPT1uLmNvZGUpdGhyb3cgbn19YXN5bmMgX2xvYWRJbmRleGVzKCl7bGV0IGU7dHJ5e2NvbnN0IHQ9dGhpcy5wYXRoLnNwbGl0KCIvIikuZmlsdGVyKEJvb2xlYW4pO2xldCBuPWF3YWl0IGdsb2JhbFRoaXMubmF2aWdhdG9yLnN0b3JhZ2UuZ2V0RGlyZWN0b3J5KCk7Zm9yKGNvbnN0IGUgb2YgdCluPWF3YWl0IG4uZ2V0RGlyZWN0b3J5SGFuZGxlKGUse2NyZWF0ZTohMX0pO2U9bn1jYXRjaCh0KXtpZigiTm90Rm91bmRFcnJvciI9PT10Py5uYW1lfHwiRU5PRU5UIj09PXQ/LmNvZGUpcmV0dXJuO3Rocm93IHR9Zm9yIGF3YWl0KGNvbnN0W24scl1vZiBlLmVudHJpZXMoKSl7aWYoImZpbGUiIT09ci5raW5kKWNvbnRpbnVlO2NvbnN0IGU9L1wudlxkKyg/PS18JCkvLGk9bi5yZXBsYWNlKGUsIiIpO2xldCBzO2lmKGkuZW5kc1dpdGgoIi50ZXh0aW5kZXgtZG9jdW1lbnRzLmJqc29uIikpcz0idGV4dCI7ZWxzZSBpZihpLmVuZHNXaXRoKCIucnRyZWUuYmpzb24iKSlzPSJnZW9zcGF0aWFsIjtlbHNle2lmKCFpLmVuZHNXaXRoKCIuYnBsdXN0cmVlLmJqc29uIikpY29udGludWU7cz0icmVndWxhciJ9Y29uc3Qgbz1pLnJlcGxhY2UoL1wudGV4dGluZGV4LWRvY3VtZW50c1wuYmpzb24kLywiIikucmVwbGFjZSgvXC5ydHJlZVwuYmpzb24kLywiIikucmVwbGFjZSgvXC5icGx1c3RyZWVcLmJqc29uJC8sIiIpO2lmKHRoaXMuaW5kZXhlcy5oYXMobykpY29udGludWU7Y29uc3QgYT10aGlzLl9wYXJzZUluZGV4TmFtZShvLHMpO2lmKCFhKWNvbnRpbnVlO2xldCBjO2lmKCJ0ZXh0Ij09PXMpe2NvbnN0IGU9YXdhaXQgdGhpcy5fZ2V0SW5kZXhQYXRoKG8scyk7Yz1uZXcgRXQobyxhLGUse30pfWVsc2UgaWYoImdlb3NwYXRpYWwiPT09cyl7Y29uc3QgZT1hd2FpdCB0aGlzLl9nZXRJbmRleFBhdGgobyxzKTtjPW5ldyBGdChvLGEsZSx7fSl9ZWxzZXtjb25zdCBlPWF3YWl0IHRoaXMuX2dldEluZGV4UGF0aChvLHMpO2M9bmV3IE90KG8sYSxlLHt9KX10cnl7YXdhaXQgYy5vcGVuKCksdGhpcy5pbmRleGVzLnNldChvLGMpfWNhdGNoKHQpe319fV9wYXJzZUluZGV4TmFtZShlLHQpe2NvbnN0IG49ZS5zcGxpdCgiXyIpO2lmKG4ubGVuZ3RoPDJ8fG4ubGVuZ3RoJTIhPTApcmV0dXJuIG51bGw7Y29uc3Qgcj17fTtmb3IobGV0IGk9MDtpPG4ubGVuZ3RoO2krPTIpe2NvbnN0IGU9bltpXSxzPW5baSsxXTtpZighZXx8dm9pZCAwPT09cylyZXR1cm4gbnVsbDtpZigidGV4dCI9PT10fHwidGV4dCI9PT1zKXJbZV09InRleHQiO2Vsc2UgaWYoImdlb3NwYXRpYWwiPT09dHx8IjJkc3BoZXJlIj09PXN8fCIyZCI9PT1zKXJbZV09IjJkIj09PXM/IjJkIjoiMmRzcGhlcmUiO2Vsc2V7Y29uc3QgdD1OdW1iZXIocyk7aWYoTnVtYmVyLmlzTmFOKHQpfHwxIT09dCYmLTEhPT10KXJldHVybiBudWxsO3JbZV09dH19cmV0dXJuIHJ9YXN5bmMgY2xvc2UoKXtpZih0aGlzLl9pbml0aWFsaXplZCl7Zm9yKGNvbnN0W2UsdF1vZiB0aGlzLmluZGV4ZXMpYXdhaXQgdC5jbG9zZSgpO2F3YWl0IHRoaXMuX21heWJlQ29tcGFjdERvY3VtZW50cygpLGF3YWl0IHRoaXMuZG9jdW1lbnRzLmNsb3NlKCksdGhpcy5fcmVsZWFzZURvY3VtZW50cyYmKGF3YWl0IHRoaXMuX3JlbGVhc2VEb2N1bWVudHMoKSx0aGlzLl9yZWxlYXNlRG9jdW1lbnRzPW51bGwpfX1hc3luYyBfbWF5YmVDb21wYWN0RG9jdW1lbnRzKCl7aWYoIXRoaXMuZG9jdW1lbnRzfHwhdGhpcy5kb2N1bWVudHMuZmlsZSlyZXR1cm47Y29uc3QgZT1hd2FpdCBJdCh0aGlzLmRvY3VtZW50c1BhdGgpO2lmKGUhPT10aGlzLmRvY3VtZW50c1ZlcnNpb24pcmV0dXJuO2NvbnN0IHQ9dGhpcy5kb2N1bWVudHMuZmlsZS5nZXRGaWxlU2l6ZSgpO2lmKCF0fHx0PGZ0KXJldHVybjtjb25zdCBuPWUrMSxyPWR0KHRoaXMuZG9jdW1lbnRzUGF0aCxuKSxpPWF3YWl0IEF0KHIse3Jlc2V0OiEwfSk7YXdhaXQgdGhpcy5kb2N1bWVudHMuY29tcGFjdChpKSxhd2FpdCBOdCh0aGlzLmRvY3VtZW50c1BhdGgsbixlKX1nZW5lcmF0ZUluZGV4TmFtZShlKXtjb25zdCB0PVtdO2Zvcihjb25zdCBuIGluIGUpZS5oYXNPd25Qcm9wZXJ0eShuKSYmdC5wdXNoKG4rIl8iK2Vbbl0pO3JldHVybiB0LmpvaW4oIl8iKX1pc1RleHRJbmRleChlKXtmb3IoY29uc3QgdCBpbiBlKWlmKCJ0ZXh0Ij09PWVbdF0pcmV0dXJuITA7cmV0dXJuITF9aXNHZW9zcGF0aWFsSW5kZXgoZSl7Zm9yKGNvbnN0IHQgaW4gZSlpZigiMmRzcGhlcmUiPT09ZVt0XXx8IjJkIj09PWVbdF0pcmV0dXJuITA7cmV0dXJuITF9YXN5bmMgX2dldEluZGV4UGF0aChlLHQpe2NvbnN0IG49U3RyaW5nKGUpLnJlcGxhY2UoL1teYS16QS1aMC05Xy1dL2csIl8iKTtyZXR1cm4idGV4dCI9PT10P2Ake3RoaXMucGF0aH0vJHtufS50ZXh0aW5kZXhgOiJnZW9zcGF0aWFsIj09PXQ/YCR7dGhpcy5wYXRofS8ke259LnJ0cmVlLmJqc29uYDpgJHt0aGlzLnBhdGh9LyR7bn0uYnBsdXN0cmVlLmJqc29uYH1hc3luYyBfYnVpbGRJbmRleChlLHQsbj17fSl7bGV0IHIsaSxzO3RoaXMuX2luaXRpYWxpemVkfHxhd2FpdCB0aGlzLl9pbml0aWFsaXplKCksdGhpcy5pc1RleHRJbmRleCh0KT8ocz0idGV4dCIsaT1hd2FpdCB0aGlzLl9nZXRJbmRleFBhdGgoZSxzKSxyPW5ldyBFdChlLHQsaSxuKSk6dGhpcy5pc0dlb3NwYXRpYWxJbmRleCh0KT8ocz0iZ2Vvc3BhdGlhbCIsaT1hd2FpdCB0aGlzLl9nZXRJbmRleFBhdGgoZSxzKSxyPW5ldyBGdChlLHQsaSxuKSk6KHM9InJlZ3VsYXIiLGk9YXdhaXQgdGhpcy5fZ2V0SW5kZXhQYXRoKGUscykscj1uZXcgT3QoZSx0LGksbikpLGF3YWl0IHIub3BlbigpLCJmdW5jdGlvbiI9PXR5cGVvZiByLmNsZWFyJiZhd2FpdCByLmNsZWFyKCk7Zm9yIGF3YWl0KGNvbnN0IG8gb2YgdGhpcy5kb2N1bWVudHMpbyYmby52YWx1ZSYmYXdhaXQgci5hZGQoby52YWx1ZSk7cmV0dXJuIHRoaXMuaW5kZXhlcy5zZXQoZSxyKSxyfWFzeW5jIHVwZGF0ZUluZGV4ZXNPbkluc2VydChlKXtjb25zdCB0PVtdO2Zvcihjb25zdFtuLHJdb2YgdGhpcy5pbmRleGVzKXQucHVzaCgoYXN5bmMoKT0+e2F3YWl0IHRoaXMuX2Vuc3VyZUluZGV4T3BlbihyKSxhd2FpdCByLmFkZChlKX0pKCkpO3QubGVuZ3RoPjAmJmF3YWl0IFByb21pc2UuYWxsKHQpfWFzeW5jIHVwZGF0ZUluZGV4ZXNPbkRlbGV0ZShlKXtjb25zdCB0PVtdO2Zvcihjb25zdFtuLHJdb2YgdGhpcy5pbmRleGVzKXQucHVzaCgoYXN5bmMoKT0+e2F3YWl0IHRoaXMuX2Vuc3VyZUluZGV4T3BlbihyKSxhd2FpdCByLnJlbW92ZShlKX0pKCkpO3QubGVuZ3RoPjAmJmF3YWl0IFByb21pc2UuYWxsKHQpfWFzeW5jIF9lbnN1cmVJbmRleE9wZW4oZSl7ZSYmImZ1bmN0aW9uIj09dHlwZW9mIGUub3BlbiYmIWUuaXNPcGVuJiZhd2FpdCBlLm9wZW4oKX1wbGFuUXVlcnkoZSl7Y29uc3QgdD10aGlzLnF1ZXJ5UGxhbm5lci5wbGFuKGUpO3JldHVybnt1c2VJbmRleDoiZnVsbF9zY2FuIiE9PXQudHlwZSxwbGFuVHlwZTp0LnR5cGUsaW5kZXhOYW1lczp0LmluZGV4ZXMsZG9jSWRzOm51bGwsZXN0aW1hdGVkQ29zdDp0LmVzdGltYXRlZENvc3QsaW5kZXhPbmx5OnQuaW5kZXhPbmx5fHwhMX19YXN5bmMgcGxhblF1ZXJ5QXN5bmMoZSl7Y29uc3QgdD10aGlzLnF1ZXJ5UGxhbm5lci5wbGFuKGUpLG49YXdhaXQgdGhpcy5xdWVyeVBsYW5uZXIuZXhlY3V0ZSh0KTtyZXR1cm57dXNlSW5kZXg6ImZ1bGxfc2NhbiIhPT10LnR5cGUscGxhblR5cGU6dC50eXBlLGluZGV4TmFtZXM6dC5pbmRleGVzLGRvY0lkczpuLGVzdGltYXRlZENvc3Q6dC5lc3RpbWF0ZWRDb3N0LGluZGV4T25seTp0LmluZGV4T25seXx8ITF9fWdldFRleHRJbmRleChlKXtmb3IoY29uc3RbdCxuXW9mIHRoaXMuaW5kZXhlcylpZihuIGluc3RhbmNlb2YgRXQmJm4uaW5kZXhlZEZpZWxkcy5pbmNsdWRlcyhlKSlyZXR1cm4gbjtyZXR1cm4gbnVsbH1hc3luYyBhZ2dyZWdhdGUoZSl7aWYoIWV8fCFJKGUpKXRocm93IG5ldyBWKCJQaXBlbGluZSBtdXN0IGJlIGFuIGFycmF5Iix7Y29sbGVjdGlvbjp0aGlzLm5hbWUsY29kZTprfSk7bGV0IHQ9W107Y29uc3Qgbj10aGlzLmZpbmQoe30pO2Zvcihhd2FpdCBuLl9lbnN1cmVJbml0aWFsaXplZCgpO2F3YWl0IG4uaGFzTmV4dCgpOyl0LnB1c2goYXdhaXQgbi5uZXh0KCkpO2ZvcihsZXQgcj0wO3I8ZS5sZW5ndGg7cisrKXtjb25zdCBuPWVbcl0saT1PYmplY3Qua2V5cyhuKTtpZigxIT09aS5sZW5ndGgpdGhyb3cgbmV3IFYoIkVhY2ggcGlwZWxpbmUgc3RhZ2UgbXVzdCBoYXZlIGV4YWN0bHkgb25lIGtleSIse2NvbGxlY3Rpb246dGhpcy5uYW1lLGNvZGU6a30pO2NvbnN0IHM9aVswXSxvPW5bc107aWYoIiRtYXRjaCI9PT1zKXtjb25zdCBlPVtdO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKVllKHRbbl0sbykmJmUucHVzaCh0W25dKTt0PWV9ZWxzZSBpZigiJHByb2plY3QiPT09cyl7Y29uc3QgZT1bXTtmb3IobGV0IG49MDtuPHQubGVuZ3RoO24rKyllLnB1c2goUnQobyx0W25dKSk7dD1lfWVsc2UgaWYoIiRhZGRGaWVsZHMiPT09c3x8IiRzZXQiPT09cyl7Y29uc3QgZT1bXTtmb3IobGV0IG49MDtuPHQubGVuZ3RoO24rKyl7Y29uc3Qgcj1fKHRbbl0pO2Zvcihjb25zdCBlIGluIG8pe2NvbnN0IGk9b1tlXTtyW2VdPU5lKGksdFtuXSl9ZS5wdXNoKHIpfXQ9ZX1lbHNlIGlmKCIkdW5zZXQiPT09cyl7Y29uc3QgZT1bXTtsZXQgbj1bXTsic3RyaW5nIj09dHlwZW9mIG8/bj1bb106QXJyYXkuaXNBcnJheShvKT9uPW86Im9iamVjdCI9PXR5cGVvZiBvJiYobj1PYmplY3Qua2V5cyhvKSk7Zm9yKGxldCByPTA7cjx0Lmxlbmd0aDtyKyspe2NvbnN0IGk9Xyh0W3JdKTtmb3IobGV0IGU9MDtlPG4ubGVuZ3RoO2UrKyl7Y29uc3QgdD1uW2VdLHI9dC5zcGxpdCgiLiIpO2lmKDE9PT1yLmxlbmd0aClkZWxldGUgaVt0XTtlbHNle2xldCBlPWk7Zm9yKGxldCB0PTA7dDxyLmxlbmd0aC0xJiYobnVsbCE9ZSYmbnVsbCE9ZSk7dCsrKWU9ZVtyW3RdXTtudWxsIT1lJiZudWxsIT1lJiZkZWxldGUgZVtyW3IubGVuZ3RoLTFdXX19ZS5wdXNoKGkpfXQ9ZX1lbHNlIGlmKCIkc29ydCI9PT1zKXtjb25zdCBlPU9iamVjdC5rZXlzKG8pO3Quc29ydChmdW5jdGlvbih0LG4pe2ZvcihsZXQgcj0wO3I8ZS5sZW5ndGg7cisrKXtjb25zdCBpPWVbcl07aWYodm9pZCAwPT09dFtpXSYmdm9pZCAwIT09bltpXSlyZXR1cm4tMSpvW2ldO2lmKHZvaWQgMCE9PXRbaV0mJnZvaWQgMD09PW5baV0pcmV0dXJuIDEqb1tpXTtpZih0W2ldPG5baV0pcmV0dXJuLTEqb1tpXTtpZih0W2ldPm5baV0pcmV0dXJuIDEqb1tpXX1yZXR1cm4gMH0pfWVsc2UgaWYoIiRsaW1pdCI9PT1zKXQ9dC5zbGljZSgwLG8pO2Vsc2UgaWYoIiRza2lwIj09PXMpdD10LnNsaWNlKG8pO2Vsc2UgaWYoIiRncm91cCI9PT1zKXtjb25zdCBlPXt9LG49by5faWQ7Zm9yKGxldCBpPTA7aTx0Lmxlbmd0aDtpKyspe2NvbnN0IHI9dFtpXTtsZXQgcztzPW51bGw9PW4/bnVsbDpOZShuLHIpO2NvbnN0IG89SlNPTi5zdHJpbmdpZnkocyk7ZVtvXXx8KGVbb109e19pZDpzLGRvY3M6W10sYWNjdW11bGF0b3JzOnt9fSksZVtvXS5kb2NzLnB1c2gocil9Y29uc3Qgcj1bXTtmb3IoY29uc3QgdCBpbiBlKXtjb25zdCBuPWVbdF0saT17X2lkOm4uX2lkfTtmb3IoY29uc3QgZSBpbiBvKXtpZigiX2lkIj09PWUpY29udGludWU7Y29uc3QgdD1vW2VdLHI9T2JqZWN0LmtleXModCk7aWYoMSE9PXIubGVuZ3RoKWNvbnRpbnVlO2NvbnN0IHM9clswXSxhPXRbc107aWYoIiRzdW0iPT09cyl7bGV0IHQ9MDtmb3IobGV0IGU9MDtlPG4uZG9jcy5sZW5ndGg7ZSsrKXtjb25zdCByPU5lKGEsbi5kb2NzW2VdKTsibnVtYmVyIj09dHlwZW9mIHI/dCs9cjpudWxsIT1yJiYodCs9TnVtYmVyKHIpfHwwKX1pW2VdPXR9ZWxzZSBpZigiJGF2ZyI9PT1zKXtsZXQgdD0wLHI9MDtmb3IobGV0IGU9MDtlPG4uZG9jcy5sZW5ndGg7ZSsrKXtjb25zdCBpPU5lKGEsbi5kb2NzW2VdKTtudWxsIT1pJiYodCs9TnVtYmVyKGkpfHwwLHIrKyl9aVtlXT1yPjA/dC9yOjB9ZWxzZSBpZigiJG1pbiI9PT1zKXtsZXQgdDtmb3IobGV0IGU9MDtlPG4uZG9jcy5sZW5ndGg7ZSsrKXtjb25zdCByPU5lKGEsbi5kb2NzW2VdKTt2b2lkIDAhPT1yJiYodm9pZCAwPT09dHx8cjx0KSYmKHQ9cil9aVtlXT10fWVsc2UgaWYoIiRtYXgiPT09cyl7bGV0IHQ7Zm9yKGxldCBlPTA7ZTxuLmRvY3MubGVuZ3RoO2UrKyl7Y29uc3Qgcj1OZShhLG4uZG9jc1tlXSk7dm9pZCAwIT09ciYmKHZvaWQgMD09PXR8fHI+dCkmJih0PXIpfWlbZV09dH1lbHNlIGlmKCIkcHVzaCI9PT1zKXtjb25zdCB0PVtdO2ZvcihsZXQgZT0wO2U8bi5kb2NzLmxlbmd0aDtlKyspe2NvbnN0IHI9TmUoYSxuLmRvY3NbZV0pO3QucHVzaChyKX1pW2VdPXR9ZWxzZSBpZigiJGFkZFRvU2V0Ij09PXMpe2NvbnN0IHQ9e307Zm9yKGxldCBlPTA7ZTxuLmRvY3MubGVuZ3RoO2UrKyl7Y29uc3Qgcj1OZShhLG4uZG9jc1tlXSk7dFtKU09OLnN0cmluZ2lmeShyKV09cn1jb25zdCByPVtdO2Zvcihjb25zdCBlIGluIHQpci5wdXNoKHRbZV0pO2lbZV09cn1lbHNlIGlmKCIkZmlyc3QiPT09cyluLmRvY3MubGVuZ3RoPjAmJihpW2VdPU5lKGEsbi5kb2NzWzBdKSk7ZWxzZSBpZigiJGxhc3QiPT09cyluLmRvY3MubGVuZ3RoPjAmJihpW2VdPU5lKGEsbi5kb2NzW24uZG9jcy5sZW5ndGgtMV0pKTtlbHNlIGlmKCIkc3RkRGV2UG9wIj09PXMpe2NvbnN0IHQ9W107Zm9yKGxldCBlPTA7ZTxuLmRvY3MubGVuZ3RoO2UrKyl7Y29uc3Qgcj1OZShhLG4uZG9jc1tlXSk7Im51bWJlciI9PXR5cGVvZiByJiZ0LnB1c2gocil9aWYodC5sZW5ndGg+MCl7Y29uc3Qgbj10LnJlZHVjZSgoZSx0KT0+ZSt0LDApL3QubGVuZ3RoLHI9dC5yZWR1Y2UoKGUsdCk9PmUrTWF0aC5wb3codC1uLDIpLDApL3QubGVuZ3RoO2lbZV09TWF0aC5zcXJ0KHIpfWVsc2UgaVtlXT0wfWVsc2UgaWYoIiRzdGREZXZTYW1wIj09PXMpe2NvbnN0IHQ9W107Zm9yKGxldCBlPTA7ZTxuLmRvY3MubGVuZ3RoO2UrKyl7Y29uc3Qgcj1OZShhLG4uZG9jc1tlXSk7Im51bWJlciI9PXR5cGVvZiByJiZ0LnB1c2gocil9aWYodC5sZW5ndGg+MSl7Y29uc3Qgbj10LnJlZHVjZSgoZSx0KT0+ZSt0LDApL3QubGVuZ3RoLHI9dC5yZWR1Y2UoKGUsdCk9PmUrTWF0aC5wb3codC1uLDIpLDApLyh0Lmxlbmd0aC0xKTtpW2VdPU1hdGguc3FydChyKX1lbHNlIGlbZV09MH1lbHNlIGlmKCIkbWVyZ2VPYmplY3RzIj09PXMpe2NvbnN0IHQ9e307Zm9yKGxldCBlPTA7ZTxuLmRvY3MubGVuZ3RoO2UrKyl7Y29uc3Qgcj1OZShhLG4uZG9jc1tlXSk7Im9iamVjdCIhPXR5cGVvZiByfHxudWxsPT09cnx8QXJyYXkuaXNBcnJheShyKXx8T2JqZWN0LmFzc2lnbih0LHIpfWlbZV09dH19ci5wdXNoKGkpfXQ9cn1lbHNlIGlmKCIkY291bnQiPT09cyl0PVt7W29dOnQubGVuZ3RofV07ZWxzZSBpZigiJHVud2luZCI9PT1zKXtjb25zdCBlPVtdO2xldCBuPW87InN0cmluZyI9PXR5cGVvZiBuJiYiJCI9PT1uLmNoYXJBdCgwKSYmKG49bi5zdWJzdHJpbmcoMSkpO2ZvcihsZXQgcj0wO3I8dC5sZW5ndGg7cisrKXtjb25zdCBpPXRbcl0scz12KGksbik7aWYocyYmSShzKSYmcy5sZW5ndGg+MClmb3IobGV0IHQ9MDt0PHMubGVuZ3RoO3QrKyl7Y29uc3Qgcj1fKGkpLG89bi5zcGxpdCgiLiIpO2xldCBhPXI7Zm9yKGxldCBlPTA7ZTxvLmxlbmd0aC0xO2UrKylhW29bZV1dfHwoYVtvW2VdXT17fSksYT1hW29bZV1dO2Fbb1tvLmxlbmd0aC0xXV09c1t0XSxlLnB1c2gocil9fXQ9ZX1lbHNlIGlmKCIkc29ydEJ5Q291bnQiPT09cyl7Y29uc3QgZT17fTtmb3IobGV0IG49MDtuPHQubGVuZ3RoO24rKyl7Y29uc3Qgcj10W25dLGk9TmUobyxyKSxzPUpTT04uc3RyaW5naWZ5KGkpO2Vbc118fChlW3NdPXtfaWQ6aSxjb3VudDowfSksZVtzXS5jb3VudCsrfXQ9T2JqZWN0LnZhbHVlcyhlKS5zb3J0KChlLHQpPT50LmNvdW50LWUuY291bnQpfWVsc2UgaWYoIiRyZXBsYWNlUm9vdCI9PT1zfHwiJHJlcGxhY2VXaXRoIj09PXMpe2NvbnN0IGU9W10sbj0iJHJlcGxhY2VSb290Ij09PXM/by5uZXdSb290Om87Zm9yKGxldCByPTA7cjx0Lmxlbmd0aDtyKyspe2NvbnN0IGk9TmUobix0W3JdKTtpZigib2JqZWN0IiE9dHlwZW9mIGl8fG51bGw9PT1pfHxBcnJheS5pc0FycmF5KGkpKXRocm93IG5ldyBWKCIkcmVwbGFjZVJvb3QgZXhwcmVzc2lvbiBtdXN0IGV2YWx1YXRlIHRvIGFuIG9iamVjdCIse2NvbGxlY3Rpb246dGhpcy5uYW1lLGNvZGU6a30pO2UucHVzaChpKX10PWV9ZWxzZSBpZigiJHNhbXBsZSI9PT1zKXtjb25zdCBlPW8uc2l6ZXx8MTtpZigibnVtYmVyIiE9dHlwZW9mIGV8fGU8MCl0aHJvdyBuZXcgVigiJHNhbXBsZSBzaXplIG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyIix7Y29sbGVjdGlvbjp0aGlzLm5hbWUsY29kZTprfSk7Y29uc3Qgbj1bLi4udF07Zm9yKGxldCB0PW4ubGVuZ3RoLTE7dD4wO3QtLSl7Y29uc3QgZT1NYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqKHQrMSkpO1tuW3RdLG5bZV1dPVtuW2VdLG5bdF1dfXQ9bi5zbGljZSgwLE1hdGgubWluKGUsbi5sZW5ndGgpKX1lbHNlIGlmKCIkYnVja2V0Ij09PXMpe2lmKCFvLmdyb3VwQnl8fCFvLmJvdW5kYXJpZXMpdGhyb3cgbmV3IFYoIiRidWNrZXQgcmVxdWlyZXMgZ3JvdXBCeSBhbmQgYm91bmRhcmllcyIse2NvbGxlY3Rpb246dGhpcy5uYW1lLGNvZGU6a30pO2NvbnN0IGU9by5ib3VuZGFyaWVzLG49by5kZWZhdWx0LHI9by5vdXRwdXR8fHtjb3VudDp7JHN1bToxfX0saT17fTtmb3IobGV0IHQ9MDt0PGUubGVuZ3RoLTE7dCsrKXtpW0pTT04uc3RyaW5naWZ5KGVbdF0pXT17X2lkOmVbdF0sZG9jczpbXX19dm9pZCAwIT09biYmKGkuZGVmYXVsdD17X2lkOm4sZG9jczpbXX0pO2ZvcihsZXQgYT0wO2E8dC5sZW5ndGg7YSsrKXtjb25zdCByPXRbYV0scz1OZShvLmdyb3VwQnkscik7bGV0IGM9ITE7Zm9yKGxldCB0PTA7dDxlLmxlbmd0aC0xO3QrKylpZihzPj1lW3RdJiZzPGVbdCsxXSl7aVtKU09OLnN0cmluZ2lmeShlW3RdKV0uZG9jcy5wdXNoKHIpLGM9ITA7YnJlYWt9Y3x8dm9pZCAwPT09bnx8aS5kZWZhdWx0LmRvY3MucHVzaChyKX1jb25zdCBzPVtdO2Zvcihjb25zdCB0IGluIGkpe2NvbnN0IGU9aVt0XTtpZigwPT09ZS5kb2NzLmxlbmd0aCljb250aW51ZTtjb25zdCBuPXtfaWQ6ZS5faWR9O2Zvcihjb25zdCB0IGluIHIpe2NvbnN0IGk9clt0XSxzPU9iamVjdC5rZXlzKGkpO2lmKDEhPT1zLmxlbmd0aCljb250aW51ZTtjb25zdCBvPXNbMF0sYT1pW29dO2lmKCIkc3VtIj09PW8pe2xldCByPTA7Zm9yKGxldCB0PTA7dDxlLmRvY3MubGVuZ3RoO3QrKyl7Y29uc3Qgbj1OZShhLGUuZG9jc1t0XSk7Im51bWJlciI9PXR5cGVvZiBuP3IrPW46bnVsbCE9biYmKHIrPU51bWJlcihuKXx8MCl9blt0XT1yfWVsc2UgaWYoIiRhdmciPT09byl7bGV0IHI9MCxpPTA7Zm9yKGxldCB0PTA7dDxlLmRvY3MubGVuZ3RoO3QrKyl7Y29uc3Qgbj1OZShhLGUuZG9jc1t0XSk7bnVsbCE9biYmKHIrPU51bWJlcihuKXx8MCxpKyspfW5bdF09aT4wP3IvaTowfWVsc2UgaWYoIiRwdXNoIj09PW8pe2NvbnN0IHI9W107Zm9yKGxldCB0PTA7dDxlLmRvY3MubGVuZ3RoO3QrKyl7Y29uc3Qgbj1OZShhLGUuZG9jc1t0XSk7ci5wdXNoKG4pfW5bdF09cn1lbHNlIGlmKCIkYWRkVG9TZXQiPT09byl7Y29uc3Qgcj17fTtmb3IobGV0IHQ9MDt0PGUuZG9jcy5sZW5ndGg7dCsrKXtjb25zdCBuPU5lKGEsZS5kb2NzW3RdKTtyW0pTT04uc3RyaW5naWZ5KG4pXT1ufW5bdF09T2JqZWN0LnZhbHVlcyhyKX19cy5wdXNoKG4pfXQ9cy5zb3J0KChlLHQpPT5lLl9pZDx0Ll9pZD8tMTplLl9pZD50Ll9pZD8xOjApfWVsc2UgaWYoIiRidWNrZXRBdXRvIj09PXMpe2lmKCFvLmdyb3VwQnl8fCFvLmJ1Y2tldHMpdGhyb3cgbmV3IFYoIiRidWNrZXRBdXRvIHJlcXVpcmVzIGdyb3VwQnkgYW5kIGJ1Y2tldHMiLHtjb2xsZWN0aW9uOnRoaXMubmFtZSxjb2RlOmt9KTtjb25zdCBlPW8uYnVja2V0cyxuPW8ub3V0cHV0fHx7Y291bnQ6eyRzdW06MX19O2lmKDA9PT10Lmxlbmd0aCl0PVtdO2Vsc2V7Y29uc3Qgcj10Lm1hcChlPT4oe3ZhbHVlOk5lKG8uZ3JvdXBCeSxlKSxkb2M6ZX0pKS5zb3J0KChlLHQpPT5lLnZhbHVlPHQudmFsdWU/LTE6ZS52YWx1ZT50LnZhbHVlPzE6MCksaT1NYXRoLmNlaWwoci5sZW5ndGgvZSkscz1bXTtmb3IobGV0IHQ9MDt0PGUmJnQqaTxyLmxlbmd0aDt0Kyspe2NvbnN0IGU9dCppLG49TWF0aC5taW4oKHQrMSkqaSxyLmxlbmd0aCksbz1yLnNsaWNlKGUsbik7aWYoMD09PW8ubGVuZ3RoKWNvbnRpbnVlO2NvbnN0IGE9e19pZDp7bWluOm9bMF0udmFsdWUsbWF4OihyLmxlbmd0aCxvW28ubGVuZ3RoLTFdLnZhbHVlKX0sZG9jczpvLm1hcChlPT5lLmRvYyl9O3MucHVzaChhKX1jb25zdCBhPVtdO2ZvcihsZXQgZT0wO2U8cy5sZW5ndGg7ZSsrKXtjb25zdCB0PXNbZV0scj17X2lkOnQuX2lkfTtmb3IoY29uc3QgZSBpbiBuKXtjb25zdCBpPW5bZV0scz1PYmplY3Qua2V5cyhpKTtpZigxIT09cy5sZW5ndGgpY29udGludWU7Y29uc3Qgbz1zWzBdLGE9aVtvXTtpZigiJHN1bSI9PT1vKXtsZXQgbj0wO2ZvcihsZXQgZT0wO2U8dC5kb2NzLmxlbmd0aDtlKyspe2NvbnN0IHI9TmUoYSx0LmRvY3NbZV0pOyJudW1iZXIiPT10eXBlb2Ygcj9uKz1yOm51bGwhPXImJihuKz1OdW1iZXIocil8fDApfXJbZV09bn1lbHNlIGlmKCIkYXZnIj09PW8pe2xldCBuPTAsaT0wO2ZvcihsZXQgZT0wO2U8dC5kb2NzLmxlbmd0aDtlKyspe2NvbnN0IHI9TmUoYSx0LmRvY3NbZV0pO251bGwhPXImJihuKz1OdW1iZXIocil8fDAsaSsrKX1yW2VdPWk+MD9uL2k6MH1lbHNlIGlmKCIkcHVzaCI9PT1vKXtjb25zdCBuPVtdO2ZvcihsZXQgZT0wO2U8dC5kb2NzLmxlbmd0aDtlKyspe2NvbnN0IHI9TmUoYSx0LmRvY3NbZV0pO24ucHVzaChyKX1yW2VdPW59fWEucHVzaChyKX10PWF9fWVsc2UgaWYoIiRvdXQiPT09cyl7Y29uc3QgZT1vO2lmKCJzdHJpbmciIT10eXBlb2YgZSl0aHJvdyBuZXcgVigiJG91dCByZXF1aXJlcyBhIHN0cmluZyBjb2xsZWN0aW9uIG5hbWUiLHtjb2xsZWN0aW9uOnRoaXMubmFtZSxjb2RlOmt9KTt0aGlzLmRiLmNvbGxlY3Rpb25zLmhhcyhlKSYmYXdhaXQgdGhpcy5kYi5kcm9wQ29sbGVjdGlvbihlKTtjb25zdCBuPXRoaXMuZGJbZV07Zm9yKGxldCByPTA7cjx0Lmxlbmd0aDtyKyspe2NvbnN0IGU9dFtyXSxpPWUuX2lkOyJvYmplY3QiPT10eXBlb2YgaSYmaS50b1N0cmluZz9pLnRvU3RyaW5nKCk6U3RyaW5nKGkpLGF3YWl0IG4uaW5zZXJ0T25lKGUpfXQ9W119ZWxzZSBpZigiJG1lcmdlIj09PXMpe2xldCBlLG49Il9pZCIscj0ibWVyZ2UiLGk9Imluc2VydCI7aWYoInN0cmluZyI9PXR5cGVvZiBvP2U9bzoib2JqZWN0Ij09dHlwZW9mIG8mJihlPW8uaW50byxuPW8ub258fG4scj1vLndoZW5NYXRjaGVkfHxyLGk9by53aGVuTm90TWF0Y2hlZHx8aSksIWUpdGhyb3cgbmV3IFYoIiRtZXJnZSByZXF1aXJlcyBhIHRhcmdldCBjb2xsZWN0aW9uIix7Y29sbGVjdGlvbjp0aGlzLm5hbWUsY29kZTprfSk7Y29uc3Qgcz10aGlzLmRiW2VdO2ZvcihsZXQgbz0wO288dC5sZW5ndGg7bysrKXtjb25zdCBlPXRbb10sYT0ic3RyaW5nIj09dHlwZW9mIG4/bjpuWzBdLGM9dihlLGEpLGw9cy5maW5kKHtbYV06Y30pO2F3YWl0IGwuX2Vuc3VyZUluaXRpYWxpemVkKCk7Y29uc3QgdT1hd2FpdCBsLmhhc05leHQoKT9hd2FpdCBsLm5leHQoKTpudWxsO2lmKHUpe2lmKCJyZXBsYWNlIj09PXIpYXdhaXQgcy5yZXBsYWNlT25lKHtfaWQ6dS5faWR9LGUpO2Vsc2UgaWYoIm1lcmdlIj09PXIpe2NvbnN0IHQ9T2JqZWN0LmFzc2lnbih7fSx1LGUpO2F3YWl0IHMucmVwbGFjZU9uZSh7X2lkOnUuX2lkfSx0KX1lbHNlIGlmKCJrZWVwRXhpc3RpbmciPT09cik7ZWxzZSBpZigiZmFpbCI9PT1yKXRocm93IG5ldyBWKCIkbWVyZ2UgZmFpbGVkOiBkdXBsaWNhdGUga2V5Iix7Y29sbGVjdGlvbjp0aGlzLm5hbWUsY29kZTpCfSl9ZWxzZSBpZigiaW5zZXJ0Ij09PWkpYXdhaXQgcy5pbnNlcnRPbmUoZSk7ZWxzZSBpZigiZGlzY2FyZCI9PT1pKTtlbHNlIGlmKCJmYWlsIj09PWkpdGhyb3cgbmV3IFYoIiRtZXJnZSBmYWlsZWQ6IGRvY3VtZW50IG5vdCBmb3VuZCIse2NvbGxlY3Rpb246dGhpcy5uYW1lLGNvZGU6a30pfXQ9W119ZWxzZSBpZigiJGxvb2t1cCI9PT1zKXtpZighKG8uZnJvbSYmby5sb2NhbEZpZWxkJiZvLmZvcmVpZ25GaWVsZCYmby5hcykpdGhyb3cgbmV3IFYoIiRsb29rdXAgcmVxdWlyZXMgZnJvbSwgbG9jYWxGaWVsZCwgZm9yZWlnbkZpZWxkLCBhbmQgYXMiLHtjb2xsZWN0aW9uOnRoaXMubmFtZSxjb2RlOmt9KTtpZighdGhpcy5kYi5nZXRDb2xsZWN0aW9uTmFtZXMoKS5pbmNsdWRlcyhvLmZyb20pKXRocm93IG5ldyBWKCIkbG9va3VwOiBjb2xsZWN0aW9uIG5vdCBmb3VuZDogIitvLmZyb20se2NvbGxlY3Rpb246dGhpcy5uYW1lLGNvZGU6UH0pO2NvbnN0IGU9dGhpcy5kYltvLmZyb21dLG49W107Zm9yKGxldCByPTA7cjx0Lmxlbmd0aDtyKyspe2NvbnN0IGk9Xyh0W3JdKSxzPXYoaSxvLmxvY2FsRmllbGQpLGE9W10sYz1lLmZpbmQoe1tvLmZvcmVpZ25GaWVsZF06c30pO2Zvcihhd2FpdCBjLl9lbnN1cmVJbml0aWFsaXplZCgpO2F3YWl0IGMuaGFzTmV4dCgpOylhLnB1c2goYXdhaXQgYy5uZXh0KCkpO2lbby5hc109YSxuLnB1c2goaSl9dD1ufWVsc2UgaWYoIiRncmFwaExvb2t1cCI9PT1zKXtpZighKG8uZnJvbSYmby5zdGFydFdpdGgmJm8uY29ubmVjdEZyb21GaWVsZCYmby5jb25uZWN0VG9GaWVsZCYmby5hcykpdGhyb3cgbmV3IFYoIiRncmFwaExvb2t1cCByZXF1aXJlcyBmcm9tLCBzdGFydFdpdGgsIGNvbm5lY3RGcm9tRmllbGQsIGNvbm5lY3RUb0ZpZWxkLCBhbmQgYXMiLHtjb2xsZWN0aW9uOnRoaXMubmFtZSxjb2RlOmt9KTtpZighdGhpcy5kYi5nZXRDb2xsZWN0aW9uTmFtZXMoKS5pbmNsdWRlcyhvLmZyb20pKXRocm93IG5ldyBWKCIkZ3JhcGhMb29rdXA6IGNvbGxlY3Rpb24gbm90IGZvdW5kOiAiK28uZnJvbSx7Y29sbGVjdGlvbjp0aGlzLm5hbWUsY29kZTpQfSk7Y29uc3QgZT10aGlzLmRiW28uZnJvbV0sbj12b2lkIDAhPT1vLm1heERlcHRoP28ubWF4RGVwdGg6TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIscj1vLmRlcHRoRmllbGQsaT1vLnJlc3RyaWN0U2VhcmNoV2l0aE1hdGNoLHM9W107Zm9yKGxldCBhPTA7YTx0Lmxlbmd0aDthKyspe2NvbnN0IGM9Xyh0W2FdKSxsPU5lKG8uc3RhcnRXaXRoLHRbYV0pLHU9LyogQF9fUFVSRV9fICovbmV3IFNldCxoPVtdLGY9W3t2YWx1ZTpsLGRlcHRoOjB9XTtmb3IoO2YubGVuZ3RoPjA7KXtjb25zdHt2YWx1ZTp0LGRlcHRoOnN9PWYuc2hpZnQoKTtpZihzPm4pY29udGludWU7Y29uc3QgYT1KU09OLnN0cmluZ2lmeSh0KTtpZih1LmhhcyhhKSljb250aW51ZTt1LmFkZChhKTtsZXQgYz17W28uY29ubmVjdFRvRmllbGRdOnR9O2kmJihjPXskYW5kOltjLGldfSk7Y29uc3QgbD1lLmZpbmQoYyk7Zm9yKGF3YWl0IGwuX2Vuc3VyZUluaXRpYWxpemVkKCk7YXdhaXQgbC5oYXNOZXh0KCk7KXtjb25zdCBlPWF3YWl0IGwubmV4dCgpLHQ9XyhlKTtyJiYodFtyXT1zKSxoLnB1c2godCk7Y29uc3Qgbj12KGUsby5jb25uZWN0RnJvbUZpZWxkKTtudWxsIT1uJiZmLnB1c2goe3ZhbHVlOm4sZGVwdGg6cysxfSl9fWNbby5hc109aCxzLnB1c2goYyl9dD1zfWVsc2UgaWYoIiRmYWNldCI9PT1zKXtpZigib2JqZWN0IiE9dHlwZW9mIG98fEFycmF5LmlzQXJyYXkobykpdGhyb3cgbmV3IFYoIiRmYWNldCByZXF1aXJlcyBhbiBvYmplY3Qgd2l0aCBwaXBlbGluZSBkZWZpbml0aW9ucyIse2NvbGxlY3Rpb246dGhpcy5uYW1lLGNvZGU6a30pO2NvbnN0IGU9e307Zm9yKGNvbnN0IG4gaW4gbyl7Y29uc3Qgcj1vW25dO2lmKCFBcnJheS5pc0FycmF5KHIpKXRocm93IG5ldyBWKCIkZmFjZXQgcGlwZWxpbmUgbXVzdCBiZSBhbiBhcnJheSIse2NvbGxlY3Rpb246dGhpcy5uYW1lLGNvZGU6a30pO2xldCBpPXQubWFwKGU9Pl8oZSkpO2ZvcihsZXQgZT0wO2U8ci5sZW5ndGg7ZSsrKXtjb25zdCB0PXJbZV0sbj1PYmplY3Qua2V5cyh0KTtpZigxIT09bi5sZW5ndGgpdGhyb3cgbmV3IFYoIkVhY2ggcGlwZWxpbmUgc3RhZ2UgbXVzdCBoYXZlIGV4YWN0bHkgb25lIGtleSIse2NvbGxlY3Rpb246dGhpcy5uYW1lLGNvZGU6a30pO2NvbnN0IHM9blswXSxvPXRbc107aWYoIiRtYXRjaCI9PT1zKXtjb25zdCBlPVtdO2ZvcihsZXQgdD0wO3Q8aS5sZW5ndGg7dCsrKVllKGlbdF0sbykmJmUucHVzaChpW3RdKTtpPWV9ZWxzZSBpZigiJHByb2plY3QiPT09cyl7Y29uc3QgZT1bXTtmb3IobGV0IHQ9MDt0PGkubGVuZ3RoO3QrKyllLnB1c2goUnQobyxpW3RdKSk7aT1lfWVsc2UgaWYoIiRsaW1pdCI9PT1zKWk9aS5zbGljZSgwLG8pO2Vsc2UgaWYoIiRza2lwIj09PXMpaT1pLnNsaWNlKG8pO2Vsc2UgaWYoIiRzb3J0Ij09PXMpe2NvbnN0IGU9T2JqZWN0LmtleXMobyk7aS5zb3J0KGZ1bmN0aW9uKHQsbil7Zm9yKGxldCByPTA7cjxlLmxlbmd0aDtyKyspe2NvbnN0IGk9ZVtyXTtpZih2b2lkIDA9PT10W2ldJiZ2b2lkIDAhPT1uW2ldKXJldHVybi0xKm9baV07aWYodm9pZCAwIT09dFtpXSYmdm9pZCAwPT09bltpXSlyZXR1cm4gMSpvW2ldO2lmKHRbaV08bltpXSlyZXR1cm4tMSpvW2ldO2lmKHRbaV0+bltpXSlyZXR1cm4gMSpvW2ldfXJldHVybiAwfSl9ZWxzZSBpZigiJGNvdW50Ij09PXMpaT1be1tvXTppLmxlbmd0aH1dO2Vsc2UgaWYoIiRncm91cCI9PT1zKXtjb25zdCBlPXt9LHQ9by5faWQ7Zm9yKGxldCByPTA7cjxpLmxlbmd0aDtyKyspe2NvbnN0IG49aVtyXTtsZXQgcztzPW51bGw9PXQ/bnVsbDpOZSh0LG4pO2NvbnN0IG89SlNPTi5zdHJpbmdpZnkocyk7ZVtvXXx8KGVbb109e19pZDpzLGRvY3M6W10sYWNjdW11bGF0b3JzOnt9fSksZVtvXS5kb2NzLnB1c2gobil9Y29uc3Qgbj1bXTtmb3IoY29uc3QgciBpbiBlKXtjb25zdCB0PWVbcl0saT17X2lkOnQuX2lkfTtmb3IoY29uc3QgZSBpbiBvKXtpZigiX2lkIj09PWUpY29udGludWU7Y29uc3Qgbj1vW2VdLHI9T2JqZWN0LmtleXMobik7aWYoMSE9PXIubGVuZ3RoKWNvbnRpbnVlO2NvbnN0IHM9clswXSxhPW5bc107aWYoIiRzdW0iPT09cyl7bGV0IG49MDtmb3IobGV0IGU9MDtlPHQuZG9jcy5sZW5ndGg7ZSsrKXtjb25zdCByPU5lKGEsdC5kb2NzW2VdKTsibnVtYmVyIj09dHlwZW9mIHI/bis9cjpudWxsIT1yJiYobis9TnVtYmVyKHIpfHwwKX1pW2VdPW59ZWxzZSBpZigiJGF2ZyI9PT1zKXtsZXQgbj0wLHI9MDtmb3IobGV0IGU9MDtlPHQuZG9jcy5sZW5ndGg7ZSsrKXtjb25zdCBpPU5lKGEsdC5kb2NzW2VdKTtudWxsIT1pJiYobis9TnVtYmVyKGkpfHwwLHIrKyl9aVtlXT1yPjA/bi9yOjB9ZWxzZSBpZigiJG1heCI9PT1zKXtsZXQgbjtmb3IobGV0IGU9MDtlPHQuZG9jcy5sZW5ndGg7ZSsrKXtjb25zdCByPU5lKGEsdC5kb2NzW2VdKTt2b2lkIDAhPT1yJiYodm9pZCAwPT09bnx8cj5uKSYmKG49cil9aVtlXT1ufX1uLnB1c2goaSl9aT1ufWVsc2UgaWYoIiRzb3J0QnlDb3VudCI9PT1zKXtjb25zdCBlPXt9O2ZvcihsZXQgdD0wO3Q8aS5sZW5ndGg7dCsrKXtjb25zdCBuPWlbdF0scj1OZShvLG4pLHM9SlNPTi5zdHJpbmdpZnkocik7ZVtzXXx8KGVbc109e19pZDpyLGNvdW50OjB9KSxlW3NdLmNvdW50Kyt9aT1PYmplY3QudmFsdWVzKGUpLnNvcnQoKGUsdCk9PnQuY291bnQtZS5jb3VudCl9ZWxzZSBpZigiJHNhbXBsZSI9PT1zKXtjb25zdCBlPW8uc2l6ZXx8MSx0PVsuLi5pXTtmb3IobGV0IG49dC5sZW5ndGgtMTtuPjA7bi0tKXtjb25zdCBlPU1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoobisxKSk7W3Rbbl0sdFtlXV09W3RbZV0sdFtuXV19aT10LnNsaWNlKDAsTWF0aC5taW4oZSx0Lmxlbmd0aCkpfWVsc2UgaWYoIiRidWNrZXQiPT09cyl7Y29uc3QgZT1vLmJvdW5kYXJpZXMsdD1vLmRlZmF1bHQsbj1vLm91dHB1dHx8e2NvdW50Onskc3VtOjF9fSxyPXt9O2ZvcihsZXQgaT0wO2k8ZS5sZW5ndGgtMTtpKyspe3JbSlNPTi5zdHJpbmdpZnkoZVtpXSldPXtfaWQ6ZVtpXSxkb2NzOltdfX12b2lkIDAhPT10JiYoci5kZWZhdWx0PXtfaWQ6dCxkb2NzOltdfSk7Zm9yKGxldCBhPTA7YTxpLmxlbmd0aDthKyspe2NvbnN0IG49aVthXSxzPU5lKG8uZ3JvdXBCeSxuKTtsZXQgYz0hMTtmb3IobGV0IHQ9MDt0PGUubGVuZ3RoLTE7dCsrKWlmKHM+PWVbdF0mJnM8ZVt0KzFdKXtyW0pTT04uc3RyaW5naWZ5KGVbdF0pXS5kb2NzLnB1c2gobiksYz0hMDticmVha31jfHx2b2lkIDA9PT10fHxyLmRlZmF1bHQuZG9jcy5wdXNoKG4pfWNvbnN0IHM9W107Zm9yKGNvbnN0IGkgaW4gcil7Y29uc3QgZT1yW2ldO2lmKDA9PT1lLmRvY3MubGVuZ3RoKWNvbnRpbnVlO2NvbnN0IHQ9e19pZDplLl9pZH07Zm9yKGNvbnN0IHIgaW4gbil7Y29uc3QgaT1uW3JdLHM9T2JqZWN0LmtleXMoaSk7aWYoMSE9PXMubGVuZ3RoKWNvbnRpbnVlO2NvbnN0IG89c1swXSxhPWlbb107aWYoIiRzdW0iPT09byl7bGV0IG49MDtmb3IobGV0IHQ9MDt0PGUuZG9jcy5sZW5ndGg7dCsrKXtjb25zdCByPU5lKGEsZS5kb2NzW3RdKTsibnVtYmVyIj09dHlwZW9mIHI/bis9cjpudWxsIT1yJiYobis9TnVtYmVyKHIpfHwwKX10W3JdPW59fXMucHVzaCh0KX1pPXMuc29ydCgoZSx0KT0+ZS5faWQ8dC5faWQ/LTE6ZS5faWQ+dC5faWQ/MTowKX19ZVtuXT1pfXQ9W2VdfWVsc2UgaWYoIiRyZWRhY3QiPT09cyl7Y29uc3QgZT1bXTtmb3IobGV0IG49MDtuPHQubGVuZ3RoO24rKyl7Y29uc3Qgcj10W25dLGk9TmUobyxyKTtpZigiJCRERVNDRU5EIj09PWkpZS5wdXNoKHIpO2Vsc2V7aWYoIiQkUFJVTkUiPT09aSljb250aW51ZTsoIiQkS0VFUCI9PT1pfHxpKSYmZS5wdXNoKHIpfX10PWV9ZWxzZXtpZigiJGdlb05lYXIiIT09cyl0aHJvdyBuZXcgVigiVW5zdXBwb3J0ZWQgYWdncmVnYXRpb24gc3RhZ2U6ICIrcyx7Y29sbGVjdGlvbjp0aGlzLm5hbWUsY29kZTprfSk7e2lmKCFvLm5lYXJ8fCFvLmRpc3RhbmNlRmllbGQpdGhyb3cgbmV3IFYoIiRnZW9OZWFyIHJlcXVpcmVzIG5lYXIgYW5kIGRpc3RhbmNlRmllbGQiLHtjb2xsZWN0aW9uOnRoaXMubmFtZSxjb2RlOmt9KTtjb25zdCBlPW8ubmVhcixuPW8uZGlzdGFuY2VGaWVsZCxyPW8ubWF4RGlzdGFuY2UsaT1vLm1pbkRpc3RhbmNlfHwwLHM9ITEhPT1vLnNwaGVyaWNhbCxhPW8ua2V5fHwibG9jYXRpb24iLGM9W107Zm9yKGxldCBvPTA7bzx0Lmxlbmd0aDtvKyspe2NvbnN0IGw9Xyh0W29dKSx1PXYobCxhKTtpZighdXx8IUFycmF5LmlzQXJyYXkodSl8fHUubGVuZ3RoPDIpY29udGludWU7bGV0IGg7aWYocyl7Y29uc3QgdD02MzcxZTMsbj1lWzFdKk1hdGguUEkvMTgwLHI9dVsxXSpNYXRoLlBJLzE4MCxpPSh1WzFdLWVbMV0pKk1hdGguUEkvMTgwLHM9KHVbMF0tZVswXSkqTWF0aC5QSS8xODAsbz1NYXRoLnNpbihpLzIpKk1hdGguc2luKGkvMikrTWF0aC5jb3MobikqTWF0aC5jb3MocikqTWF0aC5zaW4ocy8yKSpNYXRoLnNpbihzLzIpO2g9dCooMipNYXRoLmF0YW4yKE1hdGguc3FydChvKSxNYXRoLnNxcnQoMS1vKSkpfWVsc2V7Y29uc3QgdD11WzBdLWVbMF0sbj11WzFdLWVbMV07aD1NYXRoLnNxcnQodCp0K24qbil9aD49aSYmKCFyfHxoPD1yKSYmKGxbbl09aCxjLnB1c2gobCkpfWMuc29ydCgoZSx0KT0+ZVtuXS10W25dKSx0PW8ubGltaXQ/Yy5zbGljZSgwLG8ubGltaXQpOmN9fX1yZXR1cm4gdH1hc3luYyBidWxrV3JpdGUoKXt0aHJvdyBuZXcgSCgiYnVsa1dyaXRlIix7Y29sbGVjdGlvbjp0aGlzLm5hbWV9KX1hc3luYyBjb3VudCgpe3RoaXMuX2luaXRpYWxpemVkfHxhd2FpdCB0aGlzLl9pbml0aWFsaXplKCk7bGV0IGU9MDtmb3IgYXdhaXQoY29uc3QgdCBvZiB0aGlzLmRvY3VtZW50cyllKys7cmV0dXJuIGV9YXN5bmMgY29weVRvKGUpe3RoaXMuZGIuY3JlYXRlQ29sbGVjdGlvbihlKTtjb25zdCB0PXRoaXMuZGIuZ2V0Q29sbGVjdGlvbihlKTtsZXQgbj0wO2NvbnN0IHI9dGhpcy5maW5kKHt9KTtmb3IoYXdhaXQgci5fZW5zdXJlSW5pdGlhbGl6ZWQoKTthd2FpdCByLmhhc05leHQoKTspYXdhaXQgdC5pbnNlcnRPbmUoYXdhaXQgci5uZXh0KCkpLG4rKztyZXR1cm4gbn1hc3luYyBjcmVhdGVJbmRleChlLHQpe2lmKHRoaXMuX2luaXRpYWxpemVkfHxhd2FpdCB0aGlzLl9pbml0aWFsaXplKCksIWV8fCJvYmplY3QiIT10eXBlb2YgZXx8QXJyYXkuaXNBcnJheShlKSl0aHJvdyBuZXcgVygia2V5cyIsZSwiY3JlYXRlSW5kZXggcmVxdWlyZXMgYSBrZXkgc3BlY2lmaWNhdGlvbiBvYmplY3QiLHtjb2xsZWN0aW9uOnRoaXMubmFtZX0pO2NvbnN0IG49dCYmdC5uYW1lP3QubmFtZTp0aGlzLmdlbmVyYXRlSW5kZXhOYW1lKGUpO2lmKHRoaXMuaW5kZXhlcy5oYXMobikpe2NvbnN0IHQ9dGhpcy5pbmRleGVzLmdldChuKTtpZihKU09OLnN0cmluZ2lmeSh0LmtleXMpIT09SlNPTi5zdHJpbmdpZnkoZSkpdGhyb3cgbmV3IHEoIkluZGV4IHdpdGggbmFtZSAnIituKyInIGFscmVhZHkgZXhpc3RzIHdpdGggYSBkaWZmZXJlbnQga2V5IHNwZWNpZmljYXRpb24iLHtjb2RlOkwsaW5kZXg6bixjb2xsZWN0aW9uOnRoaXMubmFtZX0pO3JldHVybiBufXJldHVybiBhd2FpdCB0aGlzLl9idWlsZEluZGV4KG4sZSx0KSxufWRhdGFTaXplKCl7dGhyb3cgbmV3IEgoImRhdGFTaXplIix7Y29sbGVjdGlvbjp0aGlzLm5hbWV9KX1hc3luYyBkZWxldGVPbmUoZSl7Y29uc3QgdD1hd2FpdCB0aGlzLmZpbmRPbmUoZSk7cmV0dXJuIHQ/KGF3YWl0IHRoaXMudXBkYXRlSW5kZXhlc09uRGVsZXRlKHQpLGF3YWl0IHRoaXMuZG9jdW1lbnRzLmRlbGV0ZSh0Ll9pZC50b1N0cmluZygpKSx0aGlzLmVtaXQoImRlbGV0ZSIse19pZDp0Ll9pZH0pLHtkZWxldGVkQ291bnQ6MX0pOntkZWxldGVkQ291bnQ6MH19YXN5bmMgZGVsZXRlTWFueShlKXtjb25zdCB0PXRoaXMuZmluZChlKTthd2FpdCB0Ll9lbnN1cmVJbml0aWFsaXplZCgpO2NvbnN0IG49W10scj1bXTtmb3IoO2F3YWl0IHQuaGFzTmV4dCgpOyl7Y29uc3QgZT1hd2FpdCB0Lm5leHQoKTtuLnB1c2goZS5faWQpLHIucHVzaChlKX1jb25zdCBpPW4ubGVuZ3RoO2ZvcihsZXQgcz0wO3M8bi5sZW5ndGg7cysrKWF3YWl0IHRoaXMudXBkYXRlSW5kZXhlc09uRGVsZXRlKHJbc10pLHRoaXMuZG9jdW1lbnRzLmRlbGV0ZShuW3NdLnRvU3RyaW5nKCkpLHRoaXMuZW1pdCgiZGVsZXRlIix7X2lkOm5bc119KTtyZXR1cm57ZGVsZXRlZENvdW50Oml9fWFzeW5jIGRpc3RpbmN0KGUsdCl7Y29uc3Qgbj17fSxyPXRoaXMuZmluZCh0KTtmb3IoYXdhaXQgci5fZW5zdXJlSW5pdGlhbGl6ZWQoKTthd2FpdCByLmhhc05leHQoKTspe2NvbnN0IHQ9YXdhaXQgci5uZXh0KCk7dFtlXSYmKG5bdFtlXV09ITApfXJldHVybiBPYmplY3Qua2V5cyhuKX1hc3luYyBkcm9wKCl7dGhpcy5faW5pdGlhbGl6ZWR8fGF3YWl0IHRoaXMuX2luaXRpYWxpemUoKTtmb3IoY29uc3RbaSxzXW9mIHRoaXMuaW5kZXhlcylzJiYiZnVuY3Rpb24iPT10eXBlb2Ygcy5jbG9zZSYmYXdhaXQgcy5jbG9zZSgpO3RoaXMuZG9jdW1lbnRzJiYiZnVuY3Rpb24iPT10eXBlb2YgdGhpcy5kb2N1bWVudHMuY2xvc2UmJmF3YWl0IHRoaXMuZG9jdW1lbnRzLmNsb3NlKCksdGhpcy5fcmVsZWFzZURvY3VtZW50cyYmKGF3YWl0IHRoaXMuX3JlbGVhc2VEb2N1bWVudHMoKSx0aGlzLl9yZWxlYXNlRG9jdW1lbnRzPW51bGwpO3RyeXtjb25zdCBlPXRoaXMucGF0aC5zcGxpdCgiLyIpLmZpbHRlcihCb29sZWFuKTtsZXQgdD1hd2FpdCBnbG9iYWxUaGlzLm5hdmlnYXRvci5zdG9yYWdlLmdldERpcmVjdG9yeSgpO2Zvcihjb25zdCBuIG9mIGUpdD1hd2FpdCB0LmdldERpcmVjdG9yeUhhbmRsZShuLHtjcmVhdGU6ITF9KTtjb25zdCByPVtdO2ZvciBhd2FpdChjb25zdFtuLGldb2YgdC5lbnRyaWVzKCkpci5wdXNoKG4pO2Zvcihjb25zdCBpIG9mIHIpdHJ5e2F3YWl0IHQucmVtb3ZlRW50cnkoaSx7cmVjdXJzaXZlOiExfSl9Y2F0Y2gobil7fX1jYXRjaChyKXt9Y29uc3QgZT10aGlzLnBhdGguc3BsaXQoIi8iKS5maWx0ZXIoQm9vbGVhbiksdD1lLnBvcCgpO3RyeXtsZXQgcj1hd2FpdCBnbG9iYWxUaGlzLm5hdmlnYXRvci5zdG9yYWdlLmdldERpcmVjdG9yeSgpO2Zvcihjb25zdCB0IG9mIGUpcj1hd2FpdCByLmdldERpcmVjdG9yeUhhbmRsZSh0LHtjcmVhdGU6ITF9KTt0cnl7YXdhaXQgci5yZW1vdmVFbnRyeSh0LHtyZWN1cnNpdmU6ITB9KX1jYXRjaChuKXtpZigiVHlwZUVycm9yIiE9PW4ubmFtZSYmIW4ubWVzc2FnZT8uaW5jbHVkZXMoInJlY3Vyc2l2ZSIpKXRocm93IG47YXdhaXQgci5yZW1vdmVFbnRyeSh0KX19Y2F0Y2gocil7aWYoIk5vdEZvdW5kRXJyb3IiIT09ci5uYW1lJiYiRU5PRU5UIiE9PXIuY29kZSl0aHJvdyByfXJldHVybiB0aGlzLmRvY3VtZW50cz1udWxsLHRoaXMuaW5kZXhlcy5jbGVhcigpLHRoaXMuX2luaXRpYWxpemVkPSExLHRoaXMuZGIuY29sbGVjdGlvbnMuZGVsZXRlKHRoaXMubmFtZSksdGhpcy5lbWl0KCJkcm9wIix7Y29sbGVjdGlvbjp0aGlzLm5hbWV9KSx7b2s6MX19YXN5bmMgZHJvcEluZGV4KGUpe2lmKCF0aGlzLmluZGV4ZXMuaGFzKGUpKXRocm93IG5ldyBSKGUse2NvbGxlY3Rpb246dGhpcy5uYW1lfSk7Y29uc3QgdD10aGlzLmluZGV4ZXMuZ2V0KGUpO3JldHVybiB0JiYiZnVuY3Rpb24iPT10eXBlb2YgdC5jbGVhciYmYXdhaXQgdC5jbGVhcigpLHQmJiJmdW5jdGlvbiI9PXR5cGVvZiB0LmNsb3NlJiZhd2FpdCB0LmNsb3NlKCksdGhpcy5pbmRleGVzLmRlbGV0ZShlKSx7bkluZGV4ZXNXYXM6dGhpcy5pbmRleGVzLnNpemUrMSxvazoxfX1hc3luYyBkcm9wSW5kZXhlcygpe2NvbnN0IGU9dGhpcy5pbmRleGVzLnNpemU7Zm9yKGNvbnN0W3Qsbl1vZiB0aGlzLmluZGV4ZXMpbiYmImZ1bmN0aW9uIj09dHlwZW9mIG4uY2xlYXImJmF3YWl0IG4uY2xlYXIoKSxuJiYiZnVuY3Rpb24iPT10eXBlb2Ygbi5jbG9zZSYmYXdhaXQgbi5jbG9zZSgpO3JldHVybiB0aGlzLmluZGV4ZXMuY2xlYXIoKSx7bkluZGV4ZXNXYXM6ZSxtc2c6Im5vbi1faWQgaW5kZXhlcyBkcm9wcGVkIixvazoxfX1lbnN1cmVJbmRleCgpe3Rocm93IG5ldyBIKCJlbnN1cmVJbmRleCIse2NvbGxlY3Rpb246dGhpcy5uYW1lfSl9ZXhwbGFpbigpe3Rocm93IG5ldyBIKCJleHBsYWluIix7Y29sbGVjdGlvbjp0aGlzLm5hbWV9KX1maW5kKGUsdCl7dGhpcy5fdmFsaWRhdGVQcm9qZWN0aW9uKHQpO2NvbnN0IG49dGhpcy5fZmluZEludGVybmFsKGUsdCk7cmV0dXJuIG5ldyBRKHRoaXMsZSx0LG4sSil9X3ZhbGlkYXRlUHJvamVjdGlvbihlKXtpZighZXx8MD09PU9iamVjdC5rZXlzKGUpLmxlbmd0aClyZXR1cm47Y29uc3QgdD1PYmplY3Qua2V5cyhlKTtsZXQgbj0hMSxyPSExO2Zvcihjb25zdCBpIG9mIHQpaWYoIl9pZCIhPT1pJiYoZVtpXT9uPSEwOnI9ITAsbiYmcikpYnJlYWs7aWYobiYmcil0aHJvdyBuZXcgVigiQ2Fubm90IGRvIGV4Y2x1c2lvbiBvbiBmaWVsZCBpbiBpbmNsdXNpb24gcHJvamVjdGlvbiIse2NvZGU6VCxjb2xsZWN0aW9uOnRoaXMubmFtZX0pfWFzeW5jIF9maW5kSW50ZXJuYWwoZSx0KXt0aGlzLl9pbml0aWFsaXplZHx8YXdhaXQgdGhpcy5faW5pdGlhbGl6ZSgpO2NvbnN0IG49bnVsbD09ZT97fTplLHI9dGhpcy5fZXh0cmFjdE5lYXJTcGVjKG4pLGk9W10scz17fTtpZih0aGlzLmluZGV4ZXMuc2l6ZT4wKXtjb25zdCBlPWF3YWl0IHRoaXMucGxhblF1ZXJ5QXN5bmMobik7aWYoZS51c2VJbmRleCYmZS5kb2NJZHMmJmUuZG9jSWRzLmxlbmd0aD4wKXtmb3IoY29uc3QgdCBvZiBlLmRvY0lkcylpZighc1t0XSl7Y29uc3QgZT1hd2FpdCB0aGlzLmRvY3VtZW50cy5zZWFyY2godCk7ZSYmWWUoZSxuKSYmKHNbdF09ITAsaS5wdXNoKGUpKX19ZWxzZSBmb3IgYXdhaXQoY29uc3QgdCBvZiB0aGlzLmRvY3VtZW50cyl0JiZ0LnZhbHVlJiYhc1t0LnZhbHVlLl9pZF0mJlllKHQudmFsdWUsbikmJihzW3QudmFsdWUuX2lkXT0hMCxpLnB1c2godC52YWx1ZSkpfWVsc2UgZm9yIGF3YWl0KGNvbnN0IG8gb2YgdGhpcy5kb2N1bWVudHMpbyYmby52YWx1ZSYmIXNbby52YWx1ZS5faWRdJiZZZShvLnZhbHVlLG4pJiYoc1tvLnZhbHVlLl9pZF09ITAsaS5wdXNoKG8udmFsdWUpKTtyZXR1cm4gciYmdGhpcy5fc29ydEJ5TmVhckRpc3RhbmNlKGksciksaX1fZXh0cmFjdE5lYXJTcGVjKGUpe2Zvcihjb25zdCB0IG9mIE9iamVjdC5rZXlzKGV8fHt9KSl7aWYodC5zdGFydHNXaXRoKCIkIikpY29udGludWU7Y29uc3Qgbj1lW3RdO2lmKG4mJiJvYmplY3QiPT10eXBlb2Ygbil7aWYobi4kbmVhcil7Y29uc3QgZT10aGlzLl9wYXJzZU5lYXJDb29yZGluYXRlcyhuLiRuZWFyKTtpZihlKXJldHVybntmaWVsZDp0LC4uLmV9fWlmKG4uJG5lYXJTcGhlcmUpe2NvbnN0IGU9dGhpcy5fcGFyc2VOZWFyQ29vcmRpbmF0ZXMobi4kbmVhclNwaGVyZSk7aWYoZSlyZXR1cm57ZmllbGQ6dCwuLi5lfX19fXJldHVybiBudWxsfV9wYXJzZU5lYXJDb29yZGluYXRlcyhlKXtsZXQgdDtpZihlJiYib2JqZWN0Ij09dHlwZW9mIGUmJihlLiRnZW9tZXRyeSYmZS4kZ2VvbWV0cnkuY29vcmRpbmF0ZXM/dD1lLiRnZW9tZXRyeS5jb29yZGluYXRlczplLmNvb3JkaW5hdGVzP3Q9ZS5jb29yZGluYXRlczpBcnJheS5pc0FycmF5KGUpJiYodD1lKSksIXR8fHQubGVuZ3RoPDIpcmV0dXJuIG51bGw7Y29uc3RbbixyXT10O3JldHVybiJudW1iZXIiIT10eXBlb2Ygcnx8Im51bWJlciIhPXR5cGVvZiBuP251bGw6e2xhdDpyLGxuZzpufX1fZXh0cmFjdFBvaW50Q29vcmRpbmF0ZXMoZSl7aWYoIWUpcmV0dXJuIG51bGw7aWYoIkZlYXR1cmVDb2xsZWN0aW9uIj09PWUudHlwZSYmQXJyYXkuaXNBcnJheShlLmZlYXR1cmVzKSYmZS5mZWF0dXJlcy5sZW5ndGg+MClyZXR1cm4gdGhpcy5fZXh0cmFjdFBvaW50Q29vcmRpbmF0ZXMoZS5mZWF0dXJlc1swXS5nZW9tZXRyeSk7aWYoIkZlYXR1cmUiPT09ZS50eXBlJiZlLmdlb21ldHJ5KXJldHVybiB0aGlzLl9leHRyYWN0UG9pbnRDb29yZGluYXRlcyhlLmdlb21ldHJ5KTtpZigiUG9pbnQiPT09ZS50eXBlJiZBcnJheS5pc0FycmF5KGUuY29vcmRpbmF0ZXMpJiZlLmNvb3JkaW5hdGVzLmxlbmd0aD49Mil7Y29uc3RbdCxuXT1lLmNvb3JkaW5hdGVzO2lmKCJudW1iZXIiPT10eXBlb2YgbiYmIm51bWJlciI9PXR5cGVvZiB0KXJldHVybntsYXQ6bixsbmc6dH19cmV0dXJuIG51bGx9X3NvcnRCeU5lYXJEaXN0YW5jZShlLHQpe2NvbnN0e2ZpZWxkOm4sbGF0OnIsbG5nOml9PXQ7ZS5zb3J0KChlLHQpPT57Y29uc3Qgcz10aGlzLl9leHRyYWN0UG9pbnRDb29yZGluYXRlcyh2KGUsbikpLG89dGhpcy5fZXh0cmFjdFBvaW50Q29vcmRpbmF0ZXModih0LG4pKTtyZXR1cm4ocz90aGlzLl9oYXZlcnNpbmVEaXN0YW5jZShzLmxhdCxzLmxuZyxyLGkpOjEvMCktKG8/dGhpcy5faGF2ZXJzaW5lRGlzdGFuY2Uoby5sYXQsby5sbmcscixpKToxLzApfSl9X2hhdmVyc2luZURpc3RhbmNlKGUsdCxuLHIpe2NvbnN0IGk9KG4tZSkqTWF0aC5QSS8xODAscz0oci10KSpNYXRoLlBJLzE4MCxvPU1hdGguc2luKGkvMikqTWF0aC5zaW4oaS8yKStNYXRoLmNvcyhlKk1hdGguUEkvMTgwKSpNYXRoLmNvcyhuKk1hdGguUEkvMTgwKSpNYXRoLnNpbihzLzIpKk1hdGguc2luKHMvMik7cmV0dXJuIDYzNzEqKDIqTWF0aC5hdGFuMihNYXRoLnNxcnQobyksTWF0aC5zcXJ0KDEtbykpKX1maW5kQW5kTW9kaWZ5KCl7dGhyb3cgbmV3IEgoImZpbmRBbmRNb2RpZnkiLHtjb2xsZWN0aW9uOnRoaXMubmFtZX0pfWFzeW5jIGZpbmRPbmUoZSx0KXtjb25zdCBuPXRoaXMuZmluZChlLHQpO3JldHVybiBhd2FpdCBuLl9lbnN1cmVJbml0aWFsaXplZCgpLGF3YWl0IG4uaGFzTmV4dCgpP2F3YWl0IG4ubmV4dCgpOm51bGx9YXN5bmMgZmluZE9uZUFuZERlbGV0ZShlLHQpe2xldCBuPXRoaXMuZmluZChlKTtpZih0JiZ0LnNvcnQ/KG49bi5zb3J0KHQuc29ydCksYXdhaXQgbi5fZW5zdXJlSW5pdGlhbGl6ZWQoKSk6YXdhaXQgbi5fZW5zdXJlSW5pdGlhbGl6ZWQoKSwhKGF3YWl0IG4uaGFzTmV4dCgpKSlyZXR1cm4gbnVsbDtjb25zdCByPWF3YWl0IG4ubmV4dCgpO3JldHVybiBhd2FpdCB0aGlzLmRvY3VtZW50cy5kZWxldGUoci5faWQudG9TdHJpbmcoKSksdCYmdC5wcm9qZWN0aW9uP0UodC5wcm9qZWN0aW9uLHIpOnJ9YXN5bmMgZmluZE9uZUFuZFJlcGxhY2UoZSx0LG4pe2xldCByPXRoaXMuZmluZChlKTtpZihuJiZuLnNvcnQ/KHI9ci5zb3J0KG4uc29ydCksYXdhaXQgci5fZW5zdXJlSW5pdGlhbGl6ZWQoKSk6YXdhaXQgci5fZW5zdXJlSW5pdGlhbGl6ZWQoKSwhKGF3YWl0IHIuaGFzTmV4dCgpKSlyZXR1cm4gbnVsbDtjb25zdCBpPWF3YWl0IHIubmV4dCgpO3JldHVybiB0Ll9pZD1pLl9pZCxhd2FpdCB0aGlzLmRvY3VtZW50cy5hZGQoaS5faWQudG9TdHJpbmcoKSx0KSxuJiZuLnJldHVybk5ld0RvY3VtZW50P24mJm4ucHJvamVjdGlvbj9FKG4ucHJvamVjdGlvbix0KTp0Om4mJm4ucHJvamVjdGlvbj9FKG4ucHJvamVjdGlvbixpKTppfWFzeW5jIGZpbmRPbmVBbmRVcGRhdGUoZSx0LG4pe2xldCByPXRoaXMuZmluZChlKTtpZihuJiZuLnNvcnQ/KHI9ci5zb3J0KG4uc29ydCksYXdhaXQgci5fZW5zdXJlSW5pdGlhbGl6ZWQoKSk6YXdhaXQgci5fZW5zdXJlSW5pdGlhbGl6ZWQoKSwhKGF3YWl0IHIuaGFzTmV4dCgpKSlyZXR1cm4gbnVsbDtjb25zdCBpPWF3YWl0IHIubmV4dCgpLHM9T2JqZWN0LmFzc2lnbih7fSxpKTtyZXR1cm4gY3QodCxzLCExLFhlKGksZSkuYXJyYXlGaWx0ZXJzLG4mJm4uYXJyYXlGaWx0ZXJzKSxhd2FpdCB0aGlzLmRvY3VtZW50cy5hZGQoaS5faWQudG9TdHJpbmcoKSxzKSxuJiZuLnJldHVybk5ld0RvY3VtZW50P24mJm4ucHJvamVjdGlvbj9FKG4ucHJvamVjdGlvbixzKTpzOm4mJm4ucHJvamVjdGlvbj9FKG4ucHJvamVjdGlvbixpKTppfWdldEluZGV4ZXMoKXtjb25zdCBlPVtdO2Zvcihjb25zdFt0LG5db2YgdGhpcy5pbmRleGVzKWUucHVzaChuLmdldFNwZWMoKSk7cmV0dXJuIGV9Z2V0U2hhcmREaXN0cmlidXRpb24oKXt0aHJvdyBuZXcgSCgiZ2V0U2hhcmREaXN0cmlidXRpb24iLHtjb2xsZWN0aW9uOnRoaXMubmFtZX0pfWdldFNoYXJkVmVyc2lvbigpe3Rocm93IG5ldyBIKCJnZXRTaGFyZFZlcnNpb24iLHtjb2xsZWN0aW9uOnRoaXMubmFtZX0pfWdldFN0b3JlKCl7cmV0dXJuIHRoaXMuZG9jdW1lbnRzfWdyb3VwKCl7dGhyb3cgbmV3IEgoImdyb3VwIix7Y29sbGVjdGlvbjp0aGlzLm5hbWV9KX1hc3luYyBpbnNlcnQoZSl7cmV0dXJuIEFycmF5PT1lLmNvbnN0cnVjdG9yP2F3YWl0IHRoaXMuaW5zZXJ0TWFueShlKTphd2FpdCB0aGlzLmluc2VydE9uZShlKX1hc3luYyBpbnNlcnRPbmUoZSl7cmV0dXJuIHRoaXMuX2luaXRpYWxpemVkfHxhd2FpdCB0aGlzLl9pbml0aWFsaXplKCksbnVsbD09ZS5faWQmJihlLl9pZD1uZXcgZyksYXdhaXQgdGhpcy5kb2N1bWVudHMuYWRkKGUuX2lkLnRvU3RyaW5nKCksZSksYXdhaXQgdGhpcy51cGRhdGVJbmRleGVzT25JbnNlcnQoZSksdGhpcy5lbWl0KCJpbnNlcnQiLGUpLHtpbnNlcnRlZElkOmUuX2lkfX1hc3luYyBpbnNlcnRNYW55KGUpe3RoaXMuX2luaXRpYWxpemVkfHxhd2FpdCB0aGlzLl9pbml0aWFsaXplKCk7Y29uc3QgdD1bXTtmb3IobGV0IG49MDtuPGUubGVuZ3RoO24rKyl7Y29uc3Qgcj1hd2FpdCB0aGlzLmluc2VydE9uZShlW25dKTt0LnB1c2goci5pbnNlcnRlZElkKX1yZXR1cm57aW5zZXJ0ZWRJZHM6dH19aXNDYXBwZWQoKXt0aHJvdyBuZXcgSCgiaXNDYXBwZWQiLHtjb2xsZWN0aW9uOnRoaXMubmFtZX0pfW1hcFJlZHVjZSgpe3Rocm93IG5ldyBIKCJtYXBSZWR1Y2UiLHtjb2xsZWN0aW9uOnRoaXMubmFtZX0pfXJlSW5kZXgoKXt0aHJvdyBuZXcgSCgicmVJbmRleCIse2NvbGxlY3Rpb246dGhpcy5uYW1lfSl9YXN5bmMgcmVwbGFjZU9uZShlLHQsbil7Y29uc3Qgcj17fSxpPXRoaXMuZmluZChlKTtpZihhd2FpdCBpLl9lbnN1cmVJbml0aWFsaXplZCgpLHIubWF0Y2hlZENvdW50PWF3YWl0IGkuY291bnQoKSwwPT1yLm1hdGNoZWRDb3VudCl7aWYoci5tb2RpZmllZENvdW50PTAsbiYmbi51cHNlcnQpe2NvbnN0IGU9dDtlLl9pZD1uZXcgZyxhd2FpdCB0aGlzLmRvY3VtZW50cy5hZGQoZS5faWQudG9TdHJpbmcoKSxlKSxhd2FpdCB0aGlzLnVwZGF0ZUluZGV4ZXNPbkluc2VydChlKSx0aGlzLmVtaXQoImluc2VydCIsZSksci51cHNlcnRlZElkPWUuX2lkfX1lbHNle3IubW9kaWZpZWRDb3VudD0xO2NvbnN0IGU9YXdhaXQgaS5uZXh0KCk7YXdhaXQgdGhpcy51cGRhdGVJbmRleGVzT25EZWxldGUoZSksdC5faWQ9ZS5faWQsdGhpcy5kb2N1bWVudHMuYWRkKGUuX2lkLnRvU3RyaW5nKCksdCksYXdhaXQgdGhpcy51cGRhdGVJbmRleGVzT25JbnNlcnQodCksdGhpcy5lbWl0KCJyZXBsYWNlIix0KX1yZXR1cm4gcn1hc3luYyByZW1vdmUoZSx0KXtjb25zdCBuPXRoaXMuZmluZChlKTtpZihhd2FpdCBuLl9lbnN1cmVJbml0aWFsaXplZCgpLGF3YWl0IG4uaGFzTmV4dCgpKWlmKCEwPT09dHx8dCYmdC5qdXN0T25lKXtjb25zdCBlPWF3YWl0IG4ubmV4dCgpO2F3YWl0IHRoaXMudXBkYXRlSW5kZXhlc09uRGVsZXRlKGUpLHRoaXMuZG9jdW1lbnRzLmRlbGV0ZShlLl9pZC50b1N0cmluZygpKX1lbHNlIGZvcig7YXdhaXQgbi5oYXNOZXh0KCk7KXtjb25zdCBlPWF3YWl0IG4ubmV4dCgpO2F3YWl0IHRoaXMudXBkYXRlSW5kZXhlc09uRGVsZXRlKGUpLHRoaXMuZG9jdW1lbnRzLmRlbGV0ZShlLl9pZC50b1N0cmluZygpKX19cmVuYW1lQ29sbGVjdGlvbigpe3Rocm93IG5ldyBIKCJyZW5hbWVDb2xsZWN0aW9uIix7Y29sbGVjdGlvbjp0aGlzLm5hbWV9KX1zYXZlKCl7dGhyb3cgbmV3IEgoInNhdmUiLHtjb2xsZWN0aW9uOnRoaXMubmFtZX0pfXN0YXRzKCl7dGhyb3cgbmV3IEgoInN0YXRzIix7Y29sbGVjdGlvbjp0aGlzLm5hbWV9KX1zdG9yYWdlU2l6ZSgpe3Rocm93IG5ldyBIKCJzdG9yYWdlU2l6ZSIse2NvbGxlY3Rpb246dGhpcy5uYW1lfSl9dG90YWxTaXplKCl7dGhyb3cgbmV3IEgoInRvdGFsU2l6ZSIse2NvbGxlY3Rpb246dGhpcy5uYW1lfSl9dG90YWxJbmRleFNpemUoKXt0aHJvdyBuZXcgSCgidG90YWxJbmRleFNpemUiLHtjb2xsZWN0aW9uOnRoaXMubmFtZX0pfWFzeW5jIHVwZGF0ZShlLHQsbil7Y29uc3Qgcj10aGlzLmZpbmQoZSk7aWYoYXdhaXQgci5fZW5zdXJlSW5pdGlhbGl6ZWQoKSxhd2FpdCByLmhhc05leHQoKSlpZihuJiZuLm11bHRpKWZvcig7YXdhaXQgci5oYXNOZXh0KCk7KXtjb25zdCBpPWF3YWl0IHIubmV4dCgpLHM9WGUoaSxlKS5hcnJheUZpbHRlcnMsbz1uJiZuLmFycmF5RmlsdGVyczthd2FpdCB0aGlzLnVwZGF0ZUluZGV4ZXNPbkRlbGV0ZShpKSxjdCh0LGksITEscyxvKSxhd2FpdCB0aGlzLmRvY3VtZW50cy5hZGQoaS5faWQudG9TdHJpbmcoKSxpKSxhd2FpdCB0aGlzLnVwZGF0ZUluZGV4ZXNPbkluc2VydChpKX1lbHNle2NvbnN0IGk9YXdhaXQgci5uZXh0KCkscz1YZShpLGUpLmFycmF5RmlsdGVycyxvPW4mJm4uYXJyYXlGaWx0ZXJzO2F3YWl0IHRoaXMudXBkYXRlSW5kZXhlc09uRGVsZXRlKGkpLGN0KHQsaSwhMSxzLG8pLGF3YWl0IHRoaXMuZG9jdW1lbnRzLmFkZChpLl9pZC50b1N0cmluZygpLGkpLGF3YWl0IHRoaXMudXBkYXRlSW5kZXhlc09uSW5zZXJ0KGkpfWVsc2UgaWYobiYmbi51cHNlcnQpe2NvbnN0IG49bHQoZSx0LG5ldyBnKTthd2FpdCB0aGlzLmRvY3VtZW50cy5hZGQobi5faWQudG9TdHJpbmcoKSxuKSxhd2FpdCB0aGlzLnVwZGF0ZUluZGV4ZXNPbkluc2VydChuKX19YXN5bmMgdXBkYXRlT25lKGUsdCxuKXtjb25zdCByPXRoaXMuZmluZChlKTtpZihhd2FpdCByLl9lbnN1cmVJbml0aWFsaXplZCgpLGF3YWl0IHIuaGFzTmV4dCgpKXtjb25zdCBpPWF3YWl0IHIubmV4dCgpLHM9SlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShpKSksbz1YZShpLGUpLmFycmF5RmlsdGVycyxhPW4mJm4uYXJyYXlGaWx0ZXJzO2F3YWl0IHRoaXMudXBkYXRlSW5kZXhlc09uRGVsZXRlKGkpLGN0KHQsaSwhMSxvLGEpLHRoaXMuZG9jdW1lbnRzLmFkZChpLl9pZC50b1N0cmluZygpLGkpLGF3YWl0IHRoaXMudXBkYXRlSW5kZXhlc09uSW5zZXJ0KGkpO2NvbnN0IGM9dGhpcy5fZ2V0VXBkYXRlRGVzY3JpcHRpb24ocyxpKTt0aGlzLmVtaXQoInVwZGF0ZSIsaSxjKX1lbHNlIGlmKG4mJm4udXBzZXJ0KXtjb25zdCBuPWx0KGUsdCxuZXcgZyk7dGhpcy5kb2N1bWVudHMuYWRkKG4uX2lkLnRvU3RyaW5nKCksbiksYXdhaXQgdGhpcy51cGRhdGVJbmRleGVzT25JbnNlcnQobiksdGhpcy5lbWl0KCJpbnNlcnQiLG4pfX1hc3luYyB1cGRhdGVNYW55KGUsdCxuKXtjb25zdCByPXRoaXMuZmluZChlKTtpZihhd2FpdCByLl9lbnN1cmVJbml0aWFsaXplZCgpLGF3YWl0IHIuaGFzTmV4dCgpKWZvcig7YXdhaXQgci5oYXNOZXh0KCk7KXtjb25zdCBpPWF3YWl0IHIubmV4dCgpLHM9SlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShpKSksbz1YZShpLGUpLmFycmF5RmlsdGVycyxhPW4mJm4uYXJyYXlGaWx0ZXJzO2F3YWl0IHRoaXMudXBkYXRlSW5kZXhlc09uRGVsZXRlKGkpLGN0KHQsaSwhMSxvLGEpLHRoaXMuZG9jdW1lbnRzLmFkZChpLl9pZC50b1N0cmluZygpLGkpLGF3YWl0IHRoaXMudXBkYXRlSW5kZXhlc09uSW5zZXJ0KGkpO2NvbnN0IGM9dGhpcy5fZ2V0VXBkYXRlRGVzY3JpcHRpb24ocyxpKTt0aGlzLmVtaXQoInVwZGF0ZSIsaSxjKX1lbHNlIGlmKG4mJm4udXBzZXJ0KXtjb25zdCBuPWx0KGUsdCxuZXcgZyk7dGhpcy5kb2N1bWVudHMuYWRkKG4uX2lkLnRvU3RyaW5nKCksbiksYXdhaXQgdGhpcy51cGRhdGVJbmRleGVzT25JbnNlcnQobiksdGhpcy5lbWl0KCJpbnNlcnQiLG4pfX12YWxpZGF0ZSgpe3Rocm93IG5ldyBIKCJ2YWxpZGF0ZSIse2NvbGxlY3Rpb246dGhpcy5uYW1lfSl9X2dldFVwZGF0ZURlc2NyaXB0aW9uKGUsdCl7Y29uc3Qgbj17fSxyPVtdO2Zvcihjb25zdCBpIGluIHQpIl9pZCIhPT1pJiZKU09OLnN0cmluZ2lmeShlW2ldKSE9PUpTT04uc3RyaW5naWZ5KHRbaV0pJiYobltpXT10W2ldKTtmb3IoY29uc3QgaSBpbiBlKSJfaWQiIT09aSYmKGkgaW4gdHx8ci5wdXNoKGkpKTtyZXR1cm57dXBkYXRlZEZpZWxkczpuLHJlbW92ZWRGaWVsZHM6cix0cnVuY2F0ZWRBcnJheXM6W119fXdhdGNoKGU9W10sdD17fSl7cmV0dXJuIG5ldyBVdCh0aGlzLGUsdCl9fWZ1bmN0aW9uIFJ0KGUsdCl7Y29uc3Qgbj17fSxyPU9iamVjdC5rZXlzKGUpO2xldCBpPSExLHM9ITE7Zm9yKGNvbnN0IG8gb2Ygcil7aWYoIl9pZCI9PT1vKWNvbnRpbnVlO2NvbnN0IHQ9ZVtvXTsxPT09dHx8ITA9PT10P2k9ITA6MD09PXR8fCExPT09dHx8KHM9ITApfWlmKHN8fGkpezAhPT1lLl9pZCYmITEhPT1lLl9pZCYmKG4uX2lkPXQuX2lkKTtmb3IoY29uc3QgaSBvZiByKXtjb25zdCByPWVbaV07Il9pZCI9PT1pPzAhPT1yJiYhMSE9PXJ8fGRlbGV0ZSBuLl9pZDpuW2ldPTE9PT1yfHwhMD09PXI/dih0LGkpOk5lKHIsdCl9fWVsc2V7Zm9yKGNvbnN0IGUgaW4gdCl0Lmhhc093blByb3BlcnR5KGUpJiYobltlXT10W2VdKTtmb3IoY29uc3QgdCBvZiByKTAhPT1lW3RdJiYhMSE9PWVbdF18fGRlbGV0ZSBuW3RdfXJldHVybiBufWNsYXNzIFZ0e2NvbnN0cnVjdG9yKGUpe3RoaXMub3B0aW9ucz1lfHx7fSx0aGlzLmJhc2VGb2xkZXI9dGhpcy5vcHRpb25zLmJhc2VGb2xkZXJ8fCJtaWNyby1tb25nbyIsdGhpcy5kYk5hbWU9dGhpcy5vcHRpb25zLmRiTmFtZXx8ImRlZmF1bHQiLHRoaXMuZGJGb2xkZXI9YCR7dGhpcy5iYXNlRm9sZGVyfS8ke3RoaXMuZGJOYW1lfWAsdGhpcy5jb2xsZWN0aW9ucz0vKiBAX19QVVJFX18gKi9uZXcgTWFwO2NvbnN0IHQ9bmV3IFByb3h5KHRoaXMse2dldDooZSx0LG4pPT50IGluIGU/UmVmbGVjdC5nZXQoZSx0LG4pOiJzeW1ib2wiPT10eXBlb2YgdHx8dC5zdGFydHNXaXRoKCJfIik/dm9pZCAwOiJzdHJpbmciPT10eXBlb2YgdD9lLmdldENvbGxlY3Rpb24odCk6dm9pZCAwfSk7cmV0dXJuIHRoaXMuX3Byb3h5PXQsdH1hc3luYyBjbG9zZSgpe2Zvcihjb25zdFtlLHRdb2YgdGhpcy5jb2xsZWN0aW9ucylhd2FpdCB0LmNsb3NlKCl9Y2xvbmVDb2xsZWN0aW9uKCl7dGhyb3cgbmV3IEgoImNsb25lQ29sbGVjdGlvbiIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9Y2xvbmVEYXRhYmFzZSgpe3Rocm93IG5ldyBIKCJjbG9uZURhdGFiYXNlIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1jb21tYW5kSGVscCgpe3Rocm93IG5ldyBIKCJjb21tYW5kSGVscCIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9Y29weURhdGFiYXNlKCl7dGhyb3cgbmV3IEgoImNvcHlEYXRhYmFzZSIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9Y3JlYXRlQ29sbGVjdGlvbihlKXtyZXR1cm4gdGhpcy5jb2xsZWN0aW9ucy5oYXMoZSl8fHRoaXMuY29sbGVjdGlvbnMuc2V0KGUsbmV3IHF0KHRoaXMsZSkpLHtvazoxfX1jdXJyZW50T3AoKXt0aHJvdyBuZXcgSCgiY3VycmVudE9wIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1hc3luYyBkcm9wQ29sbGVjdGlvbihlKXtpZih0aGlzLmNvbGxlY3Rpb25zLmhhcyhlKSl7Y29uc3QgdD10aGlzLmNvbGxlY3Rpb25zLmdldChlKTsiZnVuY3Rpb24iPT10eXBlb2YgdC5kcm9wJiZhd2FpdCB0LmRyb3AoKSx0aGlzLmNvbGxlY3Rpb25zLmRlbGV0ZShlKX19YXN5bmMgZHJvcERhdGFiYXNlKCl7Zm9yKGNvbnN0W3IsaV1vZiB0aGlzLmNvbGxlY3Rpb25zKWF3YWl0IGkuZHJvcCgpO3RoaXMuY29sbGVjdGlvbnMuY2xlYXIoKTtjb25zdCBlPXRoaXMuZGJGb2xkZXIuc3BsaXQoIi8iKS5maWx0ZXIoQm9vbGVhbiksdD1lLnBvcCgpO3RyeXtsZXQgbj1hd2FpdCBnbG9iYWxUaGlzLm5hdmlnYXRvci5zdG9yYWdlLmdldERpcmVjdG9yeSgpO2Zvcihjb25zdCB0IG9mIGUpbj1hd2FpdCBuLmdldERpcmVjdG9yeUhhbmRsZSh0LHtjcmVhdGU6ITF9KTthd2FpdCBuLnJlbW92ZUVudHJ5KHQse3JlY3Vyc2l2ZTohMH0pfWNhdGNoKG4pe2lmKCJOb3RGb3VuZEVycm9yIiE9PW4ubmFtZSYmIkVOT0VOVCIhPT1uLmNvZGUpdGhyb3cgbn1yZXR1cm57b2s6MX19ZXZhbCgpe3Rocm93IG5ldyBIKCJldmFsIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1mc3luY0xvY2soKXt0aHJvdyBuZXcgSCgiZnN5bmNMb2NrIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1mc3luY1VubG9jaygpe3Rocm93IG5ldyBIKCJmc3luY1VubG9jayIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9Z2V0Q29sbGVjdGlvbihlKXtpZighdGhpcy5jb2xsZWN0aW9ucy5oYXMoZSkpe2NvbnN0IHQ9dGhpcy5fcHJveHl8fHRoaXM7dGhpcy5jb2xsZWN0aW9ucy5zZXQoZSxuZXcgcXQodCxlKSl9cmV0dXJuIHRoaXMuY29sbGVjdGlvbnMuZ2V0KGUpfWNvbGxlY3Rpb24oZSl7cmV0dXJuIHRoaXMuZ2V0Q29sbGVjdGlvbihlKX1nZXRDb2xsZWN0aW9uSW5mb3MoKXt0aHJvdyBuZXcgSCgiZ2V0Q29sbGVjdGlvbkluZm9zIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1nZXRDb2xsZWN0aW9uTmFtZXMoKXtyZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmNvbGxlY3Rpb25zLmtleXMoKSl9Z2V0TGFzdEVycm9yKCl7dGhyb3cgbmV3IEgoImdldExhc3RFcnJvciIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9Z2V0TGFzdEVycm9yT2JqKCl7dGhyb3cgbmV3IEgoImdldExhc3RFcnJvck9iaiIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9Z2V0TG9nQ29tcG9uZW50cygpe3Rocm93IG5ldyBIKCJnZXRMb2dDb21wb25lbnRzIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1nZXRNb25nbygpe3Rocm93IG5ldyBIKCJnZXRNb25nbyIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9Z2V0TmFtZSgpe3Rocm93IG5ldyBIKCJnZXROYW1lIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1nZXRQcmV2RXJyb3IoKXt0aHJvdyBuZXcgSCgiZ2V0UHJldkVycm9yIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1nZXRQcm9maWxpbmdMZXZlbCgpe3Rocm93IG5ldyBIKCJnZXRQcm9maWxpbmdMZXZlbCIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9Z2V0UHJvZmlsaW5nU3RhdHVzKCl7dGhyb3cgbmV3IEgoImdldFByb2ZpbGluZ1N0YXR1cyIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9Z2V0UmVwbGljYXRpb25JbmZvKCl7dGhyb3cgbmV3IEgoImdldFJlcGxpY2F0aW9uSW5mbyIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9Z2V0U2libGluZ0RCKCl7dGhyb3cgbmV3IEgoImdldFNpYmxpbmdEQiIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9aGVscCgpe2NvbnNvbGUubG9nKCIgICAgICAgIGhlbHAgbXIgICAgICAgICAgICAgICAgICAgICAgbWFwcmVkdWNlIiksY29uc29sZS5sb2coIiAgICAgICAgZGIuZm9vLmZpbmQoKSAgICAgICAgICAgICAgICBsaXN0IG9iamVjdHMgaW4gY29sbGVjdGlvbiBmb28iKSxjb25zb2xlLmxvZygiICAgICAgICBkYi5mb28uZmluZCggeyBhIDogMSB9ICkgICAgIGxpc3Qgb2JqZWN0cyBpbiBmb28gd2hlcmUgYSA9PSAxIiksY29uc29sZS5sb2coIiAgICAgICAgaXQgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgb2YgdGhlIGxhc3QgbGluZSBldmFsdWF0ZWQ7IHVzZSB0byBmdXJ0aGVyIGl0ZXJhdGUiKX1ob3N0SW5mbygpe3Rocm93IG5ldyBIKCJob3N0SW5mbyIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9aXNNYXN0ZXIoKXt0aHJvdyBuZXcgSCgiaXNNYXN0ZXIiLHtkYXRhYmFzZTp0aGlzLmRiTmFtZX0pfWtpbGxPcCgpe3Rocm93IG5ldyBIKCJraWxsT3AiLHtkYXRhYmFzZTp0aGlzLmRiTmFtZX0pfWxpc3RDb21tYW5kcygpe3Rocm93IG5ldyBIKCJsaXN0Q29tbWFuZHMiLHtkYXRhYmFzZTp0aGlzLmRiTmFtZX0pfWxvYWRTZXJ2ZXJTY3JpcHRzKCl7dGhyb3cgbmV3IEgoImxvYWRTZXJ2ZXJTY3JpcHRzIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1sb2dvdXQoKXt0aHJvdyBuZXcgSCgibG9nb3V0Iix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1wcmludENvbGxlY3Rpb25TdGF0cygpe3Rocm93IG5ldyBIKCJwcmludENvbGxlY3Rpb25TdGF0cyIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9cHJpbnRSZXBsaWNhdGlvbkluZm8oKXt0aHJvdyBuZXcgSCgicHJpbnRSZXBsaWNhdGlvbkluZm8iLHtkYXRhYmFzZTp0aGlzLmRiTmFtZX0pfXByaW50U2hhcmRpbmdTdGF0dXMoKXt0aHJvdyBuZXcgSCgicHJpbnRTaGFyZGluZ1N0YXR1cyIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9cHJpbnRTbGF2ZVJlcGxpY2F0aW9uSW5mbygpe3Rocm93IG5ldyBIKCJwcmludFNsYXZlUmVwbGljYXRpb25JbmZvIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1yZXBhaXJEYXRhYmFzZSgpe3Rocm93IG5ldyBIKCJyZXBhaXJEYXRhYmFzZSIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9cmVzZXRFcnJvcigpe3Rocm93IG5ldyBIKCJyZXNldEVycm9yIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1ydW5Db21tYW5kKCl7dGhyb3cgbmV3IEgoInJ1bkNvbW1hbmQiLHtkYXRhYmFzZTp0aGlzLmRiTmFtZX0pfXNlcnZlckJ1aWxkSW5mbygpe3Rocm93IG5ldyBIKCJzZXJ2ZXJCdWlsZEluZm8iLHtkYXRhYmFzZTp0aGlzLmRiTmFtZX0pfXNlcnZlckNtZExpbmVPcHRzKCl7dGhyb3cgbmV3IEgoInNlcnZlckNtZExpbmVPcHRzIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1zZXJ2ZXJTdGF0dXMoKXt0aHJvdyBuZXcgSCgic2VydmVyU3RhdHVzIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1zZXRMb2dMZXZlbCgpe3Rocm93IG5ldyBIKCJzZXRMb2dMZXZlbCIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9c2V0UHJvZmlsaW5nTGV2ZWwoKXt0aHJvdyBuZXcgSCgic2V0UHJvZmlsaW5nTGV2ZWwiLHtkYXRhYmFzZTp0aGlzLmRiTmFtZX0pfXNodXRkb3duU2VydmVyKCl7dGhyb3cgbmV3IEgoInNodXRkb3duU2VydmVyIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX1zdGF0cygpe3Rocm93IG5ldyBIKCJzdGF0cyIse2RhdGFiYXNlOnRoaXMuZGJOYW1lfSl9dmVyc2lvbigpe3Rocm93IG5ldyBIKCJ2ZXJzaW9uIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX11cGdyYWRlQ2hlY2soKXt0aHJvdyBuZXcgSCgidXBncmFkZUNoZWNrIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX11cGdyYWRlQ2hlY2tBbGxEQnMoKXt0aHJvdyBuZXcgSCgidXBncmFkZUNoZWNrQWxsREJzIix7ZGF0YWJhc2U6dGhpcy5kYk5hbWV9KX13YXRjaChlPVtdLHQ9e30pe3JldHVybiBuZXcgVXQodGhpcyxlLHQpfX1jbGFzcyBIdHtjb25zdHJ1Y3RvcihlPXt9LHQ9KCk9Pnt9KXt0aGlzLm9wdGlvbnM9ZSx0aGlzLmRhdGFiYXNlcz0vKiBAX19QVVJFX18gKi9uZXcgTWFwLHRoaXMucG9zdEV2ZW50PXQsdGhpcy5jdXJzb3JzPS8qIEBfX1BVUkVfXyAqL25ldyBNYXAsdGhpcy5jdXJzb3JDb3VudGVyPTEsdGhpcy5zdHJlYW1zPS8qIEBfX1BVUkVfXyAqL25ldyBNYXAsdGhpcy5zdHJlYW1Db3VudGVyPTF9YXN5bmMgZGlzcGF0Y2goZSl7Y29uc3R7dGFyZ2V0OnQsZGF0YWJhc2U6bixjb2xsZWN0aW9uOnIsbWV0aG9kOmksYXJnczpzPVtdLGN1cnNvcklkOm8sc3RyZWFtSWQ6YSxjdXJzb3JPcHRzOmN9PWU7aWYoImN1cnNvciI9PT10KXJldHVybiBhd2FpdCB0aGlzLl9jdXJzb3JPcChvLGkscyk7aWYoImNoYW5nZXN0cmVhbSI9PT10KXJldHVybiBhd2FpdCB0aGlzLl9jaGFuZ2VTdHJlYW1PcChhLGkscyk7aWYoImNsaWVudCI9PT10KXJldHVybiBhd2FpdCB0aGlzLl9jYWxsKHRoaXMsaSxzKTtpZighdHx8IW58fCFpKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCByZXF1ZXN0IHBheWxvYWQiKTtjb25zdCBsPXRoaXMuX2dldERCKG4pO2lmKCJkYiI9PT10KXJldHVybiBhd2FpdCB0aGlzLl9jYWxsKGwsaSxzKTtpZigiY29sbGVjdGlvbiI9PT10KXtpZighcil0aHJvdyBuZXcgRXJyb3IoIkNvbGxlY3Rpb24gbmFtZSByZXF1aXJlZCBmb3IgY29sbGVjdGlvbiB0YXJnZXQiKTtjb25zdCBlPWwuY29sbGVjdGlvbihyKTtyZXR1cm4gYXdhaXQgdGhpcy5fY2FsbChlLGkscyxjKX10aHJvdyBuZXcgRXJyb3IoYFVua25vd24gdGFyZ2V0OiAke3R9YCl9X2dldERCKGUpe2lmKHRoaXMuZGF0YWJhc2VzLmhhcyhlKSlyZXR1cm4gdGhpcy5kYXRhYmFzZXMuZ2V0KGUpO2NvbnN0IHQ9bmV3IFZ0KHsuLi50aGlzLm9wdGlvbnMsZGJOYW1lOmV9KTtyZXR1cm4gdGhpcy5kYXRhYmFzZXMuc2V0KGUsdCksdH1hc3luYyBfY2FsbChlLHQsbixyKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZVt0XSl0aHJvdyBuZXcgRXJyb3IoYE1ldGhvZCAke3R9IG5vdCBmb3VuZCBvbiB0YXJnZXRgKTtjb25zdCBpPWVbdF0oLi4ubnx8W10pLHM9aSYmImZ1bmN0aW9uIj09dHlwZW9mIGkudGhlbj9hd2FpdCBpOmk7cmV0dXJuIHMmJiJmdW5jdGlvbiI9PXR5cGVvZiBzLmhhc05leHQmJiJmdW5jdGlvbiI9PXR5cGVvZiBzLm5leHQ/YXdhaXQgdGhpcy5fcmVnaXN0ZXJDdXJzb3IocyxyKToiYWdncmVnYXRlIj09PXQmJkFycmF5LmlzQXJyYXkocyk/YXdhaXQgdGhpcy5fcmVnaXN0ZXJBcnJheUFzQ3Vyc29yKHMpOnMmJiJDaGFuZ2VTdHJlYW0iPT09cy5jb25zdHJ1Y3Rvcj8ubmFtZXx8cyYmImZ1bmN0aW9uIj09dHlwZW9mIHMub24mJnMuaGFzT3duUHJvcGVydHkoInBpcGVsaW5lIikmJnMuaGFzT3duUHJvcGVydHkoIl9jaGFuZ2VDb3VudGVyIik/dGhpcy5fcmVnaXN0ZXJDaGFuZ2VTdHJlYW0ocyk6c31hc3luYyBfcmVnaXN0ZXJDdXJzb3IoZSx0PXt9KXt0LnNvcnQmJihlPWUuc29ydCh0LnNvcnQpKSx0LnNraXAmJihlPWF3YWl0IGUuc2tpcCh0LnNraXApKSx0LmxpbWl0JiYoZT1hd2FpdCBlLmxpbWl0KHQubGltaXQpKSx0Lm1pbiYmZS5taW4mJihlPWUubWluKHQubWluKSksdC5tYXgmJmUubWF4JiYoZT1lLm1heCh0Lm1heCkpLHQuaGludCYmZS5oaW50JiYoZT1lLmhpbnQodC5oaW50KSksdC5jb21tZW50JiZlLmNvbW1lbnQmJihlPWUuY29tbWVudCh0LmNvbW1lbnQpKSx0Lm1heFRpbWVNUyYmZS5tYXhUaW1lTVMmJihlPWUubWF4VGltZU1TKHQubWF4VGltZU1TKSksdC5tYXhTY2FuJiZlLm1heFNjYW4mJihlPWUubWF4U2Nhbih0Lm1heFNjYW4pKSx0LnJldHVybktleSYmZS5yZXR1cm5LZXkmJihlPWUucmV0dXJuS2V5KHQucmV0dXJuS2V5KSksdC5zaG93UmVjb3JkSWQmJmUuc2hvd1JlY29yZElkJiYoZT1lLnNob3dSZWNvcmRJZCh0LnNob3dSZWNvcmRJZCkpLHQuY29sbGF0aW9uJiZlLmNvbGxhdGlvbiYmKGU9ZS5jb2xsYXRpb24odC5jb2xsYXRpb24pKTtjb25zdCBuPSJjdXJfIit0aGlzLmN1cnNvckNvdW50ZXIrKyxyPXRoaXMub3B0aW9ucy5iYXRjaFNpemV8fDEwMCxpPVtdO2Zvcig7aS5sZW5ndGg8ciYmYXdhaXQgZS5oYXNOZXh0KCk7KWkucHVzaChhd2FpdCBlLm5leHQoKSk7Y29uc3Qgcz0hKGF3YWl0IGUuaGFzTmV4dCgpKTtyZXR1cm4gc3x8dGhpcy5jdXJzb3JzLnNldChuLGUpLHtjdXJzb3JJZDpuLGJhdGNoOmksZXhoYXVzdGVkOnMsYmF0Y2hTaXplOnJ9fWFzeW5jIF9yZWdpc3RlckFycmF5QXNDdXJzb3IoZSl7Y29uc3QgdD0iY3VyXyIrdGhpcy5jdXJzb3JDb3VudGVyKyssbj10aGlzLm9wdGlvbnMuYmF0Y2hTaXplfHwxMDAscj1lLnNsaWNlKDAsbiksaT1lLmxlbmd0aDw9bjtpZighaSl7Y29uc3Qgcj17cG9zaXRpb246bixhcnJheTplLGFzeW5jIGhhc05leHQoKXtyZXR1cm4gdGhpcy5wb3NpdGlvbjx0aGlzLmFycmF5Lmxlbmd0aH0sYXN5bmMgbmV4dCgpe2lmKHRoaXMucG9zaXRpb24+PXRoaXMuYXJyYXkubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiTm8gbW9yZSBkb2N1bWVudHMiKTtyZXR1cm4gdGhpcy5hcnJheVt0aGlzLnBvc2l0aW9uKytdfX07dGhpcy5jdXJzb3JzLnNldCh0LHIpfXJldHVybntjdXJzb3JJZDp0LGJhdGNoOnIsZXhoYXVzdGVkOmksYmF0Y2hTaXplOm59fWFzeW5jIF9jdXJzb3JPcChlLHQsbj1bXSl7aWYoIWUpdGhyb3cgbmV3IEVycm9yKCJjdXJzb3JJZCByZXF1aXJlZCIpO2NvbnN0IHI9dGhpcy5jdXJzb3JzLmdldChlKTtpZighcil7aWYoImNsb3NlIj09PXQpcmV0dXJue2Nsb3NlZDohMH07dGhyb3cgbmV3IEVycm9yKGBDdXJzb3Igbm90IGZvdW5kOiAke2V9YCl9aWYoImNsb3NlIj09PXQpcmV0dXJuIHRoaXMuY3Vyc29ycy5kZWxldGUoZSkse2Nsb3NlZDohMH07aWYoImdldE1vcmUiPT09dCl7Y29uc3QgdD0obj8uWzBdfHx7fSkuYmF0Y2hTaXplfHwxMDAsaT1bXTtmb3IoO2kubGVuZ3RoPHQmJmF3YWl0IHIuaGFzTmV4dCgpOylpLnB1c2goYXdhaXQgci5uZXh0KCkpO2NvbnN0IHM9IShhd2FpdCByLmhhc05leHQoKSk7cmV0dXJuIHMmJnRoaXMuY3Vyc29ycy5kZWxldGUoZSkse2JhdGNoOmksZXhoYXVzdGVkOnMsYmF0Y2hTaXplOnR9fXRocm93IG5ldyBFcnJvcihgVW5rbm93biBjdXJzb3IgbWV0aG9kOiAke3R9YCl9X3JlZ2lzdGVyQ2hhbmdlU3RyZWFtKGUpe2NvbnN0IHQ9ImNzXyIrdGhpcy5zdHJlYW1Db3VudGVyKyssbj17Y2hhbmdlOmU9PnRoaXMucG9zdEV2ZW50KHt0eXBlOiJldmVudCIsZXZlbnQ6ImNoYW5nZVN0cmVhbSIscGF5bG9hZDp7c3RyZWFtSWQ6dCx0eXBlOiJjaGFuZ2UiLGRhdGE6ZX19KSxlcnJvcjplPT50aGlzLnBvc3RFdmVudCh7dHlwZToiZXZlbnQiLGV2ZW50OiJjaGFuZ2VTdHJlYW0iLHBheWxvYWQ6e3N0cmVhbUlkOnQsdHlwZToiZXJyb3IiLGRhdGE6e25hbWU6ZT8ubmFtZSxtZXNzYWdlOmU/Lm1lc3NhZ2Usc3RhY2s6ZT8uc3RhY2t9fX0pLGNsb3NlOigpPT50aGlzLnBvc3RFdmVudCh7dHlwZToiZXZlbnQiLGV2ZW50OiJjaGFuZ2VTdHJlYW0iLHBheWxvYWQ6e3N0cmVhbUlkOnQsdHlwZToiY2xvc2UifX0pfTtyZXR1cm4gZS5vbigiY2hhbmdlIixuLmNoYW5nZSksZS5vbigiZXJyb3IiLG4uZXJyb3IpLGUub24oImNsb3NlIixuLmNsb3NlKSx0aGlzLnN0cmVhbXMuc2V0KHQse3N0cmVhbTplLGhhbmRsZXJzOm59KSx7c3RyZWFtSWQ6dH19YXN5bmMgX2NoYW5nZVN0cmVhbU9wKGUsdCl7aWYoIWUpdGhyb3cgbmV3IEVycm9yKCJzdHJlYW1JZCByZXF1aXJlZCIpO2NvbnN0IG49dGhpcy5zdHJlYW1zLmdldChlKTtpZighbilyZXR1cm57Y2xvc2VkOiEwfTtpZigiY2xvc2UiPT09dCl7Y29uc3R7c3RyZWFtOnQsaGFuZGxlcnM6cn09bjtyZXR1cm4gdC5vZmYoImNoYW5nZSIsci5jaGFuZ2UpLHQub2ZmKCJlcnJvciIsci5lcnJvciksdC5vZmYoImNsb3NlIixyLmNsb3NlKSwiZnVuY3Rpb24iPT10eXBlb2YgdC5jbG9zZSYmYXdhaXQgdC5jbG9zZSgpLHRoaXMuc3RyZWFtcy5kZWxldGUoZSkse2Nsb3NlZDohMH19dGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGNoYW5nZSBzdHJlYW0gbWV0aG9kOiAke3R9YCl9d2F0Y2goZT1bXSx0PXt9KXtyZXR1cm4gbmV3IFV0KHRoaXMsZSx0KX19ZnVuY3Rpb24gV3QoZSx0PS8qIEBfX1BVUkVfXyAqL25ldyBXZWFrU2V0KXtpZihudWxsPT1lKXJldHVybiBlO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBlKXJldHVybntfX2Z1bmN0aW9uOmUudG9TdHJpbmcoKX07aWYoZSYmIm9iamVjdCI9PXR5cGVvZiBlJiYiZnVuY3Rpb24iPT10eXBlb2YgZS50b1N0cmluZyl0cnl7Y29uc3QgdD1lLnRvU3RyaW5nKCk7aWYodCYmMjQ9PT10Lmxlbmd0aCYmL15bMC05YS1mXXsyNH0kL2kudGVzdCh0KSYmZS5jb25zdHJ1Y3RvciYmIk9iamVjdElkIj09PWUuY29uc3RydWN0b3IubmFtZSlyZXR1cm57X19vYmplY3RJZDp0fX1jYXRjaChuKXt9aWYoZSBpbnN0YW5jZW9mIGcpcmV0dXJue19fb2JqZWN0SWQ6ZS50b1N0cmluZygpfTtpZihlIGluc3RhbmNlb2YgRGF0ZSlyZXR1cm57X19kYXRlOmUudG9JU09TdHJpbmcoKX07aWYoIm9iamVjdCI9PXR5cGVvZiBlKXtpZih0LmhhcyhlKSlyZXR1cm47dC5hZGQoZSl9aWYoQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gZS5tYXAoZT0+V3QoZSx0KSk7aWYoIm9iamVjdCI9PXR5cGVvZiBlKXtjb25zdCBuPXt9O2Zvcihjb25zdFtyLGldb2YgT2JqZWN0LmVudHJpZXMoZSkpbltyXT1XdChpLHQpO3JldHVybiBufXJldHVybiBlfWZ1bmN0aW9uIFF0KGUpe2lmKG51bGw9PWUpcmV0dXJuIGU7aWYoIm9iamVjdCI9PXR5cGVvZiBlJiZlLl9fZnVuY3Rpb24pcmV0dXJuInN0cmluZyI9PXR5cGVvZiBlLl9fZnVuY3Rpb24/YCgke2UuX19mdW5jdGlvbn0pLmNhbGwodGhpcylgOnZvaWQgMDtpZigib2JqZWN0Ij09dHlwZW9mIGUmJmUuX19vYmplY3RJZClyZXR1cm4gbmV3IGcoZS5fX29iamVjdElkKTtpZigib2JqZWN0Ij09dHlwZW9mIGUmJmUuX19kYXRlKXJldHVybiBuZXcgRGF0ZShlLl9fZGF0ZSk7aWYoQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gZS5tYXAoUXQpO2lmKCJvYmplY3QiPT10eXBlb2YgZSl7Y29uc3QgdD17fTtmb3IoY29uc3RbbixyXW9mIE9iamVjdC5lbnRyaWVzKGUpKXRbbl09UXQocik7cmV0dXJuIHR9cmV0dXJuIGV9Y29uc3QgSnQ9InVuZGVmaW5lZCIhPXR5cGVvZiBwcm9jZXNzJiYhIXByb2Nlc3MudmVyc2lvbnM/Lm5vZGU7bGV0IEt0LEd0PW51bGw7YXN5bmMgZnVuY3Rpb24gWXQoZSx0KXtpZighZXx8InJlcXVlc3QiIT09ZS50eXBlKXJldHVybjtHdCYmYXdhaXQgR3Q7Y29uc3R7aWQ6bixwYXlsb2FkOnJ9PWUsaT1RdChyKSxzPWZ1bmN0aW9uKGUpe3JldHVybiBLdHx8KEt0PW5ldyBIdCh7fSxlKSksS3R9KHQpO3RyeXtjb25zdCBlPWF3YWl0IHMuZGlzcGF0Y2goaSk7dCh7dHlwZToicmVzcG9uc2UiLGlkOm4sc3VjY2VzczohMCxyZXN1bHQ6V3QoZSl9KX1jYXRjaChvKXt0KHt0eXBlOiJyZXNwb25zZSIsaWQ6bixzdWNjZXNzOiExLGVycm9yOntuYW1lOm8/Lm5hbWUsbWVzc2FnZTpvPy5tZXNzYWdlLHN0YWNrOm8/LnN0YWNrLGNvZGU6bz8uY29kZSwkZXJyOm8/LiRlcnJ9fSl9fUp0JiYoR3Q9UHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKT0+e2NvbnN0IGU9bmV3IEZ1bmN0aW9uKCJzcGVjIiwicmV0dXJuIGltcG9ydChzcGVjKSIpO3JldHVybiBQcm9taXNlLmFsbChbZSgicGF0aCIpLGUoInVybCIpLGUoIm5vZGUtb3BmcyIpXSl9KS50aGVuKChbZSx0LG5dKT0+e2NvbnN0IHI9ZS5kZWZhdWx0LHtmaWxlVVJMVG9QYXRoOml9PXQse1N0b3JhZ2VNYW5hZ2VyOnN9PW4sbz1pKGltcG9ydC5tZXRhLnVybCksYT1yLmRpcm5hbWUobyksYz1yLnJlc29sdmUoYSwiLi4iKSxsPW5ldyBzKHIuam9pbihjLCIub3BmcyIpKSx1PXtzdG9yYWdlOntnZXREaXJlY3Rvcnk6KCk9PmwuZ2V0RGlyZWN0b3J5KCl9fTt2b2lkIDA9PT1nbG9iYWxUaGlzLm5hdmlnYXRvcj9nbG9iYWxUaGlzLm5hdmlnYXRvcj11Omdsb2JhbFRoaXMubmF2aWdhdG9yLnN0b3JhZ2U9dS5zdG9yYWdlfSkuY2F0Y2goKCk9Pnt9KSksYXN5bmMgZnVuY3Rpb24oKXtpZihKdCl7Y29uc3R7cGFyZW50UG9ydDplfT1hd2FpdCBpbXBvcnQoIndvcmtlcl90aHJlYWRzIiksdD10PT5lLnBvc3RNZXNzYWdlKHQpO2Uub24oIm1lc3NhZ2UiLGU9Pll0KGUsdCkpfWVsc2V7Y29uc3QgZT1lPT5zZWxmLnBvc3RNZXNzYWdlKGUpO3NlbGYub25tZXNzYWdlPXQ9Pll0KHQuZGF0YSxlKX19KCkuY2F0Y2goZT0+e2NvbnNvbGUuZXJyb3IoIldvcmtlciBpbml0aWFsaXphdGlvbiBmYWlsZWQ6IixlKSwidW5kZWZpbmVkIiE9dHlwZW9mIHByb2Nlc3M/cHJvY2Vzcy5leGl0KDEpOnNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6ImVycm9yIixlcnJvcjplLm1lc3NhZ2V9KX0pOwovLyMgc291cmNlTWFwcGluZ1VSTD1taWNyby1tb25nby1zZXJ2ZXItd29ya2VyLmpzLm1hcAo=",import.meta.url))}const c=new b(d,{workerData:l.workerData});return new Ql(c)}sendRequest(l,b={}){const Z=this._nextId++,d=Tl(l),c={type:"request",id:Z,payload:d};return new Promise((l,d)=>{let i;b.timeout&&(i=setTimeout(()=>{this._pending.delete(Z),d(new Error(`Worker request timed out after ${b.timeout}ms`))},b.timeout)),this._pending.set(Z,{resolve:l,reject:d,timeoutHandle:i}),this._post(c)})}async terminate(){this._terminating=!0;for(const[l,b]of this._pending.entries())clearTimeout(b.timeoutHandle);this._pending.clear(),await this._terminateImpl()}_handleMessage(l){const b=l?.data??l;if(b){if("response"===b.type){const l=this._pending.get(b.id);if(!l)return;if(this._pending.delete(b.id),clearTimeout(l.timeoutHandle),b.success){const Z=Fl(b.result);l.resolve(Z)}else{const Z=new Error(b.error?.message||"Worker error");b.error?.name&&(Z.name=b.error.name),b.error?.stack&&(Z.stack=b.error.stack),b.error?.code&&(Z.code=b.error.code),b.error?.$err&&(Z.$err=b.error.$err),l.reject(Z)}return}if("event"===b.type){const l=Fl(b.payload);this.emit("event",b.event,l)}}}_handleError(l){if(!this._terminating){for(const[b,Z]of this._pending.entries())clearTimeout(Z.timeoutHandle),Z.reject(l);this._pending.clear(),this.emit("error",l)}}_attach(){throw new Error("Not implemented")}_post(){throw new Error("Not implemented")}_terminateImpl(){throw new Error("Not implemented")}}class Bl extends vl{constructor(l={}){const b=globalThis.Worker;if(!b)throw new Error("Worker API is not available in this environment");super(new b(l.workerUrl||"/build/micro-mongo-server-worker.js",{type:"module"}))}_attach(){this.worker.onmessage=this._handleMessage,this.worker.onerror=this._handleError}_post(l){this.worker.postMessage(l)}_terminateImpl(){this.worker.terminate()}}class Ql extends vl{constructor(l){super(l)}_attach(){this.worker.on("message",this._handleMessage),this.worker.on("error",this._handleError),this.worker.on("exit",l=>{0===l||this._terminating||this._handleError(new Error(`Worker stopped with exit code ${l}`))})}_post(l){this.worker.postMessage(l)}_terminateImpl(){return this.worker.terminate()}}export{K as BadValueError,R as BulkWriteError,e as CannotCreateIndexError,zl as ChangeStream,V as CursorError,y as CursorNotFoundError,X as DuplicateKeyError,d as ErrorCodes,u as IndexError,n as IndexExistsError,W as IndexNotFoundError,s as InvalidNamespaceError,N as MongoClient,m as MongoDriverError,c as MongoError,r as MongoNetworkError,i as MongoServerError,o as NamespaceError,h as NamespaceNotFoundError,I as NotImplementedError,L as ObjectId,Y as OperationNotSupportedError,p as QueryError,a as TypeMismatchError,t as ValidationError,vl as WorkerBridge,G as WriteError};
//# sourceMappingURL=micro-mongo-browser.min.js.map
