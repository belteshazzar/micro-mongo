# Build Guide

micro-mongo uses [Vite](https://vitejs.dev/) as its build tool for creating optimized production bundles.

## Build Scripts

```bash
# Build everything (clean + dev + minified versions)
npm run build

# Build only unminified versions
npm run build:dev

# Build only minified versions  
npm run build:min

# Clean build directory
npm run build:clean
```

## Build Outputs

The build process creates the following files in the `build/` directory:

### ES Module Format
- `micro-mongo-{version}.js` - Unminified ES module (for development)
- `micro-mongo-{version}.min.js` - Minified ES module (for production)
- `*.js.map` - Source maps for debugging

### UMD Format  
- `micro-mongo-{version}.umd.js` - Unminified UMD bundle (browser global/AMD/CommonJS)
- `micro-mongo-{version}.min.umd.js` - Minified UMD bundle
- `*.umd.js.map` - Source maps for debugging

## Development

```bash
# Start development server with hot module replacement
npm run dev

# Preview production build locally
npm run preview
```

The development server starts at `http://localhost:5173` and includes an interactive test page.

## Using Built Files

### In Browser (ES Modules)
```html
<script type="module">
  import { MongoClient, ObjectId } from './build/micro-mongo-1.1.3.min.js';
  
  const client = await MongoClient.connect();
  const db = client.db('myapp');
  // ... use the database
</script>
```

### In Browser (UMD)
```html
<script src="./build/micro-mongo-1.1.3.min.umd.js"></script>
<script>
  const { MongoClient, ObjectId } = MicroMongo;
  // ... use the database
</script>
```

### In Node.js
```javascript
import { MongoClient, ObjectId } from './build/micro-mongo-1.1.3.min.js';
// or use the unminified version for better debugging
```

## Configuration

### vite.config.js
Main configuration for unminified builds. Produces ES and UMD formats with source maps.

### vite.config.min.js  
Configuration for minified builds. Uses Terser for compression while preserving console logs.

## Build Size

Current build sizes (version 1.1.3):

| File | Size (uncompressed) | Size (gzip) |
|------|---------------------|-------------|
| ES Module (dev) | ~887 KB | ~167 KB |
| ES Module (min) | ~449 KB | ~108 KB |
| UMD (dev) | ~940 KB | ~167 KB |
| UMD (min) | ~449 KB | ~108 KB |

## Dependencies

Build dependencies are bundled into the output files:
- `de9im` - Geospatial operations
- `stemmer` - Text stemming for text indexing

## Customizing the Build

To modify the build configuration:

1. Edit `vite.config.js` for unminified builds
2. Edit `vite.config.min.js` for minified builds
3. Update output formats, file names, or minification settings as needed

## Troubleshooting

### Build fails with module errors
Make sure all dependencies are installed:
```bash
npm install
```

### Large bundle size
The library includes geospatial and text search capabilities which add to the size. Consider creating a lighter build by removing unused features if needed.

### Source maps missing
Source maps are generated by default. Check the build output directory for `*.map` files.
